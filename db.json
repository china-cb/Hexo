{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/avatar.png","path":"images/avatar.png","modified":0,"renderable":0},{"_id":"source/images/DesignPatterns/bridge.png","path":"images/DesignPatterns/bridge.png","modified":0,"renderable":0},{"_id":"source/images/DesignPatterns/Prototype.png","path":"images/DesignPatterns/Prototype.png","modified":0,"renderable":0},{"_id":"source/images/DesignPatterns/Singleton.png","path":"images/DesignPatterns/Singleton.png","modified":0,"renderable":0},{"_id":"source/images/DesignPatterns/factory.png","path":"images/DesignPatterns/factory.png","modified":0,"renderable":0},{"_id":"source/images/DesignPatterns/builder.png","path":"images/DesignPatterns/builder.png","modified":0,"renderable":0},{"_id":"source/images/Framework/001.png","path":"images/Framework/001.png","modified":0,"renderable":0},{"_id":"source/images/Framework/002.png","path":"images/Framework/002.png","modified":0,"renderable":0},{"_id":"source/images/Framework/003.png","path":"images/Framework/003.png","modified":0,"renderable":0},{"_id":"source/images/Framework/004.png","path":"images/Framework/004.png","modified":0,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/js/affix.js","path":"js/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/exturl.js","path":"js/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/js.cookie.js","path":"js/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/post-details.js","path":"js/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/scroll-cookie.js","path":"js/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/scrollspy.js","path":"js/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"source/images/Framework/005.png","path":"images/Framework/005.png","modified":0,"renderable":0},{"_id":"source/images/Framework/006.png","path":"images/Framework/006.png","modified":0,"renderable":0},{"_id":"source/images/Framework/008.png","path":"images/Framework/008.png","modified":0,"renderable":0},{"_id":"source/images/Framework/007.png","path":"images/Framework/007.png","modified":0,"renderable":0},{"_id":"source/images/Framework/009.png","path":"images/Framework/009.png","modified":0,"renderable":0},{"_id":"source/images/Framework/010.png","path":"images/Framework/010.png","modified":0,"renderable":0},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1}],"Cache":[{"_id":"themes/next/.all-contributorsrc","hash":"a5a536579490546f2275da03765738ceabe45584","modified":1564464274364},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1564464274364},{"_id":"themes/next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1564464274364},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1564464274364},{"_id":"themes/next/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1564464274364},{"_id":"themes/next/.gitignore","hash":"b80cec1d5e6a73d1cec382aad8046d1352a1e963","modified":1564464274364},{"_id":"themes/next/.travis.yml","hash":"3d1dc928c4a97933e64379cfde749dedf62f252c","modified":1564464274364},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1564464274364},{"_id":"themes/next/README.md","hash":"2fcc7621e898732ef7976b89ca2511f84c577c35","modified":1564464274364},{"_id":"themes/next/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1564464274364},{"_id":"themes/next/_config.yml","hash":"97060d0092a8ae66fffe0fb1d2364006e4530cb8","modified":1564476711754},{"_id":"themes/next/bower.json","hash":"e6a80b9ed2d618d1cca5781952c67167a7cfac07","modified":1564464274364},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1564464274364},{"_id":"themes/next/gulpfile.coffee","hash":"d2bf238ee4bdd6a3df9dd747396ff7a576d50c59","modified":1564464274364},{"_id":"themes/next/package.json","hash":"abefbba4150026ec8b3d8e79c7e874964bd3dc76","modified":1564464274364},{"_id":"source/_posts/2016-12-09-factory .md","hash":"10c0656685b8bf44bebfe65c2d3387e2138028b2","modified":1562313355000},{"_id":"source/_posts/2016-12-16-builder.md","hash":"34f84fb7cad9ba40113d8ed363047e4aa4948ff2","modified":1562313355000},{"_id":"source/_posts/2016-12-10-singleton.md","hash":"2fbe3a4c59522e8b740efa121b60c6d4b303c055","modified":1562313355000},{"_id":"source/_posts/2017-03-09-bridge.md","hash":"a8a95ba608e0c279e74bb28ab3f47145947f191d","modified":1562313355000},{"_id":"source/_posts/2017-03-21-flyweight.md","hash":"0568dd6ec339393356d88c25d69931676760bbbd","modified":1562313355000},{"_id":"source/_posts/2016-12-22-prototype.md","hash":"baa5636bb618f9ff1011b0843897e26b4d7ffb7f","modified":1562313355000},{"_id":"source/_posts/2017-03-22-facade.md","hash":"45bbd7616aa34a949a6652dbeeed18794ec3019f","modified":1562313355000},{"_id":"source/_posts/2017-03-25-adapter.md","hash":"22a660fbfbbf99bf31d8e1c8f67487d2a0087c3b","modified":1562313355000},{"_id":"source/_posts/2017-03-26-decorator.md","hash":"00bd011e9ca47d330eafa5e86263903331f4c852","modified":1562313355000},{"_id":"source/_posts/2017-03-28-proxy.md","hash":"806670faa50e8c34a4e8c19e57c072798f157800","modified":1562313355000},{"_id":"source/_posts/2017-03-27-composite.md","hash":"5580eed09caa4f6f7558cdde518f87132378e75d","modified":1562313355000},{"_id":"source/_posts/2017-03-29-filter.md","hash":"c14d1e8c58846b4502d73e4e45348b3327fabcfc","modified":1562313355000},{"_id":"source/_posts/2017-03-31-strategy.md","hash":"8f9fbeafc8ce47193dbbbcf7ce4e9560ecc82e93","modified":1562313355000},{"_id":"source/_posts/2017-03-30-template.md","hash":"b6720ffe22b035a4ba27eb88fac6be56ea113291","modified":1562313355000},{"_id":"source/_posts/2017-04-04-state.md","hash":"2eb101e99507bc53c9b8a559d5b59a6539105d1f","modified":1562313355000},{"_id":"source/_posts/2017-04-05-observer.md","hash":"1dfa514df610cff544144f1a62c6c3b7b562cb2b","modified":1562313355000},{"_id":"source/_posts/2017-04-09-visitor.md","hash":"df2186e3cb8a1430dc9c3889d68ccbde59111f0d","modified":1562313355000},{"_id":"source/_posts/2017-04-06-chainOfResponsibility.md","hash":"815ad5f58231b875210e7dab86d631cf5d40393d","modified":1562313355000},{"_id":"source/_posts/2017-04-20-interpreter.md","hash":"450c30f9697dea1d9a6b98398bc93e4fde1a2d5a","modified":1562313355000},{"_id":"source/_posts/2017-04-23-memento.md","hash":"5edc957a59f9f7e05dc3f674132f0776014a1980","modified":1562313355000},{"_id":"source/_posts/2017-04-25-command.md","hash":"f9e12c91b82a821836a6310b8d8a26c678fef342","modified":1562313355000},{"_id":"source/_posts/2017-04-26-iterator.md","hash":"e75dabe73e788d2be87c41d94eef04d392e53b52","modified":1562313355000},{"_id":"source/_posts/2017-04-27-mediator.md","hash":"3cddf6137a32f9ff031475683d3e420f2d4df337","modified":1562313355000},{"_id":"source/_posts/2017-05-01-nullObject.md","hash":"59ea681e22b3861b531d89235f2997268ba7c827","modified":1562313355000},{"_id":"source/_posts/2017-05-13-mysqlView.md","hash":"dbb93007bcccec062243094d4ff6c0ee88ae8c79","modified":1562313355000},{"_id":"source/_posts/2017-05-14-javascriptTechnic.md","hash":"cc75b109cce2e8066f3304ab452b358dad7e91e0","modified":1562313355000},{"_id":"source/_posts/2017-05-10-mysqlStoredProcedure.md","hash":"5f8472908ad36f8f07579662ce88d6b679fea479","modified":1562313355000},{"_id":"source/_posts/2017-05-30-clusteredIndex.md","hash":"f7d577609d3e48b23539dff27272335f974b1b6d","modified":1562313355000},{"_id":"source/_posts/2017-06-19-conversion.md","hash":"45fbc75efb897c7890f47be20fd1f3780e90ee34","modified":1562313355000},{"_id":"source/_posts/2017-08-20-transactionOne.md","hash":"26539759e0e64976733401c1f6f79b8fb595f787","modified":1562313355000},{"_id":"source/_posts/2017-07-19-fpm.md","hash":"00028c31e033cc5df731f5ca1794a2e65b148943","modified":1562313355000},{"_id":"source/_posts/2017-10-28-transactionTwo.md","hash":"ba46310fc271637e218d90d15e49cbd8a9150875","modified":1562313355000},{"_id":"source/_posts/2017-2-05-FindNumber .md","hash":"996621bb0030167477b29d8b47a99383ffdae77d","modified":1562313355000},{"_id":"source/_posts/2018-03-12-Laradock .md","hash":"d96a108b0675853f2faea008feb7a1cef1427997","modified":1562313355000},{"_id":"source/_posts/2018-06-27-OutOfMemory.md","hash":"00b0eb1071864475e2260e7cd665cb385e37322d","modified":1562313355000},{"_id":"source/_posts/2018-06-12-VPS.md","hash":"6e52d1d7d1ed1c8ce9db5c7e54c80ea0031e84ee","modified":1562313355000},{"_id":"source/_posts/2018-10-13-SAPI.md","hash":"08de558c23d6bea6cfe4eac0e267c9655ac4c829","modified":1562313355000},{"_id":"source/_posts/2018-08-20-PhpExtensions.md","hash":"749035965ba0d97f4448acfb809faf9a11e13387","modified":1562313355000},{"_id":"source/_posts/2019-06-06-HEXO.md","hash":"0329ddca257f85707309c07464c3da20a6493e8c","modified":1562313355000},{"_id":"source/_posts/2018-11-17-ZVAL.md","hash":"bcc8ef30eff074b076b8da76ac714a9a31bb285b","modified":1562313355000},{"_id":"source/_posts/2019-06-05-manjaro.md","hash":"c35663dcbab26369163c45628e4ce0421543e98d","modified":1562313355000},{"_id":"source/_posts/2019-06-18-TechnicalArchitectureofLargeWebsite01.md","hash":"1b59bfaa0271155f514bec7cbc08bf55277203b8","modified":1562313355000},{"_id":"source/_posts/2019-06-23-ubuntu.md","hash":"b4deb53f3c28cf804dc414f9dfa00f6b0d39853a","modified":1562313355000},{"_id":"source/categories/index.md","hash":"b812e70069deb633a9e294e061faf1521baa67b7","modified":1562313355000},{"_id":"source/_posts/2019-06-24-k8sVSswarm.md","hash":"9e71203e44b35678da80a231b4a0a22af8f4f2cf","modified":1562313355000},{"_id":"source/_posts/2019-07-05-REST,GraphQL,Webhooks,gRPC.md","hash":"d279c7085830a4104b5d93669a7d5883dfc92f63","modified":1562313355000},{"_id":"source/tags/index.md","hash":"8cc8bfd43300a669333f9bffb7dc849b3709c904","modified":1562313355000},{"_id":"source/images/avatar.png","hash":"5a6c9030615ed963ae675734ff42291c8fd876db","modified":1562313355000},{"_id":"themes/next/.git/FETCH_HEAD","hash":"bbbbd81005f803e331f4c67dc62e4c60648290d0","modified":1564464274364},{"_id":"source/_posts/2016-12-13-ReverseString.md","hash":"a1738b57585fcd0d5e36c37c5870e861250a0955","modified":1562313355000},{"_id":"themes/next/.git/config","hash":"3aa58ad32c5b537b7b64d00c59cc2787e74a3fd2","modified":1564464274360},{"_id":"themes/next/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1564464274348},{"_id":"themes/next/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1564464274364},{"_id":"themes/next/.git/ORIG_HEAD","hash":"1ec44d7307f5ffc005e24129424d1141405d473a","modified":1564464274364},{"_id":"themes/next/.git/packed-refs","hash":"4d2d4abefe5a1cf2eced89672b8a57a554a3a8f2","modified":1564464274360},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"c149f003d03501565e7688915cd8f2e99fbf8f42","modified":1564464274364},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"d366609651386c65ee842d47d10d7cf971790383","modified":1564464274364},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"00c25366764e6b9ccb40b877c60dc13b2916bbf7","modified":1564464274364},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"3239625bb2573e61f7bcce27a74882a9ff7021e9","modified":1564464274364},{"_id":"themes/next/.github/auto_assign.yml","hash":"cb68a1dca1c4623448c2ca899614a9f21df1b036","modified":1564464274364},{"_id":"themes/next/.github/config.yml","hash":"8a5cbf5aa9529390fe0a782758aca9c3a02f9dcf","modified":1564464274364},{"_id":"themes/next/.github/eslint-disable-bot.yml","hash":"16541fb7b80f5ab90135db96285badb63c4d7d3e","modified":1564464274364},{"_id":"themes/next/.github/lock.yml","hash":"585d2c471047be320aa62f2b74dad797bf09c530","modified":1564464274364},{"_id":"themes/next/.github/mergeable.yml","hash":"0ee56e23bbc71e1e76427d2bd255a9879bd36e22","modified":1564464274364},{"_id":"themes/next/.github/release-drafter.yml","hash":"c9fdbbdf712327a8ae1ed5972973a75802e245bc","modified":1564464274364},{"_id":"themes/next/.github/stale.yml","hash":"41bf97ee86b8940a0b2e754499ec77fd2b44b717","modified":1564464274364},{"_id":"themes/next/.github/support.yml","hash":"d75db6ffa7b4ca3b865a925f9de9aef3fc51925c","modified":1564464274364},{"_id":"themes/next/.github/topissuebot.yml","hash":"10665bf2b5aba351725715c71e94ad183a0e8f18","modified":1564464274364},{"_id":"themes/next/.github/weekly-digest.yml","hash":"404e4ccb7fcd6587bc9b0247a7a7ff256d21f2cb","modified":1564464274364},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1564464274364},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"4094dab82cbdfdd0de117e94b508bbd5ceb3d363","modified":1564464274364},{"_id":"themes/next/docs/DATA-FILES.md","hash":"290237970f023ad1345dcb8825fe3004de69900c","modified":1564464274364},{"_id":"themes/next/docs/INSTALLATION.md","hash":"5385246ab4756e3e26ec9fe1f6a6759812177cc4","modified":1564464274364},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"1fb2c852fad03b73882069f1ec0659db2e1f2da0","modified":1564464274364},{"_id":"themes/next/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1564464274364},{"_id":"themes/next/docs/MATH.md","hash":"026d2cff73c22a30ea39c50783557ff4913aceac","modified":1564464274364},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"a07ca23c38f6e4dddd4b74016b30e88cd3796f75","modified":1564464274364},{"_id":"themes/next/languages/de.yml","hash":"88dcfa3e53cef1b7f858f98ca9f980179169ae4c","modified":1564464274368},{"_id":"themes/next/languages/default.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1564464274368},{"_id":"themes/next/languages/en.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1564464274368},{"_id":"themes/next/languages/es.yml","hash":"a5203c7bbae70bc40f2ee526f9e8105ca9be851e","modified":1564464274368},{"_id":"themes/next/languages/fa.yml","hash":"cc1f3a13e020e2cc666ddc57aaebc4c1ebd669d0","modified":1564464274368},{"_id":"themes/next/languages/fr.yml","hash":"c1e2e892c678920854e1f3df409118398523849e","modified":1564464274368},{"_id":"themes/next/languages/hu.yml","hash":"3b4c10c86a228da70dc4b1a1784a6f942e186032","modified":1564464274368},{"_id":"themes/next/languages/id.yml","hash":"3a9f4485e6801e0e6fae749133a52e3797760795","modified":1564464274368},{"_id":"themes/next/languages/it.yml","hash":"28ff9197a3d21e838e33bb026d8adb544320cb1a","modified":1564464274368},{"_id":"themes/next/languages/ja.yml","hash":"8f85a6500716191159f16c7f484ba61ddd16eeb6","modified":1564464274368},{"_id":"themes/next/languages/ko.yml","hash":"1df31bf037bcb6868a4bd60c49ff55eec5b8167f","modified":1564464274368},{"_id":"themes/next/languages/nl.yml","hash":"6f4a339ecc67a140f3f9c7bec369cbda6b45afd7","modified":1564464274368},{"_id":"themes/next/languages/pt-BR.yml","hash":"301a0535df5de7b585c7c9752053c41c6ef26f9b","modified":1564464274368},{"_id":"themes/next/languages/pt.yml","hash":"6d87701443e33a13574049e613f064f1eb250c95","modified":1564464274368},{"_id":"themes/next/languages/ru.yml","hash":"93872ac01074159566ee3e1738eea6e9216bab8e","modified":1564464274368},{"_id":"themes/next/languages/tr.yml","hash":"5489606e6c40c0b226a3414c8e5037aac965211d","modified":1564464274368},{"_id":"themes/next/languages/uk.yml","hash":"765ba405778f07d7ec3713606568852b04e1a862","modified":1564464274368},{"_id":"themes/next/languages/vi.yml","hash":"6a812db8606498980cd64f001e9ef2f50e124809","modified":1564464274368},{"_id":"themes/next/languages/zh-CN.yml","hash":"f311ad2cc2edba144764c36c0035b6ed0d356a53","modified":1564464274368},{"_id":"themes/next/languages/zh-HK.yml","hash":"7a5e47f561d4b6e132f7f3b09676afbf8520264e","modified":1564464274368},{"_id":"themes/next/languages/zh-TW.yml","hash":"3f3674cac8f47a9a509a7557ea1557bbfbd027e8","modified":1564464274368},{"_id":"themes/next/layout/_layout.swig","hash":"cb2e72663fb9666f5ac3c6bb3200d2e4e9731988","modified":1564464274368},{"_id":"themes/next/layout/archive.swig","hash":"014ea0b7bfbfd9bd35b0d45ee3cc04aec41bb445","modified":1564464274380},{"_id":"themes/next/layout/category.swig","hash":"fec1c414902fb40887054f0cd93f924bb3969e63","modified":1564464274380},{"_id":"themes/next/layout/index.swig","hash":"8cf3451dd2d5727920b351a8f5eefdddb5bf3638","modified":1564464274380},{"_id":"themes/next/layout/post.swig","hash":"4291b34b17fc6f1c06eb69852c894913e889a774","modified":1564464274380},{"_id":"themes/next/layout/page.swig","hash":"1b63e55834ac09fc49e92072d308e4b5028e07fd","modified":1564464274380},{"_id":"themes/next/layout/schedule.swig","hash":"3268dd3d90d8b0e142cfa1a2ebb23355baeda148","modified":1564464274380},{"_id":"themes/next/layout/tag.swig","hash":"2e72753be05d6b19795885f31831528366015399","modified":1564464274380},{"_id":"themes/next/scripts/injects-point.js","hash":"6661c1c91c7cbdefc6a5e6a034b443b8811235a1","modified":1564464274384},{"_id":"themes/next/scripts/injects.js","hash":"c5105d36b0e7aad849b87bcca06bf8f1e22dfd65","modified":1564464274384},{"_id":"themes/next/scripts/merge-configs.js","hash":"e122d11e00c826a5472897726ec6420651778964","modified":1564464274384},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1564464274392},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1564464274392},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1564464274392},{"_id":"themes/next/.git/index","hash":"8a04eca1f244137e0eef9b01b836460d63850b3a","modified":1564478762195},{"_id":"themes/next/docs/AUTHORS.md","hash":"9b6dea4c6ad89b1cf588251e0886c028d8f427e2","modified":1564464274364},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1564464274392},{"_id":"source/images/DesignPatterns/bridge.png","hash":"98cb088c18553297abbabffc47556197545cb8e7","modified":1562313355000},{"_id":"source/images/DesignPatterns/Prototype.png","hash":"7be3f999649b0b4bbd498aed9b0379723236a47a","modified":1562313355000},{"_id":"source/images/DesignPatterns/Singleton.png","hash":"076e2e7720e14cd5550a79d7e2835c7adde498a5","modified":1562313355000},{"_id":"source/images/DesignPatterns/factory.png","hash":"71e5addd9a07503f0be759dfe52637076d92d203","modified":1562313355000},{"_id":"source/images/DesignPatterns/builder.png","hash":"1515b51a8bb0caaabe282b653479e9894296c96e","modified":1562313355000},{"_id":"source/images/Framework/001.png","hash":"c8ffabe9097cea99b6df358cb887234a73974eb0","modified":1562313355000},{"_id":"source/images/Framework/002.png","hash":"4ec42f12bc42db7c4c22ffb58e7912badbbf3ecf","modified":1562313355000},{"_id":"source/images/Framework/003.png","hash":"45c5821cc6f8404dc878d802c7b97e1bce56563f","modified":1562313355000},{"_id":"source/images/Framework/004.png","hash":"13f3657d2fc6fd6963198bbacbbe0bf9278bd0fb","modified":1562313355000},{"_id":"themes/next/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1564464274348},{"_id":"themes/next/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1564464274348},{"_id":"themes/next/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1564464274348},{"_id":"themes/next/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1564464274348},{"_id":"themes/next/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1564464274348},{"_id":"themes/next/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1564464274348},{"_id":"themes/next/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1564464274348},{"_id":"themes/next/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1564464274348},{"_id":"themes/next/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1564464274348},{"_id":"themes/next/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1564464274348},{"_id":"themes/next/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1564464274348},{"_id":"themes/next/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1564464274348},{"_id":"themes/next/.git/logs/HEAD","hash":"6f94709c2fa195063500035349c71d93bbfe8457","modified":1564464274360},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"c37a60580c901c79ccb22564b228a46e06207445","modified":1564464274364},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"07c423cce4157b8e2dbf60907ccbf3f18c4cf98a","modified":1564464274364},{"_id":"themes/next/.github/ISSUE_TEMPLATE/custom-issue-template.md","hash":"57e1e06e845193e80c7df4a4454af28352526f7a","modified":1564464274364},{"_id":"themes/next/.github/ISSUE_TEMPLATE/non-english.md","hash":"0b0727ff4d5180ae67f930fb4f8e9488e33eda9f","modified":1564464274364},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"67d04e3e29a2675d1a9f87d1ae6ea0769e963ff1","modified":1564464274364},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"6c5d69e94961c793da156217ecf1179e868d7ba1","modified":1564464274364},{"_id":"themes/next/docs/ru/README.md","hash":"932d3965d8b1a1ff653c07a0cafcdbf5892d6945","modified":1564464274364},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"b1dd18d9b890b21718883ea1832e7e02a773104a","modified":1564464274364},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"caa624092175d44e3d3a8c6ca23922718da2354c","modified":1564464274364},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"0dfb458370a0ffbbe37c00f53c15e3aa3e79b125","modified":1564464274364},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"c46f3f7496fc422207cc5954e10a2bc972b650aa","modified":1564464274368},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"c13546dd70a99a7d2d409cddf5d59f2f4d4d44a4","modified":1564464274368},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"c9407e4545340cbf001fabe529e3f0e305effca4","modified":1564464274368},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"e568a1b3c532e0ecf33cc237e1425b2579bd006d","modified":1564464274368},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"83feca62190abcca0332915ffe0eefe582573085","modified":1564464274368},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"ba918bbd8faf32c28335693f03ff37c6acaff7f3","modified":1564464274368},{"_id":"themes/next/docs/zh-CN/README.md","hash":"79a73361b24e7fb7022992702961faacd6a2f9fe","modified":1564464274368},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"78f4f989346763b799397f4a3ff398b69ffc48fc","modified":1564464274368},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"20f881a8ee2a73ebbc8ef7ef25a188e3ce2cc6ec","modified":1564464274368},{"_id":"themes/next/layout/_macro/post.swig","hash":"9073f65218fe7c537e51fa60816362ee8c09f42f","modified":1564464274368},{"_id":"themes/next/layout/_partials/comments.swig","hash":"f83bf66ca79aa6a9d450de8ab5c3f19ff1f94e54","modified":1564464274368},{"_id":"themes/next/layout/_partials/github-banner.swig","hash":"40e940c3213b74933e529cd64f64c1f6f512b5ca","modified":1564464274368},{"_id":"themes/next/layout/_partials/footer.swig","hash":"748fcb5687c2340285e5a8a82bf3f361d55ee925","modified":1564464274368},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"769a983fe2f77908bfc8590ff37a0d8958b47598","modified":1564464274368},{"_id":"themes/next/layout/_partials/post-edit.swig","hash":"4b0c972c44bfa7ab07604280563deb9cc3974657","modified":1564464274368},{"_id":"themes/next/layout/_scripts/exturl.swig","hash":"571115ef5f06e5d937c2d3c7cb26727f43c7feed","modified":1564464274380},{"_id":"themes/next/layout/_scripts/next-boot.swig","hash":"283e78eb795f52236026434dab6a0667f14d3c08","modified":1564464274380},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"edaff4766e0c05fd5c889d9dd32884d376bef9d9","modified":1564464274380},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"e3c54ae7eca24a85148ec3bfb6712abf07c418c9","modified":1564464274380},{"_id":"themes/next/layout/_scripts/scroll-cookie.swig","hash":"20aa27fff30f703baea578e08b18d16d59ebf27e","modified":1564464274384},{"_id":"themes/next/layout/_scripts/three.swig","hash":"216849ad2503f578839c500ede529744a3abaf03","modified":1564464274384},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"b7a906521afd8cca1d425066192ef68e544be728","modified":1564464274384},{"_id":"themes/next/layout/_third-party/baidu-push.swig","hash":"5284f8db105f22732a6e3637a6a779d43d069935","modified":1564464274384},{"_id":"themes/next/layout/_third-party/bookmark.swig","hash":"df96a541f092eb195b103cb28fbe8881b9c2f73c","modified":1564464274384},{"_id":"themes/next/layout/_third-party/facebook-sdk.swig","hash":"e7103dc133c8a6109e2a2e086c8e65ac80dbf6bb","modified":1564464274384},{"_id":"themes/next/layout/_third-party/index.swig","hash":"ede1e5947d2bace914bf42cf8623ab7cf5168eb0","modified":1564464274384},{"_id":"themes/next/layout/_third-party/quicklink.swig","hash":"ccef9c8ef5406a33af56fe5493492ee8ac2bb965","modified":1564464274384},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"731018cc1ed976904770d515c48ae90e07a4219f","modified":1564464274384},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"1e8d58919cb30b2553282a12b5293af6e9b3e1f1","modified":1564464274384},{"_id":"themes/next/layout/_third-party/vkontakte-api.swig","hash":"adb0d6e0e4c0480b2c1249d0f5963d0de64c6721","modified":1564464274384},{"_id":"themes/next/scripts/helpers/engine.js","hash":"60eb1554456d9d0e5afc4a2d16f1580a0aa02da8","modified":1564464274384},{"_id":"themes/next/scripts/helpers/font.js","hash":"f8cdf3a1cd91cf1ec8283f0c8a8462c6bb469949","modified":1564464274384},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"799a042bbf497a4c7a2981aa2014ff28fa1bb382","modified":1564464274384},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"ed8b2871c10d7d1128bda48582997a4b926290de","modified":1564464274384},{"_id":"themes/next/scripts/filters/lazyload.js","hash":"3d424ad75b1431f57f8d1d0218b2a06ecc0a6e70","modified":1564464274384},{"_id":"themes/next/scripts/filters/exturl.js","hash":"79ad823ca803cb00e0bfc648aa6c9d59711e0519","modified":1564464274384},{"_id":"themes/next/scripts/filters/minify.js","hash":"727f49b825ddd4c8727f5fc6de146beecc083b87","modified":1564464274384},{"_id":"themes/next/source/css/main.styl","hash":"b11b2689eb36242ef088deb377946023559f5587","modified":1564464274388},{"_id":"themes/next/scripts/tags/full-image.js","hash":"149de45ff83403e97f6affa280072392dca42e4f","modified":1564464274384},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"c3554972bfb081f8b23046bc3198c0bd31b4c443","modified":1564464274384},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"f13430d9d1c9773b390787c2f046bb1f12a79878","modified":1564464274384},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"8fc05f22b88553bc1d96e0c925799cd97920fc6a","modified":1564464274384},{"_id":"themes/next/scripts/tags/include-raw.js","hash":"5db59d56f4f4082382bf1c16722e6c383892b0c5","modified":1564464274384},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"983c6c4adea86160ecc0ba2204bc312aa338121d","modified":1564464274384},{"_id":"themes/next/scripts/tags/label.js","hash":"fc5b267d903facb7a35001792db28b801cccb1f8","modified":1564464274384},{"_id":"themes/next/scripts/tags/note.js","hash":"0a02bb4c15aec41f6d5f1271cdb5c65889e265d9","modified":1564464274384},{"_id":"themes/next/scripts/tags/pdf.js","hash":"f780cc72bff91d2720626e7af69eed25e9c12a29","modified":1564464274384},{"_id":"themes/next/scripts/tags/tabs.js","hash":"00ca6340d4fe0ccdae7525373e4729117775bbfa","modified":1564464274384},{"_id":"themes/next/scripts/tags/video.js","hash":"e5ff4c44faee604dd3ea9db6b222828c4750c227","modified":1564464274384},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1564464274392},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1564464274392},{"_id":"themes/next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1564464274392},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1564464274392},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1564464274392},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1564464274392},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1564464274392},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1564464274392},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1564464274392},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1564464274392},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1564464274392},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1564464274392},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1564464274392},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1564464274392},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1564464274392},{"_id":"themes/next/source/js/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1564464274392},{"_id":"themes/next/source/js/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1564464274392},{"_id":"themes/next/source/js/algolia-search.js","hash":"c980038cbf83b89bad9051a29737bebc5dc27129","modified":1564464274392},{"_id":"themes/next/source/js/js.cookie.js","hash":"7919f3a96e156ca52e59b61266468f9f2a2eb97e","modified":1564464274392},{"_id":"themes/next/source/js/local-search.js","hash":"eaa8235957cb37540cddf6b8650b7d46db23dc1a","modified":1564464274392},{"_id":"themes/next/source/js/motion.js","hash":"ca2965da47ba9fc5b0dde0a825c29e0817b965b9","modified":1564464274392},{"_id":"themes/next/source/js/next-boot.js","hash":"0f5eeabac85b693be73b6af74fd7493b6e493b91","modified":1564464274392},{"_id":"themes/next/source/js/post-details.js","hash":"a614a3830f7dfcd4df303c1255d558a135b3854e","modified":1564464274392},{"_id":"themes/next/source/js/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1564464274392},{"_id":"themes/next/source/js/scrollspy.js","hash":"8b40c2f8f1e2bdafe555ce3304842e62d9e39ee1","modified":1564464274392},{"_id":"themes/next/source/js/utils.js","hash":"805615855c267882d8802e75c5134904ea18288e","modified":1564464274392},{"_id":"source/images/Framework/005.png","hash":"5e8b8aed169cfca314d335eb4b3dc102634d8a5e","modified":1562313355000},{"_id":"source/images/Framework/006.png","hash":"7d3d83d40c22143bef1e008ff82898a20c87e88a","modified":1562313355000},{"_id":"source/images/Framework/008.png","hash":"3bb296ad0ab56c9704a1bf0ab077f327a5cff5f1","modified":1562313355000},{"_id":"source/images/Framework/007.png","hash":"646e4d3d21603209c50fbe6aea2e983e23b213c2","modified":1562313355000},{"_id":"source/images/Framework/009.png","hash":"db046d6b4dc66fdbb62ac8f94000979b596e4c14","modified":1562313355000},{"_id":"source/images/Framework/010.png","hash":"6d9e6905fdb6644f9472fc770ac6227840af8003","modified":1562313355000},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1564464274388},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1564464274388},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1564464274392},{"_id":"themes/next/scripts/tags/button.js","hash":"f3b4f7ae7e58072bbf410d950a99a0b53cbc866d","modified":1564464274384},{"_id":"themes/next/.git/refs/heads/master","hash":"1ec44d7307f5ffc005e24129424d1141405d473a","modified":1564464274348},{"_id":"themes/next/layout/_macro/menu/menu-badge.swig","hash":"9e959646899a1dd381c0bea870408cd392c93c70","modified":1564464274368},{"_id":"themes/next/layout/_macro/menu/menu-item.swig","hash":"c4b490637738a4436b5189ef9ee4e2cd1f35e83d","modified":1564464274368},{"_id":"themes/next/layout/_partials/analytics/cnzz-analytics.swig","hash":"847664d2dea3d51ac87b3e3d504b4e4d94cbd177","modified":1564464274368},{"_id":"themes/next/layout/_partials/analytics/busuanzi-counter.swig","hash":"6bb2a2262a6c703345343c7b200c52a8ef798c30","modified":1564464274368},{"_id":"themes/next/layout/_partials/analytics/tencent-mta.swig","hash":"e94186ff2085fc96c34f51a920c5bbc3e0dec659","modified":1564464274368},{"_id":"themes/next/layout/_partials/analytics/tencent-analytics.swig","hash":"050ff8113af88e498f49a623799b526736852d6e","modified":1564464274368},{"_id":"themes/next/layout/_partials/analytics/index.swig","hash":"2925f6353934b1b2adc2808059e64dd7d220edd7","modified":1564464274368},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"e72a509cfb2d9ce28e29e5cbcb2c9fd88e3d011e","modified":1564464274368},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"8dd7ac5ccc52848b3d0fb0f102874c1a8c1c45b6","modified":1564464274368},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"f7cf6bebca5f9513af9429c14bd3180fd398a1a9","modified":1564464274368},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"c5b7c0b919ab5be3093ae9d5921e2eb2c2bd320f","modified":1564464274368},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"5978624e8cc5dd900acdf1692da0ebca5542cf09","modified":1564464274368},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"a72e33e11df9d3639cdebab4f480e397c70deacb","modified":1564464274368},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"883ea1d024a8262eb8d3213de71c8ccb30daf095","modified":1564464274368},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"d3c25d70f0fd76121e4cacb9f8af4ccbe2a3c74d","modified":1564464274368},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"5730f4b891f1363cf281a07aedfad06268166a73","modified":1564464274368},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"e2549106ea26ac48019aa3f8023b8fdc78c0f6db","modified":1564464274368},{"_id":"themes/next/layout/_partials/post/reward.swig","hash":"40483139657cde24356c6a4033a6386b909327a9","modified":1564464274368},{"_id":"themes/next/layout/_partials/post/wechat-subscriber.swig","hash":"2edfaf1579ea58e15cb5583fb7962dfee9af2257","modified":1564464274368},{"_id":"themes/next/layout/_partials/search/algolia-search.swig","hash":"d9fe715fee716f78c7976c4e8838da71439ee0e0","modified":1564464274368},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"7bce91d429216724db5e337ec64cf7f05b022c97","modified":1564464274368},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1564464274380},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"15b542f5b06b7532234af367340b9ed9fcebb0ac","modified":1564464274380},{"_id":"themes/next/layout/_partials/share/index.swig","hash":"0817ccb248ed9aae64f30db792681af688e01795","modified":1564464274380},{"_id":"themes/next/layout/_partials/share/likely.swig","hash":"e106248f72abc5e9ade3554eaff2f7f69bdb8f6d","modified":1564464274380},{"_id":"themes/next/layout/_partials/share/needsharebutton.swig","hash":"09ae1250c1e142d251cc0e979097f1dd95e277bb","modified":1564464274380},{"_id":"themes/next/layout/_partials/sidebar/site-overview.swig","hash":"84a4201867c034afbf25862b63af4a582f7086b1","modified":1564464274380},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"ffc8e8836714ea79abeb77b75859634615652877","modified":1564464274380},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"5b05f165547391bf231e52f56f3d925efc09bc44","modified":1564464274380},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"108b157fbd1ac3baaf19ae87234fa8728ab79556","modified":1564464274380},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"f2ff7799baac49eb9779f66e0cd083fac70b87a2","modified":1564464274380},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"509621f1a68e7ab41193a14a2c50a21aff976f9e","modified":1564464274380},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-jquery.swig","hash":"b485797073495e24bf2f0b85880d513257bfed72","modified":1564464274384},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"5dda65656900e8006173fda95faa134fd331ec95","modified":1564464274384},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"ac4f229b1d7a56c31c1fbb4fbf9e59dde5e9d4f5","modified":1564464274384},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"7675b97e22cf9250e7b28f6f4b98b095c10918d7","modified":1564464274384},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"1618f1a5b02934d7f376633e39d9a58f43928168","modified":1564464274384},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"dd896587305d0f9c4eba5fdc31e72f56e1e4359e","modified":1564464274384},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"20fcbed44aede1b908bd17d7a0279b03639068b1","modified":1564464274384},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"6c9eb8b9c670f9693a8155d960f851603b30190c","modified":1564464274384},{"_id":"themes/next/layout/_third-party/chat/chatra.swig","hash":"fdcf006e1ba2e53eab65e901b6c63159538307ef","modified":1564464274384},{"_id":"themes/next/layout/_third-party/chat/index.swig","hash":"5ab4a8b4306c837d2f8c211a9d7fdaed76fa254d","modified":1564464274384},{"_id":"themes/next/layout/_third-party/chat/tidio.swig","hash":"cba0e6e0fad08568a9e74ba9a5bee5341cfc04c1","modified":1564464274384},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"21cbb62243061da62e037b6307e1915f78aeda37","modified":1564464274384},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"2926cf518758895973cd60fd3b878651d04950dc","modified":1564464274384},{"_id":"themes/next/layout/_third-party/comments/disqusjs.swig","hash":"d82cc93d3270dff02fb111d7a3607b26e877f740","modified":1564464274384},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"d1e1e2c5d1418d0874911912078392d7c10390cc","modified":1564464274384},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"a6f6c778d1aff774e8de8b1884ae88e711ea6676","modified":1564464274384},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"3c2d2cf3388dc8bd1450303645b8cd907baee98d","modified":1564464274384},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"4514e5e83cdfe28275dfa2aaf14b51d993065f9c","modified":1564464274384},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"079910669dcc9b0606dde15c66bfdcf1c97b8119","modified":1564464274384},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"9b173d1e72ee6a8885da1f97239a10a048bc94d6","modified":1564464274384},{"_id":"themes/next/layout/_third-party/search/algolia-search.swig","hash":"157abdff4c5fddceae5af2631b5fff202abc0e5e","modified":1564464274384},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"b2fd17688f0433571b37704bc8df798e175e7811","modified":1564464274384},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"353da7ea00400897ae920a085aa4bee2224da50d","modified":1564464274384},{"_id":"themes/next/layout/_third-party/search/swiftype.swig","hash":"ba0dbc06b9d244073a1c681ff7a722dcbf920b51","modified":1564464274384},{"_id":"themes/next/layout/_third-party/tags/index.swig","hash":"83d0a8f71878c6b96a04ba08567b9064de6cce83","modified":1564464274384},{"_id":"themes/next/layout/_third-party/tags/mermaid.swig","hash":"5d013ed1f311540155c5e8f92465a8ef409ad561","modified":1564464274384},{"_id":"themes/next/layout/_third-party/tags/pdf.swig","hash":"2a847dd60a509d9e20c22c2a8cbb51a74a023bb4","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"e62ef36efd7a54b40a3e97a465c6cea3e9f99e3f","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"f9f1091e99bdd5524f502796f200201c58fef9e3","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"25ab6f05564c90acba2723d74648432a4736b04d","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"d1d2cb68ae5f88797b74ea96a05fa912dbec0d7f","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/facebook-comments-plugin.js","hash":"325238af1c68b8eb9cf2a2c1945a627c7d804239","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"ffe96161def97f86ec6c7dcf7371d76fa73b0d5b","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"1cfb1fa780141aed8e5360ffa530bad2784b6255","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/valine.js","hash":"4f3021fbf965954e4a3a7c5d799b61f9b4b18be7","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/vkontakte.js","hash":"5ce9376efe0f63a84ac1703e19bfdb68e5119a8a","modified":1564464274384},{"_id":"themes/next/scripts/filters/comment/warn.js","hash":"33bd124bdf668f7d7ea8e3fd5ad10aa69b5625d8","modified":1564464274384},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1564464274388},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"2e8fb29aa92325df39054b5450757858c6cebc41","modified":1564464274388},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"4056cf687cf435697afe569caf3954b04ae277c9","modified":1564464274388},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"74ccaccd5810ffb497b555ec1902a43af0eb1d9e","modified":1564464274392},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"fd14b9b9e31170056d2544fb050106930b8818e4","modified":1564464274392},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"73168052a1a6efb558b4b8dc9351b8a59dd0b409","modified":1564464274392},{"_id":"themes/next/source/css/_variables/base.styl","hash":"d09d2b63ffffc0e062edf3322328ec31db175d49","modified":1564464274392},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1564464274392},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1564464274392},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1564464274392},{"_id":"themes/next/source/js/schemes/muse.js","hash":"718dae82e96269848d06d3a1de64d2ef3301139f","modified":1564464274392},{"_id":"themes/next/source/js/schemes/pisces.js","hash":"9eb63cba0327d3d11b6cbfcbe40b88e97a8378a3","modified":1564464274392},{"_id":"themes/next/source/lib/jquery/index.js","hash":"88523924351bac0b5d560fe0c5781e2556e7693d","modified":1564464274392},{"_id":"themes/next/.git/logs/refs/heads/master","hash":"6f94709c2fa195063500035349c71d93bbfe8457","modified":1564464274364},{"_id":"themes/next/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1564464274348},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"7e51ea64611ab5d678c112b4688d4db4fd2737e2","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"fe5ff961b86004a306778c7d33a85b32e5e00e48","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"1b80562eff14476a50caf84f32d58cf4c935fffb","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"b98c65006e2546fbf3870c16fbbcbc009dbaab15","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"9d71f34fa13a41b8c8cd2fbdf3fdea608385277c","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"ce60fa5adf2d63c5e0ae453d63906d9143f36b05","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"ce826aedf42b9eca424a044452f5d193866726a6","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/rainbow.styl","hash":"4741d642f9ed2eec9be23112f7a51645e77e41f3","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/scrollbar.styl","hash":"d7b8bcf2a6031296c84bb4f4ecfb037af01d2d82","modified":1564464274388},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"1cb7554a6a333d0e47b38490ec7912f334cb9662","modified":1564464274388},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"d09d13488b67a918d46cc3cca14e5c420b7962dc","modified":1564464274388},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"773f6d791f938ff037783004369092991d7bcd31","modified":1564464274388},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"7ffde343bdf10add1f052f3c4308a15180eb4404","modified":1564464274388},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1564464274388},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"33456264a74d1bba38264d14713544d67d003733","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"0bef9f0dc134215bc4d0984ba3a16a1a0b6f87ec","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"96b76bf13173273d57e8560fca1e2b97892f0fb5","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"3964c53d0f050c0ad56f9fba6a4bb2cdb79783f4","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"9451567e731765c2597a2918dca020f3ff3bf08f","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"594dcaafaf9f8c7ac9b74f11670f978f829d32c0","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"b4381d0436e0d957a97231ae093c88df8f41e153","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"1b92831aa913e8f4d6d3b2b7080a072e4087a8a2","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"80e74ceeb683fac49c165b6795829fe6209a7b7b","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"4c6a3d8f73fa817b64df136677497ff197c8a736","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"3eca3ad647e9904f447c4c801c04ecc7ce09e769","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"a8aacdb768582d60e5b79a41f3c4c191a913f377","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"75737591682a2bafa71db4c03fb79e970ac0e7aa","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"49f519e61c7bc129926f446c57773c3cca2fb65e","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"f1f049b02dd0e76a1ef25a75700be4470cbdcaf0","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"6f427a43550f7b03c503106767fbcce1f18a4f78","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"232aedbd44243b3b80c4503c947060d3269c1afc","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1564464274392},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1564464274392},{"_id":"themes/next/.git/logs/refs/remotes/origin/HEAD","hash":"6f94709c2fa195063500035349c71d93bbfe8457","modified":1564464274360},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"583140ab9839fb8dd315c6f11842cedec80fedb2","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/header/github-banner.styl","hash":"ca97f0b6990eef947039faede80c56d9c4381ee1","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"6c4990d375b640ee4551e62c48c1cbe4c3d62212","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"d6ff05b483090e5e5ec7557ef2307ba873aeb699","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6d6388df4fb4317989febd36f1c67efd0a0cf27e","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"90f0417086b822d64af78bd2b344311e1417a16e","modified":1564464274384},{"_id":"themes/next/source/css/_common/components/highlight/copy-code.styl","hash":"ee2074b6636307aa997f7797157010a3223faaeb","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"4114f1aa7546bbdf8253e261061c9d9bb0ca6c39","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"78bce0cf6dbb06ff8983311ebaa5fd3115d992d9","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"ba17bf993d3e6a4aed02e740e3a4b913d9e7409d","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"a5a881e093e1214878cb5227adfe276f680fbcc8","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"2894fd8b7a5c2263ef2af42880ee1b51d7ff66d7","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"e3124da5350d6c01f32ccd04134a686baa4fb30a","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"f0196d12925c60577f5c6849d004bf05006300c9","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"8633ea015175b547f802d9cf6adaf38896384426","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"61ca40856e5cacd48e0fa9728fde4605c7dd4c94","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"d026942bcfe16266b89acc6401eee1265893e594","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f54367c0feda6986c030cc4d15a0ca6ceea14bcb","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"c961d37190d9bec58a36306c7e716c4e72c4582f","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"df3c19fd447da6d4a807683345007a41338f9a04","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"0bf899fab331add63f0c8ead31ca3a3db2ad74d9","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"b4f073f8bcec49fe83d5a68492e122ee0979198a","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"7594bc038ca85d361c4a5e0ab0a52d4ef0401dfa","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-reading_progress.styl","hash":"3f33bb862c2aa993f54987fbb345da067b79b112","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"4bb1346515c0e23c805dea66c48b6dbcf738fc0b","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"c13cbeee926e966a08321f0fa0a48231f3a37113","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"50f650775d4e229df663f0e0a17a454ba26f1ab5","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"d5c8ffed7f2c701052b7a53abaf5ef437374ea72","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"6a8a0172ec0c57442c9af4b7b9d2e18e776c182d","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"c614bb54ba4429dc8cefeaf24e9fcc82581b48b0","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"2dd6374ee46e42b36ff172dda19cce765d2c7a4e","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"965a4896925f4c2bfdb492e1923288c91b854f2d","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"583ad80fc929d1f9db76520480a0b7add679d7af","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-button.styl","hash":"8963be62d5a767d8e9b2ee6efbc91b93cf89b396","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"987f1cdd57dd9f6f81c133c280c20d7168c37d7f","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"aa87f828baa7e552b908a5386c279f39cbfe91c9","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"eaafd5f9cdb0798347479945366b01df3dbb1c1d","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"452aab4718c2396f17438557fb897aaa11f834e1","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"38314eec8f4a2d1667e1061d7a3deb1c16f17da9","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"967fb3a3c6c851b34ec5df2d945dc266ed63d146","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"58ec00eebe68d0eebd2eea435c710063877447df","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"6ec8ea7b11a146777b6b8da0f71f0cc1dbd129df","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"c85df3ecc0b37095cac14114c308e5829c66b5a3","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"d7501ae01fc45fa15b00d1bc5233b9fffa20a3c9","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"ca7cd57bc346a3fda8097b2b49e6d943600912d2","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/tags/pdf.styl","hash":"da8d34729fb6eb0fcb8ee81e67d2be3c02bc1bc4","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"4b62818333d2463fe416fb3156ced12e7d60aafa","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"cbc0be5a3285b469858ec9ead48e2ea90bd47ae1","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"fc58498d4f5081fcf6218e9e18c5bf2328275bef","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"1156b11ac74d2d21b1b5047767b2a9edafc9182d","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"9fac89c8146eb2675721a26f528d7d0f8be7debe","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"ef66c0a08e4243a25e41408d70ca66682b8dcea1","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"988bb452f78697b6d40028c6b283d27cff0f0561","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"157d88ed4558d224f9703e0a7fe607ab0e9ae195","modified":1564464274388},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"9738e754be24c1c9f2e60bc052f6f7b1bae0322f","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/_sidebar.styl","hash":"487dbb5b389620e7be2ce666531a7baa249d50a0","modified":1564464274388},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1564464274388},{"_id":"themes/next/.git/objects/pack/pack-c147d985dde4ea9bb06d962ac696599d4d62569b.idx","hash":"560c098b5f858be061f6ec6e21dacf96abf0d237","modified":1564464274360},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1564464274392},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1564464274392},{"_id":"themes/next/.git/objects/pack/pack-c147d985dde4ea9bb06d962ac696599d4d62569b.pack","hash":"f398912ae4be8770a62f1b0c99140ffccd6904b3","modified":1564464274360},{"_id":"public/categories/index.html","hash":"38fa8d8e79518b8f548848231a7c6b99e59fd65d","modified":1564480088179},{"_id":"public/tags/index.html","hash":"fb9e65c40c6423c4c27d3df3f86ddd5458954a96","modified":1564480088179},{"_id":"public/archives/page/5/index.html","hash":"8f65072970119bae7669eace70e71e75fecc137f","modified":1564480088179},{"_id":"public/archives/2016/index.html","hash":"415e9caf7bdb0605949d0511af92cc29cd3e846c","modified":1564480088179},{"_id":"public/archives/2016/12/index.html","hash":"7483918058d228cf3d7dcf012688d55641083783","modified":1564480088179},{"_id":"public/archives/2017/02/index.html","hash":"cd9ba0bbe65c8a1ccc8c00f0d23b481b4953d3c5","modified":1564480088180},{"_id":"public/archives/2017/03/index.html","hash":"ed3c2ab1836553bb538274dabbb162ff80524d59","modified":1564480088180},{"_id":"public/archives/2017/05/index.html","hash":"dcb7216b7c523730b2133efc011472c7316d2af5","modified":1564480088180},{"_id":"public/archives/2017/06/index.html","hash":"e9a3144da4157d7628fbdde03a8f5b6e33f041d9","modified":1564480088180},{"_id":"public/archives/2017/07/index.html","hash":"ce9dbc74339a5c9595e84efd4e7db4be44e6edf4","modified":1564480088180},{"_id":"public/archives/2017/08/index.html","hash":"398dee45fc9e25da72576a0763e4ee2a18c7b664","modified":1564480088180},{"_id":"public/archives/2017/10/index.html","hash":"c978f40318c0c2caeeb9e953ba830efd4edd0352","modified":1564480088180},{"_id":"public/archives/2018/index.html","hash":"9f45ffa0de798232d04199fbea17dbcbefd46c18","modified":1564480088180},{"_id":"public/archives/2018/03/index.html","hash":"1b635db422d51713fe1eaec6c33e1bac094ce609","modified":1564480088180},{"_id":"public/archives/2018/06/index.html","hash":"692ac03f3151ac68689949894fd2bf97e497e468","modified":1564480088180},{"_id":"public/archives/2018/08/index.html","hash":"31e52929e7ecb2d69f6deee09682ab05008708e7","modified":1564480088180},{"_id":"public/archives/2018/10/index.html","hash":"98be58db57f7427a727c00321a0774238d1b5879","modified":1564480088180},{"_id":"public/archives/2018/11/index.html","hash":"15e91450f8f2da1c3c26464b112e1f0c5472a224","modified":1564480088180},{"_id":"public/archives/2019/index.html","hash":"781d5f925701bd675a7a5f2dda8c5590b74f77ce","modified":1564480088180},{"_id":"public/archives/2019/06/index.html","hash":"a88ab4e0e2c9849adee36abe6f00a6e196c41f4e","modified":1564480088180},{"_id":"public/archives/2019/07/index.html","hash":"8dc718b211e6836197a9ef3c95b2a6460ad68ba7","modified":1564480088180},{"_id":"public/categories/PHP/page/3/index.html","hash":"46e54a0d84ae0b07ec0714c264d5a098a1031d81","modified":1564480088180},{"_id":"public/categories/数据库/index.html","hash":"fe62cfe15f6bada4b4668b982638c2dace7fde17","modified":1564480088180},{"_id":"public/categories/JavaScript/index.html","hash":"87e73067134909f2671063cb6097b8fdde8fb0cc","modified":1564480088180},{"_id":"public/categories/算法/index.html","hash":"e69d0b4e8e90a8f6af41262f57fdd521d5ae3664","modified":1564480088180},{"_id":"public/categories/容器/index.html","hash":"8d69058d3b762784458c2b0e04084042a91e0109","modified":1564480088181},{"_id":"public/categories/服务器/index.html","hash":"8316a45b64df01b4c46e40fb89b19ae2971000da","modified":1564480088181},{"_id":"public/categories/系统/index.html","hash":"34b341c4ce99cee31ca49b29befe8f29713bb548","modified":1564480088181},{"_id":"public/categories/架构/index.html","hash":"03338fd2fb6dc2b9ed944ed304578836d9a5ee7f","modified":1564480088181},{"_id":"public/tags/PHP/page/4/index.html","hash":"5e0a1f9c2f39a53af5b8c02219b154d28a90380a","modified":1564480088181},{"_id":"public/tags/设计模式/page/3/index.html","hash":"0db908d39085cf77f8b419c07a620db521617244","modified":1564480088181},{"_id":"public/tags/MySQL/index.html","hash":"ca92ab13b5615dcc8bd3439216bbb781ff7a08a5","modified":1564480088181},{"_id":"public/tags/JavaScript/index.html","hash":"dc3f4a78306300208084d5e19b45c7dbc2579905","modified":1564480088181},{"_id":"public/tags/watch/index.html","hash":"7a789107d3f21537503baaca232bd17411e314c9","modified":1564480088181},{"_id":"public/tags/算法/index.html","hash":"d0d2f49dec0af4e5df4f5563d5f37db37be92a8b","modified":1564480088181},{"_id":"public/tags/Docker/index.html","hash":"e700c62792c816f879a0aec80a6fcb503916f8e0","modified":1564480088181},{"_id":"public/tags/Apache/index.html","hash":"14afcacfbed536023fb2a7eee784afc0bc928653","modified":1564480088181},{"_id":"public/tags/内核/index.html","hash":"07f375510dd2f6f4b2d39ea1f0bd3e55a97ad42a","modified":1564480088181},{"_id":"public/tags/HEXO/index.html","hash":"8f36c07ae5f481d332486f11d96e3d5697dc2dc9","modified":1564480088181},{"_id":"public/tags/manjaro/index.html","hash":"22373129e5d0f055645c974773efeae9f0b3491f","modified":1564480088181},{"_id":"public/tags/ubuntu/index.html","hash":"2b71542ef4bd7ea580692bc09ea99547f5914f99","modified":1564480088181},{"_id":"public/2019/07/05/2019-07-05-REST,GraphQL,Webhooks,gRPC/index.html","hash":"7b65f78922d6af5c77e451fe1906587c2641e2a9","modified":1564480088181},{"_id":"public/2019/06/24/2019-06-24-k8sVSswarm/index.html","hash":"0d7aee0d026b2915622f0fe9d8896be7692a4065","modified":1564480088181},{"_id":"public/2019/06/23/2019-06-23-ubuntu/index.html","hash":"faa36f271525b459d1533a8c966a0a428f03e2b9","modified":1564480088182},{"_id":"public/2019/06/18/2019-06-18-TechnicalArchitectureofLargeWebsite01/index.html","hash":"cde328f94e382f9e0785e0b95760af5390dc3fa1","modified":1564480088182},{"_id":"public/2019/06/06/2019-06-06-HEXO/index.html","hash":"b78c82751164e32af49266266b4ef91f2d0914d4","modified":1564480088182},{"_id":"public/2019/06/05/2019-06-05-manjaro/index.html","hash":"fb739476088e8bc88519366ad36aeec4516a5bde","modified":1564480088187},{"_id":"public/2018/11/17/2018-11-17-ZVAL/index.html","hash":"9c4726f5398aca7d6a7b8a426b3c1dcb3aebb84d","modified":1564480088187},{"_id":"public/2018/10/13/2018-10-13-SAPI/index.html","hash":"7ab0fe4665b5f6608e1005dbfda5386c4c2100f9","modified":1564480088187},{"_id":"public/2018/08/20/2018-08-20-PhpExtensions/index.html","hash":"259e5e94a4821b2f64487603ef3f3289694eedd9","modified":1564480088187},{"_id":"public/2018/06/13/2018-06-27-OutOfMemory/index.html","hash":"2ba190fc0923d245a31d87605b5427cbee5eedf2","modified":1564480088187},{"_id":"public/2018/06/13/2018-06-12-VPS/index.html","hash":"63067f80ac5d0c5b2327d9dede9ac159cfe20582","modified":1564480088187},{"_id":"public/2018/03/13/2018-03-12-Laradock /index.html","hash":"a36a871f11e4dbb9890178234b327f03c7790a79","modified":1564480088187},{"_id":"public/2017/10/29/2017-10-28-transactionTwo/index.html","hash":"d1832473516e0eb5f251c9bf8f94d339b9d11655","modified":1564480088187},{"_id":"public/2017/08/21/2017-08-20-transactionOne/index.html","hash":"615aa90031102dd0ebddf8eaf8d90e1e80faf43d","modified":1564480088187},{"_id":"public/2017/07/20/2017-07-19-fpm/index.html","hash":"3ff08fa713f5ad735ac0d0f538ff084b4308d439","modified":1564480088187},{"_id":"public/2017/06/20/2017-06-19-conversion/index.html","hash":"40e56a55035c2fca6d71febc9db33e3351eaecdf","modified":1564480088187},{"_id":"public/2017/05/31/2017-05-30-clusteredIndex/index.html","hash":"5c50d64dd366cbca9543e9320ac22bae6ea3ad1d","modified":1564480088187},{"_id":"public/2017/05/15/2017-05-14-javascriptTechnic/index.html","hash":"dc12ca4d5a38a6c8ef6e2f2e979c2673357017f3","modified":1564480088188},{"_id":"public/2017/05/14/2017-05-13-mysqlView/index.html","hash":"e6a3175965e431ec0c35bb2c89b60d32acba60d5","modified":1564480088188},{"_id":"public/2017/05/11/2017-05-10-mysqlStoredProcedure/index.html","hash":"68e174b0ab090699ba8b552ee71d97aaa9b83a00","modified":1564480088188},{"_id":"public/2017/05/02/2017-05-01-nullObject/index.html","hash":"ddfbc0610574d9ae5422c0e7e2c4c375be79d7b5","modified":1564480088188},{"_id":"public/2017/04/28/2017-04-27-mediator/index.html","hash":"08688bec3c813e6c85036dfb3d24858ae6d24b5d","modified":1564480088188},{"_id":"public/2017/04/27/2017-04-26-iterator/index.html","hash":"6f406d5dbbd47b6b45e9fd39d4e5f1b6cd5412e3","modified":1564480088188},{"_id":"public/2017/04/26/2017-04-25-command/index.html","hash":"2a742800b5ca17089dae42919fba70ff99751067","modified":1564480088188},{"_id":"public/2017/04/24/2017-04-23-memento/index.html","hash":"f1daaa7129ea4229be19f86d84c6422ee1064d81","modified":1564480088188},{"_id":"public/2017/04/21/2017-04-20-interpreter/index.html","hash":"588c6f968cd44af97c39809eb6b2c728f28f9d16","modified":1564480088188},{"_id":"public/2017/04/10/2017-04-09-visitor/index.html","hash":"ec3e97342ef16205c7bcf66669f2a94a49dd9a04","modified":1564480088188},{"_id":"public/2017/04/07/2017-04-06-chainOfResponsibility/index.html","hash":"5ab3d1feab8819da5b98ca6cbb5be7fd34aa9d28","modified":1564480088188},{"_id":"public/2017/04/06/2017-04-05-observer/index.html","hash":"01ac5e55d7d6702c19509c1fc4bfead562b10f7d","modified":1564480088188},{"_id":"public/2017/04/05/2017-04-04-state/index.html","hash":"3c2c01f681176360fe832972c9a28a4c6fc20fba","modified":1564480088188},{"_id":"public/2017/04/01/2017-03-31-strategy/index.html","hash":"4f4c9be95b6e5a4a83cb4bbd5f958151138003ad","modified":1564480088188},{"_id":"public/2017/03/31/2017-03-30-template/index.html","hash":"bbcec82211b51ab15091dd8daaf505ecf3fccd59","modified":1564480088189},{"_id":"public/2017/03/30/2017-03-29-filter/index.html","hash":"e4834bc3d10cb5e4ab2dc1697c95259bbefd58e6","modified":1564480088189},{"_id":"public/2017/03/29/2017-03-28-proxy/index.html","hash":"78db685c55d10c40b96ac5def74ca3749d8a21f9","modified":1564480088189},{"_id":"public/2017/03/28/2017-03-27-composite/index.html","hash":"c96e206f341493bf0eefdba1789968498082b385","modified":1564480088189},{"_id":"public/2017/03/27/2017-03-26-decorator/index.html","hash":"8aadbf31f93f980d2f7768175c84a9462886eac8","modified":1564480088189},{"_id":"public/2017/03/26/2017-03-25-adapter/index.html","hash":"f4c8d91cf4596b87bdfe7ea85e3ae91127a9c510","modified":1564480088189},{"_id":"public/2017/03/23/2017-03-22-facade/index.html","hash":"b1d68644b96fdcac32f28fb7f7192ab757298455","modified":1564480088189},{"_id":"public/2017/03/22/2017-03-21-flyweight/index.html","hash":"3809cd9c9fd6c9280d2b923644a61b5c1f8aeaf1","modified":1564480088189},{"_id":"public/2017/03/10/2017-03-09-bridge/index.html","hash":"2933a7de70bd73e91d9fbe4093553a94e3309a37","modified":1564480088189},{"_id":"public/2017/02/06/2017-2-05-FindNumber /index.html","hash":"bc60a30885a5d228bce9cad02df49de38e02acd7","modified":1564480088189},{"_id":"public/2016/12/23/2016-12-22-prototype/index.html","hash":"eb98e70a0897c0f3e39b22f270d9865fea3550e1","modified":1564480088189},{"_id":"public/2016/12/17/2016-12-16-builder/index.html","hash":"93dcaa93ba4328a879075e262ca8a1263409b168","modified":1564480088189},{"_id":"public/2016/12/14/2016-12-13-ReverseString/index.html","hash":"396c13272ac065b744b8f037bd9d8c3cf260df0e","modified":1564480088189},{"_id":"public/2016/12/11/2016-12-10-singleton/index.html","hash":"f0fbd71b9f3b3d457de3050bfebb869001845423","modified":1564480088189},{"_id":"public/2016/12/10/2016-12-09-factory /index.html","hash":"bee1cabc991d0a0b65d4b043af0dc3cb2c20dd24","modified":1564480088189},{"_id":"public/archives/index.html","hash":"9869f862f320cbd8c7a2d1a2ed025e57381463bf","modified":1564480088189},{"_id":"public/archives/page/2/index.html","hash":"48771fa1a56dd5c17a41ac83f5c7f03d5de58f53","modified":1564480088189},{"_id":"public/archives/page/3/index.html","hash":"3b014447d8425854239b179b7d5a116fa7238525","modified":1564480088189},{"_id":"public/archives/page/4/index.html","hash":"d1d3611222db045bacccb9649191fac09e3d6c8f","modified":1564480088190},{"_id":"public/archives/2017/index.html","hash":"a6bfdd899856c06867d3c0393821a92dbff61573","modified":1564480088190},{"_id":"public/archives/2017/page/2/index.html","hash":"0633038e3486c65e04d21596b836fe412eb6acfd","modified":1564480088190},{"_id":"public/archives/2017/page/3/index.html","hash":"50b5dc290ef84f2a03250a48780c8443fcd41a74","modified":1564480088190},{"_id":"public/archives/2017/04/index.html","hash":"cd95fa9ff0330043d10e05290ac9f892dce70a72","modified":1564480088190},{"_id":"public/categories/PHP/index.html","hash":"55161cded0943d478ecaa47091182ac0397f8765","modified":1564480088190},{"_id":"public/categories/PHP/page/2/index.html","hash":"df976124a7180c7aa7bedd4ba84d0ee64e9f7d8d","modified":1564480088190},{"_id":"public/tags/PHP/index.html","hash":"6e25276ac7a03ea609a84e9bb62da59b5742abf7","modified":1564480088190},{"_id":"public/tags/PHP/page/2/index.html","hash":"0302c81e33b8523c0381871e3668241a494a2423","modified":1564480088190},{"_id":"public/tags/PHP/page/3/index.html","hash":"851062ad3b58cdb26d5702647d8c4c43fe9cf5c1","modified":1564480088190},{"_id":"public/tags/设计模式/index.html","hash":"9f73340f2edf21aac6ac07859982b42fd5ec13ea","modified":1564480088190},{"_id":"public/tags/设计模式/page/2/index.html","hash":"4aad102f58821156fe645a6cfaba2fea44c63f37","modified":1564480088190},{"_id":"public/index.html","hash":"7b19adfcd4c05d7e003098ba2166379e74672a66","modified":1564480088190},{"_id":"public/page/2/index.html","hash":"b65b693f6e73f4c89c23c10d729c2b3c28424e0c","modified":1564480088190},{"_id":"public/page/3/index.html","hash":"cc139b82692695e10baaae8a8658f5695e65b532","modified":1564480088190},{"_id":"public/page/4/index.html","hash":"6b0de1bedf6e9d277c13fa2eeee213caeb8fa67b","modified":1564480088190},{"_id":"public/page/5/index.html","hash":"5d6466236ed62ae3dfe592758fdda912ccce37c4","modified":1564480088190},{"_id":"public/images/avatar.png","hash":"5a6c9030615ed963ae675734ff42291c8fd876db","modified":1564480088199},{"_id":"public/images/DesignPatterns/bridge.png","hash":"98cb088c18553297abbabffc47556197545cb8e7","modified":1564480088199},{"_id":"public/images/DesignPatterns/Prototype.png","hash":"7be3f999649b0b4bbd498aed9b0379723236a47a","modified":1564480088199},{"_id":"public/images/DesignPatterns/Singleton.png","hash":"076e2e7720e14cd5550a79d7e2835c7adde498a5","modified":1564480088199},{"_id":"public/images/DesignPatterns/factory.png","hash":"71e5addd9a07503f0be759dfe52637076d92d203","modified":1564480088199},{"_id":"public/images/DesignPatterns/builder.png","hash":"1515b51a8bb0caaabe282b653479e9894296c96e","modified":1564480088199},{"_id":"public/images/Framework/001.png","hash":"c8ffabe9097cea99b6df358cb887234a73974eb0","modified":1564480088199},{"_id":"public/images/Framework/002.png","hash":"4ec42f12bc42db7c4c22ffb58e7912badbbf3ecf","modified":1564480088199},{"_id":"public/images/Framework/003.png","hash":"45c5821cc6f8404dc878d802c7b97e1bce56563f","modified":1564480088199},{"_id":"public/images/Framework/004.png","hash":"13f3657d2fc6fd6963198bbacbbe0bf9278bd0fb","modified":1564480088199},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1564480088199},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1564480088199},{"_id":"public/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1564480088199},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1564480088199},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1564480088199},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1564480088199},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1564480088199},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1564480088199},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1564480088200},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1564480088200},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1564480088200},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1564480088200},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1564480088200},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1564480088200},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1564480088200},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1564480088200},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1564480088200},{"_id":"public/images/Framework/005.png","hash":"5e8b8aed169cfca314d335eb4b3dc102634d8a5e","modified":1564480088639},{"_id":"public/images/Framework/006.png","hash":"7d3d83d40c22143bef1e008ff82898a20c87e88a","modified":1564480088639},{"_id":"public/images/Framework/008.png","hash":"3bb296ad0ab56c9704a1bf0ab077f327a5cff5f1","modified":1564480088639},{"_id":"public/images/Framework/007.png","hash":"646e4d3d21603209c50fbe6aea2e983e23b213c2","modified":1564480088639},{"_id":"public/images/Framework/009.png","hash":"db046d6b4dc66fdbb62ac8f94000979b596e4c14","modified":1564480088640},{"_id":"public/images/Framework/010.png","hash":"6d9e6905fdb6644f9472fc770ac6227840af8003","modified":1564480088640},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1564480088640},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1564480088640},{"_id":"public/js/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1564480088643},{"_id":"public/js/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1564480088643},{"_id":"public/js/algolia-search.js","hash":"c980038cbf83b89bad9051a29737bebc5dc27129","modified":1564480088643},{"_id":"public/js/js.cookie.js","hash":"7919f3a96e156ca52e59b61266468f9f2a2eb97e","modified":1564480088644},{"_id":"public/js/motion.js","hash":"ca2965da47ba9fc5b0dde0a825c29e0817b965b9","modified":1564480088644},{"_id":"public/js/next-boot.js","hash":"0f5eeabac85b693be73b6af74fd7493b6e493b91","modified":1564480088644},{"_id":"public/js/post-details.js","hash":"a614a3830f7dfcd4df303c1255d558a135b3854e","modified":1564480088644},{"_id":"public/js/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1564480088644},{"_id":"public/js/scrollspy.js","hash":"8b40c2f8f1e2bdafe555ce3304842e62d9e39ee1","modified":1564480088644},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1564480088644},{"_id":"public/js/schemes/muse.js","hash":"718dae82e96269848d06d3a1de64d2ef3301139f","modified":1564480088644},{"_id":"public/js/schemes/pisces.js","hash":"9eb63cba0327d3d11b6cbfcbe40b88e97a8378a3","modified":1564480088644},{"_id":"public/css/main.css","hash":"c024501e28b435d5a3e5ac456f56be3b01a8627a","modified":1564480088644},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1564480088644},{"_id":"public/js/local-search.js","hash":"eaa8235957cb37540cddf6b8650b7d46db23dc1a","modified":1564480088651},{"_id":"public/js/utils.js","hash":"805615855c267882d8802e75c5134904ea18288e","modified":1564480088652},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1564480088652},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1564480088658},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1564480088662},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1564480088662},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1564480088662},{"_id":"public/lib/jquery/index.js","hash":"88523924351bac0b5d560fe0c5781e2556e7693d","modified":1564480088674},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1564480088675}],"Category":[{"name":"PHP","_id":"cjypn1qk00004y4rbztfp660l"},{"name":"数据库","_id":"cjypn1qku0026y4rbj71ystpp"},{"name":"JavaScript","_id":"cjypn1qkw002gy4rbowly7q02"},{"name":"算法","_id":"cjypn1ql1002yy4rbxdp1yc61"},{"name":"容器","_id":"cjypn1ql40038y4rbg88emysn"},{"name":"服务器","_id":"cjypn1ql6003hy4rbyxnwbn0d"},{"name":"系统","_id":"cjypn1ql9003py4rb6b8pdn05"},{"name":"架构","_id":"cjypn1qlc003yy4rb1zxyns09"}],"Data":[],"Page":[{"title":"categories","date":"2019-06-06T01:49:23.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2019-06-05 21:49:23\ntype: \"categories\"\ncomments: false\n---\n","updated":"2019-07-05T07:55:55.000Z","path":"categories/index.html","layout":"page","_id":"cjypn1qjx0001y4rbpqrddg75","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"标签","date":"2019-06-05T21:03:55.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2019-06-05 17:03:55\ntype: \"tags\"\ncomments: false\n---\n","updated":"2019-07-05T07:55:55.000Z","path":"tags/index.html","layout":"page","_id":"cjypn1qjz0003y4rb57mntpjv","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"PHP设计模式-工厂","date":"2016-12-09T17:00:00.000Z","updated":"2016-12-09T17:00:00.000Z","comments":1,"_content":"\n> “one day~ ”\n\n\n## 瞎BB\n\nZiv 的 Blog 就这么开通了。\n\n\n2016 年末，Ziv 总算有个地方可以随便写点东西了。\n\n\n一直想找个地方，把自己看到的学到的东西都写写。Blog 这个东西一直惦记好久了。最近才发现了githup + jekyll 这地方。本来准备用HEXO的。后来觉得jekyll 的模板好看。我就又用这个了。花了漫长的时间去弄的。本来在WIN上玩Ruby 就不是太舒服。后来自己搭了个虚拟机Ubuntu。才觉得顺手了。\n\n一直觉得自己技术不是很扎实，所以最近一直在补PHP基础。所以就刚好随便写写。\n\n<!-- more -->\n---\n\n## 适用性\n\n**工厂设计模式提供获取某个对象的新实例的一个接口，同时使调用代码避免确定实际实例化基类的步骤。** \n\n## UML\n\n<img src=\"/images/DesignPatterns/factory.png\">\n\n## 代码示例\n\n为了管理控制CD，应用程序需要将必要的信息编辑入CD 对象。然后传递出去。完成CD创建工作。CD 对象需要包含标题，乐队名称，曲目列表。\n```php\n\tclass cd\n\t{\n\t\tpublic $title = '';\n\t\tpublic $band = '';\n\t\tpublic $track = array();\n\n\t\tpublic function __construct()\n\t\t{\n\n\t\t}\n\n\t\tpublic function setTitle($title)\n\t\t{\n\t\t\t$this->title = $title;\n\t\t}\n\n\t\tpublic function setBand($band)\n\t\t{\n\t\t\t$this->band = $band;\n\t\t}\n\n\t\tpublic function addTrack($track)\n\t\t{\n\t\t\t$this->track[] = $track;\n\t\t}\n\n\t}\n```\n为了创建完整的CD对象。处理过程相同: 创建一个CD类的实例，然后添加标题，乐队名称，曲目列表。\n```php\n\t$title = 'Waste of a Rib';\n\t$band = 'Never Again';\n\t$tracksFromExternalSoutce = array('What It Means','Brrr','Goodbye');\n\n\t$cd = new CD();\n\t$cd->setTitle($title);\n\t$cd->setBand($band);\n\tforeach ($tracksFromExternalSoutce as $track ){\n\t\t$cd->addTrack($track);\n\t}\n```\n输出：\n```php\n\tobject(cd)#1 (3) {\n\t  [\"title\"]=>\n\t  string(14) \"Waste of a Rib\"\n\t  [\"band\"]=>\n\t  string(11) \"Never Again\"\n\t  [\"track\"]=>\n\t  array(3) {\n\t    [0]=>\n\t    string(13) \"What It Means\"\n\t    [1]=>\n\t    string(4) \"Brrr\"\n\t    [2]=>\n\t    string(7) \"Goodbye\"\n\t  }\n\t}\n```\n如今，某些艺术家在他们的CD上发布了在计算机中能够使用的其他内容。这些CD称为增强型CD。写至光盘的第一个音轨是数据音轨。管理控制软件通过其他标签DATA TRACK识别数据音轨，并且创建相应的CD对象。\n```php\n\tclass enhancedCD\n\t{\n\t\tpublic $title = '';\n\t\tpublic $band = '';\n\t\tpublic $track = array();\n\n\t\tpublic function __construct()\n\t\t{\n\t\t\t$this->track[] = 'DATA TRACK';\n\t\t}\n\n\t\tpublic function setTitle($title)\n\t\t{\n\t\t\t$this->title = $title;\n\t\t}\n\n\t\tpublic function setBand($band)\n\t\t{\n\t\t\t$this->band = $band;\n\t\t}\n\n\t\tpublic function addTrack($track)\n\t\t{\n\t\t\t$this->track[] = $track;\n\t\t}\n\t}\n```\n查看上述共性和认识到只可能存在两种CD类型之后，似乎我们只需要创造条件语句。如果CD类型是增强型CD，那么就创建enhancedCD类的实例。否则，就应创建通用CD类。然而更好的解决方案：使用工厂设计模式。\nCDFactory类使用了PHP根据比变量动态实例化一个类的能力。create()方法接受被请求类的类型并返回类的一个实例：\n```php\n\tclass CDFactry\n\t{\n\t\tpublic static function create($type)\n\t\t{\n\t\t\t$class = strtolower($type).'CD';\n\n\t\t\treturn new $class;\n\t\t}\n\t}\n\n```\n现在，类的创建和执行变化反应了Factory 类的用法：\n```php\n\t$type = 'enhanced';\n\t$cd = CDFactry::create($type);\n\t$cd->setBand($band);\n\t$cd->setTitle($title);\n\tforeach ($tracksFromExternalSoutce as $track ){\n\t\t$cd->addTrack($track);\n\t}\n```\n输出：\n```php\n\tobject(enhancedCD)#2 (3) {\n\t  [\"title\"]=>\n\t  string(14) \"Waste of a Rib\"\n\t  [\"band\"]=>\n\t  string(11) \"Never Again\"\n\t  [\"track\"]=>\n\t  array(4) {\n\t    [0]=>\n\t    string(10) \"DATA TRACK\"\n\t    [1]=>\n\t    string(13) \"What It Means\"\n\t    [2]=>\n\t    string(4) \"Brrr\"\n\t    [3]=>\n\t    string(7) \"Goodbye\"\n\t  }\n\t}\n```\n","source":"_posts/2016-12-09-factory .md","raw":"---\ntitle: \"PHP设计模式-工厂\"\ndate: 2016-12-09 12:00:00\nupdated: 2016-12-09 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n> “one day~ ”\n\n\n## 瞎BB\n\nZiv 的 Blog 就这么开通了。\n\n\n2016 年末，Ziv 总算有个地方可以随便写点东西了。\n\n\n一直想找个地方，把自己看到的学到的东西都写写。Blog 这个东西一直惦记好久了。最近才发现了githup + jekyll 这地方。本来准备用HEXO的。后来觉得jekyll 的模板好看。我就又用这个了。花了漫长的时间去弄的。本来在WIN上玩Ruby 就不是太舒服。后来自己搭了个虚拟机Ubuntu。才觉得顺手了。\n\n一直觉得自己技术不是很扎实，所以最近一直在补PHP基础。所以就刚好随便写写。\n\n<!-- more -->\n---\n\n## 适用性\n\n**工厂设计模式提供获取某个对象的新实例的一个接口，同时使调用代码避免确定实际实例化基类的步骤。** \n\n## UML\n\n<img src=\"/images/DesignPatterns/factory.png\">\n\n## 代码示例\n\n为了管理控制CD，应用程序需要将必要的信息编辑入CD 对象。然后传递出去。完成CD创建工作。CD 对象需要包含标题，乐队名称，曲目列表。\n```php\n\tclass cd\n\t{\n\t\tpublic $title = '';\n\t\tpublic $band = '';\n\t\tpublic $track = array();\n\n\t\tpublic function __construct()\n\t\t{\n\n\t\t}\n\n\t\tpublic function setTitle($title)\n\t\t{\n\t\t\t$this->title = $title;\n\t\t}\n\n\t\tpublic function setBand($band)\n\t\t{\n\t\t\t$this->band = $band;\n\t\t}\n\n\t\tpublic function addTrack($track)\n\t\t{\n\t\t\t$this->track[] = $track;\n\t\t}\n\n\t}\n```\n为了创建完整的CD对象。处理过程相同: 创建一个CD类的实例，然后添加标题，乐队名称，曲目列表。\n```php\n\t$title = 'Waste of a Rib';\n\t$band = 'Never Again';\n\t$tracksFromExternalSoutce = array('What It Means','Brrr','Goodbye');\n\n\t$cd = new CD();\n\t$cd->setTitle($title);\n\t$cd->setBand($band);\n\tforeach ($tracksFromExternalSoutce as $track ){\n\t\t$cd->addTrack($track);\n\t}\n```\n输出：\n```php\n\tobject(cd)#1 (3) {\n\t  [\"title\"]=>\n\t  string(14) \"Waste of a Rib\"\n\t  [\"band\"]=>\n\t  string(11) \"Never Again\"\n\t  [\"track\"]=>\n\t  array(3) {\n\t    [0]=>\n\t    string(13) \"What It Means\"\n\t    [1]=>\n\t    string(4) \"Brrr\"\n\t    [2]=>\n\t    string(7) \"Goodbye\"\n\t  }\n\t}\n```\n如今，某些艺术家在他们的CD上发布了在计算机中能够使用的其他内容。这些CD称为增强型CD。写至光盘的第一个音轨是数据音轨。管理控制软件通过其他标签DATA TRACK识别数据音轨，并且创建相应的CD对象。\n```php\n\tclass enhancedCD\n\t{\n\t\tpublic $title = '';\n\t\tpublic $band = '';\n\t\tpublic $track = array();\n\n\t\tpublic function __construct()\n\t\t{\n\t\t\t$this->track[] = 'DATA TRACK';\n\t\t}\n\n\t\tpublic function setTitle($title)\n\t\t{\n\t\t\t$this->title = $title;\n\t\t}\n\n\t\tpublic function setBand($band)\n\t\t{\n\t\t\t$this->band = $band;\n\t\t}\n\n\t\tpublic function addTrack($track)\n\t\t{\n\t\t\t$this->track[] = $track;\n\t\t}\n\t}\n```\n查看上述共性和认识到只可能存在两种CD类型之后，似乎我们只需要创造条件语句。如果CD类型是增强型CD，那么就创建enhancedCD类的实例。否则，就应创建通用CD类。然而更好的解决方案：使用工厂设计模式。\nCDFactory类使用了PHP根据比变量动态实例化一个类的能力。create()方法接受被请求类的类型并返回类的一个实例：\n```php\n\tclass CDFactry\n\t{\n\t\tpublic static function create($type)\n\t\t{\n\t\t\t$class = strtolower($type).'CD';\n\n\t\t\treturn new $class;\n\t\t}\n\t}\n\n```\n现在，类的创建和执行变化反应了Factory 类的用法：\n```php\n\t$type = 'enhanced';\n\t$cd = CDFactry::create($type);\n\t$cd->setBand($band);\n\t$cd->setTitle($title);\n\tforeach ($tracksFromExternalSoutce as $track ){\n\t\t$cd->addTrack($track);\n\t}\n```\n输出：\n```php\n\tobject(enhancedCD)#2 (3) {\n\t  [\"title\"]=>\n\t  string(14) \"Waste of a Rib\"\n\t  [\"band\"]=>\n\t  string(11) \"Never Again\"\n\t  [\"track\"]=>\n\t  array(4) {\n\t    [0]=>\n\t    string(10) \"DATA TRACK\"\n\t    [1]=>\n\t    string(13) \"What It Means\"\n\t    [2]=>\n\t    string(4) \"Brrr\"\n\t    [3]=>\n\t    string(7) \"Goodbye\"\n\t  }\n\t}\n```\n","slug":"2016-12-09-factory ","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qju0000y4rbq6xcr6wc","content":"<blockquote>\n<p>“one day~ ”</p>\n</blockquote>\n<h2 id=\"瞎BB\"><a href=\"#瞎BB\" class=\"headerlink\" title=\"瞎BB\"></a>瞎BB</h2><p>Ziv 的 Blog 就这么开通了。</p>\n<p>2016 年末，Ziv 总算有个地方可以随便写点东西了。</p>\n<p>一直想找个地方，把自己看到的学到的东西都写写。Blog 这个东西一直惦记好久了。最近才发现了githup + jekyll 这地方。本来准备用HEXO的。后来觉得jekyll 的模板好看。我就又用这个了。花了漫长的时间去弄的。本来在WIN上玩Ruby 就不是太舒服。后来自己搭了个虚拟机Ubuntu。才觉得顺手了。</p>\n<p>一直觉得自己技术不是很扎实，所以最近一直在补PHP基础。所以就刚好随便写写。</p>\n<a id=\"more\"></a>\n<hr>\n<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><p><strong>工厂设计模式提供获取某个对象的新实例的一个接口，同时使调用代码避免确定实际实例化基类的步骤。</strong> </p>\n<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/factory.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>为了管理控制CD，应用程序需要将必要的信息编辑入CD 对象。然后传递出去。完成CD创建工作。CD 对象需要包含标题，乐队名称，曲目列表。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">cd</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $title = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $band = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $track = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setTitle</span><span class=\"params\">($title)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;title = $title;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setBand</span><span class=\"params\">($band)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;band = $band;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTrack</span><span class=\"params\">($track)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;track[] = $track;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>为了创建完整的CD对象。处理过程相同: 创建一个CD类的实例，然后添加标题，乐队名称，曲目列表。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$title = <span class=\"string\">'Waste of a Rib'</span>;</span><br><span class=\"line\">$band = <span class=\"string\">'Never Again'</span>;</span><br><span class=\"line\">$tracksFromExternalSoutce = <span class=\"keyword\">array</span>(<span class=\"string\">'What It Means'</span>,<span class=\"string\">'Brrr'</span>,<span class=\"string\">'Goodbye'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">$cd = <span class=\"keyword\">new</span> CD();</span><br><span class=\"line\">$cd-&gt;setTitle($title);</span><br><span class=\"line\">$cd-&gt;setBand($band);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($tracksFromExternalSoutce <span class=\"keyword\">as</span> $track )&#123;</span><br><span class=\"line\">\t$cd-&gt;addTrack($track);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object(cd)<span class=\"comment\">#1 (3) &#123;</span></span><br><span class=\"line\">  [<span class=\"string\">\"title\"</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">14</span>) <span class=\"string\">\"Waste of a Rib\"</span></span><br><span class=\"line\">  [<span class=\"string\">\"band\"</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">11</span>) <span class=\"string\">\"Never Again\"</span></span><br><span class=\"line\">  [<span class=\"string\">\"track\"</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">array</span>(<span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">    [<span class=\"number\">0</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">13</span>) <span class=\"string\">\"What It Means\"</span></span><br><span class=\"line\">    [<span class=\"number\">1</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">4</span>) <span class=\"string\">\"Brrr\"</span></span><br><span class=\"line\">    [<span class=\"number\">2</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">7</span>) <span class=\"string\">\"Goodbye\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如今，某些艺术家在他们的CD上发布了在计算机中能够使用的其他内容。这些CD称为增强型CD。写至光盘的第一个音轨是数据音轨。管理控制软件通过其他标签DATA TRACK识别数据音轨，并且创建相应的CD对象。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">enhancedCD</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $title = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $band = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $track = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;track[] = <span class=\"string\">'DATA TRACK'</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setTitle</span><span class=\"params\">($title)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;title = $title;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setBand</span><span class=\"params\">($band)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;band = $band;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTrack</span><span class=\"params\">($track)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;track[] = $track;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>查看上述共性和认识到只可能存在两种CD类型之后，似乎我们只需要创造条件语句。如果CD类型是增强型CD，那么就创建enhancedCD类的实例。否则，就应创建通用CD类。然而更好的解决方案：使用工厂设计模式。<br>CDFactory类使用了PHP根据比变量动态实例化一个类的能力。create()方法接受被请求类的类型并返回类的一个实例：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDFactry</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create</span><span class=\"params\">($type)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$class = strtolower($type).<span class=\"string\">'CD'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> $class;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>现在，类的创建和执行变化反应了Factory 类的用法：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$type = <span class=\"string\">'enhanced'</span>;</span><br><span class=\"line\">$cd = CDFactry::create($type);</span><br><span class=\"line\">$cd-&gt;setBand($band);</span><br><span class=\"line\">$cd-&gt;setTitle($title);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($tracksFromExternalSoutce <span class=\"keyword\">as</span> $track )&#123;</span><br><span class=\"line\">\t$cd-&gt;addTrack($track);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object(enhancedCD)<span class=\"comment\">#2 (3) &#123;</span></span><br><span class=\"line\">  [<span class=\"string\">\"title\"</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">14</span>) <span class=\"string\">\"Waste of a Rib\"</span></span><br><span class=\"line\">  [<span class=\"string\">\"band\"</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">11</span>) <span class=\"string\">\"Never Again\"</span></span><br><span class=\"line\">  [<span class=\"string\">\"track\"</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">array</span>(<span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">    [<span class=\"number\">0</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">10</span>) <span class=\"string\">\"DATA TRACK\"</span></span><br><span class=\"line\">    [<span class=\"number\">1</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">13</span>) <span class=\"string\">\"What It Means\"</span></span><br><span class=\"line\">    [<span class=\"number\">2</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">4</span>) <span class=\"string\">\"Brrr\"</span></span><br><span class=\"line\">    [<span class=\"number\">3</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">7</span>) <span class=\"string\">\"Goodbye\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>“one day~ ”</p>\n</blockquote>\n<h2 id=\"瞎BB\"><a href=\"#瞎BB\" class=\"headerlink\" title=\"瞎BB\"></a>瞎BB</h2><p>Ziv 的 Blog 就这么开通了。</p>\n<p>2016 年末，Ziv 总算有个地方可以随便写点东西了。</p>\n<p>一直想找个地方，把自己看到的学到的东西都写写。Blog 这个东西一直惦记好久了。最近才发现了githup + jekyll 这地方。本来准备用HEXO的。后来觉得jekyll 的模板好看。我就又用这个了。花了漫长的时间去弄的。本来在WIN上玩Ruby 就不是太舒服。后来自己搭了个虚拟机Ubuntu。才觉得顺手了。</p>\n<p>一直觉得自己技术不是很扎实，所以最近一直在补PHP基础。所以就刚好随便写写。</p>","more":"<hr>\n<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><p><strong>工厂设计模式提供获取某个对象的新实例的一个接口，同时使调用代码避免确定实际实例化基类的步骤。</strong> </p>\n<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/factory.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>为了管理控制CD，应用程序需要将必要的信息编辑入CD 对象。然后传递出去。完成CD创建工作。CD 对象需要包含标题，乐队名称，曲目列表。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">cd</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $title = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $band = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $track = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setTitle</span><span class=\"params\">($title)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;title = $title;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setBand</span><span class=\"params\">($band)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;band = $band;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTrack</span><span class=\"params\">($track)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;track[] = $track;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>为了创建完整的CD对象。处理过程相同: 创建一个CD类的实例，然后添加标题，乐队名称，曲目列表。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$title = <span class=\"string\">'Waste of a Rib'</span>;</span><br><span class=\"line\">$band = <span class=\"string\">'Never Again'</span>;</span><br><span class=\"line\">$tracksFromExternalSoutce = <span class=\"keyword\">array</span>(<span class=\"string\">'What It Means'</span>,<span class=\"string\">'Brrr'</span>,<span class=\"string\">'Goodbye'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">$cd = <span class=\"keyword\">new</span> CD();</span><br><span class=\"line\">$cd-&gt;setTitle($title);</span><br><span class=\"line\">$cd-&gt;setBand($band);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($tracksFromExternalSoutce <span class=\"keyword\">as</span> $track )&#123;</span><br><span class=\"line\">\t$cd-&gt;addTrack($track);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object(cd)<span class=\"comment\">#1 (3) &#123;</span></span><br><span class=\"line\">  [<span class=\"string\">\"title\"</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">14</span>) <span class=\"string\">\"Waste of a Rib\"</span></span><br><span class=\"line\">  [<span class=\"string\">\"band\"</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">11</span>) <span class=\"string\">\"Never Again\"</span></span><br><span class=\"line\">  [<span class=\"string\">\"track\"</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">array</span>(<span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">    [<span class=\"number\">0</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">13</span>) <span class=\"string\">\"What It Means\"</span></span><br><span class=\"line\">    [<span class=\"number\">1</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">4</span>) <span class=\"string\">\"Brrr\"</span></span><br><span class=\"line\">    [<span class=\"number\">2</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">7</span>) <span class=\"string\">\"Goodbye\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如今，某些艺术家在他们的CD上发布了在计算机中能够使用的其他内容。这些CD称为增强型CD。写至光盘的第一个音轨是数据音轨。管理控制软件通过其他标签DATA TRACK识别数据音轨，并且创建相应的CD对象。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">enhancedCD</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $title = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $band = <span class=\"string\">''</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> $track = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;track[] = <span class=\"string\">'DATA TRACK'</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setTitle</span><span class=\"params\">($title)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;title = $title;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setBand</span><span class=\"params\">($band)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;band = $band;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTrack</span><span class=\"params\">($track)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">$this</span>-&gt;track[] = $track;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>查看上述共性和认识到只可能存在两种CD类型之后，似乎我们只需要创造条件语句。如果CD类型是增强型CD，那么就创建enhancedCD类的实例。否则，就应创建通用CD类。然而更好的解决方案：使用工厂设计模式。<br>CDFactory类使用了PHP根据比变量动态实例化一个类的能力。create()方法接受被请求类的类型并返回类的一个实例：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDFactry</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create</span><span class=\"params\">($type)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t$class = strtolower($type).<span class=\"string\">'CD'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> $class;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>现在，类的创建和执行变化反应了Factory 类的用法：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$type = <span class=\"string\">'enhanced'</span>;</span><br><span class=\"line\">$cd = CDFactry::create($type);</span><br><span class=\"line\">$cd-&gt;setBand($band);</span><br><span class=\"line\">$cd-&gt;setTitle($title);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($tracksFromExternalSoutce <span class=\"keyword\">as</span> $track )&#123;</span><br><span class=\"line\">\t$cd-&gt;addTrack($track);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">object(enhancedCD)<span class=\"comment\">#2 (3) &#123;</span></span><br><span class=\"line\">  [<span class=\"string\">\"title\"</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">14</span>) <span class=\"string\">\"Waste of a Rib\"</span></span><br><span class=\"line\">  [<span class=\"string\">\"band\"</span>]=&gt;</span><br><span class=\"line\">  string(<span class=\"number\">11</span>) <span class=\"string\">\"Never Again\"</span></span><br><span class=\"line\">  [<span class=\"string\">\"track\"</span>]=&gt;</span><br><span class=\"line\">  <span class=\"keyword\">array</span>(<span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">    [<span class=\"number\">0</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">10</span>) <span class=\"string\">\"DATA TRACK\"</span></span><br><span class=\"line\">    [<span class=\"number\">1</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">13</span>) <span class=\"string\">\"What It Means\"</span></span><br><span class=\"line\">    [<span class=\"number\">2</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">4</span>) <span class=\"string\">\"Brrr\"</span></span><br><span class=\"line\">    [<span class=\"number\">3</span>]=&gt;</span><br><span class=\"line\">    string(<span class=\"number\">7</span>) <span class=\"string\">\"Goodbye\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-建造","date":"2016-12-16T17:00:00.000Z","updated":"2016-12-16T17:00:00.000Z","comments":1,"_content":"\n\n## 适用性\n\n* **建造者设计模式定义了处理其他对象的复杂构建的对象设计**\n\n<!-- more -->\n\n## UML\n\n<img src=\"/images/DesignPatterns/builder.png\">\n\n## 代码示例\n\n具体项目包含一个创建复杂产品对象的类，这个类包含完整构成对象的三个方法。如果在创建新产品对象时没有调用其中一个方法，那么类的属性便会失去。并且程序也会中断。这三个方法**setType()** **setColor()** **serSize()**。如下面的代码所示，最早版本的代码呗设计为先创建产品对象。然后再执行上述三个方法。\n```php\n\tclass product{\n\t\tprotected $_type = '' ;\n\t\tprotected $_size = '' ;\n\t\tprotected $_color = '' ;\n\n\t\tpublic function setType($type)\n\t\t{\n\t\t    $this->_type = $type;\n\t\t}\n\n\t\tpublic function setSize($size)\n\t\t{\n\t\t    $this->_size = $size;\n\t\t}\n\n\t\tpublic function setColor($color)\n\t\t{\n\t\t    $this->_color = $color;\n\t\t}\n\t}\n```\n为了创建完整的产品对象，需要将产品配置分别传递产品类的每个方法：\n```php\n\t$productConfigs = array('type'=>'shirt','size'=>'XL','color'=>'red');\n\n\t$product = new product();\n\t$product->setType($productConfigs['type']);\n\t$product->setSize($productConfigs['size']);\n\t$product->setColor($productConfigs['color']);\n```\n创建对象时分别调用每个方法并不是最佳的做法。此时，我们最好使用基于建造者设计模式的对象来创建这个产品实例。\n\nproducBuilder 类被设计为接受构建 product 对象所需的这些配置选项。 它不仅存储配置参数，而且存储一个实例化的新 **product** 实例，**build()** 方法负责调用 **product** 类中的所有方法，从而构建完整的 **product** 对象。最后，**getProduct()** 方法返回完整构建的 **product** 对象。\n```php\n\tclass productBuilder\n\t{\n\t\tprotected $_product = null;\n\t\tprotected $_configs = array();\n\n\t\tpublic function __construct($configs)\n\t\t{\n\t\t    $this->_product = new product();\n\t\t    $this->_configs = $configs; \n\t\t}\n\n\t\tpublic function build()\n\t\t{\n\t\t    $this->_product->setSize($this->_configs['size']);\n\t\t    $this->_product->setType($this->_configs['type']);\n\t\t    $this->_product->setColor($this->_configs['color']);\n\t\t}\n\n\t\tpublic function getProduct()\n\t\t{\n\t\t    return $this->_product;\n\t\t}\n\t}\n```\n需要注意的是，**build()** 方法隐藏了来自请求新 **product** 对象的代码的实际方法调用。如果 **product** 类以后发生改变，那么只需要修改 **productBuilder** 类的 **build()** 方法，下面的代码说明了如何使用 **productBuilder** 类创建 **product** 对象：\n```php\n\t$builder = new productBuilder($productConfigs);\n\t$builder->build();\n\t$product = $builder->getProduct();\n```\n建造者设计模式的目的是消除其他对象的复杂创建的过程。使用建造者设计模式不仅是最近的做法。而且在某个对象的构造和配置方法改变时可以尽可能的减少重复更改代码。\n\n","source":"_posts/2016-12-16-builder.md","raw":"---\ntitle:  \"PHP设计模式-建造\"\ndate: 2016-12-16 12:00:00\nupdated: 2016-12-16 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n\n## 适用性\n\n* **建造者设计模式定义了处理其他对象的复杂构建的对象设计**\n\n<!-- more -->\n\n## UML\n\n<img src=\"/images/DesignPatterns/builder.png\">\n\n## 代码示例\n\n具体项目包含一个创建复杂产品对象的类，这个类包含完整构成对象的三个方法。如果在创建新产品对象时没有调用其中一个方法，那么类的属性便会失去。并且程序也会中断。这三个方法**setType()** **setColor()** **serSize()**。如下面的代码所示，最早版本的代码呗设计为先创建产品对象。然后再执行上述三个方法。\n```php\n\tclass product{\n\t\tprotected $_type = '' ;\n\t\tprotected $_size = '' ;\n\t\tprotected $_color = '' ;\n\n\t\tpublic function setType($type)\n\t\t{\n\t\t    $this->_type = $type;\n\t\t}\n\n\t\tpublic function setSize($size)\n\t\t{\n\t\t    $this->_size = $size;\n\t\t}\n\n\t\tpublic function setColor($color)\n\t\t{\n\t\t    $this->_color = $color;\n\t\t}\n\t}\n```\n为了创建完整的产品对象，需要将产品配置分别传递产品类的每个方法：\n```php\n\t$productConfigs = array('type'=>'shirt','size'=>'XL','color'=>'red');\n\n\t$product = new product();\n\t$product->setType($productConfigs['type']);\n\t$product->setSize($productConfigs['size']);\n\t$product->setColor($productConfigs['color']);\n```\n创建对象时分别调用每个方法并不是最佳的做法。此时，我们最好使用基于建造者设计模式的对象来创建这个产品实例。\n\nproducBuilder 类被设计为接受构建 product 对象所需的这些配置选项。 它不仅存储配置参数，而且存储一个实例化的新 **product** 实例，**build()** 方法负责调用 **product** 类中的所有方法，从而构建完整的 **product** 对象。最后，**getProduct()** 方法返回完整构建的 **product** 对象。\n```php\n\tclass productBuilder\n\t{\n\t\tprotected $_product = null;\n\t\tprotected $_configs = array();\n\n\t\tpublic function __construct($configs)\n\t\t{\n\t\t    $this->_product = new product();\n\t\t    $this->_configs = $configs; \n\t\t}\n\n\t\tpublic function build()\n\t\t{\n\t\t    $this->_product->setSize($this->_configs['size']);\n\t\t    $this->_product->setType($this->_configs['type']);\n\t\t    $this->_product->setColor($this->_configs['color']);\n\t\t}\n\n\t\tpublic function getProduct()\n\t\t{\n\t\t    return $this->_product;\n\t\t}\n\t}\n```\n需要注意的是，**build()** 方法隐藏了来自请求新 **product** 对象的代码的实际方法调用。如果 **product** 类以后发生改变，那么只需要修改 **productBuilder** 类的 **build()** 方法，下面的代码说明了如何使用 **productBuilder** 类创建 **product** 对象：\n```php\n\t$builder = new productBuilder($productConfigs);\n\t$builder->build();\n\t$product = $builder->getProduct();\n```\n建造者设计模式的目的是消除其他对象的复杂创建的过程。使用建造者设计模式不仅是最近的做法。而且在某个对象的构造和配置方法改变时可以尽可能的减少重复更改代码。\n\n","slug":"2016-12-16-builder","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qjy0002y4rbzujqk38y","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>建造者设计模式定义了处理其他对象的复杂构建的对象设计</strong></li>\n</ul>\n<a id=\"more\"></a>\n\n<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/builder.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>具体项目包含一个创建复杂产品对象的类，这个类包含完整构成对象的三个方法。如果在创建新产品对象时没有调用其中一个方法，那么类的属性便会失去。并且程序也会中断。这三个方法<strong>setType()</strong> <strong>setColor()</strong> <strong>serSize()</strong>。如下面的代码所示，最早版本的代码呗设计为先创建产品对象。然后再执行上述三个方法。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">product</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_type = <span class=\"string\">''</span> ;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_size = <span class=\"string\">''</span> ;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_color = <span class=\"string\">''</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setType</span><span class=\"params\">($type)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_type = $type;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setSize</span><span class=\"params\">($size)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_size = $size;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setColor</span><span class=\"params\">($color)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_color = $color;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>为了创建完整的产品对象，需要将产品配置分别传递产品类的每个方法：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$productConfigs = <span class=\"keyword\">array</span>(<span class=\"string\">'type'</span>=&gt;<span class=\"string\">'shirt'</span>,<span class=\"string\">'size'</span>=&gt;<span class=\"string\">'XL'</span>,<span class=\"string\">'color'</span>=&gt;<span class=\"string\">'red'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">$product = <span class=\"keyword\">new</span> product();</span><br><span class=\"line\">$product-&gt;setType($productConfigs[<span class=\"string\">'type'</span>]);</span><br><span class=\"line\">$product-&gt;setSize($productConfigs[<span class=\"string\">'size'</span>]);</span><br><span class=\"line\">$product-&gt;setColor($productConfigs[<span class=\"string\">'color'</span>]);</span><br></pre></td></tr></table></figure>\n\n<p>创建对象时分别调用每个方法并不是最佳的做法。此时，我们最好使用基于建造者设计模式的对象来创建这个产品实例。</p>\n<p>producBuilder 类被设计为接受构建 product 对象所需的这些配置选项。 它不仅存储配置参数，而且存储一个实例化的新 <strong>product</strong> 实例，<strong>build()</strong> 方法负责调用 <strong>product</strong> 类中的所有方法，从而构建完整的 <strong>product</strong> 对象。最后，<strong>getProduct()</strong> 方法返回完整构建的 <strong>product</strong> 对象。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">productBuilder</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_product = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_configs = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($configs)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_product = <span class=\"keyword\">new</span> product();</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_configs = $configs; </span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">build</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_product-&gt;setSize(<span class=\"keyword\">$this</span>-&gt;_configs[<span class=\"string\">'size'</span>]);</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_product-&gt;setType(<span class=\"keyword\">$this</span>-&gt;_configs[<span class=\"string\">'type'</span>]);</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_product-&gt;setColor(<span class=\"keyword\">$this</span>-&gt;_configs[<span class=\"string\">'color'</span>]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getProduct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;_product;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，<strong>build()</strong> 方法隐藏了来自请求新 <strong>product</strong> 对象的代码的实际方法调用。如果 <strong>product</strong> 类以后发生改变，那么只需要修改 <strong>productBuilder</strong> 类的 <strong>build()</strong> 方法，下面的代码说明了如何使用 <strong>productBuilder</strong> 类创建 <strong>product</strong> 对象：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$builder = <span class=\"keyword\">new</span> productBuilder($productConfigs);</span><br><span class=\"line\">$builder-&gt;build();</span><br><span class=\"line\">$product = $builder-&gt;getProduct();</span><br></pre></td></tr></table></figure>\n\n<p>建造者设计模式的目的是消除其他对象的复杂创建的过程。使用建造者设计模式不仅是最近的做法。而且在某个对象的构造和配置方法改变时可以尽可能的减少重复更改代码。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>建造者设计模式定义了处理其他对象的复杂构建的对象设计</strong></li>\n</ul>","more":"<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/builder.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>具体项目包含一个创建复杂产品对象的类，这个类包含完整构成对象的三个方法。如果在创建新产品对象时没有调用其中一个方法，那么类的属性便会失去。并且程序也会中断。这三个方法<strong>setType()</strong> <strong>setColor()</strong> <strong>serSize()</strong>。如下面的代码所示，最早版本的代码呗设计为先创建产品对象。然后再执行上述三个方法。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">product</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_type = <span class=\"string\">''</span> ;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_size = <span class=\"string\">''</span> ;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_color = <span class=\"string\">''</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setType</span><span class=\"params\">($type)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_type = $type;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setSize</span><span class=\"params\">($size)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_size = $size;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setColor</span><span class=\"params\">($color)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_color = $color;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>为了创建完整的产品对象，需要将产品配置分别传递产品类的每个方法：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$productConfigs = <span class=\"keyword\">array</span>(<span class=\"string\">'type'</span>=&gt;<span class=\"string\">'shirt'</span>,<span class=\"string\">'size'</span>=&gt;<span class=\"string\">'XL'</span>,<span class=\"string\">'color'</span>=&gt;<span class=\"string\">'red'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">$product = <span class=\"keyword\">new</span> product();</span><br><span class=\"line\">$product-&gt;setType($productConfigs[<span class=\"string\">'type'</span>]);</span><br><span class=\"line\">$product-&gt;setSize($productConfigs[<span class=\"string\">'size'</span>]);</span><br><span class=\"line\">$product-&gt;setColor($productConfigs[<span class=\"string\">'color'</span>]);</span><br></pre></td></tr></table></figure>\n\n<p>创建对象时分别调用每个方法并不是最佳的做法。此时，我们最好使用基于建造者设计模式的对象来创建这个产品实例。</p>\n<p>producBuilder 类被设计为接受构建 product 对象所需的这些配置选项。 它不仅存储配置参数，而且存储一个实例化的新 <strong>product</strong> 实例，<strong>build()</strong> 方法负责调用 <strong>product</strong> 类中的所有方法，从而构建完整的 <strong>product</strong> 对象。最后，<strong>getProduct()</strong> 方法返回完整构建的 <strong>product</strong> 对象。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">productBuilder</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_product = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> $_configs = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($configs)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_product = <span class=\"keyword\">new</span> product();</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_configs = $configs; </span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">build</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_product-&gt;setSize(<span class=\"keyword\">$this</span>-&gt;_configs[<span class=\"string\">'size'</span>]);</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_product-&gt;setType(<span class=\"keyword\">$this</span>-&gt;_configs[<span class=\"string\">'type'</span>]);</span><br><span class=\"line\">\t    <span class=\"keyword\">$this</span>-&gt;_product-&gt;setColor(<span class=\"keyword\">$this</span>-&gt;_configs[<span class=\"string\">'color'</span>]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getProduct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t    <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;_product;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，<strong>build()</strong> 方法隐藏了来自请求新 <strong>product</strong> 对象的代码的实际方法调用。如果 <strong>product</strong> 类以后发生改变，那么只需要修改 <strong>productBuilder</strong> 类的 <strong>build()</strong> 方法，下面的代码说明了如何使用 <strong>productBuilder</strong> 类创建 <strong>product</strong> 对象：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$builder = <span class=\"keyword\">new</span> productBuilder($productConfigs);</span><br><span class=\"line\">$builder-&gt;build();</span><br><span class=\"line\">$product = $builder-&gt;getProduct();</span><br></pre></td></tr></table></figure>\n\n<p>建造者设计模式的目的是消除其他对象的复杂创建的过程。使用建造者设计模式不仅是最近的做法。而且在某个对象的构造和配置方法改变时可以尽可能的减少重复更改代码。</p>"},{"title":"PHP设计模式-单例","date":"2016-12-10T17:00:00.000Z","updated":"2016-12-10T17:00:00.000Z","comments":1,"_content":"\n> \"two day~ ”\n\n## 适用性\n\n* **当类只能有一个实例而且客户可以从一个众所周知的访问点访问它时。**\n* **当这个唯一实例应该是通过子类化可扩展的，并且客户应该无需更改代码就能使用一个扩展的实例时。**\n\n<!-- more -->\n\n## UML\n\n<img src=\"/images/DesignPatterns/Singleton.png\">\n\n## 代码示例\n\nCD wed站点出售CD。在访问者购买后要及时更新库存。为了实现这个功能。需要链接MySQL 数据库以及更新CD数量。使用变相对象的方式。可能要创造多个不必要的数据库链接。如下所示，完全可以选择单例模式的数据库链接：\n```php\n    class InventoryConnection\n    {\n        protected static $_instance = null;\n        \n        protected $_handle = null;\n\n        public static function getInstance()\n        {\n            if(!self::$_instance instanceof self)\n            {\n                self::$_instance = new self;\n            }\n            return self::$_instance;\n        }\n\n        protected function __construct()\n        {\n            $this->_handle = mysql_connect('localhose','user','pass');\n            mysql_select_db('cd',$this->_handle);\n        }\n\n        public function updateQuantity($band,$title,$number)\n        {\n            $query = \"update CDS set amount=amount+\".intval($number);\n            $query .= \" where band =' \".mysql_real_escape_string($band).\" ' \";\n            $query .= \" and title =' \".mysql_real_escape_string($title).\" ' \" ;\n\n            mysql_query($query,$this->_handle);\n        }\n    }\n```\nInventoryConnection 类的第一个公共方法 getInstance()的静态方法。这个方法检查$_instance 是否有实例。接下来就是购买CD.\n```php\n    class CD\n    {\n        protected $_title = '';\n        protected $_band = '';\n\n        public function __construct($title,$band)\n        {\n            $this->_title = $title;\n            $this->_band = $band;\n        }\n\n        public function buy()\n        {\n            $inventory = InventoryConnection::getInstance();\n            $inventory->updateQuantity($this->_band, $this->_title,-1);\n        }        \n    }\n```\n通过调用InventoryConnection 的getInstance() 方法来获得这个类的实例。一旦接收实例，就会调用通过调用InventoryConnection 对象updateQuantity()方法指定CD数量减1。\n```php\n    $boughtCDs = array();\n    $boughtCDs[] = array('band'=>'Never Again','Waste of a Rib');\n    $boughtCDs[] = array('banc'=>'Therappee','Long Road');\n\n    foreach ($boughtCDs as $boughtCD)\n    {\n        $cd = new CD($boughtCD['title'],$boughtCD['banc']);\n        $cd->buy();\n    }\n```","source":"_posts/2016-12-10-singleton.md","raw":"---\ntitle:  \"PHP设计模式-单例\"\ndate: 2016-12-10 12:00:00\nupdated: 2016-12-10 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n> \"two day~ ”\n\n## 适用性\n\n* **当类只能有一个实例而且客户可以从一个众所周知的访问点访问它时。**\n* **当这个唯一实例应该是通过子类化可扩展的，并且客户应该无需更改代码就能使用一个扩展的实例时。**\n\n<!-- more -->\n\n## UML\n\n<img src=\"/images/DesignPatterns/Singleton.png\">\n\n## 代码示例\n\nCD wed站点出售CD。在访问者购买后要及时更新库存。为了实现这个功能。需要链接MySQL 数据库以及更新CD数量。使用变相对象的方式。可能要创造多个不必要的数据库链接。如下所示，完全可以选择单例模式的数据库链接：\n```php\n    class InventoryConnection\n    {\n        protected static $_instance = null;\n        \n        protected $_handle = null;\n\n        public static function getInstance()\n        {\n            if(!self::$_instance instanceof self)\n            {\n                self::$_instance = new self;\n            }\n            return self::$_instance;\n        }\n\n        protected function __construct()\n        {\n            $this->_handle = mysql_connect('localhose','user','pass');\n            mysql_select_db('cd',$this->_handle);\n        }\n\n        public function updateQuantity($band,$title,$number)\n        {\n            $query = \"update CDS set amount=amount+\".intval($number);\n            $query .= \" where band =' \".mysql_real_escape_string($band).\" ' \";\n            $query .= \" and title =' \".mysql_real_escape_string($title).\" ' \" ;\n\n            mysql_query($query,$this->_handle);\n        }\n    }\n```\nInventoryConnection 类的第一个公共方法 getInstance()的静态方法。这个方法检查$_instance 是否有实例。接下来就是购买CD.\n```php\n    class CD\n    {\n        protected $_title = '';\n        protected $_band = '';\n\n        public function __construct($title,$band)\n        {\n            $this->_title = $title;\n            $this->_band = $band;\n        }\n\n        public function buy()\n        {\n            $inventory = InventoryConnection::getInstance();\n            $inventory->updateQuantity($this->_band, $this->_title,-1);\n        }        \n    }\n```\n通过调用InventoryConnection 的getInstance() 方法来获得这个类的实例。一旦接收实例，就会调用通过调用InventoryConnection 对象updateQuantity()方法指定CD数量减1。\n```php\n    $boughtCDs = array();\n    $boughtCDs[] = array('band'=>'Never Again','Waste of a Rib');\n    $boughtCDs[] = array('banc'=>'Therappee','Long Road');\n\n    foreach ($boughtCDs as $boughtCD)\n    {\n        $cd = new CD($boughtCD['title'],$boughtCD['banc']);\n        $cd->buy();\n    }\n```","slug":"2016-12-10-singleton","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qk10006y4rb4oqipwoy","content":"<blockquote>\n<p>“two day~ ”</p>\n</blockquote>\n<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>当类只能有一个实例而且客户可以从一个众所周知的访问点访问它时。</strong></li>\n<li><strong>当这个唯一实例应该是通过子类化可扩展的，并且客户应该无需更改代码就能使用一个扩展的实例时。</strong></li>\n</ul>\n<a id=\"more\"></a>\n\n<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/Singleton.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>CD wed站点出售CD。在访问者购买后要及时更新库存。为了实现这个功能。需要链接MySQL 数据库以及更新CD数量。使用变相对象的方式。可能要创造多个不必要的数据库链接。如下所示，完全可以选择单例模式的数据库链接：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InventoryConnection</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">static</span> $_instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_handle = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getInstance</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"keyword\">self</span>::$_instance <span class=\"keyword\">instanceof</span> <span class=\"keyword\">self</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>::$_instance = <span class=\"keyword\">new</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>::$_instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_handle = mysql_connect(<span class=\"string\">'localhose'</span>,<span class=\"string\">'user'</span>,<span class=\"string\">'pass'</span>);</span><br><span class=\"line\">        mysql_select_db(<span class=\"string\">'cd'</span>,<span class=\"keyword\">$this</span>-&gt;_handle);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateQuantity</span><span class=\"params\">($band,$title,$number)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $query = <span class=\"string\">\"update CDS set amount=amount+\"</span>.intval($number);</span><br><span class=\"line\">        $query .= <span class=\"string\">\" where band =' \"</span>.mysql_real_escape_string($band).<span class=\"string\">\" ' \"</span>;</span><br><span class=\"line\">        $query .= <span class=\"string\">\" and title =' \"</span>.mysql_real_escape_string($title).<span class=\"string\">\" ' \"</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\">        mysql_query($query,<span class=\"keyword\">$this</span>-&gt;_handle);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>InventoryConnection 类的第一个公共方法 getInstance()的静态方法。这个方法检查$_instance 是否有实例。接下来就是购买CD.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CD</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_title = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_band = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($title,$band)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_title = $title;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_band = $band;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">buy</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $inventory = InventoryConnection::getInstance();</span><br><span class=\"line\">        $inventory-&gt;updateQuantity(<span class=\"keyword\">$this</span>-&gt;_band, <span class=\"keyword\">$this</span>-&gt;_title,<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;        </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通过调用InventoryConnection 的getInstance() 方法来获得这个类的实例。一旦接收实例，就会调用通过调用InventoryConnection 对象updateQuantity()方法指定CD数量减1。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$boughtCDs = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">$boughtCDs[] = <span class=\"keyword\">array</span>(<span class=\"string\">'band'</span>=&gt;<span class=\"string\">'Never Again'</span>,<span class=\"string\">'Waste of a Rib'</span>);</span><br><span class=\"line\">$boughtCDs[] = <span class=\"keyword\">array</span>(<span class=\"string\">'banc'</span>=&gt;<span class=\"string\">'Therappee'</span>,<span class=\"string\">'Long Road'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($boughtCDs <span class=\"keyword\">as</span> $boughtCD)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $cd = <span class=\"keyword\">new</span> CD($boughtCD[<span class=\"string\">'title'</span>],$boughtCD[<span class=\"string\">'banc'</span>]);</span><br><span class=\"line\">    $cd-&gt;buy();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<blockquote>\n<p>“two day~ ”</p>\n</blockquote>\n<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>当类只能有一个实例而且客户可以从一个众所周知的访问点访问它时。</strong></li>\n<li><strong>当这个唯一实例应该是通过子类化可扩展的，并且客户应该无需更改代码就能使用一个扩展的实例时。</strong></li>\n</ul>","more":"<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/Singleton.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>CD wed站点出售CD。在访问者购买后要及时更新库存。为了实现这个功能。需要链接MySQL 数据库以及更新CD数量。使用变相对象的方式。可能要创造多个不必要的数据库链接。如下所示，完全可以选择单例模式的数据库链接：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InventoryConnection</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">static</span> $_instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_handle = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getInstance</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"keyword\">self</span>::$_instance <span class=\"keyword\">instanceof</span> <span class=\"keyword\">self</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>::$_instance = <span class=\"keyword\">new</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>::$_instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_handle = mysql_connect(<span class=\"string\">'localhose'</span>,<span class=\"string\">'user'</span>,<span class=\"string\">'pass'</span>);</span><br><span class=\"line\">        mysql_select_db(<span class=\"string\">'cd'</span>,<span class=\"keyword\">$this</span>-&gt;_handle);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateQuantity</span><span class=\"params\">($band,$title,$number)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $query = <span class=\"string\">\"update CDS set amount=amount+\"</span>.intval($number);</span><br><span class=\"line\">        $query .= <span class=\"string\">\" where band =' \"</span>.mysql_real_escape_string($band).<span class=\"string\">\" ' \"</span>;</span><br><span class=\"line\">        $query .= <span class=\"string\">\" and title =' \"</span>.mysql_real_escape_string($title).<span class=\"string\">\" ' \"</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\">        mysql_query($query,<span class=\"keyword\">$this</span>-&gt;_handle);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>InventoryConnection 类的第一个公共方法 getInstance()的静态方法。这个方法检查$_instance 是否有实例。接下来就是购买CD.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CD</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_title = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_band = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($title,$band)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_title = $title;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_band = $band;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">buy</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $inventory = InventoryConnection::getInstance();</span><br><span class=\"line\">        $inventory-&gt;updateQuantity(<span class=\"keyword\">$this</span>-&gt;_band, <span class=\"keyword\">$this</span>-&gt;_title,<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;        </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通过调用InventoryConnection 的getInstance() 方法来获得这个类的实例。一旦接收实例，就会调用通过调用InventoryConnection 对象updateQuantity()方法指定CD数量减1。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$boughtCDs = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">$boughtCDs[] = <span class=\"keyword\">array</span>(<span class=\"string\">'band'</span>=&gt;<span class=\"string\">'Never Again'</span>,<span class=\"string\">'Waste of a Rib'</span>);</span><br><span class=\"line\">$boughtCDs[] = <span class=\"keyword\">array</span>(<span class=\"string\">'banc'</span>=&gt;<span class=\"string\">'Therappee'</span>,<span class=\"string\">'Long Road'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($boughtCDs <span class=\"keyword\">as</span> $boughtCD)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $cd = <span class=\"keyword\">new</span> CD($boughtCD[<span class=\"string\">'title'</span>],$boughtCD[<span class=\"string\">'banc'</span>]);</span><br><span class=\"line\">    $cd-&gt;buy();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-桥接","date":"2017-03-09T17:00:00.000Z","updated":"2017-03-09T17:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n* **基础的结构型设计模式：将抽象和实现解耦,对抽象的实现是实体行为对接口的实现。**\n* **例如：人 => 抽象为属性：性别 动作：吃 => 人吃的动作抽象为interface => 实现不同的吃法。**\n\n<!-- more -->\n\n## UML\n\n<img src=\"/images/DesignPatterns/bridge.png\">\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 人抽象类\n */\nabstract class PersonAbstract\n{\n    /**\n     * 性别\n     * @var string\n     */\n    protected $_gender = '';\n\n    /**\n     * 使用的吃饭工具\n     * @var string\n     */\n    protected $_tool   = '';\n\n    /**\n     * 构造函数\n     *\n     * @param string       $gender 性别\n     * @param EatInterface $tool   [description]\n     */\n    public function __construct($gender='',EatInterface $tool)\n    {\n        $this->_gender = $gender;\n        $this->_tool   = $tool;\n    }\n\n    /**\n     * 吃的行为\n     *\n     * @param  string $food 实物\n     * @return void\n     */\n    abstract public function eat($food='');\n}\n/**\n * 男人实类\n */\nclass PersonMale extends PersonAbstract\n{\n    /**\n     * 吃的具体方式\n     *\n     * @param  string $food 食物\n     * @return string\n     */\n    public function eat($food='')\n    {\n        $this->_tool->eat($food);\n    }\n}\n/**\n * 吃接口\n */\ninterface EatInterface\n{\n    /**\n     * 吃\n     *\n     * @param  string $food 食物\n     * @return mixed\n     */\n    public function eat($food='');\n}\n\n/**\n * 用叉子吃实体\n */\nclass EatByFork implements EatInterface\n{\n    /**\n     * 吃\n     *\n     * @param  string $food 食物\n     * @return string\n     */\n    public function eat($food='')\n    {\n        echo \"用叉子吃{$food}~\";\n    }\n}\n\n/**\n * 用筷子吃实体\n */\nclass EatByChopsticks implements EatInterface\n{\n    /**\n     * 吃\n     *\n     * @param  string $food 食物\n     * @return string\n     */\n    public function eat($food='')\n    {\n        echo \"用筷子吃{$food}~\";\n    }\n}\n\ntry {\n    // 初始化一个用筷子吃饭的男人的实例\n    $male = new PersonMale('male', new EatByChopsticks());\n    // 吃饭\n    $male->eat('大米');\n\n} catch (Exception $e) {\n    echo $e->getMessage();\n}\n\n\n~~~\n","source":"_posts/2017-03-09-bridge.md","raw":"---\ntitle:  \"PHP设计模式-桥接\"\ndate: 2017-03-09 12:00:00\nupdated: 2017-03-09 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n* **基础的结构型设计模式：将抽象和实现解耦,对抽象的实现是实体行为对接口的实现。**\n* **例如：人 => 抽象为属性：性别 动作：吃 => 人吃的动作抽象为interface => 实现不同的吃法。**\n\n<!-- more -->\n\n## UML\n\n<img src=\"/images/DesignPatterns/bridge.png\">\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 人抽象类\n */\nabstract class PersonAbstract\n{\n    /**\n     * 性别\n     * @var string\n     */\n    protected $_gender = '';\n\n    /**\n     * 使用的吃饭工具\n     * @var string\n     */\n    protected $_tool   = '';\n\n    /**\n     * 构造函数\n     *\n     * @param string       $gender 性别\n     * @param EatInterface $tool   [description]\n     */\n    public function __construct($gender='',EatInterface $tool)\n    {\n        $this->_gender = $gender;\n        $this->_tool   = $tool;\n    }\n\n    /**\n     * 吃的行为\n     *\n     * @param  string $food 实物\n     * @return void\n     */\n    abstract public function eat($food='');\n}\n/**\n * 男人实类\n */\nclass PersonMale extends PersonAbstract\n{\n    /**\n     * 吃的具体方式\n     *\n     * @param  string $food 食物\n     * @return string\n     */\n    public function eat($food='')\n    {\n        $this->_tool->eat($food);\n    }\n}\n/**\n * 吃接口\n */\ninterface EatInterface\n{\n    /**\n     * 吃\n     *\n     * @param  string $food 食物\n     * @return mixed\n     */\n    public function eat($food='');\n}\n\n/**\n * 用叉子吃实体\n */\nclass EatByFork implements EatInterface\n{\n    /**\n     * 吃\n     *\n     * @param  string $food 食物\n     * @return string\n     */\n    public function eat($food='')\n    {\n        echo \"用叉子吃{$food}~\";\n    }\n}\n\n/**\n * 用筷子吃实体\n */\nclass EatByChopsticks implements EatInterface\n{\n    /**\n     * 吃\n     *\n     * @param  string $food 食物\n     * @return string\n     */\n    public function eat($food='')\n    {\n        echo \"用筷子吃{$food}~\";\n    }\n}\n\ntry {\n    // 初始化一个用筷子吃饭的男人的实例\n    $male = new PersonMale('male', new EatByChopsticks());\n    // 吃饭\n    $male->eat('大米');\n\n} catch (Exception $e) {\n    echo $e->getMessage();\n}\n\n\n~~~\n","slug":"2017-03-09-bridge","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qk20007y4rbz4k8z4zo","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>基础的结构型设计模式：将抽象和实现解耦,对抽象的实现是实体行为对接口的实现。</strong></li>\n<li><strong>例如：人 =&gt; 抽象为属性：性别 动作：吃 =&gt; 人吃的动作抽象为interface =&gt; 实现不同的吃法。</strong></li>\n</ul>\n<a id=\"more\"></a>\n\n<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/bridge.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 人抽象类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonAbstract</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 性别</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_gender = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 使用的吃饭工具</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_tool   = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string       $gender 性别</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> EatInterface $tool   [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($gender=<span class=\"string\">''</span>,EatInterface $tool)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_gender = $gender;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_tool   = $tool;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃的行为</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 实物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 男人实类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonMale</span> <span class=\"keyword\">extends</span> <span class=\"title\">PersonAbstract</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃的具体方式</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 食物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_tool-&gt;eat($food);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 吃接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">EatInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 食物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 用叉子吃实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EatByFork</span> <span class=\"keyword\">implements</span> <span class=\"title\">EatInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 食物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"用叉子吃&#123;$food&#125;~\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 用筷子吃实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EatByChopsticks</span> <span class=\"keyword\">implements</span> <span class=\"title\">EatInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 食物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"用筷子吃&#123;$food&#125;~\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个用筷子吃饭的男人的实例</span></span><br><span class=\"line\">    $male = <span class=\"keyword\">new</span> PersonMale(<span class=\"string\">'male'</span>, <span class=\"keyword\">new</span> EatByChopsticks());</span><br><span class=\"line\">    <span class=\"comment\">// 吃饭</span></span><br><span class=\"line\">    $male-&gt;eat(<span class=\"string\">'大米'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>基础的结构型设计模式：将抽象和实现解耦,对抽象的实现是实体行为对接口的实现。</strong></li>\n<li><strong>例如：人 =&gt; 抽象为属性：性别 动作：吃 =&gt; 人吃的动作抽象为interface =&gt; 实现不同的吃法。</strong></li>\n</ul>","more":"<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/bridge.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 人抽象类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonAbstract</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 性别</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_gender = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 使用的吃饭工具</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_tool   = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string       $gender 性别</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> EatInterface $tool   [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($gender=<span class=\"string\">''</span>,EatInterface $tool)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_gender = $gender;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_tool   = $tool;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃的行为</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 实物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 男人实类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonMale</span> <span class=\"keyword\">extends</span> <span class=\"title\">PersonAbstract</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃的具体方式</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 食物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_tool-&gt;eat($food);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 吃接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">EatInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 食物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 用叉子吃实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EatByFork</span> <span class=\"keyword\">implements</span> <span class=\"title\">EatInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 食物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"用叉子吃&#123;$food&#125;~\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 用筷子吃实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EatByChopsticks</span> <span class=\"keyword\">implements</span> <span class=\"title\">EatInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $food 食物</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">($food=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"用筷子吃&#123;$food&#125;~\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个用筷子吃饭的男人的实例</span></span><br><span class=\"line\">    $male = <span class=\"keyword\">new</span> PersonMale(<span class=\"string\">'male'</span>, <span class=\"keyword\">new</span> EatByChopsticks());</span><br><span class=\"line\">    <span class=\"comment\">// 吃饭</span></span><br><span class=\"line\">    $male-&gt;eat(<span class=\"string\">'大米'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-享元","date":"2017-03-21T16:00:00.000Z","updated":"2017-03-21T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * **php享元（轻量级）模式**\n * 就是缓存了创建型模式创建的对象，不知道为什么会归在结构型模式中，个人觉得创建型模式更合适，哈哈～\n * 其次，享元强调的缓存对象，外观模式强调的对外保持简单易用，是不是就大体构成了目前牛逼哄哄且满大的街【依赖注入容器】\n * 下面我们借助最简单的’工厂模式‘来实现享元模式，就是给工厂加了个缓存池\n\n<!-- more -->\n\n## UML\n\n<img src=\"/images/DesignPatterns/flyweight.png\">\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 农场\n *\n * 生产动物\n */\nclass Farm\n{\n  /**\n   * 对象缓存池\n   * @var array\n   */\n  private $_farmMap = [];\n\n  /**\n   * 构造函数\n   */\n  public function __construct()\n  {\n    echo \"-----------初始化了一个农场----------- \\n\\n\";\n  }\n\n  /**\n   * 生产方法\n   *\n   * 生产农物\n   *\n   * @param  string $type 农场类型\n   * @return mixed\n   */\n  public function produce($type='')\n  {\n    // 对象缓存池判断\n    if (key_exists($type, $this->_farmMap)) {\n      echo \"来自缓存池-> \";\n      return $this->_farmMap[$type];// 返回缓存\n    }\n\n    switch ($type) {\n      case 'chicken':\n        return $this->_farmMap[$type] =  new Chicken();\n        break;\n\n      case 'pig':\n        return $this->_farmMap[$type] =  new Pig();\n        break;\n\n      default:\n        echo \"该农场不支持生产该农物~ \\n\";\n        break;\n    }\n  }\n}\n\n/**\n * 动物接口\n */\ninterface AnimalInterface\n{\n  /**\n   * 类型获取\n   *\n   * @return string\n   */\n  public function getType();\n}\n\n\n/**\n * 实体鸡\n *\n */\nclass Chicken implements AnimalInterface\n{\n  /**\n   * 类别\n   * @var string\n   */\n  private $_type = '';\n\n  /**\n   * 构造函数\n   */\n  public function __construct()\n  {\n\n  }\n\n  /**\n   * 类型获取\n   *\n   * @return string\n   */\n  public function getType()\n  {\n    echo \"这是只鸡～ \\n\";\n  }\n}\n\n\n/**\n * 实体猪\n *\n */\nclass Pig implements AnimalInterface\n{\n  /**\n   * 类别\n   * @var string\n   */\n  private $_type = '';\n\n  /**\n   * 构造函数\n   */\n  public function __construct()\n  {\n\n  }\n\n  /**\n   * 类型获取\n   *\n   * @return string\n   */\n  public function getType()\n  {\n    echo \"这是只猪～ \\n\";\n  }\n}\n\n\n// 初始化一个工厂\n$farm = new Farm();\n//-----------初始化了一个农场----------- \n\n// 成产一只鸡\n$farm->produce('chicken')->getType();\n//这是只鸡～\n\n// 再生产一只鸡\n$farm->produce('chicken')->getType();\n//来自缓存池-> 这是只鸡～\n\n// 成产一只猪\n$farm->produce('pig')->getType();\n//这是只猪～\n\n// 再生产一只猪\n$farm->produce('pig')->getType();\n//来自缓存池-> 这是只猪～\n\n\n~~~\n","source":"_posts/2017-03-21-flyweight.md","raw":"---\ntitle:  \"PHP设计模式-享元\"\ndate: 2017-03-21 12:00:00\nupdated: 2017-03-21 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * **php享元（轻量级）模式**\n * 就是缓存了创建型模式创建的对象，不知道为什么会归在结构型模式中，个人觉得创建型模式更合适，哈哈～\n * 其次，享元强调的缓存对象，外观模式强调的对外保持简单易用，是不是就大体构成了目前牛逼哄哄且满大的街【依赖注入容器】\n * 下面我们借助最简单的’工厂模式‘来实现享元模式，就是给工厂加了个缓存池\n\n<!-- more -->\n\n## UML\n\n<img src=\"/images/DesignPatterns/flyweight.png\">\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 农场\n *\n * 生产动物\n */\nclass Farm\n{\n  /**\n   * 对象缓存池\n   * @var array\n   */\n  private $_farmMap = [];\n\n  /**\n   * 构造函数\n   */\n  public function __construct()\n  {\n    echo \"-----------初始化了一个农场----------- \\n\\n\";\n  }\n\n  /**\n   * 生产方法\n   *\n   * 生产农物\n   *\n   * @param  string $type 农场类型\n   * @return mixed\n   */\n  public function produce($type='')\n  {\n    // 对象缓存池判断\n    if (key_exists($type, $this->_farmMap)) {\n      echo \"来自缓存池-> \";\n      return $this->_farmMap[$type];// 返回缓存\n    }\n\n    switch ($type) {\n      case 'chicken':\n        return $this->_farmMap[$type] =  new Chicken();\n        break;\n\n      case 'pig':\n        return $this->_farmMap[$type] =  new Pig();\n        break;\n\n      default:\n        echo \"该农场不支持生产该农物~ \\n\";\n        break;\n    }\n  }\n}\n\n/**\n * 动物接口\n */\ninterface AnimalInterface\n{\n  /**\n   * 类型获取\n   *\n   * @return string\n   */\n  public function getType();\n}\n\n\n/**\n * 实体鸡\n *\n */\nclass Chicken implements AnimalInterface\n{\n  /**\n   * 类别\n   * @var string\n   */\n  private $_type = '';\n\n  /**\n   * 构造函数\n   */\n  public function __construct()\n  {\n\n  }\n\n  /**\n   * 类型获取\n   *\n   * @return string\n   */\n  public function getType()\n  {\n    echo \"这是只鸡～ \\n\";\n  }\n}\n\n\n/**\n * 实体猪\n *\n */\nclass Pig implements AnimalInterface\n{\n  /**\n   * 类别\n   * @var string\n   */\n  private $_type = '';\n\n  /**\n   * 构造函数\n   */\n  public function __construct()\n  {\n\n  }\n\n  /**\n   * 类型获取\n   *\n   * @return string\n   */\n  public function getType()\n  {\n    echo \"这是只猪～ \\n\";\n  }\n}\n\n\n// 初始化一个工厂\n$farm = new Farm();\n//-----------初始化了一个农场----------- \n\n// 成产一只鸡\n$farm->produce('chicken')->getType();\n//这是只鸡～\n\n// 再生产一只鸡\n$farm->produce('chicken')->getType();\n//来自缓存池-> 这是只鸡～\n\n// 成产一只猪\n$farm->produce('pig')->getType();\n//这是只猪～\n\n// 再生产一只猪\n$farm->produce('pig')->getType();\n//来自缓存池-> 这是只猪～\n\n\n~~~\n","slug":"2017-03-21-flyweight","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qk30008y4rbvahixwpk","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>php享元（轻量级）模式</strong></li>\n<li>就是缓存了创建型模式创建的对象，不知道为什么会归在结构型模式中，个人觉得创建型模式更合适，哈哈～</li>\n<li>其次，享元强调的缓存对象，外观模式强调的对外保持简单易用，是不是就大体构成了目前牛逼哄哄且满大的街【依赖注入容器】</li>\n<li>下面我们借助最简单的’工厂模式‘来实现享元模式，就是给工厂加了个缓存池</li>\n</ul>\n<a id=\"more\"></a>\n\n<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/flyweight.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农场</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 生产动物</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 对象缓存池</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> $_farmMap = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"-----------初始化了一个农场----------- \\n\\n\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 生产方法</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * 生产农物</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span>  string $type 农场类型</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produce</span><span class=\"params\">($type=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 对象缓存池判断</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (key_exists($type, <span class=\"keyword\">$this</span>-&gt;_farmMap)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">echo</span> <span class=\"string\">\"来自缓存池-&gt; \"</span>;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;_farmMap[$type];<span class=\"comment\">// 返回缓存</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">switch</span> ($type) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"string\">'chicken'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;_farmMap[$type] =  <span class=\"keyword\">new</span> Chicken();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"string\">'pig'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;_farmMap[$type] =  <span class=\"keyword\">new</span> Pig();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"该农场不支持生产该农物~ \\n\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 动物接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类型获取</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getType</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体鸡</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Chicken</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类别</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> $_type = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类型获取</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getType</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"这是只鸡～ \\n\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体猪</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Pig</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类别</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> $_type = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类型获取</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getType</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"这是只猪～ \\n\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化一个工厂</span></span><br><span class=\"line\">$farm = <span class=\"keyword\">new</span> Farm();</span><br><span class=\"line\"><span class=\"comment\">//-----------初始化了一个农场----------- </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 成产一只鸡</span></span><br><span class=\"line\">$farm-&gt;produce(<span class=\"string\">'chicken'</span>)-&gt;getType();</span><br><span class=\"line\"><span class=\"comment\">//这是只鸡～</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 再生产一只鸡</span></span><br><span class=\"line\">$farm-&gt;produce(<span class=\"string\">'chicken'</span>)-&gt;getType();</span><br><span class=\"line\"><span class=\"comment\">//来自缓存池-&gt; 这是只鸡～</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 成产一只猪</span></span><br><span class=\"line\">$farm-&gt;produce(<span class=\"string\">'pig'</span>)-&gt;getType();</span><br><span class=\"line\"><span class=\"comment\">//这是只猪～</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 再生产一只猪</span></span><br><span class=\"line\">$farm-&gt;produce(<span class=\"string\">'pig'</span>)-&gt;getType();</span><br><span class=\"line\"><span class=\"comment\">//来自缓存池-&gt; 这是只猪～</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>php享元（轻量级）模式</strong></li>\n<li>就是缓存了创建型模式创建的对象，不知道为什么会归在结构型模式中，个人觉得创建型模式更合适，哈哈～</li>\n<li>其次，享元强调的缓存对象，外观模式强调的对外保持简单易用，是不是就大体构成了目前牛逼哄哄且满大的街【依赖注入容器】</li>\n<li>下面我们借助最简单的’工厂模式‘来实现享元模式，就是给工厂加了个缓存池</li>\n</ul>","more":"<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/images/DesignPatterns/flyweight.png\">\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农场</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 生产动物</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 对象缓存池</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> $_farmMap = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"-----------初始化了一个农场----------- \\n\\n\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 生产方法</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * 生产农物</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span>  string $type 农场类型</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produce</span><span class=\"params\">($type=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 对象缓存池判断</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (key_exists($type, <span class=\"keyword\">$this</span>-&gt;_farmMap)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">echo</span> <span class=\"string\">\"来自缓存池-&gt; \"</span>;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;_farmMap[$type];<span class=\"comment\">// 返回缓存</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">switch</span> ($type) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"string\">'chicken'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;_farmMap[$type] =  <span class=\"keyword\">new</span> Chicken();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"string\">'pig'</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;_farmMap[$type] =  <span class=\"keyword\">new</span> Pig();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"该农场不支持生产该农物~ \\n\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 动物接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类型获取</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getType</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体鸡</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Chicken</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类别</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> $_type = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类型获取</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getType</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"这是只鸡～ \\n\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体猪</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Pig</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类别</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> $_type = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 类型获取</span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getType</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"这是只猪～ \\n\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化一个工厂</span></span><br><span class=\"line\">$farm = <span class=\"keyword\">new</span> Farm();</span><br><span class=\"line\"><span class=\"comment\">//-----------初始化了一个农场----------- </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 成产一只鸡</span></span><br><span class=\"line\">$farm-&gt;produce(<span class=\"string\">'chicken'</span>)-&gt;getType();</span><br><span class=\"line\"><span class=\"comment\">//这是只鸡～</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 再生产一只鸡</span></span><br><span class=\"line\">$farm-&gt;produce(<span class=\"string\">'chicken'</span>)-&gt;getType();</span><br><span class=\"line\"><span class=\"comment\">//来自缓存池-&gt; 这是只鸡～</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 成产一只猪</span></span><br><span class=\"line\">$farm-&gt;produce(<span class=\"string\">'pig'</span>)-&gt;getType();</span><br><span class=\"line\"><span class=\"comment\">//这是只猪～</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 再生产一只猪</span></span><br><span class=\"line\">$farm-&gt;produce(<span class=\"string\">'pig'</span>)-&gt;getType();</span><br><span class=\"line\"><span class=\"comment\">//来自缓存池-&gt; 这是只猪～</span></span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-原型","date":"2016-12-22T17:00:00.000Z","updated":"2017-10-10T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n**原型设计模式创建对象的方式是复制和克隆初始对象或原型，这种方式比创建新实例更为有效。**\n\n<!-- more -->\n\n## UML\n\n<img src=\"/img/in-post/post-design-patterns/Prototype.png\">\n\n* MyOject 类组合使用了原型设计模式。这个类具有名为 requestClone() 的公共方法，该方法用于生产 MyObject 实例的一个副本。\n* CloneObject 对象表示 MyObject 的复制实例。需要注意的是，因为该对象实际是一个复制品，所有它具有 requestClone()方法。\n* 通过调用MyObject 的 requestClone() 方法，可以创建 CloneObject 的许多实例。\n\n## 代码示例\n\n音乐销售 Wed 站点允许登录站点的艺术家创建许多乐队的音乐“合辑”。目前，这种功能性还限制为所有有效的音轨只能来自一个乐队。为了开始创建CD“合辑”，我们可以采用多种途径。其中，在访问者查看某乐队的CD 页面的时候可以使用最通用的选项。CD页面存在的某个链接能够启动构建新CD“合辑”的进程，该进程会发送一个ID，这个ID对应于乐队的特定CD。<br/>\n上面这个进程的第一个构建代码块是CD类。通类，为了构建CD对象，需要从数据库中检索出与被请求ID匹配的具体信息：\n\n~~~ php\n\nclass CD\n{\n    public $band = '';\n    public $tranckList = array();\n    public function _construct($id)\n    {\n        $handle = mysql_connect('localhost','user','pass');\n        mysql_select_db('cd',$handle);\n\n        $query = \"select band , title  from CDs where id={$id}\";\n\n        $resulte = mysql_query($query , $handle);\n\n        if ($row = mysql_fetch_array($resulte)) {\n            $this->band = $row['band'];\n            $this->title = $row['title'];\n        }\n    }\n\n    public function buy()\n    {\n        //cd buying magic here\n        echo '<pre>';\n        var_dump($this);\n    }\n}\n\n~~~ \n\n这个类具有标砖的公共属性 $band $title $trackList <br/>\n构造函数接受 $id 参数 ID ，并且针对数据库执行查询。当发现指定ID时，相对应乐队和标题会分别指派给公共属性 $band 和 $title .<br/>\n此外，CD类还增加了一个 buy() 函数。在最后的代码中，该方法可以处理CD 对象提供用于购买。<br/>\n下一个需要创建的类代表混合CD 实体。这种特点的对象利用了PHP 的克隆能力:\n\n~~~ php\n\nclass MixtapeCD extends CD\n{\n    public function __clone()\n    {\n        $this->title = 'Mixtape';\n    }\n}\n\n~~~\n\nMixtapeCD 实际只是一种特殊化CD ， 扩展了CD 对象。<br/>\n执行PHP 的 clone 命令是，就会对指定的对象执行 _clone() 方法。在MixtapeCD 对象中，初始CD的属性被重写。这个 MixtapeCD 对象不再对应于一个乐队和标题的CD 组合。此时，该对象关联 $band , 但具有新的标题 Mixtape 。<br/>\n下面展示了某用户基于制定乐队制定两个混合标题的情况:\n\n~~~ php\n\n$externalPurchaseInfoBandID = 12;\n$bandMixProto = new MixtapeCD($externalPurchaseInfoBandID);\n\n$externalPurchaseInfo = array();\n$externalPurchaseInfo[] = array('brrr' , 'goodbye');\n$externalPurchaseInfo[] = array('what it means','brrr');\n\nforeach ($externalPurchaseInfo as $mixed) {\n    $cd = clone $bandMixProto;\n    $cd->trackList = $mixed;\n    $cd->buy();\n}\n\n~~~\n\n$bandMixProto 对象根据 MixtapeCD 的新实例创建的。\n传递该对象的参数 $extemalPuchaseInfoBandID 被用于实际 CD类构造函数执行的查询。<br/>\n一旦创建了原型，就能够循环遍历用于特定访问者的CD合辑的音轨列表。对于 foreach() 循环的每个实例来说， $cd 都指派给 $bandMixProto 新副本。接下来特定曲目列表会被添加指定的对象。因为使用了克隆技术，所以每个新的循环都不需要针对数据库新查询。克隆对象已经存储了所有信息，最后，通过执行方法 buy() 就可以购买制定的 $cd 对象。\n\n\n\n\n\n\n\n\n","source":"_posts/2016-12-22-prototype.md","raw":"---\ntitle:  \"PHP设计模式-原型\"\ndate: 2016-12-22 12:00:00\nupdated: 2016-22-10 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n**原型设计模式创建对象的方式是复制和克隆初始对象或原型，这种方式比创建新实例更为有效。**\n\n<!-- more -->\n\n## UML\n\n<img src=\"/img/in-post/post-design-patterns/Prototype.png\">\n\n* MyOject 类组合使用了原型设计模式。这个类具有名为 requestClone() 的公共方法，该方法用于生产 MyObject 实例的一个副本。\n* CloneObject 对象表示 MyObject 的复制实例。需要注意的是，因为该对象实际是一个复制品，所有它具有 requestClone()方法。\n* 通过调用MyObject 的 requestClone() 方法，可以创建 CloneObject 的许多实例。\n\n## 代码示例\n\n音乐销售 Wed 站点允许登录站点的艺术家创建许多乐队的音乐“合辑”。目前，这种功能性还限制为所有有效的音轨只能来自一个乐队。为了开始创建CD“合辑”，我们可以采用多种途径。其中，在访问者查看某乐队的CD 页面的时候可以使用最通用的选项。CD页面存在的某个链接能够启动构建新CD“合辑”的进程，该进程会发送一个ID，这个ID对应于乐队的特定CD。<br/>\n上面这个进程的第一个构建代码块是CD类。通类，为了构建CD对象，需要从数据库中检索出与被请求ID匹配的具体信息：\n\n~~~ php\n\nclass CD\n{\n    public $band = '';\n    public $tranckList = array();\n    public function _construct($id)\n    {\n        $handle = mysql_connect('localhost','user','pass');\n        mysql_select_db('cd',$handle);\n\n        $query = \"select band , title  from CDs where id={$id}\";\n\n        $resulte = mysql_query($query , $handle);\n\n        if ($row = mysql_fetch_array($resulte)) {\n            $this->band = $row['band'];\n            $this->title = $row['title'];\n        }\n    }\n\n    public function buy()\n    {\n        //cd buying magic here\n        echo '<pre>';\n        var_dump($this);\n    }\n}\n\n~~~ \n\n这个类具有标砖的公共属性 $band $title $trackList <br/>\n构造函数接受 $id 参数 ID ，并且针对数据库执行查询。当发现指定ID时，相对应乐队和标题会分别指派给公共属性 $band 和 $title .<br/>\n此外，CD类还增加了一个 buy() 函数。在最后的代码中，该方法可以处理CD 对象提供用于购买。<br/>\n下一个需要创建的类代表混合CD 实体。这种特点的对象利用了PHP 的克隆能力:\n\n~~~ php\n\nclass MixtapeCD extends CD\n{\n    public function __clone()\n    {\n        $this->title = 'Mixtape';\n    }\n}\n\n~~~\n\nMixtapeCD 实际只是一种特殊化CD ， 扩展了CD 对象。<br/>\n执行PHP 的 clone 命令是，就会对指定的对象执行 _clone() 方法。在MixtapeCD 对象中，初始CD的属性被重写。这个 MixtapeCD 对象不再对应于一个乐队和标题的CD 组合。此时，该对象关联 $band , 但具有新的标题 Mixtape 。<br/>\n下面展示了某用户基于制定乐队制定两个混合标题的情况:\n\n~~~ php\n\n$externalPurchaseInfoBandID = 12;\n$bandMixProto = new MixtapeCD($externalPurchaseInfoBandID);\n\n$externalPurchaseInfo = array();\n$externalPurchaseInfo[] = array('brrr' , 'goodbye');\n$externalPurchaseInfo[] = array('what it means','brrr');\n\nforeach ($externalPurchaseInfo as $mixed) {\n    $cd = clone $bandMixProto;\n    $cd->trackList = $mixed;\n    $cd->buy();\n}\n\n~~~\n\n$bandMixProto 对象根据 MixtapeCD 的新实例创建的。\n传递该对象的参数 $extemalPuchaseInfoBandID 被用于实际 CD类构造函数执行的查询。<br/>\n一旦创建了原型，就能够循环遍历用于特定访问者的CD合辑的音轨列表。对于 foreach() 循环的每个实例来说， $cd 都指派给 $bandMixProto 新副本。接下来特定曲目列表会被添加指定的对象。因为使用了克隆技术，所以每个新的循环都不需要针对数据库新查询。克隆对象已经存储了所有信息，最后，通过执行方法 buy() 就可以购买制定的 $cd 对象。\n\n\n\n\n\n\n\n\n","slug":"2016-12-22-prototype","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qk5000by4rbdhcsyqx8","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><p><strong>原型设计模式创建对象的方式是复制和克隆初始对象或原型，这种方式比创建新实例更为有效。</strong></p>\n<a id=\"more\"></a>\n\n<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/img/in-post/post-design-patterns/Prototype.png\">\n\n<ul>\n<li>MyOject 类组合使用了原型设计模式。这个类具有名为 requestClone() 的公共方法，该方法用于生产 MyObject 实例的一个副本。</li>\n<li>CloneObject 对象表示 MyObject 的复制实例。需要注意的是，因为该对象实际是一个复制品，所有它具有 requestClone()方法。</li>\n<li>通过调用MyObject 的 requestClone() 方法，可以创建 CloneObject 的许多实例。</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>音乐销售 Wed 站点允许登录站点的艺术家创建许多乐队的音乐“合辑”。目前，这种功能性还限制为所有有效的音轨只能来自一个乐队。为了开始创建CD“合辑”，我们可以采用多种途径。其中，在访问者查看某乐队的CD 页面的时候可以使用最通用的选项。CD页面存在的某个链接能够启动构建新CD“合辑”的进程，该进程会发送一个ID，这个ID对应于乐队的特定CD。<br><br>上面这个进程的第一个构建代码块是CD类。通类，为了构建CD对象，需要从数据库中检索出与被请求ID匹配的具体信息：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CD</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $band = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $tranckList = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_construct</span><span class=\"params\">($id)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $handle = mysql_connect(<span class=\"string\">'localhost'</span>,<span class=\"string\">'user'</span>,<span class=\"string\">'pass'</span>);</span><br><span class=\"line\">        mysql_select_db(<span class=\"string\">'cd'</span>,$handle);</span><br><span class=\"line\"></span><br><span class=\"line\">        $query = <span class=\"string\">\"select band , title  from CDs where id=&#123;$id&#125;\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $resulte = mysql_query($query , $handle);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($row = mysql_fetch_array($resulte)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;band = $row[<span class=\"string\">'band'</span>];</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;title = $row[<span class=\"string\">'title'</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">buy</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//cd buying magic here</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">'&lt;pre&gt;'</span>;</span><br><span class=\"line\">        var_dump(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">~~~ </span><br><span class=\"line\"></span><br><span class=\"line\">这个类具有标砖的公共属性 $band $title $trackList &lt;br/&gt;</span><br><span class=\"line\">构造函数接受 $id 参数 ID ，并且针对数据库执行查询。当发现指定ID时，相对应乐队和标题会分别指派给公共属性 $band 和 $title .&lt;br/&gt;</span><br><span class=\"line\">此外，CD类还增加了一个 buy() 函数。在最后的代码中，该方法可以处理CD 对象提供用于购买。&lt;br/&gt;</span><br><span class=\"line\">下一个需要创建的类代表混合CD 实体。这种特点的对象利用了PHP 的克隆能力:</span><br><span class=\"line\"></span><br><span class=\"line\">~~~ php</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MixtapeCD</span> <span class=\"keyword\">extends</span> <span class=\"title\">CD</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__clone</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;title = <span class=\"string\">'Mixtape'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>MixtapeCD 实际只是一种特殊化CD ， 扩展了CD 对象。<br><br>执行PHP 的 clone 命令是，就会对指定的对象执行 _clone() 方法。在MixtapeCD 对象中，初始CD的属性被重写。这个 MixtapeCD 对象不再对应于一个乐队和标题的CD 组合。此时，该对象关联 $band , 但具有新的标题 Mixtape 。<br><br>下面展示了某用户基于制定乐队制定两个混合标题的情况:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$externalPurchaseInfoBandID = <span class=\"number\">12</span>;</span><br><span class=\"line\">$bandMixProto = <span class=\"keyword\">new</span> MixtapeCD($externalPurchaseInfoBandID);</span><br><span class=\"line\"></span><br><span class=\"line\">$externalPurchaseInfo = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">$externalPurchaseInfo[] = <span class=\"keyword\">array</span>(<span class=\"string\">'brrr'</span> , <span class=\"string\">'goodbye'</span>);</span><br><span class=\"line\">$externalPurchaseInfo[] = <span class=\"keyword\">array</span>(<span class=\"string\">'what it means'</span>,<span class=\"string\">'brrr'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($externalPurchaseInfo <span class=\"keyword\">as</span> $mixed) &#123;</span><br><span class=\"line\">    $cd = <span class=\"keyword\">clone</span> $bandMixProto;</span><br><span class=\"line\">    $cd-&gt;trackList = $mixed;</span><br><span class=\"line\">    $cd-&gt;buy();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>$bandMixProto 对象根据 MixtapeCD 的新实例创建的。<br>传递该对象的参数 $extemalPuchaseInfoBandID 被用于实际 CD类构造函数执行的查询。<br><br>一旦创建了原型，就能够循环遍历用于特定访问者的CD合辑的音轨列表。对于 foreach() 循环的每个实例来说， $cd 都指派给 $bandMixProto 新副本。接下来特定曲目列表会被添加指定的对象。因为使用了克隆技术，所以每个新的循环都不需要针对数据库新查询。克隆对象已经存储了所有信息，最后，通过执行方法 buy() 就可以购买制定的 $cd 对象。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><p><strong>原型设计模式创建对象的方式是复制和克隆初始对象或原型，这种方式比创建新实例更为有效。</strong></p>","more":"<h2 id=\"UML\"><a href=\"#UML\" class=\"headerlink\" title=\"UML\"></a>UML</h2><img src=\"/img/in-post/post-design-patterns/Prototype.png\">\n\n<ul>\n<li>MyOject 类组合使用了原型设计模式。这个类具有名为 requestClone() 的公共方法，该方法用于生产 MyObject 实例的一个副本。</li>\n<li>CloneObject 对象表示 MyObject 的复制实例。需要注意的是，因为该对象实际是一个复制品，所有它具有 requestClone()方法。</li>\n<li>通过调用MyObject 的 requestClone() 方法，可以创建 CloneObject 的许多实例。</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><p>音乐销售 Wed 站点允许登录站点的艺术家创建许多乐队的音乐“合辑”。目前，这种功能性还限制为所有有效的音轨只能来自一个乐队。为了开始创建CD“合辑”，我们可以采用多种途径。其中，在访问者查看某乐队的CD 页面的时候可以使用最通用的选项。CD页面存在的某个链接能够启动构建新CD“合辑”的进程，该进程会发送一个ID，这个ID对应于乐队的特定CD。<br><br>上面这个进程的第一个构建代码块是CD类。通类，为了构建CD对象，需要从数据库中检索出与被请求ID匹配的具体信息：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CD</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $band = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $tranckList = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_construct</span><span class=\"params\">($id)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $handle = mysql_connect(<span class=\"string\">'localhost'</span>,<span class=\"string\">'user'</span>,<span class=\"string\">'pass'</span>);</span><br><span class=\"line\">        mysql_select_db(<span class=\"string\">'cd'</span>,$handle);</span><br><span class=\"line\"></span><br><span class=\"line\">        $query = <span class=\"string\">\"select band , title  from CDs where id=&#123;$id&#125;\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        $resulte = mysql_query($query , $handle);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($row = mysql_fetch_array($resulte)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;band = $row[<span class=\"string\">'band'</span>];</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;title = $row[<span class=\"string\">'title'</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">buy</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//cd buying magic here</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">'&lt;pre&gt;'</span>;</span><br><span class=\"line\">        var_dump(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">~~~ </span><br><span class=\"line\"></span><br><span class=\"line\">这个类具有标砖的公共属性 $band $title $trackList &lt;br/&gt;</span><br><span class=\"line\">构造函数接受 $id 参数 ID ，并且针对数据库执行查询。当发现指定ID时，相对应乐队和标题会分别指派给公共属性 $band 和 $title .&lt;br/&gt;</span><br><span class=\"line\">此外，CD类还增加了一个 buy() 函数。在最后的代码中，该方法可以处理CD 对象提供用于购买。&lt;br/&gt;</span><br><span class=\"line\">下一个需要创建的类代表混合CD 实体。这种特点的对象利用了PHP 的克隆能力:</span><br><span class=\"line\"></span><br><span class=\"line\">~~~ php</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MixtapeCD</span> <span class=\"keyword\">extends</span> <span class=\"title\">CD</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__clone</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;title = <span class=\"string\">'Mixtape'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>MixtapeCD 实际只是一种特殊化CD ， 扩展了CD 对象。<br><br>执行PHP 的 clone 命令是，就会对指定的对象执行 _clone() 方法。在MixtapeCD 对象中，初始CD的属性被重写。这个 MixtapeCD 对象不再对应于一个乐队和标题的CD 组合。此时，该对象关联 $band , 但具有新的标题 Mixtape 。<br><br>下面展示了某用户基于制定乐队制定两个混合标题的情况:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$externalPurchaseInfoBandID = <span class=\"number\">12</span>;</span><br><span class=\"line\">$bandMixProto = <span class=\"keyword\">new</span> MixtapeCD($externalPurchaseInfoBandID);</span><br><span class=\"line\"></span><br><span class=\"line\">$externalPurchaseInfo = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">$externalPurchaseInfo[] = <span class=\"keyword\">array</span>(<span class=\"string\">'brrr'</span> , <span class=\"string\">'goodbye'</span>);</span><br><span class=\"line\">$externalPurchaseInfo[] = <span class=\"keyword\">array</span>(<span class=\"string\">'what it means'</span>,<span class=\"string\">'brrr'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ($externalPurchaseInfo <span class=\"keyword\">as</span> $mixed) &#123;</span><br><span class=\"line\">    $cd = <span class=\"keyword\">clone</span> $bandMixProto;</span><br><span class=\"line\">    $cd-&gt;trackList = $mixed;</span><br><span class=\"line\">    $cd-&gt;buy();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>$bandMixProto 对象根据 MixtapeCD 的新实例创建的。<br>传递该对象的参数 $extemalPuchaseInfoBandID 被用于实际 CD类构造函数执行的查询。<br><br>一旦创建了原型，就能够循环遍历用于特定访问者的CD合辑的音轨列表。对于 foreach() 循环的每个实例来说， $cd 都指派给 $bandMixProto 新副本。接下来特定曲目列表会被添加指定的对象。因为使用了克隆技术，所以每个新的循环都不需要针对数据库新查询。克隆对象已经存储了所有信息，最后，通过执行方法 buy() 就可以购买制定的 $cd 对象。</p>"},{"title":"PHP设计模式-外观","date":"2017-03-22T16:00:00.000Z","updated":"2017-03-22T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * **把系统中类的调用委托给一个单独的类，对外隐藏了内部的复杂性，很有依赖注入容器的感觉哦**\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n\n/**\n * 动物接口\n */\ninterface AnimalInterface\n{\n    /**\n     * 生产方法\n     *\n     * @return string\n     */\n    public function produce();\n}\n/**\n * 实体鸡工厂\n */\nclass Chicken implements AnimalInterface\n{\n    /**\n     * 生产鸡\n     *\n     * @return string\n     */\n    public function produce()\n    {\n        echo \"生产了一只鸡~ \\n\";\n    }\n}\n/**\n * 实体猪工厂\n */\nclass Pig implements AnimalInterface\n{\n    /**\n     * 生产猪\n     *\n     * @return string\n     */\n    public function produce()\n    {\n        echo \"生产了一只猪~ \\n\";\n    }\n}\n/**\n * 外观类\n */\nclass AnimalMaker\n{\n    /**\n     * 鸡实工厂例\n     * @var object\n     */\n    private $_chicken;\n\n    /**\n     * 猪实工厂例\n     * @var object\n     */\n    private $_pig;\n\n    /**\n     * 构造函数\n     *\n     * @return void\n     */\n    public function __construct()\n    {\n        $this->_chicken = new Chicken();\n        $this->_pig     = new Pig();\n    }\n\n    /**\n     * 生产方法\n     *\n     * 生产鸡\n     * @return string\n     */\n    public function produceChicken()\n    {\n        $this->_chicken->produce();\n    }\n\n    /**\n     * 生产方法\n     *\n     * 生产猪\n     * @return string\n     */\n    public function producePig()\n    {\n        $this->_pig->produce();\n    }\n}\n// 初始化外观类\n$animalMaker = new AnimalMaker();\n\n// 生产一只猪\n$animalMaker->producePig();\n\n// 生产一只鸡\n$animalMaker->produceChicken();\n\n~~~\n","source":"_posts/2017-03-22-facade.md","raw":"---\ntitle:  \"PHP设计模式-外观\"\ndate: 2017-03-22 12:00:00\nupdated: 2017-03-22 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * **把系统中类的调用委托给一个单独的类，对外隐藏了内部的复杂性，很有依赖注入容器的感觉哦**\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n\n/**\n * 动物接口\n */\ninterface AnimalInterface\n{\n    /**\n     * 生产方法\n     *\n     * @return string\n     */\n    public function produce();\n}\n/**\n * 实体鸡工厂\n */\nclass Chicken implements AnimalInterface\n{\n    /**\n     * 生产鸡\n     *\n     * @return string\n     */\n    public function produce()\n    {\n        echo \"生产了一只鸡~ \\n\";\n    }\n}\n/**\n * 实体猪工厂\n */\nclass Pig implements AnimalInterface\n{\n    /**\n     * 生产猪\n     *\n     * @return string\n     */\n    public function produce()\n    {\n        echo \"生产了一只猪~ \\n\";\n    }\n}\n/**\n * 外观类\n */\nclass AnimalMaker\n{\n    /**\n     * 鸡实工厂例\n     * @var object\n     */\n    private $_chicken;\n\n    /**\n     * 猪实工厂例\n     * @var object\n     */\n    private $_pig;\n\n    /**\n     * 构造函数\n     *\n     * @return void\n     */\n    public function __construct()\n    {\n        $this->_chicken = new Chicken();\n        $this->_pig     = new Pig();\n    }\n\n    /**\n     * 生产方法\n     *\n     * 生产鸡\n     * @return string\n     */\n    public function produceChicken()\n    {\n        $this->_chicken->produce();\n    }\n\n    /**\n     * 生产方法\n     *\n     * 生产猪\n     * @return string\n     */\n    public function producePig()\n    {\n        $this->_pig->produce();\n    }\n}\n// 初始化外观类\n$animalMaker = new AnimalMaker();\n\n// 生产一只猪\n$animalMaker->producePig();\n\n// 生产一只鸡\n$animalMaker->produceChicken();\n\n~~~\n","slug":"2017-03-22-facade","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qk7000cy4rblyhpm1mb","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>把系统中类的调用委托给一个单独的类，对外隐藏了内部的复杂性，很有依赖注入容器的感觉哦</strong><a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 动物接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produce</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体鸡工厂</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Chicken</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产鸡</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produce</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产了一只鸡~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体猪工厂</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Pig</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产猪</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produce</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产了一只猪~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 外观类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AnimalMaker</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 鸡实工厂例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_chicken;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 猪实工厂例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_pig;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_chicken = <span class=\"keyword\">new</span> Chicken();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_pig     = <span class=\"keyword\">new</span> Pig();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产鸡</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produceChicken</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_chicken-&gt;produce();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产猪</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">producePig</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_pig-&gt;produce();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 初始化外观类</span></span><br><span class=\"line\">$animalMaker = <span class=\"keyword\">new</span> AnimalMaker();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 生产一只猪</span></span><br><span class=\"line\">$animalMaker-&gt;producePig();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 生产一只鸡</span></span><br><span class=\"line\">$animalMaker-&gt;produceChicken();</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>把系统中类的调用委托给一个单独的类，对外隐藏了内部的复杂性，很有依赖注入容器的感觉哦</strong>","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 动物接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produce</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体鸡工厂</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Chicken</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产鸡</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produce</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产了一只鸡~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体猪工厂</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Pig</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimalInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产猪</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produce</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产了一只猪~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 外观类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AnimalMaker</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 鸡实工厂例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_chicken;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 猪实工厂例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_pig;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_chicken = <span class=\"keyword\">new</span> Chicken();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_pig     = <span class=\"keyword\">new</span> Pig();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产鸡</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">produceChicken</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_chicken-&gt;produce();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产猪</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">producePig</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_pig-&gt;produce();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 初始化外观类</span></span><br><span class=\"line\">$animalMaker = <span class=\"keyword\">new</span> AnimalMaker();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 生产一只猪</span></span><br><span class=\"line\">$animalMaker-&gt;producePig();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 生产一只鸡</span></span><br><span class=\"line\">$animalMaker-&gt;produceChicken();</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-配制器","date":"2017-03-25T16:00:00.000Z","updated":"2017-03-25T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * **把实现了不同接口的对象通过适配器的方式组合起来放在一个新的环境**\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 普通媒体接口\n */\n\ninterface MediaInterface\n{\n    public function play($file='');\n}\n\n\n/**\n * 高级媒体接口\n */\ninterface MediaAdvanceInterface\n{\n    public function playMp4($file='');\n    public function playWma($file='');\n}\n\n/**\n * 高级播放器适配器\n */\nclass Adapter\n{\n    private $_advancePlayerInstance;\n\n    private $_type = '';\n\n    public function __construct($type='')\n    {\n        switch ($type) {\n            case 'mp4':\n                $this->_advancePlayerInstance = new AdvanceMp4Player();\n                break;\n            case 'wma':\n                $this->_advancePlayerInstance = new AdvanceWmaPlayer();\n                break;\n\n            default:\n                throw new Exception(\"$type is not supported\", 400);\n                break;\n        }\n        $this->_type = $type;\n    }\n\n    public function play($file='')\n    {\n        switch ($this->_type) {\n            case 'mp4':\n                $this->_advancePlayerInstance->playMp4($file);\n                break;\n            case 'wma':\n                $this->_advancePlayerInstance->playWma($file);\n                break;\n            default:\n                break;\n        }\n    }\n}\n\n/**\n * mp4高级播放器实体\n */\nclass AdvanceMp4Player implements MediaAdvanceInterface\n{\n    public function playMp4($file='')\n    {\n        echo 'AdvanceMp4Player driver playing file: ' . $file . \".mp4\\n\";\n    }\n\n    public function playWma($file='')\n    {\n        //do nothing\n    }\n}\n\n/**\n * wma高级播放器实体\n */\nclass AdvanceWmaPlayer implements MediaAdvanceInterface\n{\n    public function playMp4($file='')\n    {\n        //do nothing\n    }\n\n    public function playWma($file='')\n    {\n        echo 'AdvanceWmaPlayer driver playing file: ' . $file . \".wma\\n\";\n    }\n}\n\n\n/**\n * 音频设备实体\n */\nclass AudioPlayer implements MediaInterface\n{\n    public function play($file='', $type='')\n    {\n        switch ($type) {\n            case 'mp3':\n                echo 'playing file: ' . $file . \".mp3\\n\";\n                break;\n            case 'mp4':\n                $adapter = new Adapter($type);\n                $adapter->play($file);\n                break;\n            case 'wma':\n                $adapter = new Adapter($type);\n                $adapter->play($file);\n                break;\n\n            default:\n                throw new Exception(\"$type is not supported\", 400);\n                break;\n        }\n\n    }\n}\n\n\ntry {\n    //生产一台设备\n    $mp4 = new AudioPlayer();\n    // 播放一个mp3\n    $mp4->play('忍者', 'mp3');\n    // 播放一个wma\n    $mp4->play('彩虹', 'wma');\n    // 播放一个mp4\n    $mp4->play('龙卷风mv', 'mp4');\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n\n~~~\n","source":"_posts/2017-03-25-adapter.md","raw":"---\ntitle:  \"PHP设计模式-配制器\"\ndate: 2017-03-25 12:00:00\nupdated: 2017-03-25 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * **把实现了不同接口的对象通过适配器的方式组合起来放在一个新的环境**\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 普通媒体接口\n */\n\ninterface MediaInterface\n{\n    public function play($file='');\n}\n\n\n/**\n * 高级媒体接口\n */\ninterface MediaAdvanceInterface\n{\n    public function playMp4($file='');\n    public function playWma($file='');\n}\n\n/**\n * 高级播放器适配器\n */\nclass Adapter\n{\n    private $_advancePlayerInstance;\n\n    private $_type = '';\n\n    public function __construct($type='')\n    {\n        switch ($type) {\n            case 'mp4':\n                $this->_advancePlayerInstance = new AdvanceMp4Player();\n                break;\n            case 'wma':\n                $this->_advancePlayerInstance = new AdvanceWmaPlayer();\n                break;\n\n            default:\n                throw new Exception(\"$type is not supported\", 400);\n                break;\n        }\n        $this->_type = $type;\n    }\n\n    public function play($file='')\n    {\n        switch ($this->_type) {\n            case 'mp4':\n                $this->_advancePlayerInstance->playMp4($file);\n                break;\n            case 'wma':\n                $this->_advancePlayerInstance->playWma($file);\n                break;\n            default:\n                break;\n        }\n    }\n}\n\n/**\n * mp4高级播放器实体\n */\nclass AdvanceMp4Player implements MediaAdvanceInterface\n{\n    public function playMp4($file='')\n    {\n        echo 'AdvanceMp4Player driver playing file: ' . $file . \".mp4\\n\";\n    }\n\n    public function playWma($file='')\n    {\n        //do nothing\n    }\n}\n\n/**\n * wma高级播放器实体\n */\nclass AdvanceWmaPlayer implements MediaAdvanceInterface\n{\n    public function playMp4($file='')\n    {\n        //do nothing\n    }\n\n    public function playWma($file='')\n    {\n        echo 'AdvanceWmaPlayer driver playing file: ' . $file . \".wma\\n\";\n    }\n}\n\n\n/**\n * 音频设备实体\n */\nclass AudioPlayer implements MediaInterface\n{\n    public function play($file='', $type='')\n    {\n        switch ($type) {\n            case 'mp3':\n                echo 'playing file: ' . $file . \".mp3\\n\";\n                break;\n            case 'mp4':\n                $adapter = new Adapter($type);\n                $adapter->play($file);\n                break;\n            case 'wma':\n                $adapter = new Adapter($type);\n                $adapter->play($file);\n                break;\n\n            default:\n                throw new Exception(\"$type is not supported\", 400);\n                break;\n        }\n\n    }\n}\n\n\ntry {\n    //生产一台设备\n    $mp4 = new AudioPlayer();\n    // 播放一个mp3\n    $mp4->play('忍者', 'mp3');\n    // 播放一个wma\n    $mp4->play('彩虹', 'wma');\n    // 播放一个mp4\n    $mp4->play('龙卷风mv', 'mp4');\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n\n~~~\n","slug":"2017-03-25-adapter","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qk8000hy4rb8wkp1zfd","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>把实现了不同接口的对象通过适配器的方式组合起来放在一个新的环境</strong><a id=\"more\"></a>\n\n</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 普通媒体接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">MediaInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">play</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 高级媒体接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">MediaAdvanceInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playMp4</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playWma</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 高级播放器适配器</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Adapter</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_advancePlayerInstance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_type = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($type=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> ($type) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'mp4'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_advancePlayerInstance = <span class=\"keyword\">new</span> AdvanceMp4Player();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'wma'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_advancePlayerInstance = <span class=\"keyword\">new</span> AdvanceWmaPlayer();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"$type is not supported\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_type = $type;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">play</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (<span class=\"keyword\">$this</span>-&gt;_type) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'mp4'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_advancePlayerInstance-&gt;playMp4($file);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'wma'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_advancePlayerInstance-&gt;playWma($file);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * mp4高级播放器实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AdvanceMp4Player</span> <span class=\"keyword\">implements</span> <span class=\"title\">MediaAdvanceInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playMp4</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">'AdvanceMp4Player driver playing file: '</span> . $file . <span class=\"string\">\".mp4\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playWma</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do nothing</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * wma高级播放器实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AdvanceWmaPlayer</span> <span class=\"keyword\">implements</span> <span class=\"title\">MediaAdvanceInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playMp4</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do nothing</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playWma</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">'AdvanceWmaPlayer driver playing file: '</span> . $file . <span class=\"string\">\".wma\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 音频设备实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AudioPlayer</span> <span class=\"keyword\">implements</span> <span class=\"title\">MediaInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">play</span><span class=\"params\">($file=<span class=\"string\">''</span>, $type=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> ($type) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'mp3'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">'playing file: '</span> . $file . <span class=\"string\">\".mp3\\n\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'mp4'</span>:</span><br><span class=\"line\">                $adapter = <span class=\"keyword\">new</span> Adapter($type);</span><br><span class=\"line\">                $adapter-&gt;play($file);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'wma'</span>:</span><br><span class=\"line\">                $adapter = <span class=\"keyword\">new</span> Adapter($type);</span><br><span class=\"line\">                $adapter-&gt;play($file);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"$type is not supported\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//生产一台设备</span></span><br><span class=\"line\">    $mp4 = <span class=\"keyword\">new</span> AudioPlayer();</span><br><span class=\"line\">    <span class=\"comment\">// 播放一个mp3</span></span><br><span class=\"line\">    $mp4-&gt;play(<span class=\"string\">'忍者'</span>, <span class=\"string\">'mp3'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 播放一个wma</span></span><br><span class=\"line\">    $mp4-&gt;play(<span class=\"string\">'彩虹'</span>, <span class=\"string\">'wma'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 播放一个mp4</span></span><br><span class=\"line\">    $mp4-&gt;play(<span class=\"string\">'龙卷风mv'</span>, <span class=\"string\">'mp4'</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>把实现了不同接口的对象通过适配器的方式组合起来放在一个新的环境</strong>","more":"</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 普通媒体接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">MediaInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">play</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 高级媒体接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">MediaAdvanceInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playMp4</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playWma</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 高级播放器适配器</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Adapter</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_advancePlayerInstance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_type = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($type=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> ($type) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'mp4'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_advancePlayerInstance = <span class=\"keyword\">new</span> AdvanceMp4Player();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'wma'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_advancePlayerInstance = <span class=\"keyword\">new</span> AdvanceWmaPlayer();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"$type is not supported\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_type = $type;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">play</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (<span class=\"keyword\">$this</span>-&gt;_type) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'mp4'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_advancePlayerInstance-&gt;playMp4($file);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'wma'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_advancePlayerInstance-&gt;playWma($file);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * mp4高级播放器实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AdvanceMp4Player</span> <span class=\"keyword\">implements</span> <span class=\"title\">MediaAdvanceInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playMp4</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">'AdvanceMp4Player driver playing file: '</span> . $file . <span class=\"string\">\".mp4\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playWma</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do nothing</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * wma高级播放器实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AdvanceWmaPlayer</span> <span class=\"keyword\">implements</span> <span class=\"title\">MediaAdvanceInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playMp4</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do nothing</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playWma</span><span class=\"params\">($file=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">'AdvanceWmaPlayer driver playing file: '</span> . $file . <span class=\"string\">\".wma\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 音频设备实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AudioPlayer</span> <span class=\"keyword\">implements</span> <span class=\"title\">MediaInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">play</span><span class=\"params\">($file=<span class=\"string\">''</span>, $type=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> ($type) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'mp3'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">'playing file: '</span> . $file . <span class=\"string\">\".mp3\\n\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'mp4'</span>:</span><br><span class=\"line\">                $adapter = <span class=\"keyword\">new</span> Adapter($type);</span><br><span class=\"line\">                $adapter-&gt;play($file);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'wma'</span>:</span><br><span class=\"line\">                $adapter = <span class=\"keyword\">new</span> Adapter($type);</span><br><span class=\"line\">                $adapter-&gt;play($file);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"$type is not supported\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//生产一台设备</span></span><br><span class=\"line\">    $mp4 = <span class=\"keyword\">new</span> AudioPlayer();</span><br><span class=\"line\">    <span class=\"comment\">// 播放一个mp3</span></span><br><span class=\"line\">    $mp4-&gt;play(<span class=\"string\">'忍者'</span>, <span class=\"string\">'mp3'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 播放一个wma</span></span><br><span class=\"line\">    $mp4-&gt;play(<span class=\"string\">'彩虹'</span>, <span class=\"string\">'wma'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 播放一个mp4</span></span><br><span class=\"line\">    $mp4-&gt;play(<span class=\"string\">'龙卷风mv'</span>, <span class=\"string\">'mp4'</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-装饰器","date":"2017-03-26T16:00:00.000Z","updated":"2017-03-26T16:00:00.000Z","comments":1,"_content":"## 适用性\n\n * **对现有的对象增加功能**\n * 和适配器的区别：适配器是连接两个接口，装饰器是对现有的对象包装\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 鞋接口\n */\ninterface ShoesInterface\n{\n    public function product();\n}\n\n/**\n * 装饰器抽象类.\n */\nabstract class Decorator implements ShoesInterface\n{\n    /**\n     * 产品生产线对象\n     */\n    protected $shoes;\n\n    /**\n     * 构造函数.\n     */\n    public function __construct(ShoesInterface $shoes)\n    {\n        $this->shoes = $shoes;\n    }\n\n    /**\n     * 生产.\n     */\n    public function product()\n    {\n        $this->shoes->product();\n    }\n\n    /**\n     * 装饰操作.\n     */\n    abstract public function decorate($value);\n}\n\n/**\n * 贴标装饰器\n */\nclass DecoratorBrand extends Decorator\n{\n\n    private $_brand;\n\n    /**\n     * 构造函数\n     */\n    public function __construct(ShoesInterface $phone)\n    {\n        $this->phone = $phone;\n    }\n\n    public function __set($name='', $value='')\n    {\n        $this->$name = $value;\n    }\n\n    /**\n     * 生产\n     */\n    public function product()\n    {\n        $this->phone->product();\n        $this->decorate($this->_brand);\n    }\n\n    /**\n     * 贴标操作\n     */\n    public function decorate($value='')\n    {\n        echo \"贴上{$value}标志 \\n\";\n    }\n\n}\n\n/**\n * 滑板鞋实体\n */\nclass ShoesSkateboard implements ShoesInterface\n{\n    public function product()\n    {\n        echo \"生产一滑板鞋\";\n    }\n}\n\n/**\n * 运动鞋实体\n */\nclass ShoesSport implements ShoesInterface\n{\n    public function product()\n    {\n        echo \"生产一双球鞋\";\n    }\n}\n\n\ntry {\n    echo \"未加装饰器之前：\\n\";\n    // 生产运动鞋\n    $shoesSport = new ShoesSport();\n    $shoesSport->product();\n\n    echo \"\\n--------------------\\n\";\n\n    echo \"加贴标装饰器：\\n\";\n    // 初始化一个贴商标适配器\n    $DecoratorBrand = new DecoratorBrand(new ShoesSport());\n    $DecoratorBrand->_brand = 'nike';\n    // 生产nike牌运动鞋\n    $DecoratorBrand->product();\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n~~~\n","source":"_posts/2017-03-26-decorator.md","raw":"---\ntitle:  \"PHP设计模式-装饰器\"\ndate: 2017-03-26 12:00:00\nupdated: 2017-03-26 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n## 适用性\n\n * **对现有的对象增加功能**\n * 和适配器的区别：适配器是连接两个接口，装饰器是对现有的对象包装\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 鞋接口\n */\ninterface ShoesInterface\n{\n    public function product();\n}\n\n/**\n * 装饰器抽象类.\n */\nabstract class Decorator implements ShoesInterface\n{\n    /**\n     * 产品生产线对象\n     */\n    protected $shoes;\n\n    /**\n     * 构造函数.\n     */\n    public function __construct(ShoesInterface $shoes)\n    {\n        $this->shoes = $shoes;\n    }\n\n    /**\n     * 生产.\n     */\n    public function product()\n    {\n        $this->shoes->product();\n    }\n\n    /**\n     * 装饰操作.\n     */\n    abstract public function decorate($value);\n}\n\n/**\n * 贴标装饰器\n */\nclass DecoratorBrand extends Decorator\n{\n\n    private $_brand;\n\n    /**\n     * 构造函数\n     */\n    public function __construct(ShoesInterface $phone)\n    {\n        $this->phone = $phone;\n    }\n\n    public function __set($name='', $value='')\n    {\n        $this->$name = $value;\n    }\n\n    /**\n     * 生产\n     */\n    public function product()\n    {\n        $this->phone->product();\n        $this->decorate($this->_brand);\n    }\n\n    /**\n     * 贴标操作\n     */\n    public function decorate($value='')\n    {\n        echo \"贴上{$value}标志 \\n\";\n    }\n\n}\n\n/**\n * 滑板鞋实体\n */\nclass ShoesSkateboard implements ShoesInterface\n{\n    public function product()\n    {\n        echo \"生产一滑板鞋\";\n    }\n}\n\n/**\n * 运动鞋实体\n */\nclass ShoesSport implements ShoesInterface\n{\n    public function product()\n    {\n        echo \"生产一双球鞋\";\n    }\n}\n\n\ntry {\n    echo \"未加装饰器之前：\\n\";\n    // 生产运动鞋\n    $shoesSport = new ShoesSport();\n    $shoesSport->product();\n\n    echo \"\\n--------------------\\n\";\n\n    echo \"加贴标装饰器：\\n\";\n    // 初始化一个贴商标适配器\n    $DecoratorBrand = new DecoratorBrand(new ShoesSport());\n    $DecoratorBrand->_brand = 'nike';\n    // 生产nike牌运动鞋\n    $DecoratorBrand->product();\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n~~~\n","slug":"2017-03-26-decorator","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qka000ky4rb6qran89p","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>对现有的对象增加功能</strong></li>\n<li>和适配器的区别：适配器是连接两个接口，装饰器是对现有的对象包装<a id=\"more\"></a>\n\n</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 鞋接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 装饰器抽象类.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Decorator</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 产品生产线对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $shoes;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(ShoesInterface $shoes)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;shoes = $shoes;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;shoes-&gt;product();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 装饰操作.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">decorate</span><span class=\"params\">($value)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 贴标装饰器</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DecoratorBrand</span> <span class=\"keyword\">extends</span> <span class=\"title\">Decorator</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_brand;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(ShoesInterface $phone)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;phone = $phone;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__set</span><span class=\"params\">($name=<span class=\"string\">''</span>, $value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;$name = $value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;phone-&gt;product();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;decorate(<span class=\"keyword\">$this</span>-&gt;_brand);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 贴标操作</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">decorate</span><span class=\"params\">($value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"贴上&#123;$value&#125;标志 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 滑板鞋实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShoesSkateboard</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产一滑板鞋\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 运动鞋实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShoesSport</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产一双球鞋\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"未加装饰器之前：\\n\"</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 生产运动鞋</span></span><br><span class=\"line\">    $shoesSport = <span class=\"keyword\">new</span> ShoesSport();</span><br><span class=\"line\">    $shoesSport-&gt;product();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"\\n--------------------\\n\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"加贴标装饰器：\\n\"</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个贴商标适配器</span></span><br><span class=\"line\">    $DecoratorBrand = <span class=\"keyword\">new</span> DecoratorBrand(<span class=\"keyword\">new</span> ShoesSport());</span><br><span class=\"line\">    $DecoratorBrand-&gt;_brand = <span class=\"string\">'nike'</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 生产nike牌运动鞋</span></span><br><span class=\"line\">    $DecoratorBrand-&gt;product();</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>对现有的对象增加功能</strong></li>\n<li>和适配器的区别：适配器是连接两个接口，装饰器是对现有的对象包装","more":"</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 鞋接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 装饰器抽象类.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Decorator</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 产品生产线对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $shoes;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(ShoesInterface $shoes)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;shoes = $shoes;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;shoes-&gt;product();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 装饰操作.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">decorate</span><span class=\"params\">($value)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 贴标装饰器</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DecoratorBrand</span> <span class=\"keyword\">extends</span> <span class=\"title\">Decorator</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_brand;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(ShoesInterface $phone)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;phone = $phone;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__set</span><span class=\"params\">($name=<span class=\"string\">''</span>, $value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;$name = $value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;phone-&gt;product();</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;decorate(<span class=\"keyword\">$this</span>-&gt;_brand);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 贴标操作</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">decorate</span><span class=\"params\">($value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"贴上&#123;$value&#125;标志 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 滑板鞋实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShoesSkateboard</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产一滑板鞋\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 运动鞋实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShoesSport</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产一双球鞋\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"未加装饰器之前：\\n\"</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 生产运动鞋</span></span><br><span class=\"line\">    $shoesSport = <span class=\"keyword\">new</span> ShoesSport();</span><br><span class=\"line\">    $shoesSport-&gt;product();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"\\n--------------------\\n\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"加贴标装饰器：\\n\"</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个贴商标适配器</span></span><br><span class=\"line\">    $DecoratorBrand = <span class=\"keyword\">new</span> DecoratorBrand(<span class=\"keyword\">new</span> ShoesSport());</span><br><span class=\"line\">    $DecoratorBrand-&gt;_brand = <span class=\"string\">'nike'</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 生产nike牌运动鞋</span></span><br><span class=\"line\">    $DecoratorBrand-&gt;product();</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-代理","date":"2017-03-28T16:00:00.000Z","updated":"2017-03-28T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * **对对象加以【控制】**\n * 和适配器的区别：适配器是连接两个接口（【改变】了接口）\n * 和装饰器的区别：装饰器是对现有的对象包装（【功能扩展】\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n\n/**\n * 鞋接口\n */\ninterface ShoesInterface\n{\n    public function product();\n}\n\n/**\n * 滑板鞋实体\n */\nclass ShoesSkateboard implements ShoesInterface\n{\n    public function product()\n    {\n        echo \"生产一滑板鞋\";\n    }\n}\n\n/**\n * 运动鞋实体\n */\nclass ShoesSport implements ShoesInterface\n{\n    public function product()\n    {\n        echo \"生产一双球鞋\";\n    }\n}\n\n/**\n * 代理工厂\n */\nclass Proxy\n{\n    /**\n     * 产品生产线对象\n     */\n    private $_shoes;\n\n    /**\n     * 产品生产线类型\n     */\n    private $_shoesType;\n\n    /**\n     * 构造函数.\n     */\n    public function __construct($shoesType)\n    {\n        $this->_shoesType = $shoesType;\n    }\n\n    /**\n     * 生产.\n     */\n    public function product()\n    {\n        switch ($this->_shoesType) {\n            case 'sport':\n                echo \"我可以偷点工\";\n                $this->_shoes = new ShoesSport();\n                break;\n            case 'skateboard':\n                echo \"我可以减点料\";\n                $this->_shoes = new ShoesSkateboard();\n                break;\n\n            default:\n                throw new Exception(\"shoes type is not available\", 404);\n                break;\n        }\n        $this->_shoes->product();\n    }\n}\n\ntry {\n    echo \"未加代理之前：\\n\";\n    // 生产运动鞋\n    $shoesSport = new ShoesSport();\n    $shoesSport->product();\n\n    echo \"\\n--------------------\\n\";\n    //-----------------------------------\n\n    echo \"加代理：\\n\";\n    $proxy = new Proxy('sport');\n    $proxy->product();\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n\n~~~\n","source":"_posts/2017-03-28-proxy.md","raw":"---\ntitle:  \"PHP设计模式-代理\"\ndate: 2017-03-28 12:00:00\nupdated: 2017-03-28 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * **对对象加以【控制】**\n * 和适配器的区别：适配器是连接两个接口（【改变】了接口）\n * 和装饰器的区别：装饰器是对现有的对象包装（【功能扩展】\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n\n/**\n * 鞋接口\n */\ninterface ShoesInterface\n{\n    public function product();\n}\n\n/**\n * 滑板鞋实体\n */\nclass ShoesSkateboard implements ShoesInterface\n{\n    public function product()\n    {\n        echo \"生产一滑板鞋\";\n    }\n}\n\n/**\n * 运动鞋实体\n */\nclass ShoesSport implements ShoesInterface\n{\n    public function product()\n    {\n        echo \"生产一双球鞋\";\n    }\n}\n\n/**\n * 代理工厂\n */\nclass Proxy\n{\n    /**\n     * 产品生产线对象\n     */\n    private $_shoes;\n\n    /**\n     * 产品生产线类型\n     */\n    private $_shoesType;\n\n    /**\n     * 构造函数.\n     */\n    public function __construct($shoesType)\n    {\n        $this->_shoesType = $shoesType;\n    }\n\n    /**\n     * 生产.\n     */\n    public function product()\n    {\n        switch ($this->_shoesType) {\n            case 'sport':\n                echo \"我可以偷点工\";\n                $this->_shoes = new ShoesSport();\n                break;\n            case 'skateboard':\n                echo \"我可以减点料\";\n                $this->_shoes = new ShoesSkateboard();\n                break;\n\n            default:\n                throw new Exception(\"shoes type is not available\", 404);\n                break;\n        }\n        $this->_shoes->product();\n    }\n}\n\ntry {\n    echo \"未加代理之前：\\n\";\n    // 生产运动鞋\n    $shoesSport = new ShoesSport();\n    $shoesSport->product();\n\n    echo \"\\n--------------------\\n\";\n    //-----------------------------------\n\n    echo \"加代理：\\n\";\n    $proxy = new Proxy('sport');\n    $proxy->product();\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n\n~~~\n","slug":"2017-03-28-proxy","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkc000oy4rbhedy1tjv","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>对对象加以【控制】</strong></li>\n<li>和适配器的区别：适配器是连接两个接口（【改变】了接口）</li>\n<li>和装饰器的区别：装饰器是对现有的对象包装（【功能扩展】<a id=\"more\"></a>\n\n</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 鞋接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 滑板鞋实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShoesSkateboard</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产一滑板鞋\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 运动鞋实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShoesSport</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产一双球鞋\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 代理工厂</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Proxy</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 产品生产线对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_shoes;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 产品生产线类型</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_shoesType;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($shoesType)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_shoesType = $shoesType;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (<span class=\"keyword\">$this</span>-&gt;_shoesType) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'sport'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">\"我可以偷点工\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_shoes = <span class=\"keyword\">new</span> ShoesSport();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'skateboard'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">\"我可以减点料\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_shoes = <span class=\"keyword\">new</span> ShoesSkateboard();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"shoes type is not available\"</span>, <span class=\"number\">404</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_shoes-&gt;product();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"未加代理之前：\\n\"</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 生产运动鞋</span></span><br><span class=\"line\">    $shoesSport = <span class=\"keyword\">new</span> ShoesSport();</span><br><span class=\"line\">    $shoesSport-&gt;product();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"\\n--------------------\\n\"</span>;</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"加代理：\\n\"</span>;</span><br><span class=\"line\">    $proxy = <span class=\"keyword\">new</span> Proxy(<span class=\"string\">'sport'</span>);</span><br><span class=\"line\">    $proxy-&gt;product();</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>对对象加以【控制】</strong></li>\n<li>和适配器的区别：适配器是连接两个接口（【改变】了接口）</li>\n<li>和装饰器的区别：装饰器是对现有的对象包装（【功能扩展】","more":"</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 鞋接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 滑板鞋实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShoesSkateboard</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产一滑板鞋\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 运动鞋实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShoesSport</span> <span class=\"keyword\">implements</span> <span class=\"title\">ShoesInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"生产一双球鞋\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 代理工厂</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Proxy</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 产品生产线对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_shoes;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 产品生产线类型</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_shoesType;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($shoesType)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_shoesType = $shoesType;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生产.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">product</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (<span class=\"keyword\">$this</span>-&gt;_shoesType) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'sport'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">\"我可以偷点工\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_shoes = <span class=\"keyword\">new</span> ShoesSport();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'skateboard'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">\"我可以减点料\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_shoes = <span class=\"keyword\">new</span> ShoesSkateboard();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"shoes type is not available\"</span>, <span class=\"number\">404</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_shoes-&gt;product();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"未加代理之前：\\n\"</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 生产运动鞋</span></span><br><span class=\"line\">    $shoesSport = <span class=\"keyword\">new</span> ShoesSport();</span><br><span class=\"line\">    $shoesSport-&gt;product();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"\\n--------------------\\n\"</span>;</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"加代理：\\n\"</span>;</span><br><span class=\"line\">    $proxy = <span class=\"keyword\">new</span> Proxy(<span class=\"string\">'sport'</span>);</span><br><span class=\"line\">    $proxy-&gt;product();</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-组合","date":"2017-03-27T16:00:00.000Z","updated":"2017-03-27T16:00:00.000Z","comments":1,"_content":"## 适用性\n\n * 定义：将对象以树形结构组织起来，以达成“部分－整体”的层次结构，使得客户端对单个对象和组合对象的使用具有一致性\n * 我的理解：把对象构建成树形结构\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n\n/**\n * 根节点和树节点都要实现的接口\n */\ninterface CompositeInterface\n{\n    /**\n     * 增加一个节点对象\n     *\n     * @return mixed\n     */\n    public function add(CompositeInterface $composite);\n\n    /**\n     * 删除节点一个对象\n     *\n     * @return mixed\n     */\n    public function delete(CompositeInterface $composite);\n\n    /**\n     * 实体类要实现的方法\n     *\n     * @return mixed\n     */\n    public function operation();\n\n    /**\n     * 打印对象组合\n     *\n     * @return mixed\n     */\n    public function printComposite();\n}\n\n\n/**\n * 文件实体.\n */\nclass File implements CompositeInterface\n{\n    /**\n     * 文件名称.\n     *\n     * @var string\n     */\n    private $_name = '';\n\n    /**\n     * 文件内容.\n     *\n     * @var string\n     */\n    private $_content = '';\n\n    /**\n     * 构造函数.\n     *\n     * @param string $name\n     */\n    public function __construct($name = '')\n    {\n        $this->_name = $name;\n    }\n\n    /**\n     * 魔法函数\n     * @param  string $name  属性名称\n     * @return mixed\n     */\n    public function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 增加一个节点对象\n     *\n     * @return mixed\n     */\n    public function add(CompositeInterface $composite)\n    {\n        throw new Exception('not support', 500);\n    }\n\n    /**\n     * 删除节点一个对象\n     *\n     * @return mixed\n     */\n    public function delete(CompositeInterface $composite)\n    {\n        throw new Exception('not support', 500);\n    }\n\n    /**\n     * 打印对象组合.\n     *\n     * @return mixed\n     */\n    public function printComposite()\n    {\n        throw new Exception('not support', 500);\n    }\n\n    /**\n     * 实体类要实现的方法.\n     *\n     * @return mixed\n     */\n    public function operation($operation = '', $content = '')\n    {\n        switch ($operation) {\n            case 'write':\n                $this->_content .= $content;\n                echo 'write success';\n                break;\n            case 'read':\n                echo $this->_content;\n                break;\n\n            default:\n                throw new \\Exception(\"not support\", 400);\n                break;\n        }\n    }\n}\n\n/**\n * 文件夹实体\n */\nclass Folder implements CompositeInterface\n{\n    /**\n     * 对象组合\n     * @var array\n     */\n    private $_composite = [];\n\n    /**\n     * 文件夹名称\n     * @var string\n     */\n    private $_name = '';\n\n    /**\n     * 构造函数\n     *\n     * @param string $name\n     */\n    public function __construct($name='')\n    {\n        $this->_name = $name;\n    }\n\n    /**\n     * 魔法函数\n     * @param  string $name  属性名称\n     * @return mixed\n     */\n    public function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 增加一个节点对象\n     *\n     * @return void\n     */\n    public function add(CompositeInterface $composite)\n    {\n        if (in_array($composite, $this->_composite, true)) {\n            return;\n        }\n        $this->_composite[] = $composite;\n    }\n\n    /**\n     * 删除节点一个对象\n     *\n     * @return void\n     */\n    public function delete(CompositeInterface $composite)\n    {\n        $key = array_search($composite, $this->_composite, true);\n        if (!$key) {\n            throw new Exception(\"not found\", 404);\n        }\n        unset($this->_composite[$key]);\n        $this->_composite = array_values($this->_composite);\n    }\n\n    /**\n     * 打印对象组合\n     *\n     * @return void\n     */\n    public function printComposite()\n    {\n        foreach ($this->_composite as $v) {\n            if ($v instanceof Folder) {\n                echo '---' . $v->name . \"---\\n\";\n                $v->printComposite();\n                continue;\n            }\n            echo $v->name . \"\\n\";\n        }\n    }\n\n    /**\n     * 实体类要实现的方法\n     *\n     * @return mixed\n     */\n    public function operation()\n    {\n        return;\n    }\n}\n\n\n\ntry {\n    // 构建一个根目录\n    $root = new Folder('根目录');\n\n    // 根目录下添加一个test.php的文件和usr,mnt的文件夹\n    $testFile = new File('test.php');\n    $usr = new Folder('usr');\n    $mnt = new Folder('mnt');\n    $root->add($testFile);\n    $root->add($usr);\n    $root->add($mnt);\n    $usr->add($testFile);// usr目录下加一个test.php的文件\n\n    // 打印根目录文件夹节点\n    $root->printComposite();\n\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n\n~~~\n","source":"_posts/2017-03-27-composite.md","raw":"---\ntitle:  \"PHP设计模式-组合\"\ndate: 2017-03-27 12:00:00\nupdated: 2017-03-27 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n## 适用性\n\n * 定义：将对象以树形结构组织起来，以达成“部分－整体”的层次结构，使得客户端对单个对象和组合对象的使用具有一致性\n * 我的理解：把对象构建成树形结构\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n\n/**\n * 根节点和树节点都要实现的接口\n */\ninterface CompositeInterface\n{\n    /**\n     * 增加一个节点对象\n     *\n     * @return mixed\n     */\n    public function add(CompositeInterface $composite);\n\n    /**\n     * 删除节点一个对象\n     *\n     * @return mixed\n     */\n    public function delete(CompositeInterface $composite);\n\n    /**\n     * 实体类要实现的方法\n     *\n     * @return mixed\n     */\n    public function operation();\n\n    /**\n     * 打印对象组合\n     *\n     * @return mixed\n     */\n    public function printComposite();\n}\n\n\n/**\n * 文件实体.\n */\nclass File implements CompositeInterface\n{\n    /**\n     * 文件名称.\n     *\n     * @var string\n     */\n    private $_name = '';\n\n    /**\n     * 文件内容.\n     *\n     * @var string\n     */\n    private $_content = '';\n\n    /**\n     * 构造函数.\n     *\n     * @param string $name\n     */\n    public function __construct($name = '')\n    {\n        $this->_name = $name;\n    }\n\n    /**\n     * 魔法函数\n     * @param  string $name  属性名称\n     * @return mixed\n     */\n    public function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 增加一个节点对象\n     *\n     * @return mixed\n     */\n    public function add(CompositeInterface $composite)\n    {\n        throw new Exception('not support', 500);\n    }\n\n    /**\n     * 删除节点一个对象\n     *\n     * @return mixed\n     */\n    public function delete(CompositeInterface $composite)\n    {\n        throw new Exception('not support', 500);\n    }\n\n    /**\n     * 打印对象组合.\n     *\n     * @return mixed\n     */\n    public function printComposite()\n    {\n        throw new Exception('not support', 500);\n    }\n\n    /**\n     * 实体类要实现的方法.\n     *\n     * @return mixed\n     */\n    public function operation($operation = '', $content = '')\n    {\n        switch ($operation) {\n            case 'write':\n                $this->_content .= $content;\n                echo 'write success';\n                break;\n            case 'read':\n                echo $this->_content;\n                break;\n\n            default:\n                throw new \\Exception(\"not support\", 400);\n                break;\n        }\n    }\n}\n\n/**\n * 文件夹实体\n */\nclass Folder implements CompositeInterface\n{\n    /**\n     * 对象组合\n     * @var array\n     */\n    private $_composite = [];\n\n    /**\n     * 文件夹名称\n     * @var string\n     */\n    private $_name = '';\n\n    /**\n     * 构造函数\n     *\n     * @param string $name\n     */\n    public function __construct($name='')\n    {\n        $this->_name = $name;\n    }\n\n    /**\n     * 魔法函数\n     * @param  string $name  属性名称\n     * @return mixed\n     */\n    public function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 增加一个节点对象\n     *\n     * @return void\n     */\n    public function add(CompositeInterface $composite)\n    {\n        if (in_array($composite, $this->_composite, true)) {\n            return;\n        }\n        $this->_composite[] = $composite;\n    }\n\n    /**\n     * 删除节点一个对象\n     *\n     * @return void\n     */\n    public function delete(CompositeInterface $composite)\n    {\n        $key = array_search($composite, $this->_composite, true);\n        if (!$key) {\n            throw new Exception(\"not found\", 404);\n        }\n        unset($this->_composite[$key]);\n        $this->_composite = array_values($this->_composite);\n    }\n\n    /**\n     * 打印对象组合\n     *\n     * @return void\n     */\n    public function printComposite()\n    {\n        foreach ($this->_composite as $v) {\n            if ($v instanceof Folder) {\n                echo '---' . $v->name . \"---\\n\";\n                $v->printComposite();\n                continue;\n            }\n            echo $v->name . \"\\n\";\n        }\n    }\n\n    /**\n     * 实体类要实现的方法\n     *\n     * @return mixed\n     */\n    public function operation()\n    {\n        return;\n    }\n}\n\n\n\ntry {\n    // 构建一个根目录\n    $root = new Folder('根目录');\n\n    // 根目录下添加一个test.php的文件和usr,mnt的文件夹\n    $testFile = new File('test.php');\n    $usr = new Folder('usr');\n    $mnt = new Folder('mnt');\n    $root->add($testFile);\n    $root->add($usr);\n    $root->add($mnt);\n    $usr->add($testFile);// usr目录下加一个test.php的文件\n\n    // 打印根目录文件夹节点\n    $root->printComposite();\n\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n\n~~~\n","slug":"2017-03-27-composite","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkc000ry4rbyh77vu7x","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>定义：将对象以树形结构组织起来，以达成“部分－整体”的层次结构，使得客户端对单个对象和组合对象的使用具有一致性</li>\n<li>我的理解：把对象构建成树形结构<a id=\"more\"></a>\n\n</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 根节点和树节点都要实现的接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">CompositeInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 增加一个节点对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(CompositeInterface $composite)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除节点一个对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">(CompositeInterface $composite)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 实体类要实现的方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">operation</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 打印对象组合</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">printComposite</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 文件实体.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span> <span class=\"keyword\">implements</span> <span class=\"title\">CompositeInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文件名称.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文件内容.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_content = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name = <span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_name = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔法函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name  属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 增加一个节点对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(CompositeInterface $composite)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">'not support'</span>, <span class=\"number\">500</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除节点一个对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">(CompositeInterface $composite)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">'not support'</span>, <span class=\"number\">500</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 打印对象组合.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">printComposite</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">'not support'</span>, <span class=\"number\">500</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 实体类要实现的方法.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">operation</span><span class=\"params\">($operation = <span class=\"string\">''</span>, $content = <span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> ($operation) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'write'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_content .= $content;</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">'write success'</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'read'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;_content;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> \\<span class=\"keyword\">Exception</span>(<span class=\"string\">\"not support\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 文件夹实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Folder</span> <span class=\"keyword\">implements</span> <span class=\"title\">CompositeInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 对象组合</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_composite = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文件夹名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_name = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔法函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name  属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 增加一个节点对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(CompositeInterface $composite)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (in_array($composite, <span class=\"keyword\">$this</span>-&gt;_composite, <span class=\"keyword\">true</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_composite[] = $composite;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除节点一个对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">(CompositeInterface $composite)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $key = array_search($composite, <span class=\"keyword\">$this</span>-&gt;_composite, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!$key) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"not found\"</span>, <span class=\"number\">404</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;_composite[$key]);</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_composite = array_values(<span class=\"keyword\">$this</span>-&gt;_composite);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 打印对象组合</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">printComposite</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_composite <span class=\"keyword\">as</span> $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v <span class=\"keyword\">instanceof</span> Folder) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">'---'</span> . $v-&gt;name . <span class=\"string\">\"---\\n\"</span>;</span><br><span class=\"line\">                $v-&gt;printComposite();</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> $v-&gt;name . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 实体类要实现的方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">operation</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 构建一个根目录</span></span><br><span class=\"line\">    $root = <span class=\"keyword\">new</span> Folder(<span class=\"string\">'根目录'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 根目录下添加一个test.php的文件和usr,mnt的文件夹</span></span><br><span class=\"line\">    $testFile = <span class=\"keyword\">new</span> File(<span class=\"string\">'test.php'</span>);</span><br><span class=\"line\">    $usr = <span class=\"keyword\">new</span> Folder(<span class=\"string\">'usr'</span>);</span><br><span class=\"line\">    $mnt = <span class=\"keyword\">new</span> Folder(<span class=\"string\">'mnt'</span>);</span><br><span class=\"line\">    $root-&gt;add($testFile);</span><br><span class=\"line\">    $root-&gt;add($usr);</span><br><span class=\"line\">    $root-&gt;add($mnt);</span><br><span class=\"line\">    $usr-&gt;add($testFile);<span class=\"comment\">// usr目录下加一个test.php的文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 打印根目录文件夹节点</span></span><br><span class=\"line\">    $root-&gt;printComposite();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>定义：将对象以树形结构组织起来，以达成“部分－整体”的层次结构，使得客户端对单个对象和组合对象的使用具有一致性</li>\n<li>我的理解：把对象构建成树形结构","more":"</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 根节点和树节点都要实现的接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">CompositeInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 增加一个节点对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(CompositeInterface $composite)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除节点一个对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">(CompositeInterface $composite)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 实体类要实现的方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">operation</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 打印对象组合</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">printComposite</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 文件实体.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">File</span> <span class=\"keyword\">implements</span> <span class=\"title\">CompositeInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文件名称.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文件内容.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_content = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name = <span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_name = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔法函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name  属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 增加一个节点对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(CompositeInterface $composite)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">'not support'</span>, <span class=\"number\">500</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除节点一个对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">(CompositeInterface $composite)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">'not support'</span>, <span class=\"number\">500</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 打印对象组合.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">printComposite</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">'not support'</span>, <span class=\"number\">500</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 实体类要实现的方法.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">operation</span><span class=\"params\">($operation = <span class=\"string\">''</span>, $content = <span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> ($operation) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'write'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">$this</span>-&gt;_content .= $content;</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">'write success'</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">'read'</span>:</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;_content;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> \\<span class=\"keyword\">Exception</span>(<span class=\"string\">\"not support\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 文件夹实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Folder</span> <span class=\"keyword\">implements</span> <span class=\"title\">CompositeInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 对象组合</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_composite = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文件夹名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_name = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔法函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name  属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 增加一个节点对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(CompositeInterface $composite)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (in_array($composite, <span class=\"keyword\">$this</span>-&gt;_composite, <span class=\"keyword\">true</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_composite[] = $composite;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除节点一个对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">(CompositeInterface $composite)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $key = array_search($composite, <span class=\"keyword\">$this</span>-&gt;_composite, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!$key) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"not found\"</span>, <span class=\"number\">404</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;_composite[$key]);</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_composite = array_values(<span class=\"keyword\">$this</span>-&gt;_composite);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 打印对象组合</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">printComposite</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_composite <span class=\"keyword\">as</span> $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v <span class=\"keyword\">instanceof</span> Folder) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">'---'</span> . $v-&gt;name . <span class=\"string\">\"---\\n\"</span>;</span><br><span class=\"line\">                $v-&gt;printComposite();</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> $v-&gt;name . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 实体类要实现的方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">operation</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 构建一个根目录</span></span><br><span class=\"line\">    $root = <span class=\"keyword\">new</span> Folder(<span class=\"string\">'根目录'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 根目录下添加一个test.php的文件和usr,mnt的文件夹</span></span><br><span class=\"line\">    $testFile = <span class=\"keyword\">new</span> File(<span class=\"string\">'test.php'</span>);</span><br><span class=\"line\">    $usr = <span class=\"keyword\">new</span> Folder(<span class=\"string\">'usr'</span>);</span><br><span class=\"line\">    $mnt = <span class=\"keyword\">new</span> Folder(<span class=\"string\">'mnt'</span>);</span><br><span class=\"line\">    $root-&gt;add($testFile);</span><br><span class=\"line\">    $root-&gt;add($usr);</span><br><span class=\"line\">    $root-&gt;add($mnt);</span><br><span class=\"line\">    $usr-&gt;add($testFile);<span class=\"comment\">// usr目录下加一个test.php的文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 打印根目录文件夹节点</span></span><br><span class=\"line\">    $root-&gt;printComposite();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-过滤器","date":"2017-03-29T16:00:00.000Z","updated":"2017-03-29T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * **允许我们使用不同的规则过滤某一组对象**\n<!-- more -->\n\n\n## 代码示例\n\n~~~ PHP\n\n\n/**\n * 过滤接口\n */\ninterface FilterInterface\n{\n    /**\n     * 过滤方法\n     *\n     * @param  SportsMan $person 运动员\n     * @return mixed\n     */\n    public function filter(array $person);\n}\n\n\n/**\n * 按运动项目过滤实体\n */\nclass SportsPerson\n{\n    /**\n     * 性别\n     * @var string\n     */\n    private $_gender = '';\n\n    /**\n     * 按照本运动项目过滤\n     * @var string\n     */\n    private $_sportType = '';\n\n    /**\n     * 构造函数\n     * @param string $gender\n     * @param string $sportType\n     */\n    public function __construct($gender='', $sportType='')\n    {\n        $this->_gender = $gender;\n        $this->_sportType = $sportType;\n    }\n\n    /**\n     * 魔法函数\n     * @param  string $value\n     * @return mixed\n     */\n    public function __get($value='')\n    {\n        $value = '_' . $value;\n        return $this->$value;\n    }\n}\n\n/**\n * 按性别过滤实体\n */\nclass FilterGender implements FilterInterface\n{\n    /**\n     * 按照本性别过滤\n     * @var string\n     */\n    private $_gender = '';\n\n    /**\n     * 构造函数\n     * @param string $gender\n     */\n    public function __construct($gender='')\n    {\n        $this->_gender = $gender;\n    }\n\n    /**\n     * 过滤方法\n     *\n     * @param  array $persons 运动员集合\n     * @return mixed\n     */\n    public function filter(array $persons)\n    {\n        foreach ($persons as $k => $v) {\n            if ($v->gender === $this->_gender) {\n                $personsFilter[] = $persons[$k];\n            }\n        }\n        return $personsFilter;\n    }\n}\n\n/**\n * 按运动项目过滤实体\n */\nclass FilterSportType implements FilterInterface\n{\n    /**\n     * 按照本运动项目过滤\n     * @var string\n     */\n    private $_sportType = '';\n\n    /**\n     * 构造函数\n     * @param string $sportType\n     */\n    public function __construct($sportType='')\n    {\n        $this->_sportType = $sportType;\n    }\n\n    /**\n     * 过滤方法\n     *\n     * @param  array $persons 运动员集合\n     * @return mixed\n     */\n    public function filter(array $persons)\n    {\n        foreach ($persons as $k => $v) {\n            if ($v->sportType === $this->_sportType) {\n                $personsFilter[] = $persons[$k];\n            }\n        }\n        return $personsFilter;\n    }\n}\n\n\ntry {\n    // 定义一组运动员\n    $persons = [];\n    echo '<pre/>';\n    $persons[] = new SportsPerson('male', 'basketball');\n    $persons[] = new SportsPerson('female', 'basketball');\n    $persons[] = new SportsPerson('male', 'football');\n    $persons[] = new SportsPerson('female', 'football');\n    $persons[] = new SportsPerson('male', 'swim');\n    $persons[] = new SportsPerson('female', 'swim');\n\n    // 按过滤男性\n    $filterGender = new FilterGender('male');\n    var_dump($filterGender->filter($persons));\n    // 过滤运动项目篮球\n    $filterSportType = new FilterSportType('basketball');\n    var_dump($filterSportType->filter($persons));\n\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n~~~\n","source":"_posts/2017-03-29-filter.md","raw":"---\ntitle:  \"PHP设计模式-过滤器\"\ndate: 2017-03-29 12:00:00\nupdated: 2017-03-29 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * **允许我们使用不同的规则过滤某一组对象**\n<!-- more -->\n\n\n## 代码示例\n\n~~~ PHP\n\n\n/**\n * 过滤接口\n */\ninterface FilterInterface\n{\n    /**\n     * 过滤方法\n     *\n     * @param  SportsMan $person 运动员\n     * @return mixed\n     */\n    public function filter(array $person);\n}\n\n\n/**\n * 按运动项目过滤实体\n */\nclass SportsPerson\n{\n    /**\n     * 性别\n     * @var string\n     */\n    private $_gender = '';\n\n    /**\n     * 按照本运动项目过滤\n     * @var string\n     */\n    private $_sportType = '';\n\n    /**\n     * 构造函数\n     * @param string $gender\n     * @param string $sportType\n     */\n    public function __construct($gender='', $sportType='')\n    {\n        $this->_gender = $gender;\n        $this->_sportType = $sportType;\n    }\n\n    /**\n     * 魔法函数\n     * @param  string $value\n     * @return mixed\n     */\n    public function __get($value='')\n    {\n        $value = '_' . $value;\n        return $this->$value;\n    }\n}\n\n/**\n * 按性别过滤实体\n */\nclass FilterGender implements FilterInterface\n{\n    /**\n     * 按照本性别过滤\n     * @var string\n     */\n    private $_gender = '';\n\n    /**\n     * 构造函数\n     * @param string $gender\n     */\n    public function __construct($gender='')\n    {\n        $this->_gender = $gender;\n    }\n\n    /**\n     * 过滤方法\n     *\n     * @param  array $persons 运动员集合\n     * @return mixed\n     */\n    public function filter(array $persons)\n    {\n        foreach ($persons as $k => $v) {\n            if ($v->gender === $this->_gender) {\n                $personsFilter[] = $persons[$k];\n            }\n        }\n        return $personsFilter;\n    }\n}\n\n/**\n * 按运动项目过滤实体\n */\nclass FilterSportType implements FilterInterface\n{\n    /**\n     * 按照本运动项目过滤\n     * @var string\n     */\n    private $_sportType = '';\n\n    /**\n     * 构造函数\n     * @param string $sportType\n     */\n    public function __construct($sportType='')\n    {\n        $this->_sportType = $sportType;\n    }\n\n    /**\n     * 过滤方法\n     *\n     * @param  array $persons 运动员集合\n     * @return mixed\n     */\n    public function filter(array $persons)\n    {\n        foreach ($persons as $k => $v) {\n            if ($v->sportType === $this->_sportType) {\n                $personsFilter[] = $persons[$k];\n            }\n        }\n        return $personsFilter;\n    }\n}\n\n\ntry {\n    // 定义一组运动员\n    $persons = [];\n    echo '<pre/>';\n    $persons[] = new SportsPerson('male', 'basketball');\n    $persons[] = new SportsPerson('female', 'basketball');\n    $persons[] = new SportsPerson('male', 'football');\n    $persons[] = new SportsPerson('female', 'football');\n    $persons[] = new SportsPerson('male', 'swim');\n    $persons[] = new SportsPerson('female', 'swim');\n\n    // 按过滤男性\n    $filterGender = new FilterGender('male');\n    var_dump($filterGender->filter($persons));\n    // 过滤运动项目篮球\n    $filterSportType = new FilterSportType('basketball');\n    var_dump($filterSportType->filter($persons));\n\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n~~~\n","slug":"2017-03-29-filter","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qke000vy4rbz5whgxex","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>允许我们使用不同的规则过滤某一组对象</strong><a id=\"more\"></a>\n\n\n</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 过滤接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">FilterInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 过滤方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  SportsMan $person 运动员</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">(array $person)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 按运动项目过滤实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SportsPerson</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 性别</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_gender = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 按照本运动项目过滤</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_sportType = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $gender</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $sportType</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($gender=<span class=\"string\">''</span>, $sportType=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_gender = $gender;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_sportType = $sportType;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔法函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $value = <span class=\"string\">'_'</span> . $value;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 按性别过滤实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FilterGender</span> <span class=\"keyword\">implements</span> <span class=\"title\">FilterInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 按照本性别过滤</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_gender = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $gender</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($gender=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_gender = $gender;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 过滤方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $persons 运动员集合</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">(array $persons)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($persons <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v-&gt;gender === <span class=\"keyword\">$this</span>-&gt;_gender) &#123;</span><br><span class=\"line\">                $personsFilter[] = $persons[$k];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $personsFilter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 按运动项目过滤实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FilterSportType</span> <span class=\"keyword\">implements</span> <span class=\"title\">FilterInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 按照本运动项目过滤</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_sportType = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $sportType</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($sportType=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_sportType = $sportType;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 过滤方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $persons 运动员集合</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">(array $persons)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($persons <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v-&gt;sportType === <span class=\"keyword\">$this</span>-&gt;_sportType) &#123;</span><br><span class=\"line\">                $personsFilter[] = $persons[$k];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $personsFilter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 定义一组运动员</span></span><br><span class=\"line\">    $persons = [];</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'&lt;pre/&gt;'</span>;</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'male'</span>, <span class=\"string\">'basketball'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'female'</span>, <span class=\"string\">'basketball'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'male'</span>, <span class=\"string\">'football'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'female'</span>, <span class=\"string\">'football'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'male'</span>, <span class=\"string\">'swim'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'female'</span>, <span class=\"string\">'swim'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 按过滤男性</span></span><br><span class=\"line\">    $filterGender = <span class=\"keyword\">new</span> FilterGender(<span class=\"string\">'male'</span>);</span><br><span class=\"line\">    var_dump($filterGender-&gt;filter($persons));</span><br><span class=\"line\">    <span class=\"comment\">// 过滤运动项目篮球</span></span><br><span class=\"line\">    $filterSportType = <span class=\"keyword\">new</span> FilterSportType(<span class=\"string\">'basketball'</span>);</span><br><span class=\"line\">    var_dump($filterSportType-&gt;filter($persons));</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>允许我们使用不同的规则过滤某一组对象</strong>","more":"</li>\n</ul>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 过滤接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">FilterInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 过滤方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  SportsMan $person 运动员</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">(array $person)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 按运动项目过滤实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SportsPerson</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 性别</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_gender = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 按照本运动项目过滤</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_sportType = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $gender</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $sportType</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($gender=<span class=\"string\">''</span>, $sportType=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_gender = $gender;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_sportType = $sportType;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔法函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $value = <span class=\"string\">'_'</span> . $value;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 按性别过滤实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FilterGender</span> <span class=\"keyword\">implements</span> <span class=\"title\">FilterInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 按照本性别过滤</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_gender = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $gender</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($gender=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_gender = $gender;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 过滤方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $persons 运动员集合</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">(array $persons)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($persons <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v-&gt;gender === <span class=\"keyword\">$this</span>-&gt;_gender) &#123;</span><br><span class=\"line\">                $personsFilter[] = $persons[$k];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $personsFilter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 按运动项目过滤实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FilterSportType</span> <span class=\"keyword\">implements</span> <span class=\"title\">FilterInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 按照本运动项目过滤</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_sportType = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $sportType</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($sportType=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_sportType = $sportType;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 过滤方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $persons 运动员集合</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span><span class=\"params\">(array $persons)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($persons <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v-&gt;sportType === <span class=\"keyword\">$this</span>-&gt;_sportType) &#123;</span><br><span class=\"line\">                $personsFilter[] = $persons[$k];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $personsFilter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 定义一组运动员</span></span><br><span class=\"line\">    $persons = [];</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'&lt;pre/&gt;'</span>;</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'male'</span>, <span class=\"string\">'basketball'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'female'</span>, <span class=\"string\">'basketball'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'male'</span>, <span class=\"string\">'football'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'female'</span>, <span class=\"string\">'football'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'male'</span>, <span class=\"string\">'swim'</span>);</span><br><span class=\"line\">    $persons[] = <span class=\"keyword\">new</span> SportsPerson(<span class=\"string\">'female'</span>, <span class=\"string\">'swim'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 按过滤男性</span></span><br><span class=\"line\">    $filterGender = <span class=\"keyword\">new</span> FilterGender(<span class=\"string\">'male'</span>);</span><br><span class=\"line\">    var_dump($filterGender-&gt;filter($persons));</span><br><span class=\"line\">    <span class=\"comment\">// 过滤运动项目篮球</span></span><br><span class=\"line\">    $filterSportType = <span class=\"keyword\">new</span> FilterSportType(<span class=\"string\">'basketball'</span>);</span><br><span class=\"line\">    var_dump($filterSportType-&gt;filter($persons));</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-策略","date":"2017-03-31T16:00:00.000Z","updated":"2017-03-31T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n *  **策略依照使用而定**\n\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 观察者接口\n */\ninterface StrategyInterface\n{\n    /**\n     * 行为\n     * @return void\n     */\n    public function doSomething();\n}\n\n/**\n * 观察者实体类示例1\n */\nclass StrategyExampleOne implements StrategyInterface\n{\n    /**\n     * 行为\n     * @return mixed\n     */\n    public function doSomething()\n    {\n        echo \"你选择了策略1 \\n\";\n    }\n}\n\n/**\n * 观察者实体类示例2\n */\nclass StrategyExampleTwo implements StrategyInterface\n{\n    /**\n     * 行为\n     * @return mixed\n     */\n    public function doSomething()\n    {\n        echo \"你选择了策略2 \\n\";\n    }\n}\n\n/**\n * 实体类\n *\n * 依赖外部不同策略的实体类\n */\nclass Substance\n{\n    /**\n     * 策略实例\n     * @var object\n     */\n    private $_strategy;\n\n    /**\n     * 构造函数\n     * 初始化策略\n     *\n     * @param Strategy $strategy 策略实例\n     */\n    public function __construct(StrategyInterface $strategy)\n    {\n        $this->_strategy = $strategy;\n    }\n\n    /**\n     * 模拟一个操作\n     *\n     * @return mixed\n     */\n    public function someOperation()\n    {\n        $this->_strategy->doSomething();\n    }\n}\n\n// 使用策略1\n$substanceOne = new Substance(new StrategyExampleOne);\n$substanceOne->someOperation();\n\n// 使用策略2\n$substanceTwo = new Substance(new StrategyExampleTwo);\n$substanceTwo->someOperation();\n\n~~~\n","source":"_posts/2017-03-31-strategy.md","raw":"---\ntitle:  \"PHP设计模式-策略\"\ndate: 2017-03-31 12:00:00\nupdated: 2017-03-31 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n *  **策略依照使用而定**\n\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 观察者接口\n */\ninterface StrategyInterface\n{\n    /**\n     * 行为\n     * @return void\n     */\n    public function doSomething();\n}\n\n/**\n * 观察者实体类示例1\n */\nclass StrategyExampleOne implements StrategyInterface\n{\n    /**\n     * 行为\n     * @return mixed\n     */\n    public function doSomething()\n    {\n        echo \"你选择了策略1 \\n\";\n    }\n}\n\n/**\n * 观察者实体类示例2\n */\nclass StrategyExampleTwo implements StrategyInterface\n{\n    /**\n     * 行为\n     * @return mixed\n     */\n    public function doSomething()\n    {\n        echo \"你选择了策略2 \\n\";\n    }\n}\n\n/**\n * 实体类\n *\n * 依赖外部不同策略的实体类\n */\nclass Substance\n{\n    /**\n     * 策略实例\n     * @var object\n     */\n    private $_strategy;\n\n    /**\n     * 构造函数\n     * 初始化策略\n     *\n     * @param Strategy $strategy 策略实例\n     */\n    public function __construct(StrategyInterface $strategy)\n    {\n        $this->_strategy = $strategy;\n    }\n\n    /**\n     * 模拟一个操作\n     *\n     * @return mixed\n     */\n    public function someOperation()\n    {\n        $this->_strategy->doSomething();\n    }\n}\n\n// 使用策略1\n$substanceOne = new Substance(new StrategyExampleOne);\n$substanceOne->someOperation();\n\n// 使用策略2\n$substanceTwo = new Substance(new StrategyExampleTwo);\n$substanceTwo->someOperation();\n\n~~~\n","slug":"2017-03-31-strategy","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkf000yy4rby7165za0","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>策略依照使用而定</strong></li>\n</ul>\n<a id=\"more\"></a>\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">StrategyInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者实体类示例1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StrategyExampleOne</span> <span class=\"keyword\">implements</span> <span class=\"title\">StrategyInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"你选择了策略1 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者实体类示例2</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StrategyExampleTwo</span> <span class=\"keyword\">implements</span> <span class=\"title\">StrategyInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"你选择了策略2 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体类</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 依赖外部不同策略的实体类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Substance</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 策略实例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_strategy;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化策略</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Strategy $strategy 策略实例</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(StrategyInterface $strategy)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_strategy = $strategy;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 模拟一个操作</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">someOperation</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_strategy-&gt;doSomething();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用策略1</span></span><br><span class=\"line\">$substanceOne = <span class=\"keyword\">new</span> Substance(<span class=\"keyword\">new</span> StrategyExampleOne);</span><br><span class=\"line\">$substanceOne-&gt;someOperation();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用策略2</span></span><br><span class=\"line\">$substanceTwo = <span class=\"keyword\">new</span> Substance(<span class=\"keyword\">new</span> StrategyExampleTwo);</span><br><span class=\"line\">$substanceTwo-&gt;someOperation();</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>策略依照使用而定</strong></li>\n</ul>","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">StrategyInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者实体类示例1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StrategyExampleOne</span> <span class=\"keyword\">implements</span> <span class=\"title\">StrategyInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"你选择了策略1 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者实体类示例2</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StrategyExampleTwo</span> <span class=\"keyword\">implements</span> <span class=\"title\">StrategyInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"你选择了策略2 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体类</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 依赖外部不同策略的实体类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Substance</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 策略实例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_strategy;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化策略</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Strategy $strategy 策略实例</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(StrategyInterface $strategy)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_strategy = $strategy;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 模拟一个操作</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">someOperation</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_strategy-&gt;doSomething();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用策略1</span></span><br><span class=\"line\">$substanceOne = <span class=\"keyword\">new</span> Substance(<span class=\"keyword\">new</span> StrategyExampleOne);</span><br><span class=\"line\">$substanceOne-&gt;someOperation();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用策略2</span></span><br><span class=\"line\">$substanceTwo = <span class=\"keyword\">new</span> Substance(<span class=\"keyword\">new</span> StrategyExampleTwo);</span><br><span class=\"line\">$substanceTwo-&gt;someOperation();</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-模板","date":"2017-03-30T16:00:00.000Z","updated":"2017-03-30T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * 理解：典型的控制反转，子类复写算法，但是最终的调用都是抽象类中定义的方式，也就是说抽象类中\n * 定义了算法的执行顺序\n * 使用场景：例如短信系统，选择不同的短信商，但是发送短信的动作都是一样的,未来要增加不同的厂商\n * 只需添加子类即可\n\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n\n\n/**\n * 短信抽象类\n *\n * 定义算法结构\n * 明确算法执行顺序\n */\nabstract class Sms\n{\n    /**\n     * 运营商配置\n     * @var string\n     */\n    protected $_config = [];\n\n    /**\n     * 短信文本\n     * @var string\n     */\n    protected $_text = '[xx公司]你好，你的验证码是';\n\n    /**\n     * 构造函数\n     *\n     * @param array $config 运营商配置\n     */\n    final function __construct($config=[])\n    {\n        // 初始化配置\n        $this->initialize($config);\n    }\n\n    /**\n     * 初始化运营商配置\n     *\n     * 每个厂商的配置不一定相同，所以子类复写这个方法即可\n     *\n     * @param  array $config 运营商配置\n     * @return void\n     */\n    abstract function initialize($config=[]);\n\n    /**\n     * 生成短信文本\n     *\n     * 短信模板和厂商无关\n     *\n     * @return void\n     */\n    function makeText()\n    {\n        $this->_text .= rand(000000, 999999);\n    }\n\n    /**\n     * 厂商发送短信方法\n     *\n     * 每个厂商复写这个方法即可\n     *\n     * @param  integer $mobile 手机号\n     * @return void\n     */\n    abstract function sendSms($mobile=0);\n\n    /**\n     * 发送短信\n     *\n     * 最终调用的方法，明确了算法顺序\n     *\n     * @param  integer $mobile 手机号\n     * @return void\n     */\n    final function send($mobile=0)\n    {\n        // 生成文本\n        $this->makeText();\n        // 发送短信\n        $this->sendSms($mobile);\n    }\n\n}\n\n/**\n * 某厂商one\n */\nclass SmsCompanyOne extends Sms\n{\n\n    /**\n     * 初始化运营商配置\n     *\n     * 每个厂商的配置不一定相同，所以子类复写这个方法即可\n     *\n     * @param  array $config 运营商配置\n     * @return void\n     */\n    function initialize($config=[])\n    {\n        // 实现具体算法\n        $this->_config = $config;\n    }\n\n    /**\n     * 厂商发送短信方法\n     *\n     * 每个厂商复写这个方法即可\n     *\n     * @param  integer $mobile 手机号\n     * @return void\n     */\n    function sendSms($mobile=0)\n    {\n        // 实现具体的短信发送方法\n        echo \"厂商‘one’给手机号{$mobile}发送了短信：{$this->_text} \\n\";\n    }\n\n}\n\n/**\n * 某厂商two\n */\nclass SmsCompanyTwo extends Sms\n{\n\n    /**\n     * 初始化运营商配置\n     *\n     * 每个厂商的配置不一定相同，所以子类复写这个方法即可\n     *\n     * @param  array $config 运营商配置\n     * @return void\n     */\n    function initialize($config=[])\n    {\n        // 实现具体算法\n        $this->_config = $config;\n    }\n\n    /**\n     * 厂商发送短信方法\n     *\n     * 每个厂商复写这个方法即可\n     *\n     * @param  integer $mobile 手机号\n     * @return void\n     */\n    function sendSms($mobile=0)\n    {\n        // 实现具体的短信发送方法\n        echo \"厂商‘two’给手机号{$mobile}发送了短信：{$this->_text} \\n\";\n    }\n\n}\n\n\ntry {\n    // 用厂商one发短信\n    $one = new SmsCompanyOne([\n        'appkey' => 'akjlooolllnn',\n    ]);\n    $one->send('13666666666');\n\n    // 用厂商two发短息\n    $one = new SmsCompanyTwo([\n        'pwd' => 'adadeooonn',\n    ]);\n    $one->send('13666666666');\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n~~~\n","source":"_posts/2017-03-30-template.md","raw":"---\ntitle:  \"PHP设计模式-模板\"\ndate: 2017-03-30 12:00:00\nupdated: 2017-03-30 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * 理解：典型的控制反转，子类复写算法，但是最终的调用都是抽象类中定义的方式，也就是说抽象类中\n * 定义了算法的执行顺序\n * 使用场景：例如短信系统，选择不同的短信商，但是发送短信的动作都是一样的,未来要增加不同的厂商\n * 只需添加子类即可\n\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n\n\n/**\n * 短信抽象类\n *\n * 定义算法结构\n * 明确算法执行顺序\n */\nabstract class Sms\n{\n    /**\n     * 运营商配置\n     * @var string\n     */\n    protected $_config = [];\n\n    /**\n     * 短信文本\n     * @var string\n     */\n    protected $_text = '[xx公司]你好，你的验证码是';\n\n    /**\n     * 构造函数\n     *\n     * @param array $config 运营商配置\n     */\n    final function __construct($config=[])\n    {\n        // 初始化配置\n        $this->initialize($config);\n    }\n\n    /**\n     * 初始化运营商配置\n     *\n     * 每个厂商的配置不一定相同，所以子类复写这个方法即可\n     *\n     * @param  array $config 运营商配置\n     * @return void\n     */\n    abstract function initialize($config=[]);\n\n    /**\n     * 生成短信文本\n     *\n     * 短信模板和厂商无关\n     *\n     * @return void\n     */\n    function makeText()\n    {\n        $this->_text .= rand(000000, 999999);\n    }\n\n    /**\n     * 厂商发送短信方法\n     *\n     * 每个厂商复写这个方法即可\n     *\n     * @param  integer $mobile 手机号\n     * @return void\n     */\n    abstract function sendSms($mobile=0);\n\n    /**\n     * 发送短信\n     *\n     * 最终调用的方法，明确了算法顺序\n     *\n     * @param  integer $mobile 手机号\n     * @return void\n     */\n    final function send($mobile=0)\n    {\n        // 生成文本\n        $this->makeText();\n        // 发送短信\n        $this->sendSms($mobile);\n    }\n\n}\n\n/**\n * 某厂商one\n */\nclass SmsCompanyOne extends Sms\n{\n\n    /**\n     * 初始化运营商配置\n     *\n     * 每个厂商的配置不一定相同，所以子类复写这个方法即可\n     *\n     * @param  array $config 运营商配置\n     * @return void\n     */\n    function initialize($config=[])\n    {\n        // 实现具体算法\n        $this->_config = $config;\n    }\n\n    /**\n     * 厂商发送短信方法\n     *\n     * 每个厂商复写这个方法即可\n     *\n     * @param  integer $mobile 手机号\n     * @return void\n     */\n    function sendSms($mobile=0)\n    {\n        // 实现具体的短信发送方法\n        echo \"厂商‘one’给手机号{$mobile}发送了短信：{$this->_text} \\n\";\n    }\n\n}\n\n/**\n * 某厂商two\n */\nclass SmsCompanyTwo extends Sms\n{\n\n    /**\n     * 初始化运营商配置\n     *\n     * 每个厂商的配置不一定相同，所以子类复写这个方法即可\n     *\n     * @param  array $config 运营商配置\n     * @return void\n     */\n    function initialize($config=[])\n    {\n        // 实现具体算法\n        $this->_config = $config;\n    }\n\n    /**\n     * 厂商发送短信方法\n     *\n     * 每个厂商复写这个方法即可\n     *\n     * @param  integer $mobile 手机号\n     * @return void\n     */\n    function sendSms($mobile=0)\n    {\n        // 实现具体的短信发送方法\n        echo \"厂商‘two’给手机号{$mobile}发送了短信：{$this->_text} \\n\";\n    }\n\n}\n\n\ntry {\n    // 用厂商one发短信\n    $one = new SmsCompanyOne([\n        'appkey' => 'akjlooolllnn',\n    ]);\n    $one->send('13666666666');\n\n    // 用厂商two发短息\n    $one = new SmsCompanyTwo([\n        'pwd' => 'adadeooonn',\n    ]);\n    $one->send('13666666666');\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n~~~\n","slug":"2017-03-30-template","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkg0012y4rbr99wozip","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>理解：典型的控制反转，子类复写算法，但是最终的调用都是抽象类中定义的方式，也就是说抽象类中</li>\n<li>定义了算法的执行顺序</li>\n<li>使用场景：例如短信系统，选择不同的短信商，但是发送短信的动作都是一样的,未来要增加不同的厂商</li>\n<li>只需添加子类即可</li>\n</ul>\n<a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 短信抽象类</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 定义算法结构</span></span><br><span class=\"line\"><span class=\"comment\"> * 明确算法执行顺序</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Sms</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_config = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 短信文本</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_text = <span class=\"string\">'[xx公司]你好，你的验证码是'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $config 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($config=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化配置</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;initialize($config);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商的配置不一定相同，所以子类复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $config 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initialize</span><span class=\"params\">($config=[])</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生成短信文本</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 短信模板和厂商无关</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeText</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text .= rand(<span class=\"number\">000000</span>, <span class=\"number\">999999</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 厂商发送短信方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  integer $mobile 手机号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sendSms</span><span class=\"params\">($mobile=<span class=\"number\">0</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送短信</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 最终调用的方法，明确了算法顺序</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  integer $mobile 手机号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">send</span><span class=\"params\">($mobile=<span class=\"number\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 生成文本</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;makeText();</span><br><span class=\"line\">        <span class=\"comment\">// 发送短信</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;sendSms($mobile);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 某厂商one</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SmsCompanyOne</span> <span class=\"keyword\">extends</span> <span class=\"title\">Sms</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商的配置不一定相同，所以子类复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $config 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initialize</span><span class=\"params\">($config=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 实现具体算法</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_config = $config;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 厂商发送短信方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  integer $mobile 手机号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sendSms</span><span class=\"params\">($mobile=<span class=\"number\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 实现具体的短信发送方法</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"厂商‘one’给手机号&#123;$mobile&#125;发送了短信：&#123;$this-&gt;_text&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 某厂商two</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SmsCompanyTwo</span> <span class=\"keyword\">extends</span> <span class=\"title\">Sms</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商的配置不一定相同，所以子类复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $config 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initialize</span><span class=\"params\">($config=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 实现具体算法</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_config = $config;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 厂商发送短信方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  integer $mobile 手机号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sendSms</span><span class=\"params\">($mobile=<span class=\"number\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 实现具体的短信发送方法</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"厂商‘two’给手机号&#123;$mobile&#125;发送了短信：&#123;$this-&gt;_text&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 用厂商one发短信</span></span><br><span class=\"line\">    $one = <span class=\"keyword\">new</span> SmsCompanyOne([</span><br><span class=\"line\">        <span class=\"string\">'appkey'</span> =&gt; <span class=\"string\">'akjlooolllnn'</span>,</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    $one-&gt;send(<span class=\"string\">'13666666666'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 用厂商two发短息</span></span><br><span class=\"line\">    $one = <span class=\"keyword\">new</span> SmsCompanyTwo([</span><br><span class=\"line\">        <span class=\"string\">'pwd'</span> =&gt; <span class=\"string\">'adadeooonn'</span>,</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    $one-&gt;send(<span class=\"string\">'13666666666'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>理解：典型的控制反转，子类复写算法，但是最终的调用都是抽象类中定义的方式，也就是说抽象类中</li>\n<li>定义了算法的执行顺序</li>\n<li>使用场景：例如短信系统，选择不同的短信商，但是发送短信的动作都是一样的,未来要增加不同的厂商</li>\n<li>只需添加子类即可</li>\n</ul>","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 短信抽象类</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 定义算法结构</span></span><br><span class=\"line\"><span class=\"comment\"> * 明确算法执行顺序</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Sms</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_config = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 短信文本</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> $_text = <span class=\"string\">'[xx公司]你好，你的验证码是'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $config 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($config=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化配置</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;initialize($config);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商的配置不一定相同，所以子类复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $config 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initialize</span><span class=\"params\">($config=[])</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生成短信文本</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 短信模板和厂商无关</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeText</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text .= rand(<span class=\"number\">000000</span>, <span class=\"number\">999999</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 厂商发送短信方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  integer $mobile 手机号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sendSms</span><span class=\"params\">($mobile=<span class=\"number\">0</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送短信</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 最终调用的方法，明确了算法顺序</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  integer $mobile 手机号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">send</span><span class=\"params\">($mobile=<span class=\"number\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 生成文本</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;makeText();</span><br><span class=\"line\">        <span class=\"comment\">// 发送短信</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;sendSms($mobile);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 某厂商one</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SmsCompanyOne</span> <span class=\"keyword\">extends</span> <span class=\"title\">Sms</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商的配置不一定相同，所以子类复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $config 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initialize</span><span class=\"params\">($config=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 实现具体算法</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_config = $config;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 厂商发送短信方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  integer $mobile 手机号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sendSms</span><span class=\"params\">($mobile=<span class=\"number\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 实现具体的短信发送方法</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"厂商‘one’给手机号&#123;$mobile&#125;发送了短信：&#123;$this-&gt;_text&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 某厂商two</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SmsCompanyTwo</span> <span class=\"keyword\">extends</span> <span class=\"title\">Sms</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商的配置不一定相同，所以子类复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $config 运营商配置</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initialize</span><span class=\"params\">($config=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 实现具体算法</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_config = $config;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 厂商发送短信方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 每个厂商复写这个方法即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  integer $mobile 手机号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sendSms</span><span class=\"params\">($mobile=<span class=\"number\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 实现具体的短信发送方法</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"厂商‘two’给手机号&#123;$mobile&#125;发送了短信：&#123;$this-&gt;_text&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 用厂商one发短信</span></span><br><span class=\"line\">    $one = <span class=\"keyword\">new</span> SmsCompanyOne([</span><br><span class=\"line\">        <span class=\"string\">'appkey'</span> =&gt; <span class=\"string\">'akjlooolllnn'</span>,</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    $one-&gt;send(<span class=\"string\">'13666666666'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 用厂商two发短息</span></span><br><span class=\"line\">    $one = <span class=\"keyword\">new</span> SmsCompanyTwo([</span><br><span class=\"line\">        <span class=\"string\">'pwd'</span> =&gt; <span class=\"string\">'adadeooonn'</span>,</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    $one-&gt;send(<span class=\"string\">'13666666666'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-状态","date":"2017-04-04T16:00:00.000Z","updated":"2017-04-04T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * **理解：行为随着状态变化**\n * 区别：\n * - 策略的改变由client完成，client持有context的引用；而状态的改变是由context或状态自己,\n * 就是自身持有context\n * - 简单说就是策略是client持有context，而状态是本身持有context\n * 使用场景：大量和对象状态相关的条件语句\n * \n * 下面我们来实现一个农民四季种菜\n * 春季：玉米\n * 夏季：黄瓜\n * 秋季：白菜\n * 冬季：菠菜\n\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 农耕接口\n */\ninterface Farm\n{\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow();\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest();\n\n}\n\n/**\n * 农耕接口\n */\nclass FarmAutumn implements Farm\n{\n    /**\n     * 作物名称\n     * @var string\n     */\n    private $_name = '白菜';\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        echo \"种植了一片 {$this->_name} \\n\";\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        echo \"收获了一片 {$this->_name} \\n\";\n    }\n\n}\n\n/**\n * 农耕接口\n */\nclass FarmSpring implements Farm\n{\n    /**\n     * 作物名称\n     * @var string\n     */\n    private $_name = '玉米';\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        echo \"种植了一片 {$this->_name} \\n\";\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        echo \"收获了一片 {$this->_name} \\n\";\n    }\n}\n\n/**\n * 农耕接口\n */\nclass FarmSummer implements Farm\n{\n    /**\n     * 作物名称\n     * @var string\n     */\n    private $_name = '黄瓜';\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        echo \"种植了一片 {$this->_name} \\n\";\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        echo \"收获了一片 {$this->_name} \\n\";\n    }\n\n}\n\n/**\n * 农耕接口\n */\nclass FarmWinter implements Farm\n{\n    /**\n     * 作物名称\n     * @var string\n     */\n    private $_name = '菠菜';\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        echo \"种植了一片 {$this->_name} \\n\";\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        echo \"收获了一片 {$this->_name} \\n\";\n    }\n\n}\n\n/**\n * 农民类\n */\nclass Farmer\n{\n    /**\n     * 当前季节\n     *\n     * @var string\n     */\n    private $_currentSeason = '';\n\n    /**\n     * 季节\n     * @var string\n     */\n    private $_season = [\n        'spring',\n        'summer',\n        'autumn',\n        'winter'\n    ];\n\n    /**\n     * 状态\n     * @var object\n     */\n    private $_state;\n\n    /**\n     * 设置状态\n     * @param Farm $farm 种植方法\n     */\n    private function setState($currentSeason)\n    {\n        if ($currentSeason === 'spring') {\n            $this->_state = new FarmSpring();\n        }\n        if ($currentSeason === 'summer') {\n            $this->_state = new FarmSummer();\n        }\n        if ($currentSeason === 'autumn') {\n            $this->_state = new FarmAutumn();\n        }\n        if ($currentSeason === 'winter') {\n            $this->_state = new FarmWinter();\n        }\n    }\n\n    /**\n     * 设置下个季节状态\n     */\n    private function nextSeason()\n    {\n        $nowKey = (int)array_search($this->_currentSeason, $this->_season);\n        if ($nowKey < 3) {\n            $nextSeason = $this->_season[$nowKey+1];\n        }else{\n            $nextSeason = 'spring';\n        }\n        $this->_currentSeason = $nextSeason;\n        $this->setState($this->_currentSeason);\n    }\n\n    /**\n     * 设置初始状态\n     */\n    function __construct($season = 'spring')\n    {\n        $this->_currentSeason = $season;\n        $this->setState($this->_currentSeason);\n    }\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        $this->_state->grow();\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        $this->_state->harvest();\n        // 设置下一个季节状态\n        $this->nextSeason();\n    }\n\n}\n\ntry {\n    // 初始化一个农民\n    $farmer = new Farmer();\n\n    // 春季\n    $farmer->grow();\n    $farmer->harvest();\n    // 夏季\n    $farmer->grow();\n    $farmer->harvest();\n    // 秋季\n    $farmer->grow();\n    $farmer->harvest();\n    // 冬季\n    $farmer->grow();\n    $farmer->harvest();\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n~~~\n","source":"_posts/2017-04-04-state.md","raw":"---\ntitle:  \"PHP设计模式-状态\"\ndate: 2017-04-04 12:00:00\nupdated: 2017-04-04 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * **理解：行为随着状态变化**\n * 区别：\n * - 策略的改变由client完成，client持有context的引用；而状态的改变是由context或状态自己,\n * 就是自身持有context\n * - 简单说就是策略是client持有context，而状态是本身持有context\n * 使用场景：大量和对象状态相关的条件语句\n * \n * 下面我们来实现一个农民四季种菜\n * 春季：玉米\n * 夏季：黄瓜\n * 秋季：白菜\n * 冬季：菠菜\n\n<!-- more -->\n\n## 代码示例\n\n~~~ PHP\n\n/**\n * 农耕接口\n */\ninterface Farm\n{\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow();\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest();\n\n}\n\n/**\n * 农耕接口\n */\nclass FarmAutumn implements Farm\n{\n    /**\n     * 作物名称\n     * @var string\n     */\n    private $_name = '白菜';\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        echo \"种植了一片 {$this->_name} \\n\";\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        echo \"收获了一片 {$this->_name} \\n\";\n    }\n\n}\n\n/**\n * 农耕接口\n */\nclass FarmSpring implements Farm\n{\n    /**\n     * 作物名称\n     * @var string\n     */\n    private $_name = '玉米';\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        echo \"种植了一片 {$this->_name} \\n\";\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        echo \"收获了一片 {$this->_name} \\n\";\n    }\n}\n\n/**\n * 农耕接口\n */\nclass FarmSummer implements Farm\n{\n    /**\n     * 作物名称\n     * @var string\n     */\n    private $_name = '黄瓜';\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        echo \"种植了一片 {$this->_name} \\n\";\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        echo \"收获了一片 {$this->_name} \\n\";\n    }\n\n}\n\n/**\n * 农耕接口\n */\nclass FarmWinter implements Farm\n{\n    /**\n     * 作物名称\n     * @var string\n     */\n    private $_name = '菠菜';\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        echo \"种植了一片 {$this->_name} \\n\";\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        echo \"收获了一片 {$this->_name} \\n\";\n    }\n\n}\n\n/**\n * 农民类\n */\nclass Farmer\n{\n    /**\n     * 当前季节\n     *\n     * @var string\n     */\n    private $_currentSeason = '';\n\n    /**\n     * 季节\n     * @var string\n     */\n    private $_season = [\n        'spring',\n        'summer',\n        'autumn',\n        'winter'\n    ];\n\n    /**\n     * 状态\n     * @var object\n     */\n    private $_state;\n\n    /**\n     * 设置状态\n     * @param Farm $farm 种植方法\n     */\n    private function setState($currentSeason)\n    {\n        if ($currentSeason === 'spring') {\n            $this->_state = new FarmSpring();\n        }\n        if ($currentSeason === 'summer') {\n            $this->_state = new FarmSummer();\n        }\n        if ($currentSeason === 'autumn') {\n            $this->_state = new FarmAutumn();\n        }\n        if ($currentSeason === 'winter') {\n            $this->_state = new FarmWinter();\n        }\n    }\n\n    /**\n     * 设置下个季节状态\n     */\n    private function nextSeason()\n    {\n        $nowKey = (int)array_search($this->_currentSeason, $this->_season);\n        if ($nowKey < 3) {\n            $nextSeason = $this->_season[$nowKey+1];\n        }else{\n            $nextSeason = 'spring';\n        }\n        $this->_currentSeason = $nextSeason;\n        $this->setState($this->_currentSeason);\n    }\n\n    /**\n     * 设置初始状态\n     */\n    function __construct($season = 'spring')\n    {\n        $this->_currentSeason = $season;\n        $this->setState($this->_currentSeason);\n    }\n\n    /**\n     * 种植\n     *\n     * @return string\n     */\n    function grow()\n    {\n        $this->_state->grow();\n    }\n\n    /**\n     * 收割\n     *\n     * @return string\n     */\n    function harvest()\n    {\n        $this->_state->harvest();\n        // 设置下一个季节状态\n        $this->nextSeason();\n    }\n\n}\n\ntry {\n    // 初始化一个农民\n    $farmer = new Farmer();\n\n    // 春季\n    $farmer->grow();\n    $farmer->harvest();\n    // 夏季\n    $farmer->grow();\n    $farmer->harvest();\n    // 秋季\n    $farmer->grow();\n    $farmer->harvest();\n    // 冬季\n    $farmer->grow();\n    $farmer->harvest();\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n~~~\n","slug":"2017-04-04-state","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkh0015y4rb8cuh5yt7","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>理解：行为随着状态变化</strong></li>\n<li>区别：</li>\n<li><ul>\n<li>策略的改变由client完成，client持有context的引用；而状态的改变是由context或状态自己,</li>\n</ul>\n</li>\n<li>就是自身持有context</li>\n<li><ul>\n<li>简单说就是策略是client持有context，而状态是本身持有context</li>\n</ul>\n</li>\n<li>使用场景：大量和对象状态相关的条件语句</li>\n<li></li>\n<li>下面我们来实现一个农民四季种菜</li>\n<li>春季：玉米</li>\n<li>夏季：黄瓜</li>\n<li>秋季：白菜</li>\n<li>冬季：菠菜</li>\n</ul>\n<a id=\"more\"></a>\n\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FarmAutumn</span> <span class=\"keyword\">implements</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 作物名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'白菜'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"种植了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"收获了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FarmSpring</span> <span class=\"keyword\">implements</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 作物名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'玉米'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"种植了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"收获了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FarmSummer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 作物名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'黄瓜'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"种植了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"收获了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FarmWinter</span> <span class=\"keyword\">implements</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 作物名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'菠菜'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"种植了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"收获了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农民类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Farmer</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前季节</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_currentSeason = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 季节</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_season = [</span><br><span class=\"line\">        <span class=\"string\">'spring'</span>,</span><br><span class=\"line\">        <span class=\"string\">'summer'</span>,</span><br><span class=\"line\">        <span class=\"string\">'autumn'</span>,</span><br><span class=\"line\">        <span class=\"string\">'winter'</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 状态</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_state;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置状态</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Farm $farm 种植方法</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setState</span><span class=\"params\">($currentSeason)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($currentSeason === <span class=\"string\">'spring'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_state = <span class=\"keyword\">new</span> FarmSpring();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($currentSeason === <span class=\"string\">'summer'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_state = <span class=\"keyword\">new</span> FarmSummer();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($currentSeason === <span class=\"string\">'autumn'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_state = <span class=\"keyword\">new</span> FarmAutumn();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($currentSeason === <span class=\"string\">'winter'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_state = <span class=\"keyword\">new</span> FarmWinter();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置下个季节状态</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">nextSeason</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $nowKey = (int)array_search(<span class=\"keyword\">$this</span>-&gt;_currentSeason, <span class=\"keyword\">$this</span>-&gt;_season);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($nowKey &lt; <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">            $nextSeason = <span class=\"keyword\">$this</span>-&gt;_season[$nowKey+<span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            $nextSeason = <span class=\"string\">'spring'</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_currentSeason = $nextSeason;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;setState(<span class=\"keyword\">$this</span>-&gt;_currentSeason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置初始状态</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($season = <span class=\"string\">'spring'</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_currentSeason = $season;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;setState(<span class=\"keyword\">$this</span>-&gt;_currentSeason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_state-&gt;grow();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_state-&gt;harvest();</span><br><span class=\"line\">        <span class=\"comment\">// 设置下一个季节状态</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nextSeason();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个农民</span></span><br><span class=\"line\">    $farmer = <span class=\"keyword\">new</span> Farmer();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 春季</span></span><br><span class=\"line\">    $farmer-&gt;grow();</span><br><span class=\"line\">    $farmer-&gt;harvest();</span><br><span class=\"line\">    <span class=\"comment\">// 夏季</span></span><br><span class=\"line\">    $farmer-&gt;grow();</span><br><span class=\"line\">    $farmer-&gt;harvest();</span><br><span class=\"line\">    <span class=\"comment\">// 秋季</span></span><br><span class=\"line\">    $farmer-&gt;grow();</span><br><span class=\"line\">    $farmer-&gt;harvest();</span><br><span class=\"line\">    <span class=\"comment\">// 冬季</span></span><br><span class=\"line\">    $farmer-&gt;grow();</span><br><span class=\"line\">    $farmer-&gt;harvest();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>理解：行为随着状态变化</strong></li>\n<li>区别：</li>\n<li><ul>\n<li>策略的改变由client完成，client持有context的引用；而状态的改变是由context或状态自己,</li>\n</ul>\n</li>\n<li>就是自身持有context</li>\n<li><ul>\n<li>简单说就是策略是client持有context，而状态是本身持有context</li>\n</ul>\n</li>\n<li>使用场景：大量和对象状态相关的条件语句</li>\n<li></li>\n<li>下面我们来实现一个农民四季种菜</li>\n<li>春季：玉米</li>\n<li>夏季：黄瓜</li>\n<li>秋季：白菜</li>\n<li>冬季：菠菜</li>\n</ul>","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FarmAutumn</span> <span class=\"keyword\">implements</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 作物名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'白菜'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"种植了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"收获了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FarmSpring</span> <span class=\"keyword\">implements</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 作物名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'玉米'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"种植了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"收获了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FarmSummer</span> <span class=\"keyword\">implements</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 作物名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'黄瓜'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"种植了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"收获了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农耕接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FarmWinter</span> <span class=\"keyword\">implements</span> <span class=\"title\">Farm</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 作物名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'菠菜'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"种植了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"收获了一片 &#123;$this-&gt;_name&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 农民类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Farmer</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前季节</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_currentSeason = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 季节</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_season = [</span><br><span class=\"line\">        <span class=\"string\">'spring'</span>,</span><br><span class=\"line\">        <span class=\"string\">'summer'</span>,</span><br><span class=\"line\">        <span class=\"string\">'autumn'</span>,</span><br><span class=\"line\">        <span class=\"string\">'winter'</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 状态</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_state;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置状态</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Farm $farm 种植方法</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setState</span><span class=\"params\">($currentSeason)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($currentSeason === <span class=\"string\">'spring'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_state = <span class=\"keyword\">new</span> FarmSpring();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($currentSeason === <span class=\"string\">'summer'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_state = <span class=\"keyword\">new</span> FarmSummer();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($currentSeason === <span class=\"string\">'autumn'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_state = <span class=\"keyword\">new</span> FarmAutumn();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($currentSeason === <span class=\"string\">'winter'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_state = <span class=\"keyword\">new</span> FarmWinter();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置下个季节状态</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">nextSeason</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $nowKey = (int)array_search(<span class=\"keyword\">$this</span>-&gt;_currentSeason, <span class=\"keyword\">$this</span>-&gt;_season);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($nowKey &lt; <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">            $nextSeason = <span class=\"keyword\">$this</span>-&gt;_season[$nowKey+<span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            $nextSeason = <span class=\"string\">'spring'</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_currentSeason = $nextSeason;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;setState(<span class=\"keyword\">$this</span>-&gt;_currentSeason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置初始状态</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($season = <span class=\"string\">'spring'</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_currentSeason = $season;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;setState(<span class=\"keyword\">$this</span>-&gt;_currentSeason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 种植</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">grow</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_state-&gt;grow();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 收割</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">harvest</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_state-&gt;harvest();</span><br><span class=\"line\">        <span class=\"comment\">// 设置下一个季节状态</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;nextSeason();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个农民</span></span><br><span class=\"line\">    $farmer = <span class=\"keyword\">new</span> Farmer();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 春季</span></span><br><span class=\"line\">    $farmer-&gt;grow();</span><br><span class=\"line\">    $farmer-&gt;harvest();</span><br><span class=\"line\">    <span class=\"comment\">// 夏季</span></span><br><span class=\"line\">    $farmer-&gt;grow();</span><br><span class=\"line\">    $farmer-&gt;harvest();</span><br><span class=\"line\">    <span class=\"comment\">// 秋季</span></span><br><span class=\"line\">    $farmer-&gt;grow();</span><br><span class=\"line\">    $farmer-&gt;harvest();</span><br><span class=\"line\">    <span class=\"comment\">// 冬季</span></span><br><span class=\"line\">    $farmer-&gt;grow();</span><br><span class=\"line\">    $farmer-&gt;harvest();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-观察者","date":"2017-04-05T16:00:00.000Z","updated":"2017-04-05T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * **观察者观察被观察者，被观察者通知观察者**\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n\n/**\n * 观察者接口\n */\ninterface ObserverInterface\n{\n    /**\n     * 行为\n     * @return void\n     */\n    public function doSomething(ObservableInterface $observable);\n}\n\n/**\n * 观察者实体类示例1\n */\nclass ObserverExampleOne implements ObserverInterface\n{\n    /**\n     * 行为\n     * @return mixed\n     */\n    public function doSomething(ObservableInterface $observable)\n    {\n        echo $observable->_name . \"通知了观察者1 \\n\";\n    }\n}\n\n/**\n * 观察者实体类示例2\n */\nclass ObserverExampleTwo implements ObserverInterface\n{\n    /**\n     * 行为\n     * @return mixed\n     */\n    public function doSomething(ObservableInterface $observable)\n    {\n        echo $observable->_name . \"通知了观察者2 \\n\";\n    }\n}\n\n/**\n * 被观察者接口\n *\n * 需要实现附加观察者，删除观察者，通知观察者方法\n */\ninterface ObservableInterface\n{\n    /**\n     * 附加观察者\n     * @return void\n     */\n    public function attach(ObserverInterface $observer);\n\n    /**\n     * 解除观察者\n     * @return void\n     */\n    public function detach(ObserverInterface $observer);\n\n    /**\n     * 通知观察者\n     * @return void\n     */\n    public function notify();\n}\n\n/**\n * 被观察者实体类\n *\n * 实现附加观察者，删除观察者，通知观察者方法\n */\nclass Observable implements ObservableInterface\n{\n    /**\n     * 观察者们\n     * @var array\n     */\n    private $_observers = [];\n\n    /**\n     * 被观察者名称\n     * @var string\n     */\n    private $_name = '【被观察者:皮皮虾】';\n\n    /**\n     * 魔术方法 __get\n     * @param  string $name 属性名称\n     * @return mixed\n     */\n    public function __get($name='')\n    {\n        return $this->$name;\n    }\n\n    /**\n     * 附加观察者\n     * @return void\n     */\n    public function attach(ObserverInterface $observer)\n    {\n        if (!in_array($observer, $this->_observers, true)) {\n            $this->_observers[] = $observer;\n        }\n    }\n\n    /**\n     * 解除观察者\n     * @return void\n     */\n    public function detach(ObserverInterface $observer)\n    {\n        foreach ($this->_observers as $k => $v) {\n            if ($v === $observer) {\n                unset($this->_observers[$k]);\n            }\n        }\n    }\n\n    /**\n     * 通知观察者\n     * @return void\n     */\n    public function notify()\n    {\n        foreach ($this->_observers as $v) {\n            $v->doSomething($this);\n        }\n    }\n}\n\n// 注册一个被观察者对象\n$observable = new Observable();\n// 注册观察者们\n$observerExampleOne = new ObserverExampleOne();\n$observerExampleTwo = new ObserverExampleTwo();\n\n// 附加观察者\n$observable->attach($observerExampleOne);\n$observable->attach($observerExampleTwo);\n\n// 被观察者通知观察者们\n$observable->notify();\n\n~~~\n","source":"_posts/2017-04-05-observer.md","raw":"---\ntitle:  \"PHP设计模式-观察者\"\ndate: 2017-04-05 12:00:00\nupdated: 2017-04-05 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * **观察者观察被观察者，被观察者通知观察者**\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n\n/**\n * 观察者接口\n */\ninterface ObserverInterface\n{\n    /**\n     * 行为\n     * @return void\n     */\n    public function doSomething(ObservableInterface $observable);\n}\n\n/**\n * 观察者实体类示例1\n */\nclass ObserverExampleOne implements ObserverInterface\n{\n    /**\n     * 行为\n     * @return mixed\n     */\n    public function doSomething(ObservableInterface $observable)\n    {\n        echo $observable->_name . \"通知了观察者1 \\n\";\n    }\n}\n\n/**\n * 观察者实体类示例2\n */\nclass ObserverExampleTwo implements ObserverInterface\n{\n    /**\n     * 行为\n     * @return mixed\n     */\n    public function doSomething(ObservableInterface $observable)\n    {\n        echo $observable->_name . \"通知了观察者2 \\n\";\n    }\n}\n\n/**\n * 被观察者接口\n *\n * 需要实现附加观察者，删除观察者，通知观察者方法\n */\ninterface ObservableInterface\n{\n    /**\n     * 附加观察者\n     * @return void\n     */\n    public function attach(ObserverInterface $observer);\n\n    /**\n     * 解除观察者\n     * @return void\n     */\n    public function detach(ObserverInterface $observer);\n\n    /**\n     * 通知观察者\n     * @return void\n     */\n    public function notify();\n}\n\n/**\n * 被观察者实体类\n *\n * 实现附加观察者，删除观察者，通知观察者方法\n */\nclass Observable implements ObservableInterface\n{\n    /**\n     * 观察者们\n     * @var array\n     */\n    private $_observers = [];\n\n    /**\n     * 被观察者名称\n     * @var string\n     */\n    private $_name = '【被观察者:皮皮虾】';\n\n    /**\n     * 魔术方法 __get\n     * @param  string $name 属性名称\n     * @return mixed\n     */\n    public function __get($name='')\n    {\n        return $this->$name;\n    }\n\n    /**\n     * 附加观察者\n     * @return void\n     */\n    public function attach(ObserverInterface $observer)\n    {\n        if (!in_array($observer, $this->_observers, true)) {\n            $this->_observers[] = $observer;\n        }\n    }\n\n    /**\n     * 解除观察者\n     * @return void\n     */\n    public function detach(ObserverInterface $observer)\n    {\n        foreach ($this->_observers as $k => $v) {\n            if ($v === $observer) {\n                unset($this->_observers[$k]);\n            }\n        }\n    }\n\n    /**\n     * 通知观察者\n     * @return void\n     */\n    public function notify()\n    {\n        foreach ($this->_observers as $v) {\n            $v->doSomething($this);\n        }\n    }\n}\n\n// 注册一个被观察者对象\n$observable = new Observable();\n// 注册观察者们\n$observerExampleOne = new ObserverExampleOne();\n$observerExampleTwo = new ObserverExampleTwo();\n\n// 附加观察者\n$observable->attach($observerExampleOne);\n$observable->attach($observerExampleTwo);\n\n// 被观察者通知观察者们\n$observable->notify();\n\n~~~\n","slug":"2017-04-05-observer","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qki0019y4rb7aumm88d","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>观察者观察被观察者，被观察者通知观察者</strong><a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ObserverInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">(ObservableInterface $observable)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者实体类示例1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ObserverExampleOne</span> <span class=\"keyword\">implements</span> <span class=\"title\">ObserverInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">(ObservableInterface $observable)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $observable-&gt;_name . <span class=\"string\">\"通知了观察者1 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者实体类示例2</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ObserverExampleTwo</span> <span class=\"keyword\">implements</span> <span class=\"title\">ObserverInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">(ObservableInterface $observable)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $observable-&gt;_name . <span class=\"string\">\"通知了观察者2 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 被观察者接口</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 需要实现附加观察者，删除观察者，通知观察者方法</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ObservableInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 附加观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">attach</span><span class=\"params\">(ObserverInterface $observer)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 解除观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">detach</span><span class=\"params\">(ObserverInterface $observer)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 通知观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">notify</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 被观察者实体类</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 实现附加观察者，删除观察者，通知观察者方法</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Observable</span> <span class=\"keyword\">implements</span> <span class=\"title\">ObservableInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 观察者们</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_observers = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 被观察者名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'【被观察者:皮皮虾】'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法 __get</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 附加观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">attach</span><span class=\"params\">(ObserverInterface $observer)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array($observer, <span class=\"keyword\">$this</span>-&gt;_observers, <span class=\"keyword\">true</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_observers[] = $observer;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 解除观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">detach</span><span class=\"params\">(ObserverInterface $observer)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_observers <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v === $observer) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;_observers[$k]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 通知观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">notify</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_observers <span class=\"keyword\">as</span> $v) &#123;</span><br><span class=\"line\">            $v-&gt;doSomething(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 注册一个被观察者对象</span></span><br><span class=\"line\">$observable = <span class=\"keyword\">new</span> Observable();</span><br><span class=\"line\"><span class=\"comment\">// 注册观察者们</span></span><br><span class=\"line\">$observerExampleOne = <span class=\"keyword\">new</span> ObserverExampleOne();</span><br><span class=\"line\">$observerExampleTwo = <span class=\"keyword\">new</span> ObserverExampleTwo();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 附加观察者</span></span><br><span class=\"line\">$observable-&gt;attach($observerExampleOne);</span><br><span class=\"line\">$observable-&gt;attach($observerExampleTwo);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 被观察者通知观察者们</span></span><br><span class=\"line\">$observable-&gt;notify();</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>观察者观察被观察者，被观察者通知观察者</strong>","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ObserverInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">(ObservableInterface $observable)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者实体类示例1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ObserverExampleOne</span> <span class=\"keyword\">implements</span> <span class=\"title\">ObserverInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">(ObservableInterface $observable)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $observable-&gt;_name . <span class=\"string\">\"通知了观察者1 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 观察者实体类示例2</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ObserverExampleTwo</span> <span class=\"keyword\">implements</span> <span class=\"title\">ObserverInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span><span class=\"params\">(ObservableInterface $observable)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $observable-&gt;_name . <span class=\"string\">\"通知了观察者2 \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 被观察者接口</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 需要实现附加观察者，删除观察者，通知观察者方法</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ObservableInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 附加观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">attach</span><span class=\"params\">(ObserverInterface $observer)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 解除观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">detach</span><span class=\"params\">(ObserverInterface $observer)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 通知观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">notify</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 被观察者实体类</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 实现附加观察者，删除观察者，通知观察者方法</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Observable</span> <span class=\"keyword\">implements</span> <span class=\"title\">ObservableInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 观察者们</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_observers = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 被观察者名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">'【被观察者:皮皮虾】'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法 __get</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 附加观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">attach</span><span class=\"params\">(ObserverInterface $observer)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array($observer, <span class=\"keyword\">$this</span>-&gt;_observers, <span class=\"keyword\">true</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_observers[] = $observer;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 解除观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">detach</span><span class=\"params\">(ObserverInterface $observer)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_observers <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v === $observer) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;_observers[$k]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 通知观察者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">notify</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_observers <span class=\"keyword\">as</span> $v) &#123;</span><br><span class=\"line\">            $v-&gt;doSomething(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 注册一个被观察者对象</span></span><br><span class=\"line\">$observable = <span class=\"keyword\">new</span> Observable();</span><br><span class=\"line\"><span class=\"comment\">// 注册观察者们</span></span><br><span class=\"line\">$observerExampleOne = <span class=\"keyword\">new</span> ObserverExampleOne();</span><br><span class=\"line\">$observerExampleTwo = <span class=\"keyword\">new</span> ObserverExampleTwo();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 附加观察者</span></span><br><span class=\"line\">$observable-&gt;attach($observerExampleOne);</span><br><span class=\"line\">$observable-&gt;attach($observerExampleTwo);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 被观察者通知观察者们</span></span><br><span class=\"line\">$observable-&gt;notify();</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-访问者","date":"2017-04-09T16:00:00.000Z","updated":"2017-04-09T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * 说说我对的策略模式和访问者模式的区分：\n * 乍一看，其实两者都挺像的，都是实体类依赖了外部实体的算法，但是：\n * 对于策略模式：首先你是有一堆算法，然后在不同的逻辑中去使用\n * 对于访问者模式：实体的【结构是稳定的】，但是结构中元素的算法却是多变的，比如就像人吃饭这个动作\n * 是稳定不变的，但是具体吃的行为却又是多变的\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n/**\n * 动物接口\n */\ninterface AnimailInterface\n{\n    /**\n     * 行为吃\n     *\n     * @param  VisitorInterface $visitor 访问者\n     * @return void\n     */\n    public function eat(VisitorInterface $visitor);\n}\n\n/**\n * 实体人\n *\n * 人吃饭的行为是不变的,但是吃什么是依照环境而定的\n */\nclass Person implements AnimailInterface\n{\n    /**\n     * 行为吃\n     * 具体吃什么依照访问者而定\n     *\n     * @param  VisitorInterface $visitor 访问者\n     * @return void\n     */\n    public function eat(VisitorInterface $visitor)\n    {\n        $visitor->eat();\n    }\n}\n\n/**\n * 访问者接口\n */\ninterface VisitorInterface\n{\n    /**\n     * 行为吃\n     *\n     * @return void\n     */\n    public function eat();\n}\n\n/**\n * 访问者实体\n *\n * 亚洲\n */\nclass VisitorAsia implements VisitorInterface\n{\n    /**\n     * 行为吃\n     *\n     * @return void\n     */\n    public function eat()\n    {\n        echo \"身处亚洲，所以主要吃大米咯~ \\n\";\n    }\n}\n\n/**\n * 访问者实体\n *\n * 美洲\n */\nclass VisitorAmerica implements VisitorInterface\n{\n    /**\n     * 行为吃\n     *\n     * @return void\n     */\n    public function eat()\n    {\n        echo \"身处美洲，所以主要吃油炸食物咯~ \\n\";\n    }\n}\n\n// 生产一个人的实例\n$person = new Person();\n\n// 来到了亚洲\n$person->eat(new VisitorAsia());\n\n// 来到了美洲\n$person->eat(new VisitorAmerica());\n~~~\n","source":"_posts/2017-04-09-visitor.md","raw":"---\ntitle:  \"PHP设计模式-访问者\"\ndate: 2017-04-09 12:00:00\nupdated: 2017-04-09 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * 说说我对的策略模式和访问者模式的区分：\n * 乍一看，其实两者都挺像的，都是实体类依赖了外部实体的算法，但是：\n * 对于策略模式：首先你是有一堆算法，然后在不同的逻辑中去使用\n * 对于访问者模式：实体的【结构是稳定的】，但是结构中元素的算法却是多变的，比如就像人吃饭这个动作\n * 是稳定不变的，但是具体吃的行为却又是多变的\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n/**\n * 动物接口\n */\ninterface AnimailInterface\n{\n    /**\n     * 行为吃\n     *\n     * @param  VisitorInterface $visitor 访问者\n     * @return void\n     */\n    public function eat(VisitorInterface $visitor);\n}\n\n/**\n * 实体人\n *\n * 人吃饭的行为是不变的,但是吃什么是依照环境而定的\n */\nclass Person implements AnimailInterface\n{\n    /**\n     * 行为吃\n     * 具体吃什么依照访问者而定\n     *\n     * @param  VisitorInterface $visitor 访问者\n     * @return void\n     */\n    public function eat(VisitorInterface $visitor)\n    {\n        $visitor->eat();\n    }\n}\n\n/**\n * 访问者接口\n */\ninterface VisitorInterface\n{\n    /**\n     * 行为吃\n     *\n     * @return void\n     */\n    public function eat();\n}\n\n/**\n * 访问者实体\n *\n * 亚洲\n */\nclass VisitorAsia implements VisitorInterface\n{\n    /**\n     * 行为吃\n     *\n     * @return void\n     */\n    public function eat()\n    {\n        echo \"身处亚洲，所以主要吃大米咯~ \\n\";\n    }\n}\n\n/**\n * 访问者实体\n *\n * 美洲\n */\nclass VisitorAmerica implements VisitorInterface\n{\n    /**\n     * 行为吃\n     *\n     * @return void\n     */\n    public function eat()\n    {\n        echo \"身处美洲，所以主要吃油炸食物咯~ \\n\";\n    }\n}\n\n// 生产一个人的实例\n$person = new Person();\n\n// 来到了亚洲\n$person->eat(new VisitorAsia());\n\n// 来到了美洲\n$person->eat(new VisitorAmerica());\n~~~\n","slug":"2017-04-09-visitor","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkj001cy4rbgpzatdh9","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>说说我对的策略模式和访问者模式的区分：</li>\n<li>乍一看，其实两者都挺像的，都是实体类依赖了外部实体的算法，但是：</li>\n<li>对于策略模式：首先你是有一堆算法，然后在不同的逻辑中去使用</li>\n<li>对于访问者模式：实体的【结构是稳定的】，但是结构中元素的算法却是多变的，比如就像人吃饭这个动作</li>\n<li>是稳定不变的，但是具体吃的行为却又是多变的<a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 动物接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AnimailInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  VisitorInterface $visitor 访问者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">(VisitorInterface $visitor)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体人</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 人吃饭的行为是不变的,但是吃什么是依照环境而定的</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimailInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     * 具体吃什么依照访问者而定</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  VisitorInterface $visitor 访问者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">(VisitorInterface $visitor)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $visitor-&gt;eat();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 访问者接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">VisitorInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 访问者实体</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 亚洲</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VisitorAsia</span> <span class=\"keyword\">implements</span> <span class=\"title\">VisitorInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"身处亚洲，所以主要吃大米咯~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 访问者实体</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 美洲</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VisitorAmerica</span> <span class=\"keyword\">implements</span> <span class=\"title\">VisitorInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"身处美洲，所以主要吃油炸食物咯~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 生产一个人的实例</span></span><br><span class=\"line\">$person = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 来到了亚洲</span></span><br><span class=\"line\">$person-&gt;eat(<span class=\"keyword\">new</span> VisitorAsia());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 来到了美洲</span></span><br><span class=\"line\">$person-&gt;eat(<span class=\"keyword\">new</span> VisitorAmerica());</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>说说我对的策略模式和访问者模式的区分：</li>\n<li>乍一看，其实两者都挺像的，都是实体类依赖了外部实体的算法，但是：</li>\n<li>对于策略模式：首先你是有一堆算法，然后在不同的逻辑中去使用</li>\n<li>对于访问者模式：实体的【结构是稳定的】，但是结构中元素的算法却是多变的，比如就像人吃饭这个动作</li>\n<li>是稳定不变的，但是具体吃的行为却又是多变的","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 动物接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AnimailInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  VisitorInterface $visitor 访问者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">(VisitorInterface $visitor)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实体人</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 人吃饭的行为是不变的,但是吃什么是依照环境而定的</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> <span class=\"keyword\">implements</span> <span class=\"title\">AnimailInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     * 具体吃什么依照访问者而定</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  VisitorInterface $visitor 访问者</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">(VisitorInterface $visitor)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $visitor-&gt;eat();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 访问者接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">VisitorInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 访问者实体</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 亚洲</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VisitorAsia</span> <span class=\"keyword\">implements</span> <span class=\"title\">VisitorInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"身处亚洲，所以主要吃大米咯~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 访问者实体</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 美洲</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VisitorAmerica</span> <span class=\"keyword\">implements</span> <span class=\"title\">VisitorInterface</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 行为吃</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">eat</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"身处美洲，所以主要吃油炸食物咯~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 生产一个人的实例</span></span><br><span class=\"line\">$person = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 来到了亚洲</span></span><br><span class=\"line\">$person-&gt;eat(<span class=\"keyword\">new</span> VisitorAsia());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 来到了美洲</span></span><br><span class=\"line\">$person-&gt;eat(<span class=\"keyword\">new</span> VisitorAmerica());</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-责任链","date":"2017-04-06T16:00:00.000Z","updated":"2017-04-06T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * **把一个对象传递到一个对象链上，直到有对象处理这个对象**\n * 可以干什么：我们可以做一个filter,或者gateway\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n\n/**\n * 请求对象\n */\nclass Request\n{\n    /**\n     * 请求对象身份标识\n     * @var string\n     */\n    private $_requestId = '';\n\n    /**\n     * 魔术方法 设置私有属性\n     * @param string $name  属性名称\n     * @param string $value 属性值\n     */\n    public function __set($name='', $value='')\n    {\n        $name = '_' . $name;\n        $this->$name = $value;\n    }\n\n    /**\n     * 魔术方法 获取私有属性\n     * @param string $name  属性名称\n     */\n    public function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n}\n\n/**\n * handler抽象类\n */\nabstract class Handler\n{\n    /**\n     * 下一个hanler对象\n     * @var [type]\n     */\n    private $_nextHandler;\n\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    abstract public function Check(Request $request);\n\n    /**\n     * 设置责任链上的下一个对象\n     *\n     * @param Handler $handler\n     */\n    public function setNext(Handler $handler)\n    {\n        $this->_nextHandler = $handler;\n        return $handler;\n    }\n\n    /**\n     * 启动\n     *\n     * @param Handler $handler\n     */\n    public function start(Request $request)\n    {\n        $this->check($request);\n        // 调用下一个对象\n        if (!empty($this->_nextHandler)) {\n            $this->_nextHandler->start($request);\n        }\n    }\n\n}\n\n/**\n * handler接口\n **/\nclass HandlerAccessToken extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 令牌校验通过～ \\n\";\n    }\n}\n\n/**\n * handler接口\n */\nclass HandlerArguments extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 参数校验通过～ \\n\";\n    }\n}\n\n/**\n * handler接口\n */\nclass HandlerAuthority extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 权限校验通过～ \\n\";\n    }\n}\n\n/**\n * handler接口\n */\nclass HandlerFrequent extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 请求频率校验通过～ \\n\";\n    }\n}\n\n/**\n * handler接口\n */\nclass HandlerSign extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 签名校验通过～ \\n\";\n    }\n}\n\ntry {\n    // 下面我们用责任链模式实现一个api-gateway即接口网关\n\n    // 初始化一个请求对象\n    $request  =  new Request();\n    // 设置一个请求身份id\n    $request->requestId = uniqid();\n\n    // 初始化一个：令牌校验的handler\n    $handlerAccessToken =  new HandlerAccessToken();\n    // 初始化一个：访问频次校验的handler\n    $handlerFrequent    =  new HandlerFrequent();\n    // 初始化一个：必传参数校验的handler\n    $handlerArguments   =  new HandlerArguments();\n    // 初始化一个：签名校验的handler\n    $handlerSign        =  new HandlerSign();\n    // 初始化一个：访问权限校验的handler\n    $handlerAuthority   =  new HandlerAuthority();\n\n    // 构成对象链\n    $handlerAccessToken->setNext($handlerFrequent)\n        ->setNext($handlerArguments)\n        ->setNext($handlerSign)\n        ->setNext($handlerAuthority);\n    // 启动网关\n    $handlerAccessToken->start($request);\n\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n~~~\n","source":"_posts/2017-04-06-chainOfResponsibility.md","raw":"---\ntitle:  \"PHP设计模式-责任链\"\ndate: 2017-04-06 12:00:00\nupdated: 2017-04-06 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * **把一个对象传递到一个对象链上，直到有对象处理这个对象**\n * 可以干什么：我们可以做一个filter,或者gateway\n<!-- more -->\n## 代码示例\n\n~~~ PHP\n\n/**\n * 请求对象\n */\nclass Request\n{\n    /**\n     * 请求对象身份标识\n     * @var string\n     */\n    private $_requestId = '';\n\n    /**\n     * 魔术方法 设置私有属性\n     * @param string $name  属性名称\n     * @param string $value 属性值\n     */\n    public function __set($name='', $value='')\n    {\n        $name = '_' . $name;\n        $this->$name = $value;\n    }\n\n    /**\n     * 魔术方法 获取私有属性\n     * @param string $name  属性名称\n     */\n    public function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n}\n\n/**\n * handler抽象类\n */\nabstract class Handler\n{\n    /**\n     * 下一个hanler对象\n     * @var [type]\n     */\n    private $_nextHandler;\n\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    abstract public function Check(Request $request);\n\n    /**\n     * 设置责任链上的下一个对象\n     *\n     * @param Handler $handler\n     */\n    public function setNext(Handler $handler)\n    {\n        $this->_nextHandler = $handler;\n        return $handler;\n    }\n\n    /**\n     * 启动\n     *\n     * @param Handler $handler\n     */\n    public function start(Request $request)\n    {\n        $this->check($request);\n        // 调用下一个对象\n        if (!empty($this->_nextHandler)) {\n            $this->_nextHandler->start($request);\n        }\n    }\n\n}\n\n/**\n * handler接口\n **/\nclass HandlerAccessToken extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 令牌校验通过～ \\n\";\n    }\n}\n\n/**\n * handler接口\n */\nclass HandlerArguments extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 参数校验通过～ \\n\";\n    }\n}\n\n/**\n * handler接口\n */\nclass HandlerAuthority extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 权限校验通过～ \\n\";\n    }\n}\n\n/**\n * handler接口\n */\nclass HandlerFrequent extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 请求频率校验通过～ \\n\";\n    }\n}\n\n/**\n * handler接口\n */\nclass HandlerSign extends Handler\n{\n    /**\n     * 校验方法\n     *\n     * @param Request $request 请求对象\n     */\n    public function Check(Request $request)\n    {\n        echo \"请求{$request->requestId}: 签名校验通过～ \\n\";\n    }\n}\n\ntry {\n    // 下面我们用责任链模式实现一个api-gateway即接口网关\n\n    // 初始化一个请求对象\n    $request  =  new Request();\n    // 设置一个请求身份id\n    $request->requestId = uniqid();\n\n    // 初始化一个：令牌校验的handler\n    $handlerAccessToken =  new HandlerAccessToken();\n    // 初始化一个：访问频次校验的handler\n    $handlerFrequent    =  new HandlerFrequent();\n    // 初始化一个：必传参数校验的handler\n    $handlerArguments   =  new HandlerArguments();\n    // 初始化一个：签名校验的handler\n    $handlerSign        =  new HandlerSign();\n    // 初始化一个：访问权限校验的handler\n    $handlerAuthority   =  new HandlerAuthority();\n\n    // 构成对象链\n    $handlerAccessToken->setNext($handlerFrequent)\n        ->setNext($handlerArguments)\n        ->setNext($handlerSign)\n        ->setNext($handlerAuthority);\n    // 启动网关\n    $handlerAccessToken->start($request);\n\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n\n~~~\n","slug":"2017-04-06-chainOfResponsibility","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkl001gy4rbllfi9zdy","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>把一个对象传递到一个对象链上，直到有对象处理这个对象</strong></li>\n<li>可以干什么：我们可以做一个filter,或者gateway<a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 请求对象</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Request</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 请求对象身份标识</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_requestId = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法 设置私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name  属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $value 属性值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__set</span><span class=\"params\">($name=<span class=\"string\">''</span>, $value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;$name = $value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法 获取私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name  属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler抽象类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 下一个hanler对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> [type]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_nextHandler;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置责任链上的下一个对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Handler $handler</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setNext</span><span class=\"params\">(Handler $handler)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_nextHandler = $handler;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $handler;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 启动</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Handler $handler</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">start</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;check($request);</span><br><span class=\"line\">        <span class=\"comment\">// 调用下一个对象</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>(<span class=\"keyword\">$this</span>-&gt;_nextHandler)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_nextHandler-&gt;start($request);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerAccessToken</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 令牌校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerArguments</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 参数校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerAuthority</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 权限校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerFrequent</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 请求频率校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerSign</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 签名校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 下面我们用责任链模式实现一个api-gateway即接口网关</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个请求对象</span></span><br><span class=\"line\">    $request  =  <span class=\"keyword\">new</span> Request();</span><br><span class=\"line\">    <span class=\"comment\">// 设置一个请求身份id</span></span><br><span class=\"line\">    $request-&gt;requestId = uniqid();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：令牌校验的handler</span></span><br><span class=\"line\">    $handlerAccessToken =  <span class=\"keyword\">new</span> HandlerAccessToken();</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：访问频次校验的handler</span></span><br><span class=\"line\">    $handlerFrequent    =  <span class=\"keyword\">new</span> HandlerFrequent();</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：必传参数校验的handler</span></span><br><span class=\"line\">    $handlerArguments   =  <span class=\"keyword\">new</span> HandlerArguments();</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：签名校验的handler</span></span><br><span class=\"line\">    $handlerSign        =  <span class=\"keyword\">new</span> HandlerSign();</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：访问权限校验的handler</span></span><br><span class=\"line\">    $handlerAuthority   =  <span class=\"keyword\">new</span> HandlerAuthority();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 构成对象链</span></span><br><span class=\"line\">    $handlerAccessToken-&gt;setNext($handlerFrequent)</span><br><span class=\"line\">        -&gt;setNext($handlerArguments)</span><br><span class=\"line\">        -&gt;setNext($handlerSign)</span><br><span class=\"line\">        -&gt;setNext($handlerAuthority);</span><br><span class=\"line\">    <span class=\"comment\">// 启动网关</span></span><br><span class=\"line\">    $handlerAccessToken-&gt;start($request);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li><strong>把一个对象传递到一个对象链上，直到有对象处理这个对象</strong></li>\n<li>可以干什么：我们可以做一个filter,或者gateway","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 请求对象</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Request</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 请求对象身份标识</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_requestId = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法 设置私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name  属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $value 属性值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__set</span><span class=\"params\">($name=<span class=\"string\">''</span>, $value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;$name = $value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法 获取私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name  属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler抽象类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 下一个hanler对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> [type]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_nextHandler;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置责任链上的下一个对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Handler $handler</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setNext</span><span class=\"params\">(Handler $handler)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_nextHandler = $handler;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $handler;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 启动</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Handler $handler</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">start</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;check($request);</span><br><span class=\"line\">        <span class=\"comment\">// 调用下一个对象</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>(<span class=\"keyword\">$this</span>-&gt;_nextHandler)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_nextHandler-&gt;start($request);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerAccessToken</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 令牌校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerArguments</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 参数校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerAuthority</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 权限校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerFrequent</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 请求频率校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * handler接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HandlerSign</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 校验方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Request $request 请求对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Check</span><span class=\"params\">(Request $request)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"请求&#123;$request-&gt;requestId&#125;: 签名校验通过～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 下面我们用责任链模式实现一个api-gateway即接口网关</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个请求对象</span></span><br><span class=\"line\">    $request  =  <span class=\"keyword\">new</span> Request();</span><br><span class=\"line\">    <span class=\"comment\">// 设置一个请求身份id</span></span><br><span class=\"line\">    $request-&gt;requestId = uniqid();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：令牌校验的handler</span></span><br><span class=\"line\">    $handlerAccessToken =  <span class=\"keyword\">new</span> HandlerAccessToken();</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：访问频次校验的handler</span></span><br><span class=\"line\">    $handlerFrequent    =  <span class=\"keyword\">new</span> HandlerFrequent();</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：必传参数校验的handler</span></span><br><span class=\"line\">    $handlerArguments   =  <span class=\"keyword\">new</span> HandlerArguments();</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：签名校验的handler</span></span><br><span class=\"line\">    $handlerSign        =  <span class=\"keyword\">new</span> HandlerSign();</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个：访问权限校验的handler</span></span><br><span class=\"line\">    $handlerAuthority   =  <span class=\"keyword\">new</span> HandlerAuthority();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 构成对象链</span></span><br><span class=\"line\">    $handlerAccessToken-&gt;setNext($handlerFrequent)</span><br><span class=\"line\">        -&gt;setNext($handlerArguments)</span><br><span class=\"line\">        -&gt;setNext($handlerSign)</span><br><span class=\"line\">        -&gt;setNext($handlerAuthority);</span><br><span class=\"line\">    <span class=\"comment\">// 启动网关</span></span><br><span class=\"line\">    $handlerAccessToken-&gt;start($request);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-解释器","date":"2017-04-20T16:00:00.000Z","updated":"2017-04-20T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * 理解：就是一个上下文的连接器\n * 使用场景：构建一个编译器，SQL解析器\n * 下面我们来实现一个简单增删改查的sql解析器\n <!-- more -->\n## 代码示例\n\n```php\n\nclass SqlInterpreter\n{\n    /**\n     * 表名\n     * @var string\n     */\n    private $_tableName = '';\n\n    /**\n     * 当前类的实例\n     * @var object\n     */\n    private static $_instance;\n\n    /**\n     * 设置表名\n     *\n     * @param string $table 表名\n     */\n    public static function db($tableName='')\n    {\n        if (empty($tableName)) {\n            throw new Exception(\"argument tableName is null\", 400);\n        }\n        // 单例\n        if(!self::$_instance instanceof self){// instanceof运算符的优先级高于！\n            self::$_instance = new self();\n        }\n        // 更新实例表名\n        self::$_instance->_setTableName($tableName);\n        // 返回实例\n        return self::$_instance;\n    }\n\n    /**\n     * 设置表名\n     *\n     * @param string $tableName 表名\n     */\n    private function _setTableName($tableName='')\n    {\n        $this->_tableName = $tableName;\n    }\n\n    /**\n     *  插入一条数据\n     *\n     * @param  array $data 数据\n     * @return mixed\n     */\n    public function insert($data=[])\n    {\n        if (empty($data)) {\n            throw new Exception(\"argument data is null\", 400);\n        }\n        $count = count($data);\n        //拼接字段\n        $field = array_keys($data);\n        $fieldString = '';\n        foreach ($field as $k => $v) {\n            if ($k === (int)($count - 1)) {\n                $fieldString .= \"`{$v}`\";\n                continue;\n            }\n            $fieldString .= \"`{$v}`\".',';\n        }\n        unset($k);\n        unset($v);\n\n        //拼接值\n        $value = array_values($data);\n        $valueString = '';\n        foreach ($value as $k => $v) {\n            if ($k === (int)($count - 1)) {\n                $valueString .= \"'{$v}'\";\n                continue;\n            }\n            $valueString .= \"'{$v}'\".',';\n        }\n        unset($k);\n        unset($v);\n\n        $sql = \"INSERT INTO `{$this->_tableName}` ({$fieldString}) VALUES ({$valueString})\";\n\n        echo $sql . \"\\n\";\n    }\n\n    /**\n     *  删除数据\n     *\n     * @param  array $data 数据\n     * @return mixed\n     */\n    public function delete($data=[])\n    {\n        if (empty($data)) {\n            throw new Exception(\"argument data is null\", 400);\n        }\n        // 拼接where语句\n        $count = (int)count($data);\n        $where = '';\n        $dataCopy = $data;\n        $pop = array_pop($dataCopy);\n        if ($count === 1) {\n            $field = array_keys($data)[0];\n            $value = array_values($data)[0];\n            $where = \"`{$field}` = '{$value}'\";\n        }else{\n            foreach ($data as $k => $v) {\n                if ($v === $pop) {\n                    $where .= \"`{$k}` = '{$v}'\";\n                    continue;\n                }\n                $where .= \"`{$k}` = '{$v}' AND \";\n            }\n        }\n\n        $sql = \"DELETE FROM `{$this->_tableName}` WHERE {$where}\";\n\n        echo $sql . \"\\n\";\n    }\n\n    /**\n     *  更新一条数据\n     *\n     * @param  array $data 数据\n     * @return mixed\n     */\n    public function update($data=[])\n    {\n        if (empty($data)) {\n            throw new Exception(\"argument data is null\", 400);\n        }\n        if (empty($data['id'])) {\n            throw new Exception(\"argument data['id'] is null\", 400);\n        }\n        $set = '';\n        $dataCopy = $data;\n        $pop = array_pop($dataCopy);\n        foreach ($data as $k => $v) {\n            if ($v === $pop) {\n                $set .= \"`{$k}` = '$v'\";\n                continue;\n            }\n            $set .= \"`{$k}` = '$v',\";\n        }\n\n        $sql = \"UPDATE `{$this->_tableName}` SET {$set}\";\n\n        echo $sql . \"\\n\";\n    }\n\n    /**\n     *  查找一条数据\n     *\n     * @param  array $data 数据\n     * @return mixed\n     */\n    public function find($data=[])\n    {\n        if (empty($data)) {\n            throw new Exception(\"argument data is null\", 400);\n        }\n\n        // 拼接where语句\n        $count = (int)count($data);\n        $where = '';\n        $dataCopy = $data;\n        $pop = array_pop($dataCopy);\n        if ($count === 1) {\n            $field = array_keys($data)[0];\n            $value = array_values($data)[0];\n            $where = \"`{$field}` = '{$value}'\";\n        }else{\n            foreach ($data as $k => $v) {\n                if ($v === $pop) {\n                    $where .= \"`{$k}` = '{$v}'\";\n                    continue;\n                }\n                $where .= \"`{$k}` = '{$v}' AND \";\n            }\n        }\n\n        $sql = \"SELECT * FROM `{$this->_tableName}` WHERE {$where}\";\n\n        echo $sql . \"\\n\";\n    }\n}\n\n\ntry {\n    //增加数据\n    SqlInterpreter::db('user')->insert([\n        'nickname' => 'tigerb',\n        'mobile'   => '1366666666',\n        'password' => '123456'\n    ]);\n    //删除数据\n    SqlInterpreter::db('user')->delete([\n        'nickname' => 'tigerb',\n        'mobile'   => '1366666666',\n    ]);\n    //修改数据\n    SqlInterpreter::db('member')->update([\n        'id'       => '1',\n        'nickname' => 'tigerbcode'\n    ]);\n    //查询数据\n    SqlInterpreter::db('member')->find([\n        'mobile'   => '1366666666',\n    ]);\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n```\n","source":"_posts/2017-04-20-interpreter.md","raw":"---\ntitle:  \"PHP设计模式-解释器\"\ndate: 2017-04-20 12:00:00\nupdated: 2017-04-20 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * 理解：就是一个上下文的连接器\n * 使用场景：构建一个编译器，SQL解析器\n * 下面我们来实现一个简单增删改查的sql解析器\n <!-- more -->\n## 代码示例\n\n```php\n\nclass SqlInterpreter\n{\n    /**\n     * 表名\n     * @var string\n     */\n    private $_tableName = '';\n\n    /**\n     * 当前类的实例\n     * @var object\n     */\n    private static $_instance;\n\n    /**\n     * 设置表名\n     *\n     * @param string $table 表名\n     */\n    public static function db($tableName='')\n    {\n        if (empty($tableName)) {\n            throw new Exception(\"argument tableName is null\", 400);\n        }\n        // 单例\n        if(!self::$_instance instanceof self){// instanceof运算符的优先级高于！\n            self::$_instance = new self();\n        }\n        // 更新实例表名\n        self::$_instance->_setTableName($tableName);\n        // 返回实例\n        return self::$_instance;\n    }\n\n    /**\n     * 设置表名\n     *\n     * @param string $tableName 表名\n     */\n    private function _setTableName($tableName='')\n    {\n        $this->_tableName = $tableName;\n    }\n\n    /**\n     *  插入一条数据\n     *\n     * @param  array $data 数据\n     * @return mixed\n     */\n    public function insert($data=[])\n    {\n        if (empty($data)) {\n            throw new Exception(\"argument data is null\", 400);\n        }\n        $count = count($data);\n        //拼接字段\n        $field = array_keys($data);\n        $fieldString = '';\n        foreach ($field as $k => $v) {\n            if ($k === (int)($count - 1)) {\n                $fieldString .= \"`{$v}`\";\n                continue;\n            }\n            $fieldString .= \"`{$v}`\".',';\n        }\n        unset($k);\n        unset($v);\n\n        //拼接值\n        $value = array_values($data);\n        $valueString = '';\n        foreach ($value as $k => $v) {\n            if ($k === (int)($count - 1)) {\n                $valueString .= \"'{$v}'\";\n                continue;\n            }\n            $valueString .= \"'{$v}'\".',';\n        }\n        unset($k);\n        unset($v);\n\n        $sql = \"INSERT INTO `{$this->_tableName}` ({$fieldString}) VALUES ({$valueString})\";\n\n        echo $sql . \"\\n\";\n    }\n\n    /**\n     *  删除数据\n     *\n     * @param  array $data 数据\n     * @return mixed\n     */\n    public function delete($data=[])\n    {\n        if (empty($data)) {\n            throw new Exception(\"argument data is null\", 400);\n        }\n        // 拼接where语句\n        $count = (int)count($data);\n        $where = '';\n        $dataCopy = $data;\n        $pop = array_pop($dataCopy);\n        if ($count === 1) {\n            $field = array_keys($data)[0];\n            $value = array_values($data)[0];\n            $where = \"`{$field}` = '{$value}'\";\n        }else{\n            foreach ($data as $k => $v) {\n                if ($v === $pop) {\n                    $where .= \"`{$k}` = '{$v}'\";\n                    continue;\n                }\n                $where .= \"`{$k}` = '{$v}' AND \";\n            }\n        }\n\n        $sql = \"DELETE FROM `{$this->_tableName}` WHERE {$where}\";\n\n        echo $sql . \"\\n\";\n    }\n\n    /**\n     *  更新一条数据\n     *\n     * @param  array $data 数据\n     * @return mixed\n     */\n    public function update($data=[])\n    {\n        if (empty($data)) {\n            throw new Exception(\"argument data is null\", 400);\n        }\n        if (empty($data['id'])) {\n            throw new Exception(\"argument data['id'] is null\", 400);\n        }\n        $set = '';\n        $dataCopy = $data;\n        $pop = array_pop($dataCopy);\n        foreach ($data as $k => $v) {\n            if ($v === $pop) {\n                $set .= \"`{$k}` = '$v'\";\n                continue;\n            }\n            $set .= \"`{$k}` = '$v',\";\n        }\n\n        $sql = \"UPDATE `{$this->_tableName}` SET {$set}\";\n\n        echo $sql . \"\\n\";\n    }\n\n    /**\n     *  查找一条数据\n     *\n     * @param  array $data 数据\n     * @return mixed\n     */\n    public function find($data=[])\n    {\n        if (empty($data)) {\n            throw new Exception(\"argument data is null\", 400);\n        }\n\n        // 拼接where语句\n        $count = (int)count($data);\n        $where = '';\n        $dataCopy = $data;\n        $pop = array_pop($dataCopy);\n        if ($count === 1) {\n            $field = array_keys($data)[0];\n            $value = array_values($data)[0];\n            $where = \"`{$field}` = '{$value}'\";\n        }else{\n            foreach ($data as $k => $v) {\n                if ($v === $pop) {\n                    $where .= \"`{$k}` = '{$v}'\";\n                    continue;\n                }\n                $where .= \"`{$k}` = '{$v}' AND \";\n            }\n        }\n\n        $sql = \"SELECT * FROM `{$this->_tableName}` WHERE {$where}\";\n\n        echo $sql . \"\\n\";\n    }\n}\n\n\ntry {\n    //增加数据\n    SqlInterpreter::db('user')->insert([\n        'nickname' => 'tigerb',\n        'mobile'   => '1366666666',\n        'password' => '123456'\n    ]);\n    //删除数据\n    SqlInterpreter::db('user')->delete([\n        'nickname' => 'tigerb',\n        'mobile'   => '1366666666',\n    ]);\n    //修改数据\n    SqlInterpreter::db('member')->update([\n        'id'       => '1',\n        'nickname' => 'tigerbcode'\n    ]);\n    //查询数据\n    SqlInterpreter::db('member')->find([\n        'mobile'   => '1366666666',\n    ]);\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n```\n","slug":"2017-04-20-interpreter","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkm001jy4rb04ekan5t","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>理解：就是一个上下文的连接器</li>\n<li>使用场景：构建一个编译器，SQL解析器</li>\n<li>下面我们来实现一个简单增删改查的sql解析器<a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SqlInterpreter</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 表名</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_tableName = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前类的实例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> $_instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置表名</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $table 表名</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">db</span><span class=\"params\">($tableName=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($tableName)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument tableName is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 单例</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"keyword\">self</span>::$_instance <span class=\"keyword\">instanceof</span> <span class=\"keyword\">self</span>)&#123;<span class=\"comment\">// instanceof运算符的优先级高于！</span></span><br><span class=\"line\">            <span class=\"keyword\">self</span>::$_instance = <span class=\"keyword\">new</span> <span class=\"keyword\">self</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 更新实例表名</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>::$_instance-&gt;_setTableName($tableName);</span><br><span class=\"line\">        <span class=\"comment\">// 返回实例</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>::$_instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置表名</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $tableName 表名</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_setTableName</span><span class=\"params\">($tableName=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_tableName = $tableName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  插入一条数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $data 数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">insert</span><span class=\"params\">($data=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $count = count($data);</span><br><span class=\"line\">        <span class=\"comment\">//拼接字段</span></span><br><span class=\"line\">        $field = array_keys($data);</span><br><span class=\"line\">        $fieldString = <span class=\"string\">''</span>;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($field <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($k === (int)($count - <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                $fieldString .= <span class=\"string\">\"`&#123;$v&#125;`\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $fieldString .= <span class=\"string\">\"`&#123;$v&#125;`\"</span>.<span class=\"string\">','</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($k);</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($v);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//拼接值</span></span><br><span class=\"line\">        $value = array_values($data);</span><br><span class=\"line\">        $valueString = <span class=\"string\">''</span>;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($value <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($k === (int)($count - <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                $valueString .= <span class=\"string\">\"'&#123;$v&#125;'\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $valueString .= <span class=\"string\">\"'&#123;$v&#125;'\"</span>.<span class=\"string\">','</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($k);</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($v);</span><br><span class=\"line\"></span><br><span class=\"line\">        $sql = <span class=\"string\">\"INSERT INTO `&#123;$this-&gt;_tableName&#125;` (&#123;$fieldString&#125;) VALUES (&#123;$valueString&#125;)\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $sql . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  删除数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $data 数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">($data=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 拼接where语句</span></span><br><span class=\"line\">        $count = (int)count($data);</span><br><span class=\"line\">        $where = <span class=\"string\">''</span>;</span><br><span class=\"line\">        $dataCopy = $data;</span><br><span class=\"line\">        $pop = array_pop($dataCopy);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($count === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            $field = array_keys($data)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            $value = array_values($data)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            $where = <span class=\"string\">\"`&#123;$field&#125;` = '&#123;$value&#125;'\"</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ($v === $pop) &#123;</span><br><span class=\"line\">                    $where .= <span class=\"string\">\"`&#123;$k&#125;` = '&#123;$v&#125;'\"</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                $where .= <span class=\"string\">\"`&#123;$k&#125;` = '&#123;$v&#125;' AND \"</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        $sql = <span class=\"string\">\"DELETE FROM `&#123;$this-&gt;_tableName&#125;` WHERE &#123;$where&#125;\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $sql . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  更新一条数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $data 数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">($data=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data[<span class=\"string\">'id'</span>])) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data['id'] is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $set = <span class=\"string\">''</span>;</span><br><span class=\"line\">        $dataCopy = $data;</span><br><span class=\"line\">        $pop = array_pop($dataCopy);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v === $pop) &#123;</span><br><span class=\"line\">                $set .= <span class=\"string\">\"`&#123;$k&#125;` = '$v'\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $set .= <span class=\"string\">\"`&#123;$k&#125;` = '$v',\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        $sql = <span class=\"string\">\"UPDATE `&#123;$this-&gt;_tableName&#125;` SET &#123;$set&#125;\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $sql . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  查找一条数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $data 数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">find</span><span class=\"params\">($data=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 拼接where语句</span></span><br><span class=\"line\">        $count = (int)count($data);</span><br><span class=\"line\">        $where = <span class=\"string\">''</span>;</span><br><span class=\"line\">        $dataCopy = $data;</span><br><span class=\"line\">        $pop = array_pop($dataCopy);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($count === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            $field = array_keys($data)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            $value = array_values($data)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            $where = <span class=\"string\">\"`&#123;$field&#125;` = '&#123;$value&#125;'\"</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ($v === $pop) &#123;</span><br><span class=\"line\">                    $where .= <span class=\"string\">\"`&#123;$k&#125;` = '&#123;$v&#125;'\"</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                $where .= <span class=\"string\">\"`&#123;$k&#125;` = '&#123;$v&#125;' AND \"</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        $sql = <span class=\"string\">\"SELECT * FROM `&#123;$this-&gt;_tableName&#125;` WHERE &#123;$where&#125;\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $sql . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//增加数据</span></span><br><span class=\"line\">    SqlInterpreter::db(<span class=\"string\">'user'</span>)-&gt;insert([</span><br><span class=\"line\">        <span class=\"string\">'nickname'</span> =&gt; <span class=\"string\">'tigerb'</span>,</span><br><span class=\"line\">        <span class=\"string\">'mobile'</span>   =&gt; <span class=\"string\">'1366666666'</span>,</span><br><span class=\"line\">        <span class=\"string\">'password'</span> =&gt; <span class=\"string\">'123456'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">//删除数据</span></span><br><span class=\"line\">    SqlInterpreter::db(<span class=\"string\">'user'</span>)-&gt;delete([</span><br><span class=\"line\">        <span class=\"string\">'nickname'</span> =&gt; <span class=\"string\">'tigerb'</span>,</span><br><span class=\"line\">        <span class=\"string\">'mobile'</span>   =&gt; <span class=\"string\">'1366666666'</span>,</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">//修改数据</span></span><br><span class=\"line\">    SqlInterpreter::db(<span class=\"string\">'member'</span>)-&gt;update([</span><br><span class=\"line\">        <span class=\"string\">'id'</span>       =&gt; <span class=\"string\">'1'</span>,</span><br><span class=\"line\">        <span class=\"string\">'nickname'</span> =&gt; <span class=\"string\">'tigerbcode'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">//查询数据</span></span><br><span class=\"line\">    SqlInterpreter::db(<span class=\"string\">'member'</span>)-&gt;find([</span><br><span class=\"line\">        <span class=\"string\">'mobile'</span>   =&gt; <span class=\"string\">'1366666666'</span>,</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>理解：就是一个上下文的连接器</li>\n<li>使用场景：构建一个编译器，SQL解析器</li>\n<li>下面我们来实现一个简单增删改查的sql解析器","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SqlInterpreter</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 表名</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_tableName = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前类的实例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> $_instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置表名</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $table 表名</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">db</span><span class=\"params\">($tableName=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($tableName)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument tableName is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 单例</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"keyword\">self</span>::$_instance <span class=\"keyword\">instanceof</span> <span class=\"keyword\">self</span>)&#123;<span class=\"comment\">// instanceof运算符的优先级高于！</span></span><br><span class=\"line\">            <span class=\"keyword\">self</span>::$_instance = <span class=\"keyword\">new</span> <span class=\"keyword\">self</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 更新实例表名</span></span><br><span class=\"line\">        <span class=\"keyword\">self</span>::$_instance-&gt;_setTableName($tableName);</span><br><span class=\"line\">        <span class=\"comment\">// 返回实例</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>::$_instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置表名</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $tableName 表名</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_setTableName</span><span class=\"params\">($tableName=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_tableName = $tableName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  插入一条数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $data 数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">insert</span><span class=\"params\">($data=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $count = count($data);</span><br><span class=\"line\">        <span class=\"comment\">//拼接字段</span></span><br><span class=\"line\">        $field = array_keys($data);</span><br><span class=\"line\">        $fieldString = <span class=\"string\">''</span>;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($field <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($k === (int)($count - <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                $fieldString .= <span class=\"string\">\"`&#123;$v&#125;`\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $fieldString .= <span class=\"string\">\"`&#123;$v&#125;`\"</span>.<span class=\"string\">','</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($k);</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($v);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//拼接值</span></span><br><span class=\"line\">        $value = array_values($data);</span><br><span class=\"line\">        $valueString = <span class=\"string\">''</span>;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($value <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($k === (int)($count - <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                $valueString .= <span class=\"string\">\"'&#123;$v&#125;'\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $valueString .= <span class=\"string\">\"'&#123;$v&#125;'\"</span>.<span class=\"string\">','</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($k);</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>($v);</span><br><span class=\"line\"></span><br><span class=\"line\">        $sql = <span class=\"string\">\"INSERT INTO `&#123;$this-&gt;_tableName&#125;` (&#123;$fieldString&#125;) VALUES (&#123;$valueString&#125;)\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $sql . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  删除数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $data 数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delete</span><span class=\"params\">($data=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 拼接where语句</span></span><br><span class=\"line\">        $count = (int)count($data);</span><br><span class=\"line\">        $where = <span class=\"string\">''</span>;</span><br><span class=\"line\">        $dataCopy = $data;</span><br><span class=\"line\">        $pop = array_pop($dataCopy);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($count === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            $field = array_keys($data)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            $value = array_values($data)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            $where = <span class=\"string\">\"`&#123;$field&#125;` = '&#123;$value&#125;'\"</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ($v === $pop) &#123;</span><br><span class=\"line\">                    $where .= <span class=\"string\">\"`&#123;$k&#125;` = '&#123;$v&#125;'\"</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                $where .= <span class=\"string\">\"`&#123;$k&#125;` = '&#123;$v&#125;' AND \"</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        $sql = <span class=\"string\">\"DELETE FROM `&#123;$this-&gt;_tableName&#125;` WHERE &#123;$where&#125;\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $sql . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  更新一条数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $data 数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">($data=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data[<span class=\"string\">'id'</span>])) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data['id'] is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $set = <span class=\"string\">''</span>;</span><br><span class=\"line\">        $dataCopy = $data;</span><br><span class=\"line\">        $pop = array_pop($dataCopy);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($v === $pop) &#123;</span><br><span class=\"line\">                $set .= <span class=\"string\">\"`&#123;$k&#125;` = '$v'\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $set .= <span class=\"string\">\"`&#123;$k&#125;` = '$v',\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        $sql = <span class=\"string\">\"UPDATE `&#123;$this-&gt;_tableName&#125;` SET &#123;$set&#125;\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $sql . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  查找一条数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  array $data 数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">find</span><span class=\"params\">($data=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>($data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">\"argument data is null\"</span>, <span class=\"number\">400</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 拼接where语句</span></span><br><span class=\"line\">        $count = (int)count($data);</span><br><span class=\"line\">        $where = <span class=\"string\">''</span>;</span><br><span class=\"line\">        $dataCopy = $data;</span><br><span class=\"line\">        $pop = array_pop($dataCopy);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($count === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            $field = array_keys($data)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            $value = array_values($data)[<span class=\"number\">0</span>];</span><br><span class=\"line\">            $where = <span class=\"string\">\"`&#123;$field&#125;` = '&#123;$value&#125;'\"</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">foreach</span> ($data <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ($v === $pop) &#123;</span><br><span class=\"line\">                    $where .= <span class=\"string\">\"`&#123;$k&#125;` = '&#123;$v&#125;'\"</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                $where .= <span class=\"string\">\"`&#123;$k&#125;` = '&#123;$v&#125;' AND \"</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        $sql = <span class=\"string\">\"SELECT * FROM `&#123;$this-&gt;_tableName&#125;` WHERE &#123;$where&#125;\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $sql . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//增加数据</span></span><br><span class=\"line\">    SqlInterpreter::db(<span class=\"string\">'user'</span>)-&gt;insert([</span><br><span class=\"line\">        <span class=\"string\">'nickname'</span> =&gt; <span class=\"string\">'tigerb'</span>,</span><br><span class=\"line\">        <span class=\"string\">'mobile'</span>   =&gt; <span class=\"string\">'1366666666'</span>,</span><br><span class=\"line\">        <span class=\"string\">'password'</span> =&gt; <span class=\"string\">'123456'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">//删除数据</span></span><br><span class=\"line\">    SqlInterpreter::db(<span class=\"string\">'user'</span>)-&gt;delete([</span><br><span class=\"line\">        <span class=\"string\">'nickname'</span> =&gt; <span class=\"string\">'tigerb'</span>,</span><br><span class=\"line\">        <span class=\"string\">'mobile'</span>   =&gt; <span class=\"string\">'1366666666'</span>,</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">//修改数据</span></span><br><span class=\"line\">    SqlInterpreter::db(<span class=\"string\">'member'</span>)-&gt;update([</span><br><span class=\"line\">        <span class=\"string\">'id'</span>       =&gt; <span class=\"string\">'1'</span>,</span><br><span class=\"line\">        <span class=\"string\">'nickname'</span> =&gt; <span class=\"string\">'tigerbcode'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">//查询数据</span></span><br><span class=\"line\">    SqlInterpreter::db(<span class=\"string\">'member'</span>)-&gt;find([</span><br><span class=\"line\">        <span class=\"string\">'mobile'</span>   =&gt; <span class=\"string\">'1366666666'</span>,</span><br><span class=\"line\">    ]);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-备忘录","date":"2017-04-23T16:00:00.000Z","updated":"2017-04-23T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * 就是外部存储对象的状态，以提供后退/恢复/复原\n * 使用场景：编辑器后退操作/数据库事物/存档\n <!-- more -->\n## 代码示例\n\n```php\n\n\nclass Memento\n{\n    /**\n     * 备忘录列表\n     *\n     * @var array\n     */\n    private $_mementoList = [];\n\n    /**\n     * 添加编辑器实例状态\n     *\n     * @param Editor $editor 编辑器实例\n     */\n    function add(Editor $editor)\n    {\n        array_push($this->_mementoList, $editor);\n    }\n\n    /**\n     * 返回编辑器实例上个状态\n     *\n     * @param Editor $editor 编辑器实例\n     */\n    function undo()\n    {\n        return array_pop($this->_mementoList);\n    }\n\n    /**\n     * 返回编辑器实例开始状态\n     *\n     * @param Editor $editor 编辑器实例\n     */\n    function redo()\n    {\n        return array_shift($this->_mementoList);\n    }\n}\n\n\nclass Editor\n{\n    /**\n     * 编辑器内容\n     * @var string\n     */\n    private $_content = '';\n\n    /**\n     * 备忘录实例\n     * @var Memento\n     */\n    private $_memento;\n\n    /**\n     * 构造函数\n     *\n     * @param string $content 打开的文件内容\n     */\n    function __construct($content='')\n    {\n        $this->_content = $content;\n        // 打印初始内容\n        $this->read();\n\n        // 初始化备忘录插件\n        $this->_memento = new Memento();\n        // 第一次打开编辑器自动保存一次以提供重置状态操作\n        $this->save($content);\n    }\n\n    /**\n     * 写入内容\n     *\n     * @param  string $value 文本\n     * @return boolean\n     */\n    function write($value='')\n    {\n        $this->_content .= $value;\n        $this->read();\n    }\n\n    /**\n     * 读取当前内容\n     *\n     * @param  string $value 文本\n     * @return boolean\n     */\n    function read()\n    {\n        echo $this->_content? $this->_content . \"\\n\": \"空文本\" . \"\\n\";\n    }\n\n\n    /**\n     * 保存内容\n     *\n     * @return boolean\n     */\n    function save()\n    {\n        $this->_memento->add(clone $this);\n    }\n\n    /**s\n     * 后退\n     *\n     * @return boolean\n     */\n    function undo()\n    {\n        // 获取上个状态\n        $undo = $this->_memento->undo();\n        // 重置当前状态为上个状态\n        $this->_content = $undo->_content;\n    }\n\n    /**\n     * 复原\n     *\n     * @return boolean\n     */\n    function redo()\n    {\n        // 获取开始状态\n        $undo = $this->_memento->redo();\n        // 重置当前状态为开始状态\n        $this->_content = $undo->_content;\n    }\n}\n\n\ntry {\n    // 初始化一个编辑器并新建一个空文件\n    $editor = new Editor('');\n\n    // 写入一段文本\n    $editor->write('hello php !');\n    // 保存\n    $editor->save();\n    // 修改刚才的文本\n    $editor->write(' no code no life !');\n    // 撤销\n    $editor->undo();\n    $editor->read();\n    // 再次修改并保存文本\n    $editor->write(' life is a struggle !');\n    $editor->save();\n    // 重置\n    $editor->redo();\n    $editor->read();\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n```\n","source":"_posts/2017-04-23-memento.md","raw":"---\ntitle:  \"PHP设计模式-备忘录\"\ndate: 2017-04-23 12:00:00\nupdated: 2017-04-23 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * 就是外部存储对象的状态，以提供后退/恢复/复原\n * 使用场景：编辑器后退操作/数据库事物/存档\n <!-- more -->\n## 代码示例\n\n```php\n\n\nclass Memento\n{\n    /**\n     * 备忘录列表\n     *\n     * @var array\n     */\n    private $_mementoList = [];\n\n    /**\n     * 添加编辑器实例状态\n     *\n     * @param Editor $editor 编辑器实例\n     */\n    function add(Editor $editor)\n    {\n        array_push($this->_mementoList, $editor);\n    }\n\n    /**\n     * 返回编辑器实例上个状态\n     *\n     * @param Editor $editor 编辑器实例\n     */\n    function undo()\n    {\n        return array_pop($this->_mementoList);\n    }\n\n    /**\n     * 返回编辑器实例开始状态\n     *\n     * @param Editor $editor 编辑器实例\n     */\n    function redo()\n    {\n        return array_shift($this->_mementoList);\n    }\n}\n\n\nclass Editor\n{\n    /**\n     * 编辑器内容\n     * @var string\n     */\n    private $_content = '';\n\n    /**\n     * 备忘录实例\n     * @var Memento\n     */\n    private $_memento;\n\n    /**\n     * 构造函数\n     *\n     * @param string $content 打开的文件内容\n     */\n    function __construct($content='')\n    {\n        $this->_content = $content;\n        // 打印初始内容\n        $this->read();\n\n        // 初始化备忘录插件\n        $this->_memento = new Memento();\n        // 第一次打开编辑器自动保存一次以提供重置状态操作\n        $this->save($content);\n    }\n\n    /**\n     * 写入内容\n     *\n     * @param  string $value 文本\n     * @return boolean\n     */\n    function write($value='')\n    {\n        $this->_content .= $value;\n        $this->read();\n    }\n\n    /**\n     * 读取当前内容\n     *\n     * @param  string $value 文本\n     * @return boolean\n     */\n    function read()\n    {\n        echo $this->_content? $this->_content . \"\\n\": \"空文本\" . \"\\n\";\n    }\n\n\n    /**\n     * 保存内容\n     *\n     * @return boolean\n     */\n    function save()\n    {\n        $this->_memento->add(clone $this);\n    }\n\n    /**s\n     * 后退\n     *\n     * @return boolean\n     */\n    function undo()\n    {\n        // 获取上个状态\n        $undo = $this->_memento->undo();\n        // 重置当前状态为上个状态\n        $this->_content = $undo->_content;\n    }\n\n    /**\n     * 复原\n     *\n     * @return boolean\n     */\n    function redo()\n    {\n        // 获取开始状态\n        $undo = $this->_memento->redo();\n        // 重置当前状态为开始状态\n        $this->_content = $undo->_content;\n    }\n}\n\n\ntry {\n    // 初始化一个编辑器并新建一个空文件\n    $editor = new Editor('');\n\n    // 写入一段文本\n    $editor->write('hello php !');\n    // 保存\n    $editor->save();\n    // 修改刚才的文本\n    $editor->write(' no code no life !');\n    // 撤销\n    $editor->undo();\n    $editor->read();\n    // 再次修改并保存文本\n    $editor->write(' life is a struggle !');\n    $editor->save();\n    // 重置\n    $editor->redo();\n    $editor->read();\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n```\n","slug":"2017-04-23-memento","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkm001my4rbduqy0xgz","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>就是外部存储对象的状态，以提供后退/恢复/复原</li>\n<li>使用场景：编辑器后退操作/数据库事物/存档<a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Memento</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 备忘录列表</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_mementoList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 添加编辑器实例状态</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Editor $editor 编辑器实例</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(Editor $editor)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        array_push(<span class=\"keyword\">$this</span>-&gt;_mementoList, $editor);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回编辑器实例上个状态</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Editor $editor 编辑器实例</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">undo</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_pop(<span class=\"keyword\">$this</span>-&gt;_mementoList);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回编辑器实例开始状态</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Editor $editor 编辑器实例</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">redo</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_shift(<span class=\"keyword\">$this</span>-&gt;_mementoList);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Editor</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 编辑器内容</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_content = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 备忘录实例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> Memento</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_memento;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $content 打开的文件内容</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($content=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_content = $content;</span><br><span class=\"line\">        <span class=\"comment\">// 打印初始内容</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;read();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 初始化备忘录插件</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_memento = <span class=\"keyword\">new</span> Memento();</span><br><span class=\"line\">        <span class=\"comment\">// 第一次打开编辑器自动保存一次以提供重置状态操作</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;save($content);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 写入内容</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $value 文本</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">write</span><span class=\"params\">($value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_content .= $value;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;read();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 读取当前内容</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $value 文本</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">read</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;_content? <span class=\"keyword\">$this</span>-&gt;_content . <span class=\"string\">\"\\n\"</span>: <span class=\"string\">\"空文本\"</span> . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 保存内容</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">save</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_memento-&gt;add(<span class=\"keyword\">clone</span> <span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**s</span></span><br><span class=\"line\"><span class=\"comment\">     * 后退</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">undo</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取上个状态</span></span><br><span class=\"line\">        $undo = <span class=\"keyword\">$this</span>-&gt;_memento-&gt;undo();</span><br><span class=\"line\">        <span class=\"comment\">// 重置当前状态为上个状态</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_content = $undo-&gt;_content;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 复原</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">redo</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取开始状态</span></span><br><span class=\"line\">        $undo = <span class=\"keyword\">$this</span>-&gt;_memento-&gt;redo();</span><br><span class=\"line\">        <span class=\"comment\">// 重置当前状态为开始状态</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_content = $undo-&gt;_content;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个编辑器并新建一个空文件</span></span><br><span class=\"line\">    $editor = <span class=\"keyword\">new</span> Editor(<span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 写入一段文本</span></span><br><span class=\"line\">    $editor-&gt;write(<span class=\"string\">'hello php !'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 保存</span></span><br><span class=\"line\">    $editor-&gt;save();</span><br><span class=\"line\">    <span class=\"comment\">// 修改刚才的文本</span></span><br><span class=\"line\">    $editor-&gt;write(<span class=\"string\">' no code no life !'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 撤销</span></span><br><span class=\"line\">    $editor-&gt;undo();</span><br><span class=\"line\">    $editor-&gt;read();</span><br><span class=\"line\">    <span class=\"comment\">// 再次修改并保存文本</span></span><br><span class=\"line\">    $editor-&gt;write(<span class=\"string\">' life is a struggle !'</span>);</span><br><span class=\"line\">    $editor-&gt;save();</span><br><span class=\"line\">    <span class=\"comment\">// 重置</span></span><br><span class=\"line\">    $editor-&gt;redo();</span><br><span class=\"line\">    $editor-&gt;read();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>就是外部存储对象的状态，以提供后退/恢复/复原</li>\n<li>使用场景：编辑器后退操作/数据库事物/存档","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Memento</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 备忘录列表</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_mementoList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 添加编辑器实例状态</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Editor $editor 编辑器实例</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(Editor $editor)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        array_push(<span class=\"keyword\">$this</span>-&gt;_mementoList, $editor);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回编辑器实例上个状态</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Editor $editor 编辑器实例</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">undo</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_pop(<span class=\"keyword\">$this</span>-&gt;_mementoList);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回编辑器实例开始状态</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Editor $editor 编辑器实例</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">redo</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_shift(<span class=\"keyword\">$this</span>-&gt;_mementoList);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Editor</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 编辑器内容</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_content = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 备忘录实例</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> Memento</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_memento;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $content 打开的文件内容</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($content=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_content = $content;</span><br><span class=\"line\">        <span class=\"comment\">// 打印初始内容</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;read();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 初始化备忘录插件</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_memento = <span class=\"keyword\">new</span> Memento();</span><br><span class=\"line\">        <span class=\"comment\">// 第一次打开编辑器自动保存一次以提供重置状态操作</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;save($content);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 写入内容</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $value 文本</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">write</span><span class=\"params\">($value=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_content .= $value;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;read();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 读取当前内容</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $value 文本</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">read</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;_content? <span class=\"keyword\">$this</span>-&gt;_content . <span class=\"string\">\"\\n\"</span>: <span class=\"string\">\"空文本\"</span> . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 保存内容</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">save</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_memento-&gt;add(<span class=\"keyword\">clone</span> <span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**s</span></span><br><span class=\"line\"><span class=\"comment\">     * 后退</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">undo</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取上个状态</span></span><br><span class=\"line\">        $undo = <span class=\"keyword\">$this</span>-&gt;_memento-&gt;undo();</span><br><span class=\"line\">        <span class=\"comment\">// 重置当前状态为上个状态</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_content = $undo-&gt;_content;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 复原</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">redo</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取开始状态</span></span><br><span class=\"line\">        $undo = <span class=\"keyword\">$this</span>-&gt;_memento-&gt;redo();</span><br><span class=\"line\">        <span class=\"comment\">// 重置当前状态为开始状态</span></span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_content = $undo-&gt;_content;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个编辑器并新建一个空文件</span></span><br><span class=\"line\">    $editor = <span class=\"keyword\">new</span> Editor(<span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 写入一段文本</span></span><br><span class=\"line\">    $editor-&gt;write(<span class=\"string\">'hello php !'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 保存</span></span><br><span class=\"line\">    $editor-&gt;save();</span><br><span class=\"line\">    <span class=\"comment\">// 修改刚才的文本</span></span><br><span class=\"line\">    $editor-&gt;write(<span class=\"string\">' no code no life !'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 撤销</span></span><br><span class=\"line\">    $editor-&gt;undo();</span><br><span class=\"line\">    $editor-&gt;read();</span><br><span class=\"line\">    <span class=\"comment\">// 再次修改并保存文本</span></span><br><span class=\"line\">    $editor-&gt;write(<span class=\"string\">' life is a struggle !'</span>);</span><br><span class=\"line\">    $editor-&gt;save();</span><br><span class=\"line\">    <span class=\"comment\">// 重置</span></span><br><span class=\"line\">    $editor-&gt;redo();</span><br><span class=\"line\">    $editor-&gt;read();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-命令","date":"2017-04-25T16:00:00.000Z","updated":"2017-04-25T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n *  命令模式:就是在依赖的类中间加一个命令类，本来可以直接调用的类方法现在通过命令来调用，已达到\n * 解耦的的目的，其次可以实现undo，redo等操作，因为你知道调了哪些命令\n * 下面我们来用命令模式实现一个记事本，涉及的命令：\n * - 新建\n * - 写入\n * - 保存\n  <!-- more -->\n## 代码示例\n\n```php\n\n\n/**\n * 命令接口\n */\ninterface Order\n{\n    /**\n     * 执行命令\n     * @return void\n     */\n    public function execute();\n}\n\n/**\n * 文本类\n */\nclass Text\n{\n    /**\n     * 创建\n     *\n     * @param  string $name 文件名称\n     * @return string\n     */\n    public function create($filename='')\n    {\n        echo \"创建了一个文件: {$filename} \\n\";\n    }\n\n    /**\n     * 写入\n     *\n     * @param  string $content 文件名称\n     * @return string\n     */\n    public function write($filename='', $content='')\n    {\n        echo \"文件{$filename}写入了内容: {$content} \\n\";\n    }\n\n    /**\n     * 保存\n     *\n     * @param  string $filename 文件名称\n     * @return string\n     */\n    public function save($filename='')\n    {\n        echo \"保存了一个文件: {$filename} \\n\";\n    }\n}\n\n\n/**\n * 控制台\n * 负责命令执行\n */\nclass Console\n{\n    /**\n     * 命令队列\n     * @var array\n     */\n    private $_orderList = [];\n\n    /**\n     * 添加命令到队列\n     * @param Order $order\n     */\n    public function add(Order $order)\n    {\n        array_push($this->_orderList, $order);\n    }\n\n    /**\n     * 执行命令\n     * @return mixed\n     */\n    public function run()\n    {\n        foreach ($this->_orderList as $k => $v) {\n            $v->execute();\n        }\n    }\n}\n\n/**\n * 创建文本命令\n */\nclass OrderCreate implements Order\n{\n    /**\n     * 文本类实体\n     * @var object\n     */\n    private $_text;\n\n    /**\n     * 命令参数\n     * @var array\n     */\n    private $_arguments = [\n        'filename' => ''\n    ];\n\n    /**\n     * 构造函数\n     *\n     * @param Text $text\n     * @param array $arguments\n     */\n    public function __construct(Text $text, $arguments=[])\n    {\n        $this->_text      = $text;\n        $this->_arguments = $arguments;\n    }\n\n    /**\n     * 执行命令\n     *\n     * @return void\n     */\n    public function execute()\n    {\n        $this->_text->create($this->_arguments['filename']);\n    }\n}\n\n/**\n * 保存文本命令\n */\nclass OrderSave implements Order\n{\n    /**\n     * 文本类实体\n     * @var object\n     */\n    private $_text;\n\n    /**\n     * 命令参数\n     * @var array\n     */\n    private $_arguments = [\n        'filename' => ''\n    ];\n\n    /**\n     * 构造函数\n     *\n     * @param Text text\n     * @param array $arguments\n     */\n    public function __construct(Text $text, $arguments=[])\n    {\n        $this->_text      = $text;\n        $this->_arguments = $arguments;\n    }\n\n    /**\n     * 执行命令\n     *\n     * @return void\n     */\n    public function execute()\n    {\n        $this->_text->save($this->_arguments['filename']);\n    }\n}\n\n/**\n * 写入文本命令\n */\nclass OrderWrite implements Order\n{\n    /**\n     * 文本类实体\n     * @var object\n     */\n    private $_text;\n\n    /**\n     * 命令参数\n     * @var array\n     */\n    private $_arguments = [\n        'filename' => '',\n        'content'  => ''\n    ];\n\n\n    /**\n     * 构造函数\n     *\n     * @param Text text\n     * @param array $arguments\n     */\n    public function __construct(Text $text, $arguments=[])\n    {\n        $this->_text      = $text;\n        $this->_arguments = $arguments;\n    }\n\n    /**\n     * 执行命令\n     *\n     * @return void\n     */\n    public function execute()\n    {\n        $this->_text->Write(\n            $this->_arguments['filename'],\n            $this->_arguments['content']\n        );\n    }\n}\n\ntry {\n    // 创建一个记事本实例\n    $text   = new Text();\n\n    // 创建命令\n    $create = new OrderCreate($text, [\n        'filename' => 'test.txt'\n    ]);\n    // 写入命令\n    $write  = new OrderWrite($text, [\n        'filename' => 'test.txt',\n        'content'  => 'life is a struggle'\n    ]);\n    // 保存命令\n    $save   = new OrderSave($text, [\n        'filename' => 'text.txt'\n    ]);\n\n    // 创建一个控制台\n    $console = new Console();\n    // 添加命令\n    $console->add($create);\n    $console->add($write);\n    $console->add($save);\n    // 运行命令\n    $console->run();\n\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n```\n","source":"_posts/2017-04-25-command.md","raw":"---\ntitle:  \"PHP设计模式-命令\"\ndate: 2017-04-25 12:00:00\nupdated: 2017-04-25 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n *  命令模式:就是在依赖的类中间加一个命令类，本来可以直接调用的类方法现在通过命令来调用，已达到\n * 解耦的的目的，其次可以实现undo，redo等操作，因为你知道调了哪些命令\n * 下面我们来用命令模式实现一个记事本，涉及的命令：\n * - 新建\n * - 写入\n * - 保存\n  <!-- more -->\n## 代码示例\n\n```php\n\n\n/**\n * 命令接口\n */\ninterface Order\n{\n    /**\n     * 执行命令\n     * @return void\n     */\n    public function execute();\n}\n\n/**\n * 文本类\n */\nclass Text\n{\n    /**\n     * 创建\n     *\n     * @param  string $name 文件名称\n     * @return string\n     */\n    public function create($filename='')\n    {\n        echo \"创建了一个文件: {$filename} \\n\";\n    }\n\n    /**\n     * 写入\n     *\n     * @param  string $content 文件名称\n     * @return string\n     */\n    public function write($filename='', $content='')\n    {\n        echo \"文件{$filename}写入了内容: {$content} \\n\";\n    }\n\n    /**\n     * 保存\n     *\n     * @param  string $filename 文件名称\n     * @return string\n     */\n    public function save($filename='')\n    {\n        echo \"保存了一个文件: {$filename} \\n\";\n    }\n}\n\n\n/**\n * 控制台\n * 负责命令执行\n */\nclass Console\n{\n    /**\n     * 命令队列\n     * @var array\n     */\n    private $_orderList = [];\n\n    /**\n     * 添加命令到队列\n     * @param Order $order\n     */\n    public function add(Order $order)\n    {\n        array_push($this->_orderList, $order);\n    }\n\n    /**\n     * 执行命令\n     * @return mixed\n     */\n    public function run()\n    {\n        foreach ($this->_orderList as $k => $v) {\n            $v->execute();\n        }\n    }\n}\n\n/**\n * 创建文本命令\n */\nclass OrderCreate implements Order\n{\n    /**\n     * 文本类实体\n     * @var object\n     */\n    private $_text;\n\n    /**\n     * 命令参数\n     * @var array\n     */\n    private $_arguments = [\n        'filename' => ''\n    ];\n\n    /**\n     * 构造函数\n     *\n     * @param Text $text\n     * @param array $arguments\n     */\n    public function __construct(Text $text, $arguments=[])\n    {\n        $this->_text      = $text;\n        $this->_arguments = $arguments;\n    }\n\n    /**\n     * 执行命令\n     *\n     * @return void\n     */\n    public function execute()\n    {\n        $this->_text->create($this->_arguments['filename']);\n    }\n}\n\n/**\n * 保存文本命令\n */\nclass OrderSave implements Order\n{\n    /**\n     * 文本类实体\n     * @var object\n     */\n    private $_text;\n\n    /**\n     * 命令参数\n     * @var array\n     */\n    private $_arguments = [\n        'filename' => ''\n    ];\n\n    /**\n     * 构造函数\n     *\n     * @param Text text\n     * @param array $arguments\n     */\n    public function __construct(Text $text, $arguments=[])\n    {\n        $this->_text      = $text;\n        $this->_arguments = $arguments;\n    }\n\n    /**\n     * 执行命令\n     *\n     * @return void\n     */\n    public function execute()\n    {\n        $this->_text->save($this->_arguments['filename']);\n    }\n}\n\n/**\n * 写入文本命令\n */\nclass OrderWrite implements Order\n{\n    /**\n     * 文本类实体\n     * @var object\n     */\n    private $_text;\n\n    /**\n     * 命令参数\n     * @var array\n     */\n    private $_arguments = [\n        'filename' => '',\n        'content'  => ''\n    ];\n\n\n    /**\n     * 构造函数\n     *\n     * @param Text text\n     * @param array $arguments\n     */\n    public function __construct(Text $text, $arguments=[])\n    {\n        $this->_text      = $text;\n        $this->_arguments = $arguments;\n    }\n\n    /**\n     * 执行命令\n     *\n     * @return void\n     */\n    public function execute()\n    {\n        $this->_text->Write(\n            $this->_arguments['filename'],\n            $this->_arguments['content']\n        );\n    }\n}\n\ntry {\n    // 创建一个记事本实例\n    $text   = new Text();\n\n    // 创建命令\n    $create = new OrderCreate($text, [\n        'filename' => 'test.txt'\n    ]);\n    // 写入命令\n    $write  = new OrderWrite($text, [\n        'filename' => 'test.txt',\n        'content'  => 'life is a struggle'\n    ]);\n    // 保存命令\n    $save   = new OrderSave($text, [\n        'filename' => 'text.txt'\n    ]);\n\n    // 创建一个控制台\n    $console = new Console();\n    // 添加命令\n    $console->add($create);\n    $console->add($write);\n    $console->add($save);\n    // 运行命令\n    $console->run();\n\n} catch (\\Exception $e) {\n    echo $e->getMessage();\n}\n```\n","slug":"2017-04-25-command","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qko001py4rbk3mr7x6b","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>命令模式:就是在依赖的类中间加一个命令类，本来可以直接调用的类方法现在通过命令来调用，已达到</li>\n<li>解耦的的目的，其次可以实现undo，redo等操作，因为你知道调了哪些命令</li>\n<li>下面我们来用命令模式实现一个记事本，涉及的命令：</li>\n<li><ul>\n<li>新建</li>\n</ul>\n</li>\n<li><ul>\n<li>写入</li>\n</ul>\n</li>\n<li><ul>\n<li>保存<a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 命令接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Order</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 文本类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Text</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 文件名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create</span><span class=\"params\">($filename=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"创建了一个文件: &#123;$filename&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 写入</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $content 文件名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">write</span><span class=\"params\">($filename=<span class=\"string\">''</span>, $content=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"文件&#123;$filename&#125;写入了内容: &#123;$content&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 保存</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $filename 文件名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">save</span><span class=\"params\">($filename=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"保存了一个文件: &#123;$filename&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 控制台</span></span><br><span class=\"line\"><span class=\"comment\"> * 负责命令执行</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Console</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 命令队列</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_orderList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 添加命令到队列</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Order $order</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(Order $order)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        array_push(<span class=\"keyword\">$this</span>-&gt;_orderList, $order);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">run</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_orderList <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            $v-&gt;execute();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 创建文本命令</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OrderCreate</span> <span class=\"keyword\">implements</span> <span class=\"title\">Order</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文本类实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 命令参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_arguments = [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">''</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Text $text</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $arguments</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Text $text, $arguments=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text      = $text;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_arguments = $arguments;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text-&gt;create(<span class=\"keyword\">$this</span>-&gt;_arguments[<span class=\"string\">'filename'</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 保存文本命令</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OrderSave</span> <span class=\"keyword\">implements</span> <span class=\"title\">Order</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文本类实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 命令参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_arguments = [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">''</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Text text</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $arguments</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Text $text, $arguments=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text      = $text;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_arguments = $arguments;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text-&gt;save(<span class=\"keyword\">$this</span>-&gt;_arguments[<span class=\"string\">'filename'</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 写入文本命令</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OrderWrite</span> <span class=\"keyword\">implements</span> <span class=\"title\">Order</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文本类实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 命令参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_arguments = [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">''</span>,</span><br><span class=\"line\">        <span class=\"string\">'content'</span>  =&gt; <span class=\"string\">''</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Text text</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $arguments</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Text $text, $arguments=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text      = $text;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_arguments = $arguments;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text-&gt;Write(</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_arguments[<span class=\"string\">'filename'</span>],</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_arguments[<span class=\"string\">'content'</span>]</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建一个记事本实例</span></span><br><span class=\"line\">    $text   = <span class=\"keyword\">new</span> Text();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建命令</span></span><br><span class=\"line\">    $create = <span class=\"keyword\">new</span> OrderCreate($text, [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">'test.txt'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">// 写入命令</span></span><br><span class=\"line\">    $write  = <span class=\"keyword\">new</span> OrderWrite($text, [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">'test.txt'</span>,</span><br><span class=\"line\">        <span class=\"string\">'content'</span>  =&gt; <span class=\"string\">'life is a struggle'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">// 保存命令</span></span><br><span class=\"line\">    $save   = <span class=\"keyword\">new</span> OrderSave($text, [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">'text.txt'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建一个控制台</span></span><br><span class=\"line\">    $console = <span class=\"keyword\">new</span> Console();</span><br><span class=\"line\">    <span class=\"comment\">// 添加命令</span></span><br><span class=\"line\">    $console-&gt;add($create);</span><br><span class=\"line\">    $console-&gt;add($write);</span><br><span class=\"line\">    $console-&gt;add($save);</span><br><span class=\"line\">    <span class=\"comment\">// 运行命令</span></span><br><span class=\"line\">    $console-&gt;run();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>命令模式:就是在依赖的类中间加一个命令类，本来可以直接调用的类方法现在通过命令来调用，已达到</li>\n<li>解耦的的目的，其次可以实现undo，redo等操作，因为你知道调了哪些命令</li>\n<li>下面我们来用命令模式实现一个记事本，涉及的命令：</li>\n<li><ul>\n<li>新建</li>\n</ul>\n</li>\n<li><ul>\n<li>写入</li>\n</ul>\n</li>\n<li><ul>\n<li>保存","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 命令接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Order</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 文本类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Text</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 文件名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create</span><span class=\"params\">($filename=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"创建了一个文件: &#123;$filename&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 写入</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $content 文件名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">write</span><span class=\"params\">($filename=<span class=\"string\">''</span>, $content=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"文件&#123;$filename&#125;写入了内容: &#123;$content&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 保存</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $filename 文件名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">save</span><span class=\"params\">($filename=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"保存了一个文件: &#123;$filename&#125; \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 控制台</span></span><br><span class=\"line\"><span class=\"comment\"> * 负责命令执行</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Console</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 命令队列</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_orderList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 添加命令到队列</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Order $order</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span><span class=\"params\">(Order $order)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        array_push(<span class=\"keyword\">$this</span>-&gt;_orderList, $order);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">run</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_orderList <span class=\"keyword\">as</span> $k =&gt; $v) &#123;</span><br><span class=\"line\">            $v-&gt;execute();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 创建文本命令</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OrderCreate</span> <span class=\"keyword\">implements</span> <span class=\"title\">Order</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文本类实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 命令参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_arguments = [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">''</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Text $text</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $arguments</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Text $text, $arguments=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text      = $text;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_arguments = $arguments;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text-&gt;create(<span class=\"keyword\">$this</span>-&gt;_arguments[<span class=\"string\">'filename'</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 保存文本命令</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OrderSave</span> <span class=\"keyword\">implements</span> <span class=\"title\">Order</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文本类实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 命令参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_arguments = [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">''</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Text text</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $arguments</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Text $text, $arguments=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text      = $text;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_arguments = $arguments;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text-&gt;save(<span class=\"keyword\">$this</span>-&gt;_arguments[<span class=\"string\">'filename'</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 写入文本命令</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OrderWrite</span> <span class=\"keyword\">implements</span> <span class=\"title\">Order</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 文本类实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 命令参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_arguments = [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">''</span>,</span><br><span class=\"line\">        <span class=\"string\">'content'</span>  =&gt; <span class=\"string\">''</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> Text text</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $arguments</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(Text $text, $arguments=[])</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text      = $text;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_arguments = $arguments;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行命令</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_text-&gt;Write(</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_arguments[<span class=\"string\">'filename'</span>],</span><br><span class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_arguments[<span class=\"string\">'content'</span>]</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 创建一个记事本实例</span></span><br><span class=\"line\">    $text   = <span class=\"keyword\">new</span> Text();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建命令</span></span><br><span class=\"line\">    $create = <span class=\"keyword\">new</span> OrderCreate($text, [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">'test.txt'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">// 写入命令</span></span><br><span class=\"line\">    $write  = <span class=\"keyword\">new</span> OrderWrite($text, [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">'test.txt'</span>,</span><br><span class=\"line\">        <span class=\"string\">'content'</span>  =&gt; <span class=\"string\">'life is a struggle'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\">    <span class=\"comment\">// 保存命令</span></span><br><span class=\"line\">    $save   = <span class=\"keyword\">new</span> OrderSave($text, [</span><br><span class=\"line\">        <span class=\"string\">'filename'</span> =&gt; <span class=\"string\">'text.txt'</span></span><br><span class=\"line\">    ]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建一个控制台</span></span><br><span class=\"line\">    $console = <span class=\"keyword\">new</span> Console();</span><br><span class=\"line\">    <span class=\"comment\">// 添加命令</span></span><br><span class=\"line\">    $console-&gt;add($create);</span><br><span class=\"line\">    $console-&gt;add($write);</span><br><span class=\"line\">    $console-&gt;add($save);</span><br><span class=\"line\">    <span class=\"comment\">// 运行命令</span></span><br><span class=\"line\">    $console-&gt;run();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-迭代器","date":"2017-04-26T16:00:00.000Z","updated":"2017-04-26T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * 遍历对象内部的属性，无需对外暴露内部的构成\n * 下面我们来实现一个迭代器访问学校所有的老师\n   <!-- more -->\n## 代码示例\n\n```php\n\nnamespace iterator;\n\n/**\n * 学校接口\n */\ninterface School\n{\n    /**\n     * 获取迭代器\n     *\n     * @return mixed\n     */\n    public function getIterator();\n}\n\n/**\n * 迭代器接口\n */\ninterface Iterator\n{\n    /**\n     * 是否还有下一个\n     *\n     * @return boolean\n     */\n    public function hasNext();\n\n    /**\n     * 下一个\n     *\n     * @return object\n     */\n    public function next();\n\n    /**\n     * 当前\n     *\n     * @return mixed\n     */\n    public function current();\n\n    /**\n     * 当前索引\n     *\n     * @return mixed\n     */\n    public function index();\n}\n\n/**\n * 实验小学实体\n */\nclass SchoolExperimental implements School\n{\n    /**\n     * 老师集合\n     * @var\n     */\n    private $_teachers = [];\n\n    /**\n     * 魔法方法\n     *\n     * @param  string $name 属性名称\n     * @return mixed\n     */\n    public function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 添加老师\n     * @param string $name\n     */\n    public function addTeacher($name='')\n    {\n        $this->_teachers[] = $name;\n    }\n\n    /**\n     * 获取教师迭代器\n     *\n     * @return mixed\n     */\n    public function getIterator()\n    {\n        return new TeacherIterator($this);\n    }\n}\n\n/**\n * 老师迭代实体\n */\nclass TeacherIterator implements Iterator\n{\n\n    /**\n     * 索引值\n     * @var integer\n     */\n    private $_index = 0;\n\n    /**\n     * 要迭代的对象\n     * @var object\n     */\n    private $_teachers;\n\n    /**\n     * 构造函数\n     *\n     * @param School $school\n     */\n    public function __construct(School $school)\n    {\n        $this->_teachers = $school->teachers;\n    }\n\n    /**\n     * 是否还有下一个\n     *\n     * @return boolean\n     */\n    public function hasNext()\n    {\n        if ($this->_index < count($this->_teachers)) {\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * 下一个\n     *\n     * @return object\n     */\n    public function next()\n    {\n        if (!$this->hasNext()) {\n            echo NULL;\n            return;\n        }\n        $index = $this->_index + 1;\n        echo $this->_teachers[$index];\n    }\n\n    /**\n     * 当前\n     *\n     * @return mixed\n     */\n    public function current()\n    {\n        if (!isset($this->_teachers[$this->_index])) {\n            echo  NULL;\n            return;\n        }\n        $current = $this->_teachers[$this->_index];\n        $this->_index += 1;\n        echo $current . \"\\n\";\n    }\n\n    /**\n     * 当前索引\n     *\n     * @return integer\n     */\n    public function index()\n    {\n        echo $this->_index;\n    }\n}\n\ntry {\n    // 初始化一个实验小学\n    $experimental = new SchoolExperimental();\n    // 添加老师\n    $experimental->addTeacher('Griffin');\n    $experimental->addTeacher('Curry');\n    $experimental->addTeacher('Mc');\n    $experimental->addTeacher('Kobe');\n    $experimental->addTeacher('Rose');\n    $experimental->addTeacher('Kd');\n    // 获取教师迭代器\n    $iterator = $experimental->getIterator();\n    // 打印所有老师\n    do {\n        $iterator->current();\n    } while ($iterator->hasNext());\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n```","source":"_posts/2017-04-26-iterator.md","raw":"---\ntitle:  \"PHP设计模式-迭代器\"\ndate: 2017-04-26 12:00:00\nupdated: 2017-04-26 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * 遍历对象内部的属性，无需对外暴露内部的构成\n * 下面我们来实现一个迭代器访问学校所有的老师\n   <!-- more -->\n## 代码示例\n\n```php\n\nnamespace iterator;\n\n/**\n * 学校接口\n */\ninterface School\n{\n    /**\n     * 获取迭代器\n     *\n     * @return mixed\n     */\n    public function getIterator();\n}\n\n/**\n * 迭代器接口\n */\ninterface Iterator\n{\n    /**\n     * 是否还有下一个\n     *\n     * @return boolean\n     */\n    public function hasNext();\n\n    /**\n     * 下一个\n     *\n     * @return object\n     */\n    public function next();\n\n    /**\n     * 当前\n     *\n     * @return mixed\n     */\n    public function current();\n\n    /**\n     * 当前索引\n     *\n     * @return mixed\n     */\n    public function index();\n}\n\n/**\n * 实验小学实体\n */\nclass SchoolExperimental implements School\n{\n    /**\n     * 老师集合\n     * @var\n     */\n    private $_teachers = [];\n\n    /**\n     * 魔法方法\n     *\n     * @param  string $name 属性名称\n     * @return mixed\n     */\n    public function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 添加老师\n     * @param string $name\n     */\n    public function addTeacher($name='')\n    {\n        $this->_teachers[] = $name;\n    }\n\n    /**\n     * 获取教师迭代器\n     *\n     * @return mixed\n     */\n    public function getIterator()\n    {\n        return new TeacherIterator($this);\n    }\n}\n\n/**\n * 老师迭代实体\n */\nclass TeacherIterator implements Iterator\n{\n\n    /**\n     * 索引值\n     * @var integer\n     */\n    private $_index = 0;\n\n    /**\n     * 要迭代的对象\n     * @var object\n     */\n    private $_teachers;\n\n    /**\n     * 构造函数\n     *\n     * @param School $school\n     */\n    public function __construct(School $school)\n    {\n        $this->_teachers = $school->teachers;\n    }\n\n    /**\n     * 是否还有下一个\n     *\n     * @return boolean\n     */\n    public function hasNext()\n    {\n        if ($this->_index < count($this->_teachers)) {\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * 下一个\n     *\n     * @return object\n     */\n    public function next()\n    {\n        if (!$this->hasNext()) {\n            echo NULL;\n            return;\n        }\n        $index = $this->_index + 1;\n        echo $this->_teachers[$index];\n    }\n\n    /**\n     * 当前\n     *\n     * @return mixed\n     */\n    public function current()\n    {\n        if (!isset($this->_teachers[$this->_index])) {\n            echo  NULL;\n            return;\n        }\n        $current = $this->_teachers[$this->_index];\n        $this->_index += 1;\n        echo $current . \"\\n\";\n    }\n\n    /**\n     * 当前索引\n     *\n     * @return integer\n     */\n    public function index()\n    {\n        echo $this->_index;\n    }\n}\n\ntry {\n    // 初始化一个实验小学\n    $experimental = new SchoolExperimental();\n    // 添加老师\n    $experimental->addTeacher('Griffin');\n    $experimental->addTeacher('Curry');\n    $experimental->addTeacher('Mc');\n    $experimental->addTeacher('Kobe');\n    $experimental->addTeacher('Rose');\n    $experimental->addTeacher('Kd');\n    // 获取教师迭代器\n    $iterator = $experimental->getIterator();\n    // 打印所有老师\n    do {\n        $iterator->current();\n    } while ($iterator->hasNext());\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n```","slug":"2017-04-26-iterator","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkp001sy4rbmm9rkas2","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>遍历对象内部的属性，无需对外暴露内部的构成</li>\n<li>下面我们来实现一个迭代器访问学校所有的老师<a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">iterator</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 学校接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">School</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取迭代器</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIterator</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 迭代器接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Iterator</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 是否还有下一个</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hasNext</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 下一个</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">next</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">current</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前索引</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">index</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实验小学实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SchoolExperimental</span> <span class=\"keyword\">implements</span> <span class=\"title\">School</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 老师集合</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_teachers = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔法方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 添加老师</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTeacher</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_teachers[] = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取教师迭代器</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIterator</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> TeacherIterator(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 老师迭代实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TeacherIterator</span> <span class=\"keyword\">implements</span> <span class=\"title\">Iterator</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 索引值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> integer</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_index = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 要迭代的对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_teachers;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> School $school</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(School $school)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_teachers = $school-&gt;teachers;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 是否还有下一个</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hasNext</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;_index &lt; count(<span class=\"keyword\">$this</span>-&gt;_teachers)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 下一个</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">next</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;hasNext()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"keyword\">NULL</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $index = <span class=\"keyword\">$this</span>-&gt;_index + <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;_teachers[$index];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">current</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;_teachers[<span class=\"keyword\">$this</span>-&gt;_index])) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>  <span class=\"keyword\">NULL</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $current = <span class=\"keyword\">$this</span>-&gt;_teachers[<span class=\"keyword\">$this</span>-&gt;_index];</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_index += <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $current . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前索引</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> integer</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">index</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;_index;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个实验小学</span></span><br><span class=\"line\">    $experimental = <span class=\"keyword\">new</span> SchoolExperimental();</span><br><span class=\"line\">    <span class=\"comment\">// 添加老师</span></span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Griffin'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Curry'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Mc'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Kobe'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Rose'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Kd'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 获取教师迭代器</span></span><br><span class=\"line\">    $iterator = $experimental-&gt;getIterator();</span><br><span class=\"line\">    <span class=\"comment\">// 打印所有老师</span></span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        $iterator-&gt;current();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> ($iterator-&gt;hasNext());</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>遍历对象内部的属性，无需对外暴露内部的构成</li>\n<li>下面我们来实现一个迭代器访问学校所有的老师","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">iterator</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 学校接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">School</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取迭代器</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIterator</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 迭代器接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Iterator</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 是否还有下一个</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hasNext</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 下一个</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">next</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">current</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前索引</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">index</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 实验小学实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SchoolExperimental</span> <span class=\"keyword\">implements</span> <span class=\"title\">School</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 老师集合</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_teachers = [];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔法方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 添加老师</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $name</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTeacher</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_teachers[] = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取教师迭代器</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIterator</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> TeacherIterator(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 老师迭代实体</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TeacherIterator</span> <span class=\"keyword\">implements</span> <span class=\"title\">Iterator</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 索引值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> integer</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_index = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 要迭代的对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_teachers;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> School $school</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">(School $school)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_teachers = $school-&gt;teachers;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 是否还有下一个</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> boolean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hasNext</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;_index &lt; count(<span class=\"keyword\">$this</span>-&gt;_teachers)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 下一个</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> object</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">next</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">$this</span>-&gt;hasNext()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"keyword\">NULL</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $index = <span class=\"keyword\">$this</span>-&gt;_index + <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;_teachers[$index];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">current</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;_teachers[<span class=\"keyword\">$this</span>-&gt;_index])) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span>  <span class=\"keyword\">NULL</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $current = <span class=\"keyword\">$this</span>-&gt;_teachers[<span class=\"keyword\">$this</span>-&gt;_index];</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_index += <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> $current . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当前索引</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> integer</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">index</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"keyword\">$this</span>-&gt;_index;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个实验小学</span></span><br><span class=\"line\">    $experimental = <span class=\"keyword\">new</span> SchoolExperimental();</span><br><span class=\"line\">    <span class=\"comment\">// 添加老师</span></span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Griffin'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Curry'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Mc'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Kobe'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Rose'</span>);</span><br><span class=\"line\">    $experimental-&gt;addTeacher(<span class=\"string\">'Kd'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 获取教师迭代器</span></span><br><span class=\"line\">    $iterator = $experimental-&gt;getIterator();</span><br><span class=\"line\">    <span class=\"comment\">// 打印所有老师</span></span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        $iterator-&gt;current();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> ($iterator-&gt;hasNext());</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-中介者","date":"2017-04-27T16:00:00.000Z","updated":"2017-04-27T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * 就是不同的对象之间通信，互相之间不直接调用，而是通过一个中间对象（中介者）\n * 使用场景：对象之间大量的互相依赖\n * 下面实现一个房屋中介\n    <!-- more -->\n## 代码示例\n\n```php\n/**\n * 抽象类人\n */\nabstract class Person\n{\n    /**\n     * 名字\n     * @var string\n     */\n    private $_name = '';\n\n    /**\n     * 构造函数\n     */\n    function __construct($name)\n    {\n        $this->_name = $name;\n    }\n\n    /**\n     * 魔术方法\n     * 读取私有属性\n     *\n     * @param  string $name 属性名称\n     * @return mixed\n     */\n    function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 抽象方法\n     *\n     * @return mixed\n     */\n    abstract function doSomthing(Person $person);\n}\n\n/**\n * 房屋中介\n */\nclass HouseMediator\n{\n    /**\n     * 提供租房服务\n     *\n     * @param  Person $person 租客\n     * @return Person\n     */\n    function rentHouse(Person $person)\n    {\n        // 初始化一个房东\n        $landlord = new Landlord('小梅');\n        // 租房子\n        echo '通过房屋中介，' . $landlord->doSomthing($person);\n    }\n}\n\n/**\n * 房东\n */\nclass Landlord extends Person\n{\n    /**\n     * 租出去房子\n     *\n     * @return mixed\n     */\n    public function doSomthing(Person $person)\n    {\n        // 租出去闲置房子\n        return \"‘{$this->name}’租出去一件闲置房给‘{$person->name}’ ～ \\n\";\n    }\n}\n\n/**\n * 租客\n */\nclass Tenant extends Person\n{\n    /**\n     * 组间房子\n     *\n     * @return mixed\n     */\n    public function doSomthing(Person $person)\n    {\n        // 本来是之间找房东租房,但是茫茫人海错综复杂\n        // 下面我们通过一家正规的房屋中介租房\n        $houseMediator = new HouseMediator();\n        $houseMediator->rentHouse($this);\n    }\n}\n\ntry {\n    // 初始化一个租客\n    $tenant = new Tenant('小明');\n\n    // 小明直接找小梅租房\n    $landlord = new Landlord('小梅');\n    echo $landlord->doSomthing($tenant);\n\n    // 小明通过房屋中介租房\n    // 初始化一个房屋中介\n    $mediator = new HouseMediator();\n    // 租房\n    $mediator->rentHouse($tenant);\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n```\n\n","source":"_posts/2017-04-27-mediator.md","raw":"---\ntitle:  \"PHP设计模式-中介者\"\ndate: 2017-04-27 12:00:00\nupdated: 2017-04-27 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * 就是不同的对象之间通信，互相之间不直接调用，而是通过一个中间对象（中介者）\n * 使用场景：对象之间大量的互相依赖\n * 下面实现一个房屋中介\n    <!-- more -->\n## 代码示例\n\n```php\n/**\n * 抽象类人\n */\nabstract class Person\n{\n    /**\n     * 名字\n     * @var string\n     */\n    private $_name = '';\n\n    /**\n     * 构造函数\n     */\n    function __construct($name)\n    {\n        $this->_name = $name;\n    }\n\n    /**\n     * 魔术方法\n     * 读取私有属性\n     *\n     * @param  string $name 属性名称\n     * @return mixed\n     */\n    function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 抽象方法\n     *\n     * @return mixed\n     */\n    abstract function doSomthing(Person $person);\n}\n\n/**\n * 房屋中介\n */\nclass HouseMediator\n{\n    /**\n     * 提供租房服务\n     *\n     * @param  Person $person 租客\n     * @return Person\n     */\n    function rentHouse(Person $person)\n    {\n        // 初始化一个房东\n        $landlord = new Landlord('小梅');\n        // 租房子\n        echo '通过房屋中介，' . $landlord->doSomthing($person);\n    }\n}\n\n/**\n * 房东\n */\nclass Landlord extends Person\n{\n    /**\n     * 租出去房子\n     *\n     * @return mixed\n     */\n    public function doSomthing(Person $person)\n    {\n        // 租出去闲置房子\n        return \"‘{$this->name}’租出去一件闲置房给‘{$person->name}’ ～ \\n\";\n    }\n}\n\n/**\n * 租客\n */\nclass Tenant extends Person\n{\n    /**\n     * 组间房子\n     *\n     * @return mixed\n     */\n    public function doSomthing(Person $person)\n    {\n        // 本来是之间找房东租房,但是茫茫人海错综复杂\n        // 下面我们通过一家正规的房屋中介租房\n        $houseMediator = new HouseMediator();\n        $houseMediator->rentHouse($this);\n    }\n}\n\ntry {\n    // 初始化一个租客\n    $tenant = new Tenant('小明');\n\n    // 小明直接找小梅租房\n    $landlord = new Landlord('小梅');\n    echo $landlord->doSomthing($tenant);\n\n    // 小明通过房屋中介租房\n    // 初始化一个房屋中介\n    $mediator = new HouseMediator();\n    // 租房\n    $mediator->rentHouse($tenant);\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n\n```\n\n","slug":"2017-04-27-mediator","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkq001vy4rbik4ldamt","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>就是不同的对象之间通信，互相之间不直接调用，而是通过一个中间对象（中介者）</li>\n<li>使用场景：对象之间大量的互相依赖</li>\n<li>下面实现一个房屋中介 <a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 抽象类人</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 名字</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_name = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法</span></span><br><span class=\"line\"><span class=\"comment\">     * 读取私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 抽象方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">(Person $person)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 房屋中介</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HouseMediator</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 提供租房服务</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  Person $person 租客</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> Person</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rentHouse</span><span class=\"params\">(Person $person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化一个房东</span></span><br><span class=\"line\">        $landlord = <span class=\"keyword\">new</span> Landlord(<span class=\"string\">'小梅'</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 租房子</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">'通过房屋中介，'</span> . $landlord-&gt;doSomthing($person);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 房东</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Landlord</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 租出去房子</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">(Person $person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 租出去闲置房子</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"‘&#123;$this-&gt;name&#125;’租出去一件闲置房给‘&#123;$person-&gt;name&#125;’ ～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 租客</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Tenant</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 组间房子</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">(Person $person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 本来是之间找房东租房,但是茫茫人海错综复杂</span></span><br><span class=\"line\">        <span class=\"comment\">// 下面我们通过一家正规的房屋中介租房</span></span><br><span class=\"line\">        $houseMediator = <span class=\"keyword\">new</span> HouseMediator();</span><br><span class=\"line\">        $houseMediator-&gt;rentHouse(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个租客</span></span><br><span class=\"line\">    $tenant = <span class=\"keyword\">new</span> Tenant(<span class=\"string\">'小明'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 小明直接找小梅租房</span></span><br><span class=\"line\">    $landlord = <span class=\"keyword\">new</span> Landlord(<span class=\"string\">'小梅'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $landlord-&gt;doSomthing($tenant);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 小明通过房屋中介租房</span></span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个房屋中介</span></span><br><span class=\"line\">    $mediator = <span class=\"keyword\">new</span> HouseMediator();</span><br><span class=\"line\">    <span class=\"comment\">// 租房</span></span><br><span class=\"line\">    $mediator-&gt;rentHouse($tenant);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>就是不同的对象之间通信，互相之间不直接调用，而是通过一个中间对象（中介者）</li>\n<li>使用场景：对象之间大量的互相依赖</li>\n<li>下面实现一个房屋中介","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 抽象类人</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 名字</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_name = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法</span></span><br><span class=\"line\"><span class=\"comment\">     * 读取私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 抽象方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">(Person $person)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 房屋中介</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HouseMediator</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 提供租房服务</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  Person $person 租客</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> Person</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">rentHouse</span><span class=\"params\">(Person $person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 初始化一个房东</span></span><br><span class=\"line\">        $landlord = <span class=\"keyword\">new</span> Landlord(<span class=\"string\">'小梅'</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 租房子</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">'通过房屋中介，'</span> . $landlord-&gt;doSomthing($person);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 房东</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Landlord</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 租出去房子</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">(Person $person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 租出去闲置房子</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"‘&#123;$this-&gt;name&#125;’租出去一件闲置房给‘&#123;$person-&gt;name&#125;’ ～ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 租客</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Tenant</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 组间房子</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">(Person $person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 本来是之间找房东租房,但是茫茫人海错综复杂</span></span><br><span class=\"line\">        <span class=\"comment\">// 下面我们通过一家正规的房屋中介租房</span></span><br><span class=\"line\">        $houseMediator = <span class=\"keyword\">new</span> HouseMediator();</span><br><span class=\"line\">        $houseMediator-&gt;rentHouse(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个租客</span></span><br><span class=\"line\">    $tenant = <span class=\"keyword\">new</span> Tenant(<span class=\"string\">'小明'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 小明直接找小梅租房</span></span><br><span class=\"line\">    $landlord = <span class=\"keyword\">new</span> Landlord(<span class=\"string\">'小梅'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> $landlord-&gt;doSomthing($tenant);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 小明通过房屋中介租房</span></span><br><span class=\"line\">    <span class=\"comment\">// 初始化一个房屋中介</span></span><br><span class=\"line\">    $mediator = <span class=\"keyword\">new</span> HouseMediator();</span><br><span class=\"line\">    <span class=\"comment\">// 租房</span></span><br><span class=\"line\">    $mediator-&gt;rentHouse($tenant);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"PHP设计模式-空对象","date":"2017-05-01T16:00:00.000Z","updated":"2017-05-01T16:00:00.000Z","comments":1,"_content":"\n## 适用性\n\n * 当程序运行过程中出现操作空对象时，程序依然能够通过操作提供的空对象继续执行\n * 下面实现老师课堂叫学生回答问题\n     <!-- more -->\n## 代码示例\n\n```php\n/**\n * 抽象类人\n */\nabstract class Person\n{\n    /**\n     * 名字\n     * @var string\n     */\n    private $_name = '';\n\n    /**\n     * 构造函数\n     */\n    function __construct($name)\n    {\n        $this->_name = $name;\n    }\n\n    /**\n     * 魔术方法\n     * 读取私有属性\n     *\n     * @param  string $name 属性名称\n     * @return mixed\n     */\n    function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 抽象方法\n     *\n     * @return mixed\n     */\n    abstract function doSomthing($person);\n}\n\n/**\n * 老师\n */\nclass Teacher extends Person\n{\n    /**\n     * 老师提问\n     *\n     * @return mixed\n     */\n    function doSomthing($person)\n    {\n        if (!$person instanceof Student) {\n            $person = new NullPerson('');\n        }\n        $person->doSomthing($this);\n    }\n}\n\n/**\n * 学生\n */\nclass Student extends Person\n{\n    /**\n     * 答题方法\n     *\n     * @return mixed\n     */\n    function doSomthing($person)\n    {\n        echo \"老师‘{$person->name}’让学生‘{$this->name}’回答了一道题~ \\n\";\n    }\n}\n\n/**\n * 鬼\n */\nclass NullPerson extends Person\n{\n    /**\n     * 空方法\n     *\n     * @return mixed\n     */\n    function doSomthing($person)\n    {\n        echo \"难道这是个鬼吗............ \\n\";\n    }\n}\n\n\ntry {\n    //创建一个老师：路飞\n    $teacher = new Teacher('路飞');\n\n    // 创建学生\n    $mc      = new Student('麦迪');\n    $kobe    = new Student('科比');\n    $paul    = new Student('保罗');\n\n    // 老师提问\n    $teacher->doSomthing($mc);\n    $teacher->doSomthing($kobe);\n    $teacher->doSomthing($paul);\n    $teacher->doSomthing('小李');// 提问了一个班级里不存在人名\n\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n```\n","source":"_posts/2017-05-01-nullObject.md","raw":"---\ntitle:  \"PHP设计模式-空对象\"\ndate: 2017-05-01  12:00:00\nupdated: 2017-05-01  12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 设计模式\n---\n\n## 适用性\n\n * 当程序运行过程中出现操作空对象时，程序依然能够通过操作提供的空对象继续执行\n * 下面实现老师课堂叫学生回答问题\n     <!-- more -->\n## 代码示例\n\n```php\n/**\n * 抽象类人\n */\nabstract class Person\n{\n    /**\n     * 名字\n     * @var string\n     */\n    private $_name = '';\n\n    /**\n     * 构造函数\n     */\n    function __construct($name)\n    {\n        $this->_name = $name;\n    }\n\n    /**\n     * 魔术方法\n     * 读取私有属性\n     *\n     * @param  string $name 属性名称\n     * @return mixed\n     */\n    function __get($name='')\n    {\n        $name = '_' . $name;\n        return $this->$name;\n    }\n\n    /**\n     * 抽象方法\n     *\n     * @return mixed\n     */\n    abstract function doSomthing($person);\n}\n\n/**\n * 老师\n */\nclass Teacher extends Person\n{\n    /**\n     * 老师提问\n     *\n     * @return mixed\n     */\n    function doSomthing($person)\n    {\n        if (!$person instanceof Student) {\n            $person = new NullPerson('');\n        }\n        $person->doSomthing($this);\n    }\n}\n\n/**\n * 学生\n */\nclass Student extends Person\n{\n    /**\n     * 答题方法\n     *\n     * @return mixed\n     */\n    function doSomthing($person)\n    {\n        echo \"老师‘{$person->name}’让学生‘{$this->name}’回答了一道题~ \\n\";\n    }\n}\n\n/**\n * 鬼\n */\nclass NullPerson extends Person\n{\n    /**\n     * 空方法\n     *\n     * @return mixed\n     */\n    function doSomthing($person)\n    {\n        echo \"难道这是个鬼吗............ \\n\";\n    }\n}\n\n\ntry {\n    //创建一个老师：路飞\n    $teacher = new Teacher('路飞');\n\n    // 创建学生\n    $mc      = new Student('麦迪');\n    $kobe    = new Student('科比');\n    $paul    = new Student('保罗');\n\n    // 老师提问\n    $teacher->doSomthing($mc);\n    $teacher->doSomthing($kobe);\n    $teacher->doSomthing($paul);\n    $teacher->doSomthing('小李');// 提问了一个班级里不存在人名\n\n\n} catch (\\Exception $e) {\n    echo 'error:' . $e->getMessage();\n}\n```\n","slug":"2017-05-01-nullObject","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkr001yy4rb0mtoofli","content":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>当程序运行过程中出现操作空对象时，程序依然能够通过操作提供的空对象继续执行</li>\n<li>下面实现老师课堂叫学生回答问题  <a id=\"more\"></a>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 抽象类人</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 名字</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_name = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法</span></span><br><span class=\"line\"><span class=\"comment\">     * 读取私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 抽象方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">($person)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 老师</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Teacher</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 老师提问</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">($person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!$person <span class=\"keyword\">instanceof</span> Student) &#123;</span><br><span class=\"line\">            $person = <span class=\"keyword\">new</span> NullPerson(<span class=\"string\">''</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $person-&gt;doSomthing(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 学生</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 答题方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">($person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"老师‘&#123;$person-&gt;name&#125;’让学生‘&#123;$this-&gt;name&#125;’回答了一道题~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 鬼</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NullPerson</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 空方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">($person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"难道这是个鬼吗............ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//创建一个老师：路飞</span></span><br><span class=\"line\">    $teacher = <span class=\"keyword\">new</span> Teacher(<span class=\"string\">'路飞'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建学生</span></span><br><span class=\"line\">    $mc      = <span class=\"keyword\">new</span> Student(<span class=\"string\">'麦迪'</span>);</span><br><span class=\"line\">    $kobe    = <span class=\"keyword\">new</span> Student(<span class=\"string\">'科比'</span>);</span><br><span class=\"line\">    $paul    = <span class=\"keyword\">new</span> Student(<span class=\"string\">'保罗'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 老师提问</span></span><br><span class=\"line\">    $teacher-&gt;doSomthing($mc);</span><br><span class=\"line\">    $teacher-&gt;doSomthing($kobe);</span><br><span class=\"line\">    $teacher-&gt;doSomthing($paul);</span><br><span class=\"line\">    $teacher-&gt;doSomthing(<span class=\"string\">'小李'</span>);<span class=\"comment\">// 提问了一个班级里不存在人名</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"适用性\"><a href=\"#适用性\" class=\"headerlink\" title=\"适用性\"></a>适用性</h2><ul>\n<li>当程序运行过程中出现操作空对象时，程序依然能够通过操作提供的空对象继续执行</li>\n<li>下面实现老师课堂叫学生回答问题","more":"<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2></li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 抽象类人</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 名字</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@var</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> $_name = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_name = $name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 魔术方法</span></span><br><span class=\"line\"><span class=\"comment\">     * 读取私有属性</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span>  string $name 属性名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($name=<span class=\"string\">''</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $name = <span class=\"string\">'_'</span> . $name;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;$name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 抽象方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">abstract</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">($person)</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 老师</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Teacher</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 老师提问</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">($person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!$person <span class=\"keyword\">instanceof</span> Student) &#123;</span><br><span class=\"line\">            $person = <span class=\"keyword\">new</span> NullPerson(<span class=\"string\">''</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $person-&gt;doSomthing(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 学生</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 答题方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">($person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"老师‘&#123;$person-&gt;name&#125;’让学生‘&#123;$this-&gt;name&#125;’回答了一道题~ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 鬼</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NullPerson</span> <span class=\"keyword\">extends</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 空方法</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomthing</span><span class=\"params\">($person)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"难道这是个鬼吗............ \\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//创建一个老师：路飞</span></span><br><span class=\"line\">    $teacher = <span class=\"keyword\">new</span> Teacher(<span class=\"string\">'路飞'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建学生</span></span><br><span class=\"line\">    $mc      = <span class=\"keyword\">new</span> Student(<span class=\"string\">'麦迪'</span>);</span><br><span class=\"line\">    $kobe    = <span class=\"keyword\">new</span> Student(<span class=\"string\">'科比'</span>);</span><br><span class=\"line\">    $paul    = <span class=\"keyword\">new</span> Student(<span class=\"string\">'保罗'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 老师提问</span></span><br><span class=\"line\">    $teacher-&gt;doSomthing($mc);</span><br><span class=\"line\">    $teacher-&gt;doSomthing($kobe);</span><br><span class=\"line\">    $teacher-&gt;doSomthing($paul);</span><br><span class=\"line\">    $teacher-&gt;doSomthing(<span class=\"string\">'小李'</span>);<span class=\"comment\">// 提问了一个班级里不存在人名</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (\\<span class=\"keyword\">Exception</span> $e) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">'error:'</span> . $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"MySQL视图","date":"2017-05-13T16:00:00.000Z","updated":"2017-05-13T16:00:00.000Z","comments":1,"_content":"\n\n# 概述：\n> 视图即是虚拟表，也称为派生表，因为它们的内容都派生自其它表的查询结果。虽然视图看起来感觉和基本表一样，但是它们不是基本表。基本表的内容是持久的，而视图的内容是在使用过程中动态产生的。\n——摘自《SQLite权威指南》\n     <!-- more -->\n# 基本使用:\n**创建视图:**\n~~~sql\n CREATE VIEW \"表名\" AS \"SQL 语句\";\n~~~\n# 优势：\n* 1.可靠的安全性\n* 2.查询性能提高\n* 3.有效应对灵活性的功能需求\n* 4.轻松应对复杂的查询需求\n\n\n# 理解：\n* 1.在使用视图的时候，就是与使用表的语法一样的。\n* 2.创建视图的时候，该视图的名字如果与已经存在表重名的话，那么会报错，不允许创建。\n* 3.视图就是一种特殊的表。\n\n","source":"_posts/2017-05-13-mysqlView.md","raw":"---\ntitle:  \"MySQL视图\"\ndate: 2017-05-13  12:00:00\nupdated: 2017-05-13  12:00:00\ncomments: true\ncategories: 数据库\ntags:\n    - MySQL\n---\n\n\n# 概述：\n> 视图即是虚拟表，也称为派生表，因为它们的内容都派生自其它表的查询结果。虽然视图看起来感觉和基本表一样，但是它们不是基本表。基本表的内容是持久的，而视图的内容是在使用过程中动态产生的。\n——摘自《SQLite权威指南》\n     <!-- more -->\n# 基本使用:\n**创建视图:**\n~~~sql\n CREATE VIEW \"表名\" AS \"SQL 语句\";\n~~~\n# 优势：\n* 1.可靠的安全性\n* 2.查询性能提高\n* 3.有效应对灵活性的功能需求\n* 4.轻松应对复杂的查询需求\n\n\n# 理解：\n* 1.在使用视图的时候，就是与使用表的语法一样的。\n* 2.创建视图的时候，该视图的名字如果与已经存在表重名的话，那么会报错，不允许创建。\n* 3.视图就是一种特殊的表。\n\n","slug":"2017-05-13-mysqlView","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qks0021y4rbqlvebu84","content":"<h1 id=\"概述：\"><a href=\"#概述：\" class=\"headerlink\" title=\"概述：\"></a>概述：</h1><blockquote>\n<p>视图即是虚拟表，也称为派生表，因为它们的内容都派生自其它表的查询结果。虽然视图看起来感觉和基本表一样，但是它们不是基本表。基本表的内容是持久的，而视图的内容是在使用过程中动态产生的。<br>——摘自《SQLite权威指南》<br>     <a id=\"more\"></a></p>\n</blockquote>\n<h1 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用:\"></a>基本使用:</h1><p><strong>创建视图:</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">VIEW</span> <span class=\"string\">\"表名\"</span> <span class=\"keyword\">AS</span> <span class=\"string\">\"SQL 语句\"</span>;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"优势：\"><a href=\"#优势：\" class=\"headerlink\" title=\"优势：\"></a>优势：</h1><ul>\n<li>1.可靠的安全性</li>\n<li>2.查询性能提高</li>\n<li>3.有效应对灵活性的功能需求</li>\n<li>4.轻松应对复杂的查询需求</li>\n</ul>\n<h1 id=\"理解：\"><a href=\"#理解：\" class=\"headerlink\" title=\"理解：\"></a>理解：</h1><ul>\n<li>1.在使用视图的时候，就是与使用表的语法一样的。</li>\n<li>2.创建视图的时候，该视图的名字如果与已经存在表重名的话，那么会报错，不允许创建。</li>\n<li>3.视图就是一种特殊的表。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h1 id=\"概述：\"><a href=\"#概述：\" class=\"headerlink\" title=\"概述：\"></a>概述：</h1><blockquote>\n<p>视图即是虚拟表，也称为派生表，因为它们的内容都派生自其它表的查询结果。虽然视图看起来感觉和基本表一样，但是它们不是基本表。基本表的内容是持久的，而视图的内容是在使用过程中动态产生的。<br>——摘自《SQLite权威指南》<br>","more":"</p>\n</blockquote>\n<h1 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用:\"></a>基本使用:</h1><p><strong>创建视图:</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">VIEW</span> <span class=\"string\">\"表名\"</span> <span class=\"keyword\">AS</span> <span class=\"string\">\"SQL 语句\"</span>;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"优势：\"><a href=\"#优势：\" class=\"headerlink\" title=\"优势：\"></a>优势：</h1><ul>\n<li>1.可靠的安全性</li>\n<li>2.查询性能提高</li>\n<li>3.有效应对灵活性的功能需求</li>\n<li>4.轻松应对复杂的查询需求</li>\n</ul>\n<h1 id=\"理解：\"><a href=\"#理解：\" class=\"headerlink\" title=\"理解：\"></a>理解：</h1><ul>\n<li>1.在使用视图的时候，就是与使用表的语法一样的。</li>\n<li>2.创建视图的时候，该视图的名字如果与已经存在表重名的话，那么会报错，不允许创建。</li>\n<li>3.视图就是一种特殊的表。</li>\n</ul>"},{"title":"JavaScript小技巧","date":"2017-05-14T16:00:00.000Z","updated":"2017-05-14T16:00:00.000Z","comments":1,"_content":"## 1) 使用`!!`将变量转换成布尔类型\n\n有时，我们需要检查一些变量是否存在，或者它是否具有有效值，从而将它们的值视为`true`。对于做这样的检查，你可以使用`||`（双重否定运算符），它能自动将任何类型的数据转换为布尔值，只有这些变量才会返回`false：0`，`null`，`\"\"`，`undefined`或`NaN`，其他的都返回`true`。我们来看看这个简单的例子：\n     <!-- more -->\n```javascript\nfunction Account(cash) {  \n    this.cash = cash;\n    this.hasMoney = !!cash;\n}\nvar account = new Account(100.50);  \nconsole.log(account.cash); // 100.50  \nconsole.log(account.hasMoney); // true\n\nvar emptyAccount = new Account(0);  \nconsole.log(emptyAccount.cash); // 0  \nconsole.log(emptyAccount.hasMoney); // false  \n```\n在这个例子中，如果`account.cash`的值大于零，则`account.hasMoney`的值就是`true`。\n## 2) 使用`+`将变量转换成数字\n\n这个转换超级简单，但它只适用于数字字符串，不然就会返回`NaN`（不是数字）。看看这个例子：\n```javascript\nfunction toNumber(strNumber) {  \n    return +strNumber;\n}\nconsole.log(toNumber(\"1234\")); // 1234  \nconsole.log(toNumber(\"ACB\")); // NaN  \n```\n这个转换操作也可以作用于`Date`，在这种情况下，它将返回时间戳：\n```javascript\nconsole.log(+new Date()) // 1461288164385  \n```\n## 3) 短路条件\n\n如果你看到过这种类似的代码:\n```javascript\nif (conected) {  \n    login();\n}\n```\n那么你可以在这两个变量之间使用`&&`（`AND`运算符）来缩短代码。例如，前面的代码可以缩减到一行：\n```javascript\nconected && login();  \n```\n你也可以用这种方法来检查对象中是否存在某些属性或函数。类似于以下代码：\n```javascript\nuser && user.login(); \n```\n## 4) 使用`||`设置默认值\n\n在ES6中有默认参数这个功能。为了在旧版浏览器中模拟此功能，你可以使用`||`（`OR`运算符），并把默认值作为它的第二个参数。如果第一个参数返回`false`，那么第二个参数将会被作为默认值返回。看下这个例子：\n```javascript\nfunction User(name, age) {  \n    this.name = name || \"Oliver Queen\";\n    this.age = age || 27;\n}\nvar user1 = new User();  \nconsole.log(user1.name); // Oliver Queen  \nconsole.log(user1.age); // 27\n\nvar user2 = new User(\"Barry Allen\", 25);  \nconsole.log(user2.name); // Barry Allen  \nconsole.log(user2.age); // 25  \n```\n## 5) 在循环中缓存`array.length`\n\n这个技巧非常简单，并且在循环处理大数组时能够避免对性能造成巨大的影响。基本上几乎每个人都是这样使用`for`来循环遍历一个数组的：\n```javascript\nfor (var i = 0; i < array.length; i++) {  \n    console.log(array[i]);\n}\n```\n如果你使用较小的数组，那还好，但是如果处理大数组，则此代码将在每个循环里重复计算数组的大小，这会产生一定的延迟。为了避免这种情况，你可以在变量中缓存`array.length`，以便在循环中每次都使用缓存来代替`array.length`：\n```javascript\nvar length = array.length;  \nfor (var i = 0; i < length; i++) {  \n    console.log(array[i]);\n}\n```\n为了更简洁，可以这么写：\n```javascript\nfor (var i = 0, length = array.length; i < length; i++) {  \n    console.log(array[i]);\n}\n```\n## 6) 检测对象中的属性\n\n当你需要检查某些属性是否存在，避免运行未定义的函数或属性时，这个技巧非常有用。如果你打算编写跨浏览器代码，你也可能会用到这个技术。例如，我们假设你需要编写与旧版`Internet Explorer 6`兼容的代码，并且想要使用`document.querySelector()`来通过`ID`获取某些元素。 但是，在现代浏览器中，这个函数不存在。所以，要检查这个函数是否存在，你可以使用`in`运算符。看下这个例子：\n```javascript\nif ('querySelector' in document) {  \n    document.querySelector(\"#id\");\n} else {\n    document.getElementById(\"id\");\n}\n```\n在这种情况下，如果在`document`中没有`querySelector`函数，它就会使用`document.getElementById()`作为代替。\n## 7) 获取数组的最后一个元素\n\n`Array.prototype.slice（begin，end）`可以用来裁剪数组。但是如果没有设置结束参数`end`的值的话，该函数会自动将`end`设置为数组长度值。我认为很少有人知道这个函数可以接受负值，如果你将`begin`设置一个负数的话，你就能从数组中获取到倒数的元素：\n```javascript\nvar array = [1, 2, 3, 4, 5, 6];  \nconsole.log(array.slice(-1)); // [6]  \nconsole.log(array.slice(-2)); // [5,6]  \nconsole.log(array.slice(-3)); // [4,5,6]  \n```\n## 8) 数组截断\n\n这个技术可以锁定数组的大小，这对于要删除数组中固定数量的元素是非常有用的。例如，如果你有一个包含10个元素的数组，但是你只想获得前五个元素，则可以通过设置`array.length = 5`来阶段数组。看下这个例子：\n```javascript\nvar array = [1, 2, 3, 4, 5, 6];  \nconsole.log(array.length); // 6  \narray.length = 3;  \nconsole.log(array.length); // 3  \nconsole.log(array); // [1,2,3]  \n```\n## 9) 全部替换\n\n`String.replace()`函数允许使用`String`和`Regex`来替换字符串，这个函数本身只能替换第一个匹配的串。但是你可以在正则表达式末尾添加`/g`来模拟`replaceAll()`函数：\n```javascript\nvar string = \"john john\";  \nconsole.log(string.replace(/hn/, \"ana\")); // \"joana john\"  \nconsole.log(string.replace(/hn/g, \"ana\")); // \"joana joana\"  \n```\n## 10) 合并数组\n\n如果你需要合并两个数组，你可以使用`Array.concat()`函数：\n```javascript\nvar array1 = [1, 2, 3];  \nvar array2 = [4, 5, 6];  \nconsole.log(array1.concat(array2)); // [1,2,3,4,5,6];  \n```\n但是，这个函数对于大数组来说不并合适，因为它将会创建一个新的数组并消耗大量的内存。在这种情况下，你可以使用`Array.push.apply（arr1，arr2）`，它不会创建一个新数组，而是将第二个数组合并到第一个数组中，以减少内存使用：\n```javascript\nvar array1 = [1, 2, 3];  \nvar array2 = [4, 5, 6];  \nconsole.log(array1.push.apply(array1, array2)); // [1,2,3,4,5,6];  \n```\n## 11) 把NodeList转换成数组\n\n如果运行`document.querySelectorAll(\"p\")`函数，它会返回一个`DOM`元素数组，即`NodeList`对象。但是这个对象并没有一些属于数组的函数，例如：`sort()`，`reduce()`，`map()`，`filter()`。为了启用这些函数，以及数组的其他的原生函数，你需要将`NodeList`转换为数组。要进行转换，只需使用这个函数：`[] .slice.call（elements）`：\n```javascript\nvar elements = document.querySelectorAll(\"p\"); // NodeList  \nvar arrayElements = [].slice.call(elements); // 现在已经转换成数组了\nvar arrayElements = Array.from(elements); // 把NodeList转换成数组的另外一个方法\n```\n## 12) 对数组元素进行洗牌\n\n如果要像外部库`Lodash`那样对数据元素重新洗牌，只需使用这个技巧：\n```javascript\nvar list = [1, 2, 3];  \nconsole.log(list.sort(function() {  \n    return Math.random() - 0.5\n})); // [2,1,3]\n```\n","source":"_posts/2017-05-14-javascriptTechnic.md","raw":"---\ntitle:  \"JavaScript小技巧\"\ndate: 2017-05-14  12:00:00\nupdated: 2017-05-14  12:00:00\ncomments: true\ncategories: JavaScript\ntags:\n    - JavaScript\n---\n## 1) 使用`!!`将变量转换成布尔类型\n\n有时，我们需要检查一些变量是否存在，或者它是否具有有效值，从而将它们的值视为`true`。对于做这样的检查，你可以使用`||`（双重否定运算符），它能自动将任何类型的数据转换为布尔值，只有这些变量才会返回`false：0`，`null`，`\"\"`，`undefined`或`NaN`，其他的都返回`true`。我们来看看这个简单的例子：\n     <!-- more -->\n```javascript\nfunction Account(cash) {  \n    this.cash = cash;\n    this.hasMoney = !!cash;\n}\nvar account = new Account(100.50);  \nconsole.log(account.cash); // 100.50  \nconsole.log(account.hasMoney); // true\n\nvar emptyAccount = new Account(0);  \nconsole.log(emptyAccount.cash); // 0  \nconsole.log(emptyAccount.hasMoney); // false  \n```\n在这个例子中，如果`account.cash`的值大于零，则`account.hasMoney`的值就是`true`。\n## 2) 使用`+`将变量转换成数字\n\n这个转换超级简单，但它只适用于数字字符串，不然就会返回`NaN`（不是数字）。看看这个例子：\n```javascript\nfunction toNumber(strNumber) {  \n    return +strNumber;\n}\nconsole.log(toNumber(\"1234\")); // 1234  \nconsole.log(toNumber(\"ACB\")); // NaN  \n```\n这个转换操作也可以作用于`Date`，在这种情况下，它将返回时间戳：\n```javascript\nconsole.log(+new Date()) // 1461288164385  \n```\n## 3) 短路条件\n\n如果你看到过这种类似的代码:\n```javascript\nif (conected) {  \n    login();\n}\n```\n那么你可以在这两个变量之间使用`&&`（`AND`运算符）来缩短代码。例如，前面的代码可以缩减到一行：\n```javascript\nconected && login();  \n```\n你也可以用这种方法来检查对象中是否存在某些属性或函数。类似于以下代码：\n```javascript\nuser && user.login(); \n```\n## 4) 使用`||`设置默认值\n\n在ES6中有默认参数这个功能。为了在旧版浏览器中模拟此功能，你可以使用`||`（`OR`运算符），并把默认值作为它的第二个参数。如果第一个参数返回`false`，那么第二个参数将会被作为默认值返回。看下这个例子：\n```javascript\nfunction User(name, age) {  \n    this.name = name || \"Oliver Queen\";\n    this.age = age || 27;\n}\nvar user1 = new User();  \nconsole.log(user1.name); // Oliver Queen  \nconsole.log(user1.age); // 27\n\nvar user2 = new User(\"Barry Allen\", 25);  \nconsole.log(user2.name); // Barry Allen  \nconsole.log(user2.age); // 25  \n```\n## 5) 在循环中缓存`array.length`\n\n这个技巧非常简单，并且在循环处理大数组时能够避免对性能造成巨大的影响。基本上几乎每个人都是这样使用`for`来循环遍历一个数组的：\n```javascript\nfor (var i = 0; i < array.length; i++) {  \n    console.log(array[i]);\n}\n```\n如果你使用较小的数组，那还好，但是如果处理大数组，则此代码将在每个循环里重复计算数组的大小，这会产生一定的延迟。为了避免这种情况，你可以在变量中缓存`array.length`，以便在循环中每次都使用缓存来代替`array.length`：\n```javascript\nvar length = array.length;  \nfor (var i = 0; i < length; i++) {  \n    console.log(array[i]);\n}\n```\n为了更简洁，可以这么写：\n```javascript\nfor (var i = 0, length = array.length; i < length; i++) {  \n    console.log(array[i]);\n}\n```\n## 6) 检测对象中的属性\n\n当你需要检查某些属性是否存在，避免运行未定义的函数或属性时，这个技巧非常有用。如果你打算编写跨浏览器代码，你也可能会用到这个技术。例如，我们假设你需要编写与旧版`Internet Explorer 6`兼容的代码，并且想要使用`document.querySelector()`来通过`ID`获取某些元素。 但是，在现代浏览器中，这个函数不存在。所以，要检查这个函数是否存在，你可以使用`in`运算符。看下这个例子：\n```javascript\nif ('querySelector' in document) {  \n    document.querySelector(\"#id\");\n} else {\n    document.getElementById(\"id\");\n}\n```\n在这种情况下，如果在`document`中没有`querySelector`函数，它就会使用`document.getElementById()`作为代替。\n## 7) 获取数组的最后一个元素\n\n`Array.prototype.slice（begin，end）`可以用来裁剪数组。但是如果没有设置结束参数`end`的值的话，该函数会自动将`end`设置为数组长度值。我认为很少有人知道这个函数可以接受负值，如果你将`begin`设置一个负数的话，你就能从数组中获取到倒数的元素：\n```javascript\nvar array = [1, 2, 3, 4, 5, 6];  \nconsole.log(array.slice(-1)); // [6]  \nconsole.log(array.slice(-2)); // [5,6]  \nconsole.log(array.slice(-3)); // [4,5,6]  \n```\n## 8) 数组截断\n\n这个技术可以锁定数组的大小，这对于要删除数组中固定数量的元素是非常有用的。例如，如果你有一个包含10个元素的数组，但是你只想获得前五个元素，则可以通过设置`array.length = 5`来阶段数组。看下这个例子：\n```javascript\nvar array = [1, 2, 3, 4, 5, 6];  \nconsole.log(array.length); // 6  \narray.length = 3;  \nconsole.log(array.length); // 3  \nconsole.log(array); // [1,2,3]  \n```\n## 9) 全部替换\n\n`String.replace()`函数允许使用`String`和`Regex`来替换字符串，这个函数本身只能替换第一个匹配的串。但是你可以在正则表达式末尾添加`/g`来模拟`replaceAll()`函数：\n```javascript\nvar string = \"john john\";  \nconsole.log(string.replace(/hn/, \"ana\")); // \"joana john\"  \nconsole.log(string.replace(/hn/g, \"ana\")); // \"joana joana\"  \n```\n## 10) 合并数组\n\n如果你需要合并两个数组，你可以使用`Array.concat()`函数：\n```javascript\nvar array1 = [1, 2, 3];  \nvar array2 = [4, 5, 6];  \nconsole.log(array1.concat(array2)); // [1,2,3,4,5,6];  \n```\n但是，这个函数对于大数组来说不并合适，因为它将会创建一个新的数组并消耗大量的内存。在这种情况下，你可以使用`Array.push.apply（arr1，arr2）`，它不会创建一个新数组，而是将第二个数组合并到第一个数组中，以减少内存使用：\n```javascript\nvar array1 = [1, 2, 3];  \nvar array2 = [4, 5, 6];  \nconsole.log(array1.push.apply(array1, array2)); // [1,2,3,4,5,6];  \n```\n## 11) 把NodeList转换成数组\n\n如果运行`document.querySelectorAll(\"p\")`函数，它会返回一个`DOM`元素数组，即`NodeList`对象。但是这个对象并没有一些属于数组的函数，例如：`sort()`，`reduce()`，`map()`，`filter()`。为了启用这些函数，以及数组的其他的原生函数，你需要将`NodeList`转换为数组。要进行转换，只需使用这个函数：`[] .slice.call（elements）`：\n```javascript\nvar elements = document.querySelectorAll(\"p\"); // NodeList  \nvar arrayElements = [].slice.call(elements); // 现在已经转换成数组了\nvar arrayElements = Array.from(elements); // 把NodeList转换成数组的另外一个方法\n```\n## 12) 对数组元素进行洗牌\n\n如果要像外部库`Lodash`那样对数据元素重新洗牌，只需使用这个技巧：\n```javascript\nvar list = [1, 2, 3];  \nconsole.log(list.sort(function() {  \n    return Math.random() - 0.5\n})); // [2,1,3]\n```\n","slug":"2017-05-14-javascriptTechnic","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkt0024y4rbohscc06y","content":"<h2 id=\"1-使用-将变量转换成布尔类型\"><a href=\"#1-使用-将变量转换成布尔类型\" class=\"headerlink\" title=\"1) 使用!!将变量转换成布尔类型\"></a>1) 使用<code>!!</code>将变量转换成布尔类型</h2><p>有时，我们需要检查一些变量是否存在，或者它是否具有有效值，从而将它们的值视为<code>true</code>。对于做这样的检查，你可以使用<code>||</code>（双重否定运算符），它能自动将任何类型的数据转换为布尔值，只有这些变量才会返回<code>false：0</code>，<code>null</code>，<code>&quot;&quot;</code>，<code>undefined</code>或<code>NaN</code>，其他的都返回<code>true</code>。我们来看看这个简单的例子：<br>     <a id=\"more\"></a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Account</span>(<span class=\"params\">cash</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cash = cash;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.hasMoney = !!cash;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> account = <span class=\"keyword\">new</span> Account(<span class=\"number\">100.50</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(account.cash); <span class=\"comment\">// 100.50  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(account.hasMoney); <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> emptyAccount = <span class=\"keyword\">new</span> Account(<span class=\"number\">0</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(emptyAccount.cash); <span class=\"comment\">// 0  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(emptyAccount.hasMoney); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<p>在这个例子中，如果<code>account.cash</code>的值大于零，则<code>account.hasMoney</code>的值就是<code>true</code>。</p>\n<h2 id=\"2-使用-将变量转换成数字\"><a href=\"#2-使用-将变量转换成数字\" class=\"headerlink\" title=\"2) 使用+将变量转换成数字\"></a>2) 使用<code>+</code>将变量转换成数字</h2><p>这个转换超级简单，但它只适用于数字字符串，不然就会返回<code>NaN</code>（不是数字）。看看这个例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">toNumber</span>(<span class=\"params\">strNumber</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> +strNumber;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toNumber(<span class=\"string\">\"1234\"</span>)); <span class=\"comment\">// 1234  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toNumber(<span class=\"string\">\"ACB\"</span>)); <span class=\"comment\">// NaN</span></span><br></pre></td></tr></table></figure>\n\n<p>这个转换操作也可以作用于<code>Date</code>，在这种情况下，它将返回时间戳：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(+<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()) <span class=\"comment\">// 1461288164385</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-短路条件\"><a href=\"#3-短路条件\" class=\"headerlink\" title=\"3) 短路条件\"></a>3) 短路条件</h2><p>如果你看到过这种类似的代码:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (conected) &#123;  </span><br><span class=\"line\">    login();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>那么你可以在这两个变量之间使用<code>&amp;&amp;</code>（<code>AND</code>运算符）来缩短代码。例如，前面的代码可以缩减到一行：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conected &amp;&amp; login();</span><br></pre></td></tr></table></figure>\n\n<p>你也可以用这种方法来检查对象中是否存在某些属性或函数。类似于以下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user &amp;&amp; user.login();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-使用-设置默认值\"><a href=\"#4-使用-设置默认值\" class=\"headerlink\" title=\"4) 使用||设置默认值\"></a>4) 使用<code>||</code>设置默认值</h2><p>在ES6中有默认参数这个功能。为了在旧版浏览器中模拟此功能，你可以使用<code>||</code>（<code>OR</code>运算符），并把默认值作为它的第二个参数。如果第一个参数返回<code>false</code>，那么第二个参数将会被作为默认值返回。看下这个例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">User</span>(<span class=\"params\">name, age</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name || <span class=\"string\">\"Oliver Queen\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age || <span class=\"number\">27</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> user1 = <span class=\"keyword\">new</span> User();  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(user1.name); <span class=\"comment\">// Oliver Queen  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(user1.age); <span class=\"comment\">// 27</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> user2 = <span class=\"keyword\">new</span> User(<span class=\"string\">\"Barry Allen\"</span>, <span class=\"number\">25</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(user2.name); <span class=\"comment\">// Barry Allen  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(user2.age); <span class=\"comment\">// 25</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-在循环中缓存array-length\"><a href=\"#5-在循环中缓存array-length\" class=\"headerlink\" title=\"5) 在循环中缓存array.length\"></a>5) 在循环中缓存<code>array.length</code></h2><p>这个技巧非常简单，并且在循环处理大数组时能够避免对性能造成巨大的影响。基本上几乎每个人都是这样使用<code>for</code>来循环遍历一个数组的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; array.length; i++) &#123;  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(array[i]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果你使用较小的数组，那还好，但是如果处理大数组，则此代码将在每个循环里重复计算数组的大小，这会产生一定的延迟。为了避免这种情况，你可以在变量中缓存<code>array.length</code>，以便在循环中每次都使用缓存来代替<code>array.length</code>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> length = array.length;  </span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; length; i++) &#123;  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(array[i]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>为了更简洁，可以这么写：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, length = array.length; i &lt; length; i++) &#123;  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(array[i]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-检测对象中的属性\"><a href=\"#6-检测对象中的属性\" class=\"headerlink\" title=\"6) 检测对象中的属性\"></a>6) 检测对象中的属性</h2><p>当你需要检查某些属性是否存在，避免运行未定义的函数或属性时，这个技巧非常有用。如果你打算编写跨浏览器代码，你也可能会用到这个技术。例如，我们假设你需要编写与旧版<code>Internet Explorer 6</code>兼容的代码，并且想要使用<code>document.querySelector()</code>来通过<code>ID</code>获取某些元素。 但是，在现代浏览器中，这个函数不存在。所以，要检查这个函数是否存在，你可以使用<code>in</code>运算符。看下这个例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">'querySelector'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">document</span>) &#123;  </span><br><span class=\"line\">    <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\"#id\"</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"id\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这种情况下，如果在<code>document</code>中没有<code>querySelector</code>函数，它就会使用<code>document.getElementById()</code>作为代替。</p>\n<h2 id=\"7-获取数组的最后一个元素\"><a href=\"#7-获取数组的最后一个元素\" class=\"headerlink\" title=\"7) 获取数组的最后一个元素\"></a>7) 获取数组的最后一个元素</h2><p><code>Array.prototype.slice（begin，end）</code>可以用来裁剪数组。但是如果没有设置结束参数<code>end</code>的值的话，该函数会自动将<code>end</code>设置为数组长度值。我认为很少有人知道这个函数可以接受负值，如果你将<code>begin</code>设置一个负数的话，你就能从数组中获取到倒数的元素：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.slice(<span class=\"number\">-1</span>)); <span class=\"comment\">// [6]  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.slice(<span class=\"number\">-2</span>)); <span class=\"comment\">// [5,6]  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.slice(<span class=\"number\">-3</span>)); <span class=\"comment\">// [4,5,6]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-数组截断\"><a href=\"#8-数组截断\" class=\"headerlink\" title=\"8) 数组截断\"></a>8) 数组截断</h2><p>这个技术可以锁定数组的大小，这对于要删除数组中固定数量的元素是非常有用的。例如，如果你有一个包含10个元素的数组，但是你只想获得前五个元素，则可以通过设置<code>array.length = 5</code>来阶段数组。看下这个例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.length); <span class=\"comment\">// 6  </span></span><br><span class=\"line\">array.length = <span class=\"number\">3</span>;  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.length); <span class=\"comment\">// 3  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array); <span class=\"comment\">// [1,2,3]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"9-全部替换\"><a href=\"#9-全部替换\" class=\"headerlink\" title=\"9) 全部替换\"></a>9) 全部替换</h2><p><code>String.replace()</code>函数允许使用<code>String</code>和<code>Regex</code>来替换字符串，这个函数本身只能替换第一个匹配的串。但是你可以在正则表达式末尾添加<code>/g</code>来模拟<code>replaceAll()</code>函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> string = <span class=\"string\">\"john john\"</span>;  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(string.replace(<span class=\"regexp\">/hn/</span>, <span class=\"string\">\"ana\"</span>)); <span class=\"comment\">// \"joana john\"  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(string.replace(<span class=\"regexp\">/hn/g</span>, <span class=\"string\">\"ana\"</span>)); <span class=\"comment\">// \"joana joana\"</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"10-合并数组\"><a href=\"#10-合并数组\" class=\"headerlink\" title=\"10) 合并数组\"></a>10) 合并数组</h2><p>如果你需要合并两个数组，你可以使用<code>Array.concat()</code>函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];  </span><br><span class=\"line\"><span class=\"keyword\">var</span> array2 = [<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array1.concat(array2)); <span class=\"comment\">// [1,2,3,4,5,6];</span></span><br></pre></td></tr></table></figure>\n\n<p>但是，这个函数对于大数组来说不并合适，因为它将会创建一个新的数组并消耗大量的内存。在这种情况下，你可以使用<code>Array.push.apply（arr1，arr2）</code>，它不会创建一个新数组，而是将第二个数组合并到第一个数组中，以减少内存使用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];  </span><br><span class=\"line\"><span class=\"keyword\">var</span> array2 = [<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array1.push.apply(array1, array2)); <span class=\"comment\">// [1,2,3,4,5,6];</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"11-把NodeList转换成数组\"><a href=\"#11-把NodeList转换成数组\" class=\"headerlink\" title=\"11) 把NodeList转换成数组\"></a>11) 把NodeList转换成数组</h2><p>如果运行<code>document.querySelectorAll(&quot;p&quot;)</code>函数，它会返回一个<code>DOM</code>元素数组，即<code>NodeList</code>对象。但是这个对象并没有一些属于数组的函数，例如：<code>sort()</code>，<code>reduce()</code>，<code>map()</code>，<code>filter()</code>。为了启用这些函数，以及数组的其他的原生函数，你需要将<code>NodeList</code>转换为数组。要进行转换，只需使用这个函数：<code>[] .slice.call（elements）</code>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> elements = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">\"p\"</span>); <span class=\"comment\">// NodeList  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrayElements = [].slice.call(elements); <span class=\"comment\">// 现在已经转换成数组了</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrayElements = <span class=\"built_in\">Array</span>.from(elements); <span class=\"comment\">// 把NodeList转换成数组的另外一个方法</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"12-对数组元素进行洗牌\"><a href=\"#12-对数组元素进行洗牌\" class=\"headerlink\" title=\"12) 对数组元素进行洗牌\"></a>12) 对数组元素进行洗牌</h2><p>如果要像外部库<code>Lodash</code>那样对数据元素重新洗牌，只需使用这个技巧：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> list = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(list.sort(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.random() - <span class=\"number\">0.5</span></span><br><span class=\"line\">&#125;)); <span class=\"comment\">// [2,1,3]</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"1-使用-将变量转换成布尔类型\"><a href=\"#1-使用-将变量转换成布尔类型\" class=\"headerlink\" title=\"1) 使用!!将变量转换成布尔类型\"></a>1) 使用<code>!!</code>将变量转换成布尔类型</h2><p>有时，我们需要检查一些变量是否存在，或者它是否具有有效值，从而将它们的值视为<code>true</code>。对于做这样的检查，你可以使用<code>||</code>（双重否定运算符），它能自动将任何类型的数据转换为布尔值，只有这些变量才会返回<code>false：0</code>，<code>null</code>，<code>&quot;&quot;</code>，<code>undefined</code>或<code>NaN</code>，其他的都返回<code>true</code>。我们来看看这个简单的例子：<br>","more":"</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Account</span>(<span class=\"params\">cash</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cash = cash;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.hasMoney = !!cash;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> account = <span class=\"keyword\">new</span> Account(<span class=\"number\">100.50</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(account.cash); <span class=\"comment\">// 100.50  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(account.hasMoney); <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> emptyAccount = <span class=\"keyword\">new</span> Account(<span class=\"number\">0</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(emptyAccount.cash); <span class=\"comment\">// 0  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(emptyAccount.hasMoney); <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n\n<p>在这个例子中，如果<code>account.cash</code>的值大于零，则<code>account.hasMoney</code>的值就是<code>true</code>。</p>\n<h2 id=\"2-使用-将变量转换成数字\"><a href=\"#2-使用-将变量转换成数字\" class=\"headerlink\" title=\"2) 使用+将变量转换成数字\"></a>2) 使用<code>+</code>将变量转换成数字</h2><p>这个转换超级简单，但它只适用于数字字符串，不然就会返回<code>NaN</code>（不是数字）。看看这个例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">toNumber</span>(<span class=\"params\">strNumber</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> +strNumber;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toNumber(<span class=\"string\">\"1234\"</span>)); <span class=\"comment\">// 1234  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(toNumber(<span class=\"string\">\"ACB\"</span>)); <span class=\"comment\">// NaN</span></span><br></pre></td></tr></table></figure>\n\n<p>这个转换操作也可以作用于<code>Date</code>，在这种情况下，它将返回时间戳：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(+<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()) <span class=\"comment\">// 1461288164385</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-短路条件\"><a href=\"#3-短路条件\" class=\"headerlink\" title=\"3) 短路条件\"></a>3) 短路条件</h2><p>如果你看到过这种类似的代码:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (conected) &#123;  </span><br><span class=\"line\">    login();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>那么你可以在这两个变量之间使用<code>&amp;&amp;</code>（<code>AND</code>运算符）来缩短代码。例如，前面的代码可以缩减到一行：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conected &amp;&amp; login();</span><br></pre></td></tr></table></figure>\n\n<p>你也可以用这种方法来检查对象中是否存在某些属性或函数。类似于以下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user &amp;&amp; user.login();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-使用-设置默认值\"><a href=\"#4-使用-设置默认值\" class=\"headerlink\" title=\"4) 使用||设置默认值\"></a>4) 使用<code>||</code>设置默认值</h2><p>在ES6中有默认参数这个功能。为了在旧版浏览器中模拟此功能，你可以使用<code>||</code>（<code>OR</code>运算符），并把默认值作为它的第二个参数。如果第一个参数返回<code>false</code>，那么第二个参数将会被作为默认值返回。看下这个例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">User</span>(<span class=\"params\">name, age</span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name || <span class=\"string\">\"Oliver Queen\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.age = age || <span class=\"number\">27</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> user1 = <span class=\"keyword\">new</span> User();  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(user1.name); <span class=\"comment\">// Oliver Queen  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(user1.age); <span class=\"comment\">// 27</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> user2 = <span class=\"keyword\">new</span> User(<span class=\"string\">\"Barry Allen\"</span>, <span class=\"number\">25</span>);  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(user2.name); <span class=\"comment\">// Barry Allen  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(user2.age); <span class=\"comment\">// 25</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-在循环中缓存array-length\"><a href=\"#5-在循环中缓存array-length\" class=\"headerlink\" title=\"5) 在循环中缓存array.length\"></a>5) 在循环中缓存<code>array.length</code></h2><p>这个技巧非常简单，并且在循环处理大数组时能够避免对性能造成巨大的影响。基本上几乎每个人都是这样使用<code>for</code>来循环遍历一个数组的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; array.length; i++) &#123;  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(array[i]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果你使用较小的数组，那还好，但是如果处理大数组，则此代码将在每个循环里重复计算数组的大小，这会产生一定的延迟。为了避免这种情况，你可以在变量中缓存<code>array.length</code>，以便在循环中每次都使用缓存来代替<code>array.length</code>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> length = array.length;  </span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; length; i++) &#123;  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(array[i]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>为了更简洁，可以这么写：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, length = array.length; i &lt; length; i++) &#123;  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(array[i]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-检测对象中的属性\"><a href=\"#6-检测对象中的属性\" class=\"headerlink\" title=\"6) 检测对象中的属性\"></a>6) 检测对象中的属性</h2><p>当你需要检查某些属性是否存在，避免运行未定义的函数或属性时，这个技巧非常有用。如果你打算编写跨浏览器代码，你也可能会用到这个技术。例如，我们假设你需要编写与旧版<code>Internet Explorer 6</code>兼容的代码，并且想要使用<code>document.querySelector()</code>来通过<code>ID</code>获取某些元素。 但是，在现代浏览器中，这个函数不存在。所以，要检查这个函数是否存在，你可以使用<code>in</code>运算符。看下这个例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">'querySelector'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">document</span>) &#123;  </span><br><span class=\"line\">    <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\"#id\"</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"id\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这种情况下，如果在<code>document</code>中没有<code>querySelector</code>函数，它就会使用<code>document.getElementById()</code>作为代替。</p>\n<h2 id=\"7-获取数组的最后一个元素\"><a href=\"#7-获取数组的最后一个元素\" class=\"headerlink\" title=\"7) 获取数组的最后一个元素\"></a>7) 获取数组的最后一个元素</h2><p><code>Array.prototype.slice（begin，end）</code>可以用来裁剪数组。但是如果没有设置结束参数<code>end</code>的值的话，该函数会自动将<code>end</code>设置为数组长度值。我认为很少有人知道这个函数可以接受负值，如果你将<code>begin</code>设置一个负数的话，你就能从数组中获取到倒数的元素：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.slice(<span class=\"number\">-1</span>)); <span class=\"comment\">// [6]  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.slice(<span class=\"number\">-2</span>)); <span class=\"comment\">// [5,6]  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.slice(<span class=\"number\">-3</span>)); <span class=\"comment\">// [4,5,6]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-数组截断\"><a href=\"#8-数组截断\" class=\"headerlink\" title=\"8) 数组截断\"></a>8) 数组截断</h2><p>这个技术可以锁定数组的大小，这对于要删除数组中固定数量的元素是非常有用的。例如，如果你有一个包含10个元素的数组，但是你只想获得前五个元素，则可以通过设置<code>array.length = 5</code>来阶段数组。看下这个例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.length); <span class=\"comment\">// 6  </span></span><br><span class=\"line\">array.length = <span class=\"number\">3</span>;  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array.length); <span class=\"comment\">// 3  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array); <span class=\"comment\">// [1,2,3]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"9-全部替换\"><a href=\"#9-全部替换\" class=\"headerlink\" title=\"9) 全部替换\"></a>9) 全部替换</h2><p><code>String.replace()</code>函数允许使用<code>String</code>和<code>Regex</code>来替换字符串，这个函数本身只能替换第一个匹配的串。但是你可以在正则表达式末尾添加<code>/g</code>来模拟<code>replaceAll()</code>函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> string = <span class=\"string\">\"john john\"</span>;  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(string.replace(<span class=\"regexp\">/hn/</span>, <span class=\"string\">\"ana\"</span>)); <span class=\"comment\">// \"joana john\"  </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(string.replace(<span class=\"regexp\">/hn/g</span>, <span class=\"string\">\"ana\"</span>)); <span class=\"comment\">// \"joana joana\"</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"10-合并数组\"><a href=\"#10-合并数组\" class=\"headerlink\" title=\"10) 合并数组\"></a>10) 合并数组</h2><p>如果你需要合并两个数组，你可以使用<code>Array.concat()</code>函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];  </span><br><span class=\"line\"><span class=\"keyword\">var</span> array2 = [<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array1.concat(array2)); <span class=\"comment\">// [1,2,3,4,5,6];</span></span><br></pre></td></tr></table></figure>\n\n<p>但是，这个函数对于大数组来说不并合适，因为它将会创建一个新的数组并消耗大量的内存。在这种情况下，你可以使用<code>Array.push.apply（arr1，arr2）</code>，它不会创建一个新数组，而是将第二个数组合并到第一个数组中，以减少内存使用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];  </span><br><span class=\"line\"><span class=\"keyword\">var</span> array2 = [<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(array1.push.apply(array1, array2)); <span class=\"comment\">// [1,2,3,4,5,6];</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"11-把NodeList转换成数组\"><a href=\"#11-把NodeList转换成数组\" class=\"headerlink\" title=\"11) 把NodeList转换成数组\"></a>11) 把NodeList转换成数组</h2><p>如果运行<code>document.querySelectorAll(&quot;p&quot;)</code>函数，它会返回一个<code>DOM</code>元素数组，即<code>NodeList</code>对象。但是这个对象并没有一些属于数组的函数，例如：<code>sort()</code>，<code>reduce()</code>，<code>map()</code>，<code>filter()</code>。为了启用这些函数，以及数组的其他的原生函数，你需要将<code>NodeList</code>转换为数组。要进行转换，只需使用这个函数：<code>[] .slice.call（elements）</code>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> elements = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">\"p\"</span>); <span class=\"comment\">// NodeList  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrayElements = [].slice.call(elements); <span class=\"comment\">// 现在已经转换成数组了</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arrayElements = <span class=\"built_in\">Array</span>.from(elements); <span class=\"comment\">// 把NodeList转换成数组的另外一个方法</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"12-对数组元素进行洗牌\"><a href=\"#12-对数组元素进行洗牌\" class=\"headerlink\" title=\"12) 对数组元素进行洗牌\"></a>12) 对数组元素进行洗牌</h2><p>如果要像外部库<code>Lodash</code>那样对数据元素重新洗牌，只需使用这个技巧：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> list = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];  </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(list.sort(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.random() - <span class=\"number\">0.5</span></span><br><span class=\"line\">&#125;)); <span class=\"comment\">// [2,1,3]</span></span><br></pre></td></tr></table></figure>"},{"title":"MySQL聚合索引与非聚合索引","date":"2017-05-30T16:00:00.000Z","updated":"2017-05-30T16:00:00.000Z","comments":1,"_content":"# 基本介绍\n\n### 聚集索引\n聚集索引是指数据库表行中数据的物理顺序与键值的逻辑（索引）顺序相同。一个表只能有一个聚集索引，因为一个表的物理顺序只有一种情况，所以，对应的聚集索引只能有一个。\n如果某索引不是聚集索引，则表中的行物理顺序与索引顺序不匹配，与非聚集索引相同，聚集索引有着更快的检索速度。\n### 非聚集索引\n一种索引，该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同。\n\n <!-- more -->\n\n# 优劣势\n\n### 优点\n* 1.可以把相关数据保存在一起，如：实现电子邮箱时，可以根据用户ID来聚集数据，这样只需要从磁盘读取少量的数据页就能获取某个用户全部邮件，如果没有使用聚集索引，则每封邮件都可能导致一次磁盘IO\n* 2.数据访问更快，聚集索引将索引和数据保存在同一个`btree`中，因此从聚集索引中获取数据通常比在非聚集索引中查找要快\n* 3.使用覆盖索引扫描的查询可以直接使用页节点中的主键值\n\n### 缺点\n* 1.聚簇数据最大限度地提高了IO密集型应用的性能，但如果数据全部放在内存中，则访问的顺序就没有那么重要了，聚集索引也没有什么优势了\n* 2.插入速度严重依赖于插入顺序，按照主键的顺序插入是加载数据到`innodb`表中速度最快的方式，但如果不是按照主键顺序加载数据，那么在加载完成后最好使用1optimize table`命令重新组织一下表\n* 3.更新聚集索引列的代价很高，因为会强制`innodb`将每个被更新的行移动到新的位置\n* 4.基于聚集索引的表在插入新行，或者主键被更新导致需要移动行的时候，可能面临页分裂的问题，当行的主键值要求必须将这一行插入到某个已满的页中时，存储引擎会将该页分裂成两个页面来容纳该行，这就是一次页分裂操作，页分裂会导致表占用更多的磁盘空间\n\n# `innodb`和`myisam`物理存储的数据分布对比\n\n### `myisam`：\n\n　　是按照数据插入的顺序存储在磁盘上的，`myisam`中的主键索引和二级索引在结构上并没有什么不同，主键索引就是一个名为`primary`的唯一非空索引。\n\n### `innodb`：\n\n　　因为`innodb`支持聚集索引，所以使用非常不同的方式存储同样的数据，`innodb`聚集索引包含了整个表的数据，而不是只有索引，因为在`Innodb`中，聚集索引就是表，所以不像`myisam`那样需要独立的行存储。聚集索引的每一个叶子节点都包含了主键值，事务ID，用于事务和`MVCC`的回滚指针以及所有剩余列的值，如果主键是一个列前缀索引，`innodb`也会包含完整的主键列和剩下的列的值。\n\n　　还有一点和`myisam`不同的是，`innodb`的二级索引和聚集索引很不同，`innodb`二级索引的叶子节点中存储的不是行指针，而是主键值，并以此作为指向行的指针，这样的策略减少了当出现行移动或者数据页的分裂时二级索引的维护工作，使用主键值当做指针会让二级索引占用更多的空间，换来的好处是，`innodb`在移动行时无须更新二级索引中的这个指针。\n\n## 何时使用聚集索引或非聚集索引\n\n|动作描述|使用聚集索引|使用非聚集索引|\n|-|-|-|\n|列经常被分组排序|应|应|\n|返回某范围内的数据|应|不应|\n|一个或极少不同值|不应|不应|\n|小数目的不同值|应|不应|\n|大数目的不同值|不应|应|\n|频繁更新的列|不应|应|\n|外键列|应|应|\n|主键列|应|应|\n|频繁修改索引列|不应|应|\n\n# 总结：\n* **聚集索引就字典的首字母查询**\n* **非聚集索引就是字典的边盘部首查询**\n* **聚集索引一个表只能有一个，而非聚集索引一个表可以存在多个**\n* **聚集索引存储记录是物理上连续存在，而非聚集索引是逻辑上的连续，物理存储并不连续**\n\n\n\n","source":"_posts/2017-05-30-clusteredIndex.md","raw":"---\ntitle:  \"MySQL聚合索引与非聚合索引\"\ndate: 2017-05-30  12:00:00\nupdated: 2017-05-30  12:00:00\ncomments: true\ncategories: 数据库\ntags:\n    - MySQL\n---\n# 基本介绍\n\n### 聚集索引\n聚集索引是指数据库表行中数据的物理顺序与键值的逻辑（索引）顺序相同。一个表只能有一个聚集索引，因为一个表的物理顺序只有一种情况，所以，对应的聚集索引只能有一个。\n如果某索引不是聚集索引，则表中的行物理顺序与索引顺序不匹配，与非聚集索引相同，聚集索引有着更快的检索速度。\n### 非聚集索引\n一种索引，该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同。\n\n <!-- more -->\n\n# 优劣势\n\n### 优点\n* 1.可以把相关数据保存在一起，如：实现电子邮箱时，可以根据用户ID来聚集数据，这样只需要从磁盘读取少量的数据页就能获取某个用户全部邮件，如果没有使用聚集索引，则每封邮件都可能导致一次磁盘IO\n* 2.数据访问更快，聚集索引将索引和数据保存在同一个`btree`中，因此从聚集索引中获取数据通常比在非聚集索引中查找要快\n* 3.使用覆盖索引扫描的查询可以直接使用页节点中的主键值\n\n### 缺点\n* 1.聚簇数据最大限度地提高了IO密集型应用的性能，但如果数据全部放在内存中，则访问的顺序就没有那么重要了，聚集索引也没有什么优势了\n* 2.插入速度严重依赖于插入顺序，按照主键的顺序插入是加载数据到`innodb`表中速度最快的方式，但如果不是按照主键顺序加载数据，那么在加载完成后最好使用1optimize table`命令重新组织一下表\n* 3.更新聚集索引列的代价很高，因为会强制`innodb`将每个被更新的行移动到新的位置\n* 4.基于聚集索引的表在插入新行，或者主键被更新导致需要移动行的时候，可能面临页分裂的问题，当行的主键值要求必须将这一行插入到某个已满的页中时，存储引擎会将该页分裂成两个页面来容纳该行，这就是一次页分裂操作，页分裂会导致表占用更多的磁盘空间\n\n# `innodb`和`myisam`物理存储的数据分布对比\n\n### `myisam`：\n\n　　是按照数据插入的顺序存储在磁盘上的，`myisam`中的主键索引和二级索引在结构上并没有什么不同，主键索引就是一个名为`primary`的唯一非空索引。\n\n### `innodb`：\n\n　　因为`innodb`支持聚集索引，所以使用非常不同的方式存储同样的数据，`innodb`聚集索引包含了整个表的数据，而不是只有索引，因为在`Innodb`中，聚集索引就是表，所以不像`myisam`那样需要独立的行存储。聚集索引的每一个叶子节点都包含了主键值，事务ID，用于事务和`MVCC`的回滚指针以及所有剩余列的值，如果主键是一个列前缀索引，`innodb`也会包含完整的主键列和剩下的列的值。\n\n　　还有一点和`myisam`不同的是，`innodb`的二级索引和聚集索引很不同，`innodb`二级索引的叶子节点中存储的不是行指针，而是主键值，并以此作为指向行的指针，这样的策略减少了当出现行移动或者数据页的分裂时二级索引的维护工作，使用主键值当做指针会让二级索引占用更多的空间，换来的好处是，`innodb`在移动行时无须更新二级索引中的这个指针。\n\n## 何时使用聚集索引或非聚集索引\n\n|动作描述|使用聚集索引|使用非聚集索引|\n|-|-|-|\n|列经常被分组排序|应|应|\n|返回某范围内的数据|应|不应|\n|一个或极少不同值|不应|不应|\n|小数目的不同值|应|不应|\n|大数目的不同值|不应|应|\n|频繁更新的列|不应|应|\n|外键列|应|应|\n|主键列|应|应|\n|频繁修改索引列|不应|应|\n\n# 总结：\n* **聚集索引就字典的首字母查询**\n* **非聚集索引就是字典的边盘部首查询**\n* **聚集索引一个表只能有一个，而非聚集索引一个表可以存在多个**\n* **聚集索引存储记录是物理上连续存在，而非聚集索引是逻辑上的连续，物理存储并不连续**\n\n\n\n","slug":"2017-05-30-clusteredIndex","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qku0029y4rbx98j8itm","content":"<h1 id=\"基本介绍\"><a href=\"#基本介绍\" class=\"headerlink\" title=\"基本介绍\"></a>基本介绍</h1><h3 id=\"聚集索引\"><a href=\"#聚集索引\" class=\"headerlink\" title=\"聚集索引\"></a>聚集索引</h3><p>聚集索引是指数据库表行中数据的物理顺序与键值的逻辑（索引）顺序相同。一个表只能有一个聚集索引，因为一个表的物理顺序只有一种情况，所以，对应的聚集索引只能有一个。<br>如果某索引不是聚集索引，则表中的行物理顺序与索引顺序不匹配，与非聚集索引相同，聚集索引有着更快的检索速度。</p>\n<h3 id=\"非聚集索引\"><a href=\"#非聚集索引\" class=\"headerlink\" title=\"非聚集索引\"></a>非聚集索引</h3><p>一种索引，该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同。</p>\n <a id=\"more\"></a>\n\n<h1 id=\"优劣势\"><a href=\"#优劣势\" class=\"headerlink\" title=\"优劣势\"></a>优劣势</h1><h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>1.可以把相关数据保存在一起，如：实现电子邮箱时，可以根据用户ID来聚集数据，这样只需要从磁盘读取少量的数据页就能获取某个用户全部邮件，如果没有使用聚集索引，则每封邮件都可能导致一次磁盘IO</li>\n<li>2.数据访问更快，聚集索引将索引和数据保存在同一个<code>btree</code>中，因此从聚集索引中获取数据通常比在非聚集索引中查找要快</li>\n<li>3.使用覆盖索引扫描的查询可以直接使用页节点中的主键值</li>\n</ul>\n<h3 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>1.聚簇数据最大限度地提高了IO密集型应用的性能，但如果数据全部放在内存中，则访问的顺序就没有那么重要了，聚集索引也没有什么优势了</li>\n<li>2.插入速度严重依赖于插入顺序，按照主键的顺序插入是加载数据到<code>innodb</code>表中速度最快的方式，但如果不是按照主键顺序加载数据，那么在加载完成后最好使用1optimize table`命令重新组织一下表</li>\n<li>3.更新聚集索引列的代价很高，因为会强制<code>innodb</code>将每个被更新的行移动到新的位置</li>\n<li>4.基于聚集索引的表在插入新行，或者主键被更新导致需要移动行的时候，可能面临页分裂的问题，当行的主键值要求必须将这一行插入到某个已满的页中时，存储引擎会将该页分裂成两个页面来容纳该行，这就是一次页分裂操作，页分裂会导致表占用更多的磁盘空间</li>\n</ul>\n<h1 id=\"innodb和myisam物理存储的数据分布对比\"><a href=\"#innodb和myisam物理存储的数据分布对比\" class=\"headerlink\" title=\"innodb和myisam物理存储的数据分布对比\"></a><code>innodb</code>和<code>myisam</code>物理存储的数据分布对比</h1><h3 id=\"myisam：\"><a href=\"#myisam：\" class=\"headerlink\" title=\"myisam：\"></a><code>myisam</code>：</h3><p>　　是按照数据插入的顺序存储在磁盘上的，<code>myisam</code>中的主键索引和二级索引在结构上并没有什么不同，主键索引就是一个名为<code>primary</code>的唯一非空索引。</p>\n<h3 id=\"innodb：\"><a href=\"#innodb：\" class=\"headerlink\" title=\"innodb：\"></a><code>innodb</code>：</h3><p>　　因为<code>innodb</code>支持聚集索引，所以使用非常不同的方式存储同样的数据，<code>innodb</code>聚集索引包含了整个表的数据，而不是只有索引，因为在<code>Innodb</code>中，聚集索引就是表，所以不像<code>myisam</code>那样需要独立的行存储。聚集索引的每一个叶子节点都包含了主键值，事务ID，用于事务和<code>MVCC</code>的回滚指针以及所有剩余列的值，如果主键是一个列前缀索引，<code>innodb</code>也会包含完整的主键列和剩下的列的值。</p>\n<p>　　还有一点和<code>myisam</code>不同的是，<code>innodb</code>的二级索引和聚集索引很不同，<code>innodb</code>二级索引的叶子节点中存储的不是行指针，而是主键值，并以此作为指向行的指针，这样的策略减少了当出现行移动或者数据页的分裂时二级索引的维护工作，使用主键值当做指针会让二级索引占用更多的空间，换来的好处是，<code>innodb</code>在移动行时无须更新二级索引中的这个指针。</p>\n<h2 id=\"何时使用聚集索引或非聚集索引\"><a href=\"#何时使用聚集索引或非聚集索引\" class=\"headerlink\" title=\"何时使用聚集索引或非聚集索引\"></a>何时使用聚集索引或非聚集索引</h2><table>\n<thead>\n<tr>\n<th>动作描述</th>\n<th>使用聚集索引</th>\n<th>使用非聚集索引</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>列经常被分组排序</td>\n<td>应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>返回某范围内的数据</td>\n<td>应</td>\n<td>不应</td>\n</tr>\n<tr>\n<td>一个或极少不同值</td>\n<td>不应</td>\n<td>不应</td>\n</tr>\n<tr>\n<td>小数目的不同值</td>\n<td>应</td>\n<td>不应</td>\n</tr>\n<tr>\n<td>大数目的不同值</td>\n<td>不应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>频繁更新的列</td>\n<td>不应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>外键列</td>\n<td>应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>主键列</td>\n<td>应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>频繁修改索引列</td>\n<td>不应</td>\n<td>应</td>\n</tr>\n</tbody></table>\n<h1 id=\"总结：\"><a href=\"#总结：\" class=\"headerlink\" title=\"总结：\"></a>总结：</h1><ul>\n<li><strong>聚集索引就字典的首字母查询</strong></li>\n<li><strong>非聚集索引就是字典的边盘部首查询</strong></li>\n<li><strong>聚集索引一个表只能有一个，而非聚集索引一个表可以存在多个</strong></li>\n<li><strong>聚集索引存储记录是物理上连续存在，而非聚集索引是逻辑上的连续，物理存储并不连续</strong></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h1 id=\"基本介绍\"><a href=\"#基本介绍\" class=\"headerlink\" title=\"基本介绍\"></a>基本介绍</h1><h3 id=\"聚集索引\"><a href=\"#聚集索引\" class=\"headerlink\" title=\"聚集索引\"></a>聚集索引</h3><p>聚集索引是指数据库表行中数据的物理顺序与键值的逻辑（索引）顺序相同。一个表只能有一个聚集索引，因为一个表的物理顺序只有一种情况，所以，对应的聚集索引只能有一个。<br>如果某索引不是聚集索引，则表中的行物理顺序与索引顺序不匹配，与非聚集索引相同，聚集索引有着更快的检索速度。</p>\n<h3 id=\"非聚集索引\"><a href=\"#非聚集索引\" class=\"headerlink\" title=\"非聚集索引\"></a>非聚集索引</h3><p>一种索引，该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同。</p>","more":"<h1 id=\"优劣势\"><a href=\"#优劣势\" class=\"headerlink\" title=\"优劣势\"></a>优劣势</h1><h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>1.可以把相关数据保存在一起，如：实现电子邮箱时，可以根据用户ID来聚集数据，这样只需要从磁盘读取少量的数据页就能获取某个用户全部邮件，如果没有使用聚集索引，则每封邮件都可能导致一次磁盘IO</li>\n<li>2.数据访问更快，聚集索引将索引和数据保存在同一个<code>btree</code>中，因此从聚集索引中获取数据通常比在非聚集索引中查找要快</li>\n<li>3.使用覆盖索引扫描的查询可以直接使用页节点中的主键值</li>\n</ul>\n<h3 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>1.聚簇数据最大限度地提高了IO密集型应用的性能，但如果数据全部放在内存中，则访问的顺序就没有那么重要了，聚集索引也没有什么优势了</li>\n<li>2.插入速度严重依赖于插入顺序，按照主键的顺序插入是加载数据到<code>innodb</code>表中速度最快的方式，但如果不是按照主键顺序加载数据，那么在加载完成后最好使用1optimize table`命令重新组织一下表</li>\n<li>3.更新聚集索引列的代价很高，因为会强制<code>innodb</code>将每个被更新的行移动到新的位置</li>\n<li>4.基于聚集索引的表在插入新行，或者主键被更新导致需要移动行的时候，可能面临页分裂的问题，当行的主键值要求必须将这一行插入到某个已满的页中时，存储引擎会将该页分裂成两个页面来容纳该行，这就是一次页分裂操作，页分裂会导致表占用更多的磁盘空间</li>\n</ul>\n<h1 id=\"innodb和myisam物理存储的数据分布对比\"><a href=\"#innodb和myisam物理存储的数据分布对比\" class=\"headerlink\" title=\"innodb和myisam物理存储的数据分布对比\"></a><code>innodb</code>和<code>myisam</code>物理存储的数据分布对比</h1><h3 id=\"myisam：\"><a href=\"#myisam：\" class=\"headerlink\" title=\"myisam：\"></a><code>myisam</code>：</h3><p>　　是按照数据插入的顺序存储在磁盘上的，<code>myisam</code>中的主键索引和二级索引在结构上并没有什么不同，主键索引就是一个名为<code>primary</code>的唯一非空索引。</p>\n<h3 id=\"innodb：\"><a href=\"#innodb：\" class=\"headerlink\" title=\"innodb：\"></a><code>innodb</code>：</h3><p>　　因为<code>innodb</code>支持聚集索引，所以使用非常不同的方式存储同样的数据，<code>innodb</code>聚集索引包含了整个表的数据，而不是只有索引，因为在<code>Innodb</code>中，聚集索引就是表，所以不像<code>myisam</code>那样需要独立的行存储。聚集索引的每一个叶子节点都包含了主键值，事务ID，用于事务和<code>MVCC</code>的回滚指针以及所有剩余列的值，如果主键是一个列前缀索引，<code>innodb</code>也会包含完整的主键列和剩下的列的值。</p>\n<p>　　还有一点和<code>myisam</code>不同的是，<code>innodb</code>的二级索引和聚集索引很不同，<code>innodb</code>二级索引的叶子节点中存储的不是行指针，而是主键值，并以此作为指向行的指针，这样的策略减少了当出现行移动或者数据页的分裂时二级索引的维护工作，使用主键值当做指针会让二级索引占用更多的空间，换来的好处是，<code>innodb</code>在移动行时无须更新二级索引中的这个指针。</p>\n<h2 id=\"何时使用聚集索引或非聚集索引\"><a href=\"#何时使用聚集索引或非聚集索引\" class=\"headerlink\" title=\"何时使用聚集索引或非聚集索引\"></a>何时使用聚集索引或非聚集索引</h2><table>\n<thead>\n<tr>\n<th>动作描述</th>\n<th>使用聚集索引</th>\n<th>使用非聚集索引</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>列经常被分组排序</td>\n<td>应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>返回某范围内的数据</td>\n<td>应</td>\n<td>不应</td>\n</tr>\n<tr>\n<td>一个或极少不同值</td>\n<td>不应</td>\n<td>不应</td>\n</tr>\n<tr>\n<td>小数目的不同值</td>\n<td>应</td>\n<td>不应</td>\n</tr>\n<tr>\n<td>大数目的不同值</td>\n<td>不应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>频繁更新的列</td>\n<td>不应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>外键列</td>\n<td>应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>主键列</td>\n<td>应</td>\n<td>应</td>\n</tr>\n<tr>\n<td>频繁修改索引列</td>\n<td>不应</td>\n<td>应</td>\n</tr>\n</tbody></table>\n<h1 id=\"总结：\"><a href=\"#总结：\" class=\"headerlink\" title=\"总结：\"></a>总结：</h1><ul>\n<li><strong>聚集索引就字典的首字母查询</strong></li>\n<li><strong>非聚集索引就是字典的边盘部首查询</strong></li>\n<li><strong>聚集索引一个表只能有一个，而非聚集索引一个表可以存在多个</strong></li>\n<li><strong>聚集索引存储记录是物理上连续存在，而非聚集索引是逻辑上的连续，物理存储并不连续</strong></li>\n</ul>"},{"title":"PHP数组和对象相互转换","date":"2017-06-19T16:00:00.000Z","updated":"2017-06-19T16:00:00.000Z","comments":1,"_content":"> 最近面试了很多PHP程序员，我出了这道题目，没几个做出来的。我很好奇，这也是项目中也经常能遇到的一个问题。所以顺便就记录一下。\n <!-- more -->\n## 题目\n`array('foo' => 'bar','one' => 'two','three' => 'four')`\n把这个数组转成对象，然后在把对象转成数组。\n\n## 答案\n```php\n/**\n * 对象转数组\n * @param unknown $obj 对象\n */\nfunction objectToArray($obj){\n    $arr = is_object($obj) ? get_object_vars($obj) : $obj;\n    if(is_array($arr)){\n        return array_map(__FUNCTION__, $arr);\n    }else{\n        return $arr;\n    }\n}\n\n/**\n * 数组转对象\n * @param unknown $arr\n */\nfunction arrayToObject($arr){\n    if(is_array($arr)){\n        return (object) array_map(__FUNCTION__, $arr);\n    }else{\n        return $arr;\n    }\n}\n```\n## 扩展\n`get_object_var($object)` 返回一个数组。获取`$object`对象中的属性，组成一个数组。\n```php\nclass person{\n public $name=\"王小明\";\n public $age = 18;\n public $birth = 19910506;\n}\n$p = new person();\nprint_r(get_object_vars($p));\n# 输出：\nArray ( [name] => 王美人 [age] => 25 [birth] => 19910506 ) \n\n```\n\n","source":"_posts/2017-06-19-conversion.md","raw":"---\ntitle:  \"PHP数组和对象相互转换\"\ndate: 2017-06-19  12:00:00\nupdated: 2017-06-19  12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n---\n> 最近面试了很多PHP程序员，我出了这道题目，没几个做出来的。我很好奇，这也是项目中也经常能遇到的一个问题。所以顺便就记录一下。\n <!-- more -->\n## 题目\n`array('foo' => 'bar','one' => 'two','three' => 'four')`\n把这个数组转成对象，然后在把对象转成数组。\n\n## 答案\n```php\n/**\n * 对象转数组\n * @param unknown $obj 对象\n */\nfunction objectToArray($obj){\n    $arr = is_object($obj) ? get_object_vars($obj) : $obj;\n    if(is_array($arr)){\n        return array_map(__FUNCTION__, $arr);\n    }else{\n        return $arr;\n    }\n}\n\n/**\n * 数组转对象\n * @param unknown $arr\n */\nfunction arrayToObject($arr){\n    if(is_array($arr)){\n        return (object) array_map(__FUNCTION__, $arr);\n    }else{\n        return $arr;\n    }\n}\n```\n## 扩展\n`get_object_var($object)` 返回一个数组。获取`$object`对象中的属性，组成一个数组。\n```php\nclass person{\n public $name=\"王小明\";\n public $age = 18;\n public $birth = 19910506;\n}\n$p = new person();\nprint_r(get_object_vars($p));\n# 输出：\nArray ( [name] => 王美人 [age] => 25 [birth] => 19910506 ) \n\n```\n\n","slug":"2017-06-19-conversion","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkv002cy4rbi67805mi","content":"<blockquote>\n<p>最近面试了很多PHP程序员，我出了这道题目，没几个做出来的。我很好奇，这也是项目中也经常能遇到的一个问题。所以顺便就记录一下。<br> <a id=\"more\"></a></p>\n</blockquote>\n<h2 id=\"题目\"><a href=\"#题目\" class=\"headerlink\" title=\"题目\"></a>题目</h2><p><code>array(&#39;foo&#39; =&gt; &#39;bar&#39;,&#39;one&#39; =&gt; &#39;two&#39;,&#39;three&#39; =&gt; &#39;four&#39;)</code><br>把这个数组转成对象，然后在把对象转成数组。</p>\n<h2 id=\"答案\"><a href=\"#答案\" class=\"headerlink\" title=\"答案\"></a>答案</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 对象转数组</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> unknown $obj 对象</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">objectToArray</span><span class=\"params\">($obj)</span></span>&#123;</span><br><span class=\"line\">    $arr = is_object($obj) ? get_object_vars($obj) : $obj;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(is_array($arr))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_map(<span class=\"keyword\">__FUNCTION__</span>, $arr);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $arr;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 数组转对象</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> unknown $arr</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">arrayToObject</span><span class=\"params\">($arr)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(is_array($arr))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (object) array_map(<span class=\"keyword\">__FUNCTION__</span>, $arr);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $arr;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h2><p><code>get_object_var($object)</code> 返回一个数组。获取<code>$object</code>对象中的属性，组成一个数组。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">person</span></span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">public</span> $name=<span class=\"string\">\"王小明\"</span>;</span><br><span class=\"line\"> <span class=\"keyword\">public</span> $age = <span class=\"number\">18</span>;</span><br><span class=\"line\"> <span class=\"keyword\">public</span> $birth = <span class=\"number\">19910506</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$p = <span class=\"keyword\">new</span> person();</span><br><span class=\"line\">print_r(get_object_vars($p));</span><br><span class=\"line\"><span class=\"comment\"># 输出：</span></span><br><span class=\"line\"><span class=\"keyword\">Array</span> ( [name] =&gt; 王美人 [age] =&gt; <span class=\"number\">25</span> [birth] =&gt; <span class=\"number\">19910506</span> )</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>最近面试了很多PHP程序员，我出了这道题目，没几个做出来的。我很好奇，这也是项目中也经常能遇到的一个问题。所以顺便就记录一下。<br>","more":"</p>\n</blockquote>\n<h2 id=\"题目\"><a href=\"#题目\" class=\"headerlink\" title=\"题目\"></a>题目</h2><p><code>array(&#39;foo&#39; =&gt; &#39;bar&#39;,&#39;one&#39; =&gt; &#39;two&#39;,&#39;three&#39; =&gt; &#39;four&#39;)</code><br>把这个数组转成对象，然后在把对象转成数组。</p>\n<h2 id=\"答案\"><a href=\"#答案\" class=\"headerlink\" title=\"答案\"></a>答案</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 对象转数组</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> unknown $obj 对象</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">objectToArray</span><span class=\"params\">($obj)</span></span>&#123;</span><br><span class=\"line\">    $arr = is_object($obj) ? get_object_vars($obj) : $obj;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(is_array($arr))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_map(<span class=\"keyword\">__FUNCTION__</span>, $arr);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $arr;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 数组转对象</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> unknown $arr</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">arrayToObject</span><span class=\"params\">($arr)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(is_array($arr))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (object) array_map(<span class=\"keyword\">__FUNCTION__</span>, $arr);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $arr;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h2><p><code>get_object_var($object)</code> 返回一个数组。获取<code>$object</code>对象中的属性，组成一个数组。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">person</span></span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">public</span> $name=<span class=\"string\">\"王小明\"</span>;</span><br><span class=\"line\"> <span class=\"keyword\">public</span> $age = <span class=\"number\">18</span>;</span><br><span class=\"line\"> <span class=\"keyword\">public</span> $birth = <span class=\"number\">19910506</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$p = <span class=\"keyword\">new</span> person();</span><br><span class=\"line\">print_r(get_object_vars($p));</span><br><span class=\"line\"><span class=\"comment\"># 输出：</span></span><br><span class=\"line\"><span class=\"keyword\">Array</span> ( [name] =&gt; 王美人 [age] =&gt; <span class=\"number\">25</span> [birth] =&gt; <span class=\"number\">19910506</span> )</span><br></pre></td></tr></table></figure>"},{"title":"细说事物(第一天)","date":"2017-08-20T16:00:00.000Z","updated":"2017-08-20T16:00:00.000Z","comments":1,"_content":"\n# 事务简介\n事务就是**锁**和**并发**的结合体.\n* **优势**:容易理解\n* **劣势**:性能较低\n\n扩展 - `DRDS/TDDL‵\n <!-- more -->\n\n### ACID保证事务的完整性\n* 原子性（Atomicity）\n* 一致性（Consistency）\n* 隔离性（Isolation）\n* 持久性（Durability）\n\n### 单个事务单元\n* 商品要建立一个基于GMT_Modified的索引\n* 从数据库读取一行记录\n* 向数据库写入一行记录,同时更新这记录的所有索引\n* 删除整张表\n\n### 一组事务单元\n* Bob->Smith 100元\n* Smith->Joe 100元\n* Joe->Bob 100元\n\n# 事务\n### 产生的原因\n**事务单元之间的Happen-before关系**\n* 读写\n* 写读\n* 读读\n* 写写\n\n### 排队法\n**序列化读写**\n* **优势**:不需要冲突控制\n* **劣势**:慢速设备\n\n<table>\n<tr>\n<td>事务单元</td>\n<td>->读</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n</table>\n\n### 排他锁\n**针对同一单元的访问进行控制**\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->读</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->读</td>\n</tr>\n</table>\n\n### 读写锁\n**针对读读场景进行优化**\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td></td>\n<td>->读</td>\n</tr>\n</table>\n\n\n### MVCC\n**本质上来说就是copy on write,能够做到写不阻塞读**\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元3</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>->读</td>\n</tr>\n</table>\n\n# 事务处理\n### 谁先谁后\n**在MMVC中一个读请求应该读哪一个写之后的数据?**\n* SCN(Oracle)\n* Trx_id(Innodb)\n\n### 故障恢复\n* 业务属性不匹配\n* 系统崩溃\n\n### 死锁和死锁检测\n**死锁产生的原因**\n* 两个线程\n* 不同方向\n* 相同资源\n\n**死锁的解决方法**\n* 降低隔离界别\n* 碰撞检测\n* 等锁超时\n","source":"_posts/2017-08-20-transactionOne.md","raw":"---\ntitle:  \"细说事物(第一天)\"\ndate: 2017-08-20 12:00:00\nupdated: 2017-08-20 12:00:00\ncomments: true\ncategories: 数据库\ntags:\n    - MySQL\n---\n\n# 事务简介\n事务就是**锁**和**并发**的结合体.\n* **优势**:容易理解\n* **劣势**:性能较低\n\n扩展 - `DRDS/TDDL‵\n <!-- more -->\n\n### ACID保证事务的完整性\n* 原子性（Atomicity）\n* 一致性（Consistency）\n* 隔离性（Isolation）\n* 持久性（Durability）\n\n### 单个事务单元\n* 商品要建立一个基于GMT_Modified的索引\n* 从数据库读取一行记录\n* 向数据库写入一行记录,同时更新这记录的所有索引\n* 删除整张表\n\n### 一组事务单元\n* Bob->Smith 100元\n* Smith->Joe 100元\n* Joe->Bob 100元\n\n# 事务\n### 产生的原因\n**事务单元之间的Happen-before关系**\n* 读写\n* 写读\n* 读读\n* 写写\n\n### 排队法\n**序列化读写**\n* **优势**:不需要冲突控制\n* **劣势**:慢速设备\n\n<table>\n<tr>\n<td>事务单元</td>\n<td>->读</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n</table>\n\n### 排他锁\n**针对同一单元的访问进行控制**\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->读</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->读</td>\n</tr>\n</table>\n\n### 读写锁\n**针对读读场景进行优化**\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td></td>\n<td>->读</td>\n</tr>\n</table>\n\n\n### MVCC\n**本质上来说就是copy on write,能够做到写不阻塞读**\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元3</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>->读</td>\n</tr>\n</table>\n\n# 事务处理\n### 谁先谁后\n**在MMVC中一个读请求应该读哪一个写之后的数据?**\n* SCN(Oracle)\n* Trx_id(Innodb)\n\n### 故障恢复\n* 业务属性不匹配\n* 系统崩溃\n\n### 死锁和死锁检测\n**死锁产生的原因**\n* 两个线程\n* 不同方向\n* 相同资源\n\n**死锁的解决方法**\n* 降低隔离界别\n* 碰撞检测\n* 等锁超时\n","slug":"2017-08-20-transactionOne","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkw002fy4rbl386uuls","content":"<h1 id=\"事务简介\"><a href=\"#事务简介\" class=\"headerlink\" title=\"事务简介\"></a>事务简介</h1><p>事务就是<strong>锁</strong>和<strong>并发</strong>的结合体.</p>\n<ul>\n<li><strong>优势</strong>:容易理解</li>\n<li><strong>劣势</strong>:性能较低</li>\n</ul>\n<p>扩展 - `DRDS/TDDL‵<br> <a id=\"more\"></a></p>\n<h3 id=\"ACID保证事务的完整性\"><a href=\"#ACID保证事务的完整性\" class=\"headerlink\" title=\"ACID保证事务的完整性\"></a>ACID保证事务的完整性</h3><ul>\n<li>原子性（Atomicity）</li>\n<li>一致性（Consistency）</li>\n<li>隔离性（Isolation）</li>\n<li>持久性（Durability）</li>\n</ul>\n<h3 id=\"单个事务单元\"><a href=\"#单个事务单元\" class=\"headerlink\" title=\"单个事务单元\"></a>单个事务单元</h3><ul>\n<li>商品要建立一个基于GMT_Modified的索引</li>\n<li>从数据库读取一行记录</li>\n<li>向数据库写入一行记录,同时更新这记录的所有索引</li>\n<li>删除整张表</li>\n</ul>\n<h3 id=\"一组事务单元\"><a href=\"#一组事务单元\" class=\"headerlink\" title=\"一组事务单元\"></a>一组事务单元</h3><ul>\n<li>Bob-&gt;Smith 100元</li>\n<li>Smith-&gt;Joe 100元</li>\n<li>Joe-&gt;Bob 100元</li>\n</ul>\n<h1 id=\"事务\"><a href=\"#事务\" class=\"headerlink\" title=\"事务\"></a>事务</h1><h3 id=\"产生的原因\"><a href=\"#产生的原因\" class=\"headerlink\" title=\"产生的原因\"></a>产生的原因</h3><p><strong>事务单元之间的Happen-before关系</strong></p>\n<ul>\n<li>读写</li>\n<li>写读</li>\n<li>读读</li>\n<li>写写</li>\n</ul>\n<h3 id=\"排队法\"><a href=\"#排队法\" class=\"headerlink\" title=\"排队法\"></a>排队法</h3><p><strong>序列化读写</strong></p>\n<ul>\n<li><strong>优势</strong>:不需要冲突控制</li>\n<li><strong>劣势</strong>:慢速设备</li>\n</ul>\n<table>\n<tr>\n<td>事务单元</td>\n<td>->读</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n</table>\n\n<h3 id=\"排他锁\"><a href=\"#排他锁\" class=\"headerlink\" title=\"排他锁\"></a>排他锁</h3><p><strong>针对同一单元的访问进行控制</strong></p>\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->读</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->读</td>\n</tr>\n</table>\n\n<h3 id=\"读写锁\"><a href=\"#读写锁\" class=\"headerlink\" title=\"读写锁\"></a>读写锁</h3><p><strong>针对读读场景进行优化</strong></p>\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td></td>\n<td>->读</td>\n</tr>\n</table>\n\n\n<h3 id=\"MVCC\"><a href=\"#MVCC\" class=\"headerlink\" title=\"MVCC\"></a>MVCC</h3><p><strong>本质上来说就是copy on write,能够做到写不阻塞读</strong></p>\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元3</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>->读</td>\n</tr>\n</table>\n\n<h1 id=\"事务处理\"><a href=\"#事务处理\" class=\"headerlink\" title=\"事务处理\"></a>事务处理</h1><h3 id=\"谁先谁后\"><a href=\"#谁先谁后\" class=\"headerlink\" title=\"谁先谁后\"></a>谁先谁后</h3><p><strong>在MMVC中一个读请求应该读哪一个写之后的数据?</strong></p>\n<ul>\n<li>SCN(Oracle)</li>\n<li>Trx_id(Innodb)</li>\n</ul>\n<h3 id=\"故障恢复\"><a href=\"#故障恢复\" class=\"headerlink\" title=\"故障恢复\"></a>故障恢复</h3><ul>\n<li>业务属性不匹配</li>\n<li>系统崩溃</li>\n</ul>\n<h3 id=\"死锁和死锁检测\"><a href=\"#死锁和死锁检测\" class=\"headerlink\" title=\"死锁和死锁检测\"></a>死锁和死锁检测</h3><p><strong>死锁产生的原因</strong></p>\n<ul>\n<li>两个线程</li>\n<li>不同方向</li>\n<li>相同资源</li>\n</ul>\n<p><strong>死锁的解决方法</strong></p>\n<ul>\n<li>降低隔离界别</li>\n<li>碰撞检测</li>\n<li>等锁超时</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h1 id=\"事务简介\"><a href=\"#事务简介\" class=\"headerlink\" title=\"事务简介\"></a>事务简介</h1><p>事务就是<strong>锁</strong>和<strong>并发</strong>的结合体.</p>\n<ul>\n<li><strong>优势</strong>:容易理解</li>\n<li><strong>劣势</strong>:性能较低</li>\n</ul>\n<p>扩展 - `DRDS/TDDL‵<br>","more":"</p>\n<h3 id=\"ACID保证事务的完整性\"><a href=\"#ACID保证事务的完整性\" class=\"headerlink\" title=\"ACID保证事务的完整性\"></a>ACID保证事务的完整性</h3><ul>\n<li>原子性（Atomicity）</li>\n<li>一致性（Consistency）</li>\n<li>隔离性（Isolation）</li>\n<li>持久性（Durability）</li>\n</ul>\n<h3 id=\"单个事务单元\"><a href=\"#单个事务单元\" class=\"headerlink\" title=\"单个事务单元\"></a>单个事务单元</h3><ul>\n<li>商品要建立一个基于GMT_Modified的索引</li>\n<li>从数据库读取一行记录</li>\n<li>向数据库写入一行记录,同时更新这记录的所有索引</li>\n<li>删除整张表</li>\n</ul>\n<h3 id=\"一组事务单元\"><a href=\"#一组事务单元\" class=\"headerlink\" title=\"一组事务单元\"></a>一组事务单元</h3><ul>\n<li>Bob-&gt;Smith 100元</li>\n<li>Smith-&gt;Joe 100元</li>\n<li>Joe-&gt;Bob 100元</li>\n</ul>\n<h1 id=\"事务\"><a href=\"#事务\" class=\"headerlink\" title=\"事务\"></a>事务</h1><h3 id=\"产生的原因\"><a href=\"#产生的原因\" class=\"headerlink\" title=\"产生的原因\"></a>产生的原因</h3><p><strong>事务单元之间的Happen-before关系</strong></p>\n<ul>\n<li>读写</li>\n<li>写读</li>\n<li>读读</li>\n<li>写写</li>\n</ul>\n<h3 id=\"排队法\"><a href=\"#排队法\" class=\"headerlink\" title=\"排队法\"></a>排队法</h3><p><strong>序列化读写</strong></p>\n<ul>\n<li><strong>优势</strong>:不需要冲突控制</li>\n<li><strong>劣势</strong>:慢速设备</li>\n</ul>\n<table>\n<tr>\n<td>事务单元</td>\n<td>->读</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n</table>\n\n<h3 id=\"排他锁\"><a href=\"#排他锁\" class=\"headerlink\" title=\"排他锁\"></a>排他锁</h3><p><strong>针对同一单元的访问进行控制</strong></p>\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->读</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->读</td>\n</tr>\n</table>\n\n<h3 id=\"读写锁\"><a href=\"#读写锁\" class=\"headerlink\" title=\"读写锁\"></a>读写锁</h3><p><strong>针对读读场景进行优化</strong></p>\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->读</td>\n<td>->写</td>\n<td>->写</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td></td>\n<td>->读</td>\n</tr>\n</table>\n\n\n<h3 id=\"MVCC\"><a href=\"#MVCC\" class=\"headerlink\" title=\"MVCC\"></a>MVCC</h3><p><strong>本质上来说就是copy on write,能够做到写不阻塞读</strong></p>\n<table>\n<tr>\n<td>事务单元1</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n<td>->写</td>\n</tr>\n<tr>\n<td>事务单元2</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td>->读</td>\n<td>->读</td>\n</tr>\n<tr>\n<td>事务单元3</td>\n<td></td>\n<td>->读</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td>->读</td>\n</tr>\n</table>\n\n<h1 id=\"事务处理\"><a href=\"#事务处理\" class=\"headerlink\" title=\"事务处理\"></a>事务处理</h1><h3 id=\"谁先谁后\"><a href=\"#谁先谁后\" class=\"headerlink\" title=\"谁先谁后\"></a>谁先谁后</h3><p><strong>在MMVC中一个读请求应该读哪一个写之后的数据?</strong></p>\n<ul>\n<li>SCN(Oracle)</li>\n<li>Trx_id(Innodb)</li>\n</ul>\n<h3 id=\"故障恢复\"><a href=\"#故障恢复\" class=\"headerlink\" title=\"故障恢复\"></a>故障恢复</h3><ul>\n<li>业务属性不匹配</li>\n<li>系统崩溃</li>\n</ul>\n<h3 id=\"死锁和死锁检测\"><a href=\"#死锁和死锁检测\" class=\"headerlink\" title=\"死锁和死锁检测\"></a>死锁和死锁检测</h3><p><strong>死锁产生的原因</strong></p>\n<ul>\n<li>两个线程</li>\n<li>不同方向</li>\n<li>相同资源</li>\n</ul>\n<p><strong>死锁的解决方法</strong></p>\n<ul>\n<li>降低隔离界别</li>\n<li>碰撞检测</li>\n<li>等锁超时</li>\n</ul>"},{"title":"简聊CGI,FastCGI,PHP-CGI,PHP-FPM之间的关系","date":"2017-07-19T16:00:00.000Z","updated":"2017-07-19T16:00:00.000Z","comments":1,"_content":"\n## 概述\n`FPM(FastCGI Process Manager)`是`PHP FastCGI`运行模式的一个进程管理器，从它的定义可以看出，`FPM`的核心功能是进程管理，那么它用来管理什么进程呢？这个问题就需要从`FastCGI`说起了。\n> 你(`PHP`)去和爱斯基摩人(`web`服务器，如 `Apache`、`Nginx`)谈生意.你说中文(`PHP`代码)，他说爱斯基摩语(`C`代码)，互相听不懂，怎么办？那就都把各自说的话转换成英语(`FastCGI` 协议)吧。\n怎么转换呢？你就要使用一个翻译机(`PHP-FPM`) (当然对方也有一个翻译机，那个是他自带的)\n我们这个翻译机是最新型的，老式的那个（`PHP-CGI`）被淘汰了。不过它(`PHP-FPM`)只有年轻人（`Linux`系统）会用，老头子们（`Windows`系统）不会摆弄它，只好继续用老式的那个。\n <!-- more -->\n#### `CGI`是干嘛的？\n**`CGI`是为了保证`web server`传递过来的数据是标准格式的，方便`CGI`程序的编写者.**\n* `web server`（比如说`nginx`）只是内容的分发者。比如，如果请求/index.html，那么`web server`会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。好了，如果现在请求的是/index.php，根据配置文件，`nginx`知道这个不是静态文件，需要去找PHP解析器来处理，那么他会把这个请求简单处理后交给PHP解析器。`Nginx`会传哪些数据给PHP解析器呢？url要有吧，查询字符串也得有吧，POST数据也要有，HTTP header不能少吧，好的，`CGI`就是规定要传哪些数据、以什么样的格式传递给后方处理这个请求的协议。仔细想想，你在PHP代码中使用的用户从哪里来的。\n* 当`web server`收到/index.php这个请求后，会启动对应的`CGI`程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以规定`CGI`规定的格式返回处理后的结果，退出进程。`web server`再把结果返回给浏览器。\n\n#### `CGI`是个协议，跟进程什么的没关系。那fastcgi又是什么呢？\n**Fastcgi是用来提高`CGI`程序性能的。**\n* 提高性能，那么`CGI`程序的性能问题在哪呢？\"PHP解析器会解析php.ini文件，初始化执行环境\"，就是这里了。标准的`CGI`对每个请求都会执行这些步骤（不闲累啊！启动进程很累的说！），所以处理每个时间的时间会比较长。这明显不合理嘛！那么Fastcgi是怎么做的呢？首先，Fastcgi会先启一个master，解析配置文件，初始化执行环境，然后再启动多个worker。当请求过来时，master会传递给一个worker，然后立即可以接受下一个请求。这样就避免了重复的劳动，效率自然是高。而且当worker不够用时，master可以根据配置预先启动几个worker等着；当然空闲worker太多时，也会停掉一些，这样就提高了性能，也节约了资源。这就是fastcgi的对进程的管理。\n\n#### `PHP-FPM`是什么呢？\n**`PHP-FPM`(`FastCGI` Process Manager：`FastCGI`进程管理器)对于PHP 5.3.3之前的php来说，是一个补丁包[1]  ，旨在将`FastCGI`进程管理整合进PHP包中。如果你使用的是PHP5.3.3之前的PHP的话，就必须将它patch到你的PHP源代码中，在编译安装PHP后才可以使用。**\n* 大家都知道，PHP的解释器是php-cgi。php-cgi只是个`CGI`程序，他自己本身只能解析请求，返回结果，不会进程管理（皇上，臣妾真的做不到啊！）所以就出现了一些能够调度php-cgi进程的程序，比如说由lighthttpd分离出来的spawn-fcgi。好了`PHP-FPM`也是这么个东东，在长时间的发展后，逐渐得到了大家的认可（要知道，前几年大家可是抱怨`PHP-FPM`稳定性太差的），也越来越流行。\n\n#### `FastCGI`的不足?\n**因为是多进程，所以比`CGI`多线程消耗更多的服务器内存，PHP-CGI解释器每进程消耗7至25兆内存，将这个数字乘以50或100就是很大的内存数。**\n\n* `Nginx` 0.8.46+PHP 5.2.14(`FastCGI`)服务器在3万并发连接下，开启的10个`Nginx`进程消耗150M内存（15M*10=150M），开启的64个php-cgi进程消耗1280M内存（20M*64=1280M），加上系统自身消耗的内存，总共消耗不到2GB内存。如果服务器内存较小，完全可以只开启25个php-cgi进程，这样php-cgi消耗的总内存数才500M。\n上面的数据摘自`Nginx` 0.8.x + PHP 5.2.13(`FastCGI`)搭建胜过Apache十倍的Web服务器(第6版)。\n\n#### `PHP-CGI`的不足?\n* php-cgi变更php.ini配置后需重启php-cgi才能让新的php-ini生效，不可以平滑重启。\n* 直接杀死php-cgi进程，php就不能运行了。(`PHP-FPM`和Spawn-FCGI就没有这个问题，守护进程会平滑从新生成新的子进程。）\n","source":"_posts/2017-07-19-fpm.md","raw":"---\ntitle:  \"简聊CGI,FastCGI,PHP-CGI,PHP-FPM之间的关系\"\ndate: 2017-07-19  12:00:00\nupdated: 2017-07-19 12:00:00\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - watch\n---\n\n## 概述\n`FPM(FastCGI Process Manager)`是`PHP FastCGI`运行模式的一个进程管理器，从它的定义可以看出，`FPM`的核心功能是进程管理，那么它用来管理什么进程呢？这个问题就需要从`FastCGI`说起了。\n> 你(`PHP`)去和爱斯基摩人(`web`服务器，如 `Apache`、`Nginx`)谈生意.你说中文(`PHP`代码)，他说爱斯基摩语(`C`代码)，互相听不懂，怎么办？那就都把各自说的话转换成英语(`FastCGI` 协议)吧。\n怎么转换呢？你就要使用一个翻译机(`PHP-FPM`) (当然对方也有一个翻译机，那个是他自带的)\n我们这个翻译机是最新型的，老式的那个（`PHP-CGI`）被淘汰了。不过它(`PHP-FPM`)只有年轻人（`Linux`系统）会用，老头子们（`Windows`系统）不会摆弄它，只好继续用老式的那个。\n <!-- more -->\n#### `CGI`是干嘛的？\n**`CGI`是为了保证`web server`传递过来的数据是标准格式的，方便`CGI`程序的编写者.**\n* `web server`（比如说`nginx`）只是内容的分发者。比如，如果请求/index.html，那么`web server`会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。好了，如果现在请求的是/index.php，根据配置文件，`nginx`知道这个不是静态文件，需要去找PHP解析器来处理，那么他会把这个请求简单处理后交给PHP解析器。`Nginx`会传哪些数据给PHP解析器呢？url要有吧，查询字符串也得有吧，POST数据也要有，HTTP header不能少吧，好的，`CGI`就是规定要传哪些数据、以什么样的格式传递给后方处理这个请求的协议。仔细想想，你在PHP代码中使用的用户从哪里来的。\n* 当`web server`收到/index.php这个请求后，会启动对应的`CGI`程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以规定`CGI`规定的格式返回处理后的结果，退出进程。`web server`再把结果返回给浏览器。\n\n#### `CGI`是个协议，跟进程什么的没关系。那fastcgi又是什么呢？\n**Fastcgi是用来提高`CGI`程序性能的。**\n* 提高性能，那么`CGI`程序的性能问题在哪呢？\"PHP解析器会解析php.ini文件，初始化执行环境\"，就是这里了。标准的`CGI`对每个请求都会执行这些步骤（不闲累啊！启动进程很累的说！），所以处理每个时间的时间会比较长。这明显不合理嘛！那么Fastcgi是怎么做的呢？首先，Fastcgi会先启一个master，解析配置文件，初始化执行环境，然后再启动多个worker。当请求过来时，master会传递给一个worker，然后立即可以接受下一个请求。这样就避免了重复的劳动，效率自然是高。而且当worker不够用时，master可以根据配置预先启动几个worker等着；当然空闲worker太多时，也会停掉一些，这样就提高了性能，也节约了资源。这就是fastcgi的对进程的管理。\n\n#### `PHP-FPM`是什么呢？\n**`PHP-FPM`(`FastCGI` Process Manager：`FastCGI`进程管理器)对于PHP 5.3.3之前的php来说，是一个补丁包[1]  ，旨在将`FastCGI`进程管理整合进PHP包中。如果你使用的是PHP5.3.3之前的PHP的话，就必须将它patch到你的PHP源代码中，在编译安装PHP后才可以使用。**\n* 大家都知道，PHP的解释器是php-cgi。php-cgi只是个`CGI`程序，他自己本身只能解析请求，返回结果，不会进程管理（皇上，臣妾真的做不到啊！）所以就出现了一些能够调度php-cgi进程的程序，比如说由lighthttpd分离出来的spawn-fcgi。好了`PHP-FPM`也是这么个东东，在长时间的发展后，逐渐得到了大家的认可（要知道，前几年大家可是抱怨`PHP-FPM`稳定性太差的），也越来越流行。\n\n#### `FastCGI`的不足?\n**因为是多进程，所以比`CGI`多线程消耗更多的服务器内存，PHP-CGI解释器每进程消耗7至25兆内存，将这个数字乘以50或100就是很大的内存数。**\n\n* `Nginx` 0.8.46+PHP 5.2.14(`FastCGI`)服务器在3万并发连接下，开启的10个`Nginx`进程消耗150M内存（15M*10=150M），开启的64个php-cgi进程消耗1280M内存（20M*64=1280M），加上系统自身消耗的内存，总共消耗不到2GB内存。如果服务器内存较小，完全可以只开启25个php-cgi进程，这样php-cgi消耗的总内存数才500M。\n上面的数据摘自`Nginx` 0.8.x + PHP 5.2.13(`FastCGI`)搭建胜过Apache十倍的Web服务器(第6版)。\n\n#### `PHP-CGI`的不足?\n* php-cgi变更php.ini配置后需重启php-cgi才能让新的php-ini生效，不可以平滑重启。\n* 直接杀死php-cgi进程，php就不能运行了。(`PHP-FPM`和Spawn-FCGI就没有这个问题，守护进程会平滑从新生成新的子进程。）\n","slug":"2017-07-19-fpm","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkx002ky4rbs4llauiv","content":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p><code>FPM(FastCGI Process Manager)</code>是<code>PHP FastCGI</code>运行模式的一个进程管理器，从它的定义可以看出，<code>FPM</code>的核心功能是进程管理，那么它用来管理什么进程呢？这个问题就需要从<code>FastCGI</code>说起了。</p>\n<blockquote>\n<p>你(<code>PHP</code>)去和爱斯基摩人(<code>web</code>服务器，如 <code>Apache</code>、<code>Nginx</code>)谈生意.你说中文(<code>PHP</code>代码)，他说爱斯基摩语(<code>C</code>代码)，互相听不懂，怎么办？那就都把各自说的话转换成英语(<code>FastCGI</code> 协议)吧。<br>怎么转换呢？你就要使用一个翻译机(<code>PHP-FPM</code>) (当然对方也有一个翻译机，那个是他自带的)<br>我们这个翻译机是最新型的，老式的那个（<code>PHP-CGI</code>）被淘汰了。不过它(<code>PHP-FPM</code>)只有年轻人（<code>Linux</code>系统）会用，老头子们（<code>Windows</code>系统）不会摆弄它，只好继续用老式的那个。<br> <a id=\"more\"></a></p>\n</blockquote>\n<h4 id=\"CGI是干嘛的？\"><a href=\"#CGI是干嘛的？\" class=\"headerlink\" title=\"CGI是干嘛的？\"></a><code>CGI</code>是干嘛的？</h4><p><strong><code>CGI</code>是为了保证<code>web server</code>传递过来的数据是标准格式的，方便<code>CGI</code>程序的编写者.</strong></p>\n<ul>\n<li><code>web server</code>（比如说<code>nginx</code>）只是内容的分发者。比如，如果请求/index.html，那么<code>web server</code>会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。好了，如果现在请求的是/index.php，根据配置文件，<code>nginx</code>知道这个不是静态文件，需要去找PHP解析器来处理，那么他会把这个请求简单处理后交给PHP解析器。<code>Nginx</code>会传哪些数据给PHP解析器呢？url要有吧，查询字符串也得有吧，POST数据也要有，HTTP header不能少吧，好的，<code>CGI</code>就是规定要传哪些数据、以什么样的格式传递给后方处理这个请求的协议。仔细想想，你在PHP代码中使用的用户从哪里来的。</li>\n<li>当<code>web server</code>收到/index.php这个请求后，会启动对应的<code>CGI</code>程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以规定<code>CGI</code>规定的格式返回处理后的结果，退出进程。<code>web server</code>再把结果返回给浏览器。</li>\n</ul>\n<h4 id=\"CGI是个协议，跟进程什么的没关系。那fastcgi又是什么呢？\"><a href=\"#CGI是个协议，跟进程什么的没关系。那fastcgi又是什么呢？\" class=\"headerlink\" title=\"CGI是个协议，跟进程什么的没关系。那fastcgi又是什么呢？\"></a><code>CGI</code>是个协议，跟进程什么的没关系。那fastcgi又是什么呢？</h4><p><strong>Fastcgi是用来提高<code>CGI</code>程序性能的。</strong></p>\n<ul>\n<li>提高性能，那么<code>CGI</code>程序的性能问题在哪呢？”PHP解析器会解析php.ini文件，初始化执行环境”，就是这里了。标准的<code>CGI</code>对每个请求都会执行这些步骤（不闲累啊！启动进程很累的说！），所以处理每个时间的时间会比较长。这明显不合理嘛！那么Fastcgi是怎么做的呢？首先，Fastcgi会先启一个master，解析配置文件，初始化执行环境，然后再启动多个worker。当请求过来时，master会传递给一个worker，然后立即可以接受下一个请求。这样就避免了重复的劳动，效率自然是高。而且当worker不够用时，master可以根据配置预先启动几个worker等着；当然空闲worker太多时，也会停掉一些，这样就提高了性能，也节约了资源。这就是fastcgi的对进程的管理。</li>\n</ul>\n<h4 id=\"PHP-FPM是什么呢？\"><a href=\"#PHP-FPM是什么呢？\" class=\"headerlink\" title=\"PHP-FPM是什么呢？\"></a><code>PHP-FPM</code>是什么呢？</h4><p><strong><code>PHP-FPM</code>(<code>FastCGI</code> Process Manager：<code>FastCGI</code>进程管理器)对于PHP 5.3.3之前的php来说，是一个补丁包[1]  ，旨在将<code>FastCGI</code>进程管理整合进PHP包中。如果你使用的是PHP5.3.3之前的PHP的话，就必须将它patch到你的PHP源代码中，在编译安装PHP后才可以使用。</strong></p>\n<ul>\n<li>大家都知道，PHP的解释器是php-cgi。php-cgi只是个<code>CGI</code>程序，他自己本身只能解析请求，返回结果，不会进程管理（皇上，臣妾真的做不到啊！）所以就出现了一些能够调度php-cgi进程的程序，比如说由lighthttpd分离出来的spawn-fcgi。好了<code>PHP-FPM</code>也是这么个东东，在长时间的发展后，逐渐得到了大家的认可（要知道，前几年大家可是抱怨<code>PHP-FPM</code>稳定性太差的），也越来越流行。</li>\n</ul>\n<h4 id=\"FastCGI的不足\"><a href=\"#FastCGI的不足\" class=\"headerlink\" title=\"FastCGI的不足?\"></a><code>FastCGI</code>的不足?</h4><p><strong>因为是多进程，所以比<code>CGI</code>多线程消耗更多的服务器内存，PHP-CGI解释器每进程消耗7至25兆内存，将这个数字乘以50或100就是很大的内存数。</strong></p>\n<ul>\n<li><code>Nginx</code> 0.8.46+PHP 5.2.14(<code>FastCGI</code>)服务器在3万并发连接下，开启的10个<code>Nginx</code>进程消耗150M内存（15M<em>10=150M），开启的64个php-cgi进程消耗1280M内存（20M</em>64=1280M），加上系统自身消耗的内存，总共消耗不到2GB内存。如果服务器内存较小，完全可以只开启25个php-cgi进程，这样php-cgi消耗的总内存数才500M。<br>上面的数据摘自<code>Nginx</code> 0.8.x + PHP 5.2.13(<code>FastCGI</code>)搭建胜过Apache十倍的Web服务器(第6版)。</li>\n</ul>\n<h4 id=\"PHP-CGI的不足\"><a href=\"#PHP-CGI的不足\" class=\"headerlink\" title=\"PHP-CGI的不足?\"></a><code>PHP-CGI</code>的不足?</h4><ul>\n<li>php-cgi变更php.ini配置后需重启php-cgi才能让新的php-ini生效，不可以平滑重启。</li>\n<li>直接杀死php-cgi进程，php就不能运行了。(<code>PHP-FPM</code>和Spawn-FCGI就没有这个问题，守护进程会平滑从新生成新的子进程。）</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p><code>FPM(FastCGI Process Manager)</code>是<code>PHP FastCGI</code>运行模式的一个进程管理器，从它的定义可以看出，<code>FPM</code>的核心功能是进程管理，那么它用来管理什么进程呢？这个问题就需要从<code>FastCGI</code>说起了。</p>\n<blockquote>\n<p>你(<code>PHP</code>)去和爱斯基摩人(<code>web</code>服务器，如 <code>Apache</code>、<code>Nginx</code>)谈生意.你说中文(<code>PHP</code>代码)，他说爱斯基摩语(<code>C</code>代码)，互相听不懂，怎么办？那就都把各自说的话转换成英语(<code>FastCGI</code> 协议)吧。<br>怎么转换呢？你就要使用一个翻译机(<code>PHP-FPM</code>) (当然对方也有一个翻译机，那个是他自带的)<br>我们这个翻译机是最新型的，老式的那个（<code>PHP-CGI</code>）被淘汰了。不过它(<code>PHP-FPM</code>)只有年轻人（<code>Linux</code>系统）会用，老头子们（<code>Windows</code>系统）不会摆弄它，只好继续用老式的那个。<br>","more":"</p>\n</blockquote>\n<h4 id=\"CGI是干嘛的？\"><a href=\"#CGI是干嘛的？\" class=\"headerlink\" title=\"CGI是干嘛的？\"></a><code>CGI</code>是干嘛的？</h4><p><strong><code>CGI</code>是为了保证<code>web server</code>传递过来的数据是标准格式的，方便<code>CGI</code>程序的编写者.</strong></p>\n<ul>\n<li><code>web server</code>（比如说<code>nginx</code>）只是内容的分发者。比如，如果请求/index.html，那么<code>web server</code>会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。好了，如果现在请求的是/index.php，根据配置文件，<code>nginx</code>知道这个不是静态文件，需要去找PHP解析器来处理，那么他会把这个请求简单处理后交给PHP解析器。<code>Nginx</code>会传哪些数据给PHP解析器呢？url要有吧，查询字符串也得有吧，POST数据也要有，HTTP header不能少吧，好的，<code>CGI</code>就是规定要传哪些数据、以什么样的格式传递给后方处理这个请求的协议。仔细想想，你在PHP代码中使用的用户从哪里来的。</li>\n<li>当<code>web server</code>收到/index.php这个请求后，会启动对应的<code>CGI</code>程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以规定<code>CGI</code>规定的格式返回处理后的结果，退出进程。<code>web server</code>再把结果返回给浏览器。</li>\n</ul>\n<h4 id=\"CGI是个协议，跟进程什么的没关系。那fastcgi又是什么呢？\"><a href=\"#CGI是个协议，跟进程什么的没关系。那fastcgi又是什么呢？\" class=\"headerlink\" title=\"CGI是个协议，跟进程什么的没关系。那fastcgi又是什么呢？\"></a><code>CGI</code>是个协议，跟进程什么的没关系。那fastcgi又是什么呢？</h4><p><strong>Fastcgi是用来提高<code>CGI</code>程序性能的。</strong></p>\n<ul>\n<li>提高性能，那么<code>CGI</code>程序的性能问题在哪呢？”PHP解析器会解析php.ini文件，初始化执行环境”，就是这里了。标准的<code>CGI</code>对每个请求都会执行这些步骤（不闲累啊！启动进程很累的说！），所以处理每个时间的时间会比较长。这明显不合理嘛！那么Fastcgi是怎么做的呢？首先，Fastcgi会先启一个master，解析配置文件，初始化执行环境，然后再启动多个worker。当请求过来时，master会传递给一个worker，然后立即可以接受下一个请求。这样就避免了重复的劳动，效率自然是高。而且当worker不够用时，master可以根据配置预先启动几个worker等着；当然空闲worker太多时，也会停掉一些，这样就提高了性能，也节约了资源。这就是fastcgi的对进程的管理。</li>\n</ul>\n<h4 id=\"PHP-FPM是什么呢？\"><a href=\"#PHP-FPM是什么呢？\" class=\"headerlink\" title=\"PHP-FPM是什么呢？\"></a><code>PHP-FPM</code>是什么呢？</h4><p><strong><code>PHP-FPM</code>(<code>FastCGI</code> Process Manager：<code>FastCGI</code>进程管理器)对于PHP 5.3.3之前的php来说，是一个补丁包[1]  ，旨在将<code>FastCGI</code>进程管理整合进PHP包中。如果你使用的是PHP5.3.3之前的PHP的话，就必须将它patch到你的PHP源代码中，在编译安装PHP后才可以使用。</strong></p>\n<ul>\n<li>大家都知道，PHP的解释器是php-cgi。php-cgi只是个<code>CGI</code>程序，他自己本身只能解析请求，返回结果，不会进程管理（皇上，臣妾真的做不到啊！）所以就出现了一些能够调度php-cgi进程的程序，比如说由lighthttpd分离出来的spawn-fcgi。好了<code>PHP-FPM</code>也是这么个东东，在长时间的发展后，逐渐得到了大家的认可（要知道，前几年大家可是抱怨<code>PHP-FPM</code>稳定性太差的），也越来越流行。</li>\n</ul>\n<h4 id=\"FastCGI的不足\"><a href=\"#FastCGI的不足\" class=\"headerlink\" title=\"FastCGI的不足?\"></a><code>FastCGI</code>的不足?</h4><p><strong>因为是多进程，所以比<code>CGI</code>多线程消耗更多的服务器内存，PHP-CGI解释器每进程消耗7至25兆内存，将这个数字乘以50或100就是很大的内存数。</strong></p>\n<ul>\n<li><code>Nginx</code> 0.8.46+PHP 5.2.14(<code>FastCGI</code>)服务器在3万并发连接下，开启的10个<code>Nginx</code>进程消耗150M内存（15M<em>10=150M），开启的64个php-cgi进程消耗1280M内存（20M</em>64=1280M），加上系统自身消耗的内存，总共消耗不到2GB内存。如果服务器内存较小，完全可以只开启25个php-cgi进程，这样php-cgi消耗的总内存数才500M。<br>上面的数据摘自<code>Nginx</code> 0.8.x + PHP 5.2.13(<code>FastCGI</code>)搭建胜过Apache十倍的Web服务器(第6版)。</li>\n</ul>\n<h4 id=\"PHP-CGI的不足\"><a href=\"#PHP-CGI的不足\" class=\"headerlink\" title=\"PHP-CGI的不足?\"></a><code>PHP-CGI</code>的不足?</h4><ul>\n<li>php-cgi变更php.ini配置后需重启php-cgi才能让新的php-ini生效，不可以平滑重启。</li>\n<li>直接杀死php-cgi进程，php就不能运行了。(<code>PHP-FPM</code>和Spawn-FCGI就没有这个问题，守护进程会平滑从新生成新的子进程。）</li>\n</ul>"},{"title":"细说事物(第二天)","date":"2017-10-28T16:00:00.000Z","updated":"2017-10-28T16:00:00.000Z","comments":1,"_content":"\n### 隔离性（扩展:MVCC/SNAPSHOT ISOLATION）\n* 读已提交\n* 读未提交\n* 可重复读\n* 序列化读\n* 快照隔离界别\n  > * 用新的方式实现传统意义上读为提交的场景，同时保证可序列化的隔离级别。\n  * 写>读时会增加系统成本\n  * Mvcc适合读写比率比较高的情况\n <!-- more -->\n### 持久性（扩展:持久性保证策略）\n**RAID**\n* 如何保证数据同时写到两块磁盘\n* 每一次请求都要刷磁盘性能过低，将请求打包统一发送到快存储\n  1. 直接写入内存\n  > * 优点：IOPS高\n  > * 缺点：丢数据\n  2. Group commit\n  > * 优点：保证系统的持久性和吞吐量\n  > * 缺点:请求延迟提升\n\n### 单机事务的典型异常应对策略\n* 业务属性不匹配-回滚\n* 系统DOWN机回复\n  * **重启后进入recovery**\n    >* 提交后的事务单元继续完成提交\n    >* 未提交事务单元回滚\n\n### 事务的调优原则\n1. 在不影响业务应用的前提下\n  * 减少锁的覆盖范围\n  * Myisam表锁->Innodb行锁\n  * 原子锁->MVCC多版本\n2. 增加锁上可并行线程数\n  * 读锁写锁分离，允许并行读取数据\n  * 多线程并行读取\n3. 乐观锁/悲观锁\n  * **悲观锁**-适合并发争抢比较严重的场景\n      > 是线程到blocking状态,通知信息OK状态切换回等待状态,需要不停的换入换出.\n  * **乐观锁**-适合并发争抢比较不太严重的场\n\n### 事务单元扩展\n**Tow Phase lock(2PL)**\n\n### 死锁扩展-U锁\n**更新锁-更新对只读情况，升级写锁**\n\n### MVCC拾遗\n乐观锁并发方案: **让版本低的并发更新回滚**\n>* 优势：并发低时性能好\n>* 代价：并发高时失败率高，需要不断重试\n","source":"_posts/2017-10-28-transactionTwo.md","raw":"---\ntitle:  \"细说事物(第二天)\"\ndate: 2017-10-28 12:00:00\nupdated: 2017-10-28 12:00:00\ncomments: true\ncategories: 数据库\ntags:\n    - MySQL\n---\n\n### 隔离性（扩展:MVCC/SNAPSHOT ISOLATION）\n* 读已提交\n* 读未提交\n* 可重复读\n* 序列化读\n* 快照隔离界别\n  > * 用新的方式实现传统意义上读为提交的场景，同时保证可序列化的隔离级别。\n  * 写>读时会增加系统成本\n  * Mvcc适合读写比率比较高的情况\n <!-- more -->\n### 持久性（扩展:持久性保证策略）\n**RAID**\n* 如何保证数据同时写到两块磁盘\n* 每一次请求都要刷磁盘性能过低，将请求打包统一发送到快存储\n  1. 直接写入内存\n  > * 优点：IOPS高\n  > * 缺点：丢数据\n  2. Group commit\n  > * 优点：保证系统的持久性和吞吐量\n  > * 缺点:请求延迟提升\n\n### 单机事务的典型异常应对策略\n* 业务属性不匹配-回滚\n* 系统DOWN机回复\n  * **重启后进入recovery**\n    >* 提交后的事务单元继续完成提交\n    >* 未提交事务单元回滚\n\n### 事务的调优原则\n1. 在不影响业务应用的前提下\n  * 减少锁的覆盖范围\n  * Myisam表锁->Innodb行锁\n  * 原子锁->MVCC多版本\n2. 增加锁上可并行线程数\n  * 读锁写锁分离，允许并行读取数据\n  * 多线程并行读取\n3. 乐观锁/悲观锁\n  * **悲观锁**-适合并发争抢比较严重的场景\n      > 是线程到blocking状态,通知信息OK状态切换回等待状态,需要不停的换入换出.\n  * **乐观锁**-适合并发争抢比较不太严重的场\n\n### 事务单元扩展\n**Tow Phase lock(2PL)**\n\n### 死锁扩展-U锁\n**更新锁-更新对只读情况，升级写锁**\n\n### MVCC拾遗\n乐观锁并发方案: **让版本低的并发更新回滚**\n>* 优势：并发低时性能好\n>* 代价：并发高时失败率高，需要不断重试\n","slug":"2017-10-28-transactionTwo","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qky002ny4rbosw8bje0","content":"<h3 id=\"隔离性（扩展-MVCC-SNAPSHOT-ISOLATION）\"><a href=\"#隔离性（扩展-MVCC-SNAPSHOT-ISOLATION）\" class=\"headerlink\" title=\"隔离性（扩展:MVCC/SNAPSHOT ISOLATION）\"></a>隔离性（扩展:MVCC/SNAPSHOT ISOLATION）</h3><ul>\n<li>读已提交</li>\n<li>读未提交</li>\n<li>可重复读</li>\n<li>序列化读</li>\n<li>快照隔离界别<blockquote>\n<ul>\n<li>用新的方式实现传统意义上读为提交的场景，同时保证可序列化的隔离级别。</li>\n<li>写&gt;读时会增加系统成本</li>\n<li>Mvcc适合读写比率比较高的情况</li>\n</ul>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"持久性（扩展-持久性保证策略）\"><a href=\"#持久性（扩展-持久性保证策略）\" class=\"headerlink\" title=\"持久性（扩展:持久性保证策略）\"></a>持久性（扩展:持久性保证策略）</h3></li>\n<li><em>RAID*</em></li>\n<li>如何保证数据同时写到两块磁盘</li>\n<li>每一次请求都要刷磁盘性能过低，将请求打包统一发送到快存储<ol>\n<li>直接写入内存<blockquote>\n<ul>\n<li>优点：IOPS高</li>\n<li>缺点：丢数据</li>\n</ul>\n</blockquote>\n</li>\n<li>Group commit<blockquote>\n<ul>\n<li>优点：保证系统的持久性和吞吐量</li>\n<li>缺点:请求延迟提升</li>\n</ul>\n</blockquote>\n</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"单机事务的典型异常应对策略\"><a href=\"#单机事务的典型异常应对策略\" class=\"headerlink\" title=\"单机事务的典型异常应对策略\"></a>单机事务的典型异常应对策略</h3><ul>\n<li>业务属性不匹配-回滚</li>\n<li>系统DOWN机回复<ul>\n<li><strong>重启后进入recovery</strong><blockquote>\n<ul>\n<li>提交后的事务单元继续完成提交</li>\n<li>未提交事务单元回滚</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"事务的调优原则\"><a href=\"#事务的调优原则\" class=\"headerlink\" title=\"事务的调优原则\"></a>事务的调优原则</h3><ol>\n<li>在不影响业务应用的前提下<ul>\n<li>减少锁的覆盖范围</li>\n<li>Myisam表锁-&gt;Innodb行锁</li>\n<li>原子锁-&gt;MVCC多版本</li>\n</ul>\n</li>\n<li>增加锁上可并行线程数<ul>\n<li>读锁写锁分离，允许并行读取数据</li>\n<li>多线程并行读取</li>\n</ul>\n</li>\n<li>乐观锁/悲观锁<ul>\n<li><strong>悲观锁</strong>-适合并发争抢比较严重的场景<blockquote>\n<p>是线程到blocking状态,通知信息OK状态切换回等待状态,需要不停的换入换出.</p>\n</blockquote>\n</li>\n<li><strong>乐观锁</strong>-适合并发争抢比较不太严重的场</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"事务单元扩展\"><a href=\"#事务单元扩展\" class=\"headerlink\" title=\"事务单元扩展\"></a>事务单元扩展</h3><p><strong>Tow Phase lock(2PL)</strong></p>\n<h3 id=\"死锁扩展-U锁\"><a href=\"#死锁扩展-U锁\" class=\"headerlink\" title=\"死锁扩展-U锁\"></a>死锁扩展-U锁</h3><p><strong>更新锁-更新对只读情况，升级写锁</strong></p>\n<h3 id=\"MVCC拾遗\"><a href=\"#MVCC拾遗\" class=\"headerlink\" title=\"MVCC拾遗\"></a>MVCC拾遗</h3><p>乐观锁并发方案: <strong>让版本低的并发更新回滚</strong></p>\n<blockquote>\n<ul>\n<li>优势：并发低时性能好</li>\n<li>代价：并发高时失败率高，需要不断重试</li>\n</ul>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h3 id=\"隔离性（扩展-MVCC-SNAPSHOT-ISOLATION）\"><a href=\"#隔离性（扩展-MVCC-SNAPSHOT-ISOLATION）\" class=\"headerlink\" title=\"隔离性（扩展:MVCC/SNAPSHOT ISOLATION）\"></a>隔离性（扩展:MVCC/SNAPSHOT ISOLATION）</h3><ul>\n<li>读已提交</li>\n<li>读未提交</li>\n<li>可重复读</li>\n<li>序列化读</li>\n<li>快照隔离界别<blockquote>\n<ul>\n<li>用新的方式实现传统意义上读为提交的场景，同时保证可序列化的隔离级别。</li>\n<li>写&gt;读时会增加系统成本</li>\n<li>Mvcc适合读写比率比较高的情况</li>\n</ul>\n</blockquote>","more":"<h3 id=\"持久性（扩展-持久性保证策略）\"><a href=\"#持久性（扩展-持久性保证策略）\" class=\"headerlink\" title=\"持久性（扩展:持久性保证策略）\"></a>持久性（扩展:持久性保证策略）</h3></li>\n<li><em>RAID*</em></li>\n<li>如何保证数据同时写到两块磁盘</li>\n<li>每一次请求都要刷磁盘性能过低，将请求打包统一发送到快存储<ol>\n<li>直接写入内存<blockquote>\n<ul>\n<li>优点：IOPS高</li>\n<li>缺点：丢数据</li>\n</ul>\n</blockquote>\n</li>\n<li>Group commit<blockquote>\n<ul>\n<li>优点：保证系统的持久性和吞吐量</li>\n<li>缺点:请求延迟提升</li>\n</ul>\n</blockquote>\n</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"单机事务的典型异常应对策略\"><a href=\"#单机事务的典型异常应对策略\" class=\"headerlink\" title=\"单机事务的典型异常应对策略\"></a>单机事务的典型异常应对策略</h3><ul>\n<li>业务属性不匹配-回滚</li>\n<li>系统DOWN机回复<ul>\n<li><strong>重启后进入recovery</strong><blockquote>\n<ul>\n<li>提交后的事务单元继续完成提交</li>\n<li>未提交事务单元回滚</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"事务的调优原则\"><a href=\"#事务的调优原则\" class=\"headerlink\" title=\"事务的调优原则\"></a>事务的调优原则</h3><ol>\n<li>在不影响业务应用的前提下<ul>\n<li>减少锁的覆盖范围</li>\n<li>Myisam表锁-&gt;Innodb行锁</li>\n<li>原子锁-&gt;MVCC多版本</li>\n</ul>\n</li>\n<li>增加锁上可并行线程数<ul>\n<li>读锁写锁分离，允许并行读取数据</li>\n<li>多线程并行读取</li>\n</ul>\n</li>\n<li>乐观锁/悲观锁<ul>\n<li><strong>悲观锁</strong>-适合并发争抢比较严重的场景<blockquote>\n<p>是线程到blocking状态,通知信息OK状态切换回等待状态,需要不停的换入换出.</p>\n</blockquote>\n</li>\n<li><strong>乐观锁</strong>-适合并发争抢比较不太严重的场</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"事务单元扩展\"><a href=\"#事务单元扩展\" class=\"headerlink\" title=\"事务单元扩展\"></a>事务单元扩展</h3><p><strong>Tow Phase lock(2PL)</strong></p>\n<h3 id=\"死锁扩展-U锁\"><a href=\"#死锁扩展-U锁\" class=\"headerlink\" title=\"死锁扩展-U锁\"></a>死锁扩展-U锁</h3><p><strong>更新锁-更新对只读情况，升级写锁</strong></p>\n<h3 id=\"MVCC拾遗\"><a href=\"#MVCC拾遗\" class=\"headerlink\" title=\"MVCC拾遗\"></a>MVCC拾遗</h3><p>乐观锁并发方案: <strong>让版本低的并发更新回滚</strong></p>\n<blockquote>\n<ul>\n<li>优势：并发低时性能好</li>\n<li>代价：并发高时失败率高，需要不断重试</li>\n</ul>\n</blockquote>"},{"title":"找数字-网易校招","date":"2017-02-05T17:00:00.000Z","updated":"2017-02-05T17:00:00.000Z","comments":1,"_content":"\n## 题目描述\n\n**给定一个数组，除了第一个出现1次之外，其余全都出现3次。找出出现一次的值。如：{1, 2, 1, 2, 1, 2, 7}, 找出7.**\n\n<!-- more -->\n\n## 分析与解法\n\n我们以数组`[1, 2, 3, 1, 2, 1, 2]`举例，将数组元素用二进制表示：<br/>\n\n~~~\n0 1\n1 0\n1 1\n0 1\n1 0\n0 1\n1 0\n~~~\n\n如果理解了上题，此题的思路似乎也就呼之欲出了。我们也可以按位运算，计算1 bit的数量，如果每个数字都出现三次，那么每位上的1 bit数量肯定是3的倍数，相反如果不是3的倍数，那么就是那个特殊的数在捣蛋。<br/>\n\n我们似乎需要这么一种“加法”运算，使得每位上的 1 bit 数量能够得到累计，并且累计到了3就自动清零。但是理想是美好的，现实是残酷的，并没有这样一种神奇的运算（三进制？）。<br/>\n\n但是我们可以用一个数“辅助”，因为每一位的1 bit数量统计都是类似的，所以假设正在统计某一位的1 bit数量。我们用`a`来表示 1 bit 的数量，当 1 bit的数量为0时，a=0；当数量为1时，a=1；当数量为2时，a=2？非也，位运算只能表示0和1，所以这时我们引进第二个变量b，我们用b=1来代表已经有了2个 1 bit，所以当有两个 1 bit 时，a=0,b=1。数量统计结果逢3化0，所以只有0、1、2三种结果：<br/>\n\n~~~\nbits数量 a b\n   0     0 0\n   1     1 0\n   2     0 1\n~~~\n\n思路也就显而易见了，每次运算我们维护a和b的值，运算到最后即可得到结果：<br/>\n\n~~~ php\n$c = array(1, 2, 1, 2, 1, 2, 7);\n$a = 0;\n$b = 0;\nfor ($i=0; $i < count($c); $i++) { \n    $b = $a & ($b ^ $c[$i]);\n    $a = $b | ($a ^ $c[$i]);\n}\necho $a; 7\n~~~\n","source":"_posts/2017-2-05-FindNumber .md","raw":"---\ntitle:   \"找数字-网易校招\"\ndate: 2017-2-05 12:00:00\nupdated: 2017-2-05 12:00:00\ncomments: true\ncategories: 算法\ntags:\n    - PHP\n    - 算法\n---\n\n## 题目描述\n\n**给定一个数组，除了第一个出现1次之外，其余全都出现3次。找出出现一次的值。如：{1, 2, 1, 2, 1, 2, 7}, 找出7.**\n\n<!-- more -->\n\n## 分析与解法\n\n我们以数组`[1, 2, 3, 1, 2, 1, 2]`举例，将数组元素用二进制表示：<br/>\n\n~~~\n0 1\n1 0\n1 1\n0 1\n1 0\n0 1\n1 0\n~~~\n\n如果理解了上题，此题的思路似乎也就呼之欲出了。我们也可以按位运算，计算1 bit的数量，如果每个数字都出现三次，那么每位上的1 bit数量肯定是3的倍数，相反如果不是3的倍数，那么就是那个特殊的数在捣蛋。<br/>\n\n我们似乎需要这么一种“加法”运算，使得每位上的 1 bit 数量能够得到累计，并且累计到了3就自动清零。但是理想是美好的，现实是残酷的，并没有这样一种神奇的运算（三进制？）。<br/>\n\n但是我们可以用一个数“辅助”，因为每一位的1 bit数量统计都是类似的，所以假设正在统计某一位的1 bit数量。我们用`a`来表示 1 bit 的数量，当 1 bit的数量为0时，a=0；当数量为1时，a=1；当数量为2时，a=2？非也，位运算只能表示0和1，所以这时我们引进第二个变量b，我们用b=1来代表已经有了2个 1 bit，所以当有两个 1 bit 时，a=0,b=1。数量统计结果逢3化0，所以只有0、1、2三种结果：<br/>\n\n~~~\nbits数量 a b\n   0     0 0\n   1     1 0\n   2     0 1\n~~~\n\n思路也就显而易见了，每次运算我们维护a和b的值，运算到最后即可得到结果：<br/>\n\n~~~ php\n$c = array(1, 2, 1, 2, 1, 2, 7);\n$a = 0;\n$b = 0;\nfor ($i=0; $i < count($c); $i++) { \n    $b = $a & ($b ^ $c[$i]);\n    $a = $b | ($a ^ $c[$i]);\n}\necho $a; 7\n~~~\n","slug":"2017-2-05-FindNumber ","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qkz002sy4rbw7r9fam2","content":"<h2 id=\"题目描述\"><a href=\"#题目描述\" class=\"headerlink\" title=\"题目描述\"></a>题目描述</h2><p><strong>给定一个数组，除了第一个出现1次之外，其余全都出现3次。找出出现一次的值。如：{1, 2, 1, 2, 1, 2, 7}, 找出7.</strong></p>\n<a id=\"more\"></a>\n\n<h2 id=\"分析与解法\"><a href=\"#分析与解法\" class=\"headerlink\" title=\"分析与解法\"></a>分析与解法</h2><p>我们以数组<code>[1, 2, 3, 1, 2, 1, 2]</code>举例，将数组元素用二进制表示：<br></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 1</span><br><span class=\"line\">1 0</span><br><span class=\"line\">1 1</span><br><span class=\"line\">0 1</span><br><span class=\"line\">1 0</span><br><span class=\"line\">0 1</span><br><span class=\"line\">1 0</span><br></pre></td></tr></table></figure>\n\n<p>如果理解了上题，此题的思路似乎也就呼之欲出了。我们也可以按位运算，计算1 bit的数量，如果每个数字都出现三次，那么每位上的1 bit数量肯定是3的倍数，相反如果不是3的倍数，那么就是那个特殊的数在捣蛋。<br></p>\n<p>我们似乎需要这么一种“加法”运算，使得每位上的 1 bit 数量能够得到累计，并且累计到了3就自动清零。但是理想是美好的，现实是残酷的，并没有这样一种神奇的运算（三进制？）。<br></p>\n<p>但是我们可以用一个数“辅助”，因为每一位的1 bit数量统计都是类似的，所以假设正在统计某一位的1 bit数量。我们用<code>a</code>来表示 1 bit 的数量，当 1 bit的数量为0时，a=0；当数量为1时，a=1；当数量为2时，a=2？非也，位运算只能表示0和1，所以这时我们引进第二个变量b，我们用b=1来代表已经有了2个 1 bit，所以当有两个 1 bit 时，a=0,b=1。数量统计结果逢3化0，所以只有0、1、2三种结果：<br></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bits数量 a b</span><br><span class=\"line\">   0     0 0</span><br><span class=\"line\">   1     1 0</span><br><span class=\"line\">   2     0 1</span><br></pre></td></tr></table></figure>\n\n<p>思路也就显而易见了，每次运算我们维护a和b的值，运算到最后即可得到结果：<br></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$c = <span class=\"keyword\">array</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">7</span>);</span><br><span class=\"line\">$a = <span class=\"number\">0</span>;</span><br><span class=\"line\">$b = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i=<span class=\"number\">0</span>; $i &lt; count($c); $i++) &#123; </span><br><span class=\"line\">    $b = $a &amp; ($b ^ $c[$i]);</span><br><span class=\"line\">    $a = $b | ($a ^ $c[$i]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $a; <span class=\"number\">7</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"题目描述\"><a href=\"#题目描述\" class=\"headerlink\" title=\"题目描述\"></a>题目描述</h2><p><strong>给定一个数组，除了第一个出现1次之外，其余全都出现3次。找出出现一次的值。如：{1, 2, 1, 2, 1, 2, 7}, 找出7.</strong></p>","more":"<h2 id=\"分析与解法\"><a href=\"#分析与解法\" class=\"headerlink\" title=\"分析与解法\"></a>分析与解法</h2><p>我们以数组<code>[1, 2, 3, 1, 2, 1, 2]</code>举例，将数组元素用二进制表示：<br></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 1</span><br><span class=\"line\">1 0</span><br><span class=\"line\">1 1</span><br><span class=\"line\">0 1</span><br><span class=\"line\">1 0</span><br><span class=\"line\">0 1</span><br><span class=\"line\">1 0</span><br></pre></td></tr></table></figure>\n\n<p>如果理解了上题，此题的思路似乎也就呼之欲出了。我们也可以按位运算，计算1 bit的数量，如果每个数字都出现三次，那么每位上的1 bit数量肯定是3的倍数，相反如果不是3的倍数，那么就是那个特殊的数在捣蛋。<br></p>\n<p>我们似乎需要这么一种“加法”运算，使得每位上的 1 bit 数量能够得到累计，并且累计到了3就自动清零。但是理想是美好的，现实是残酷的，并没有这样一种神奇的运算（三进制？）。<br></p>\n<p>但是我们可以用一个数“辅助”，因为每一位的1 bit数量统计都是类似的，所以假设正在统计某一位的1 bit数量。我们用<code>a</code>来表示 1 bit 的数量，当 1 bit的数量为0时，a=0；当数量为1时，a=1；当数量为2时，a=2？非也，位运算只能表示0和1，所以这时我们引进第二个变量b，我们用b=1来代表已经有了2个 1 bit，所以当有两个 1 bit 时，a=0,b=1。数量统计结果逢3化0，所以只有0、1、2三种结果：<br></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bits数量 a b</span><br><span class=\"line\">   0     0 0</span><br><span class=\"line\">   1     1 0</span><br><span class=\"line\">   2     0 1</span><br></pre></td></tr></table></figure>\n\n<p>思路也就显而易见了，每次运算我们维护a和b的值，运算到最后即可得到结果：<br></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$c = <span class=\"keyword\">array</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">7</span>);</span><br><span class=\"line\">$a = <span class=\"number\">0</span>;</span><br><span class=\"line\">$b = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i=<span class=\"number\">0</span>; $i &lt; count($c); $i++) &#123; </span><br><span class=\"line\">    $b = $a &amp; ($b ^ $c[$i]);</span><br><span class=\"line\">    $a = $b | ($a ^ $c[$i]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $a; <span class=\"number\">7</span></span><br></pre></td></tr></table></figure>"},{"title":"laradock到laravel","date":"2018-03-12T16:00:00.000Z","updated":"2018-03-12T16:00:00.000Z","comments":1,"_content":"\nDocker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。\n <!-- more -->\n\n### 前置依赖\n* Git\n* Docker（最新版本）\n* Docker-Compose\n\n```bash\n# step 1: 安装必要的一些系统工具\nsudo apt-get update\nsudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common\n# step 2: 安装GPG证书\ncurl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -\n# Step 3: 写入软件源信息\nsudo add-apt-repository \"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\"\n# Step 4: 更新并安装 Docker-CE\nsudo apt-get -y update\nsudo apt-get -y install docker-ce\n\n```\n\n### `laradock`\n1 -下载`laradock`\n```bash\ngit clone https://github.com/Laradock/laradock.git\n```\n2 -创建配置文件\n```bash\ncd laradock\ncp env-example .env\n```\n3 -更换docker源\n\n```bash\nsudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\"https://pg6cpimx.mirror.aliyuncs.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n4 -启动服务\n```bash\ndocker-compose up -d nginx mysql redis\n```\n5 -访问你的网站 http://127.0.0.1\n\n6 -停止容器\n```bash\ndocker-composer down\n```\n\n### `laravel`\n\n1 -查看容器并进入容器\n```bash\ndocker-compose ps\ndocker-compose exec workspace bash\n```\n2 -更改`composer`源\n```bash\n# 修改composer.json文件\n\"repositories\": {\n        \"packagist\": {\n            \"type\": \"composer\",\n            \"url\": \"https://packagist.phpcomposer.com\"\n        }\n    }\n```\n3 -`composer`安装`laravel`安装器\n```bash\ncomposer global require \"laravel/installer\"\n```\n4 -创建`laravel`项目`blog`\n```bash\n/root/.composer/vendor/bin/laravel new blog\n```\n5 -退出容器\n```bash\nexit\n```\n6 -配置域名并访问`laravel`\n\n```bash\n# 修改配置文件 laradock/nginx/sites/laravel.conf\ncd nginx/sites/\ncp laravel.conf.example laravel.conf\n# 修改配置\nroot /var/www/blog/public;\n# 修改本地hosts文件\nvi /etc/hosts\n# 添加\n127.0.0.1       laravel.test\n```\n7 -重启容器\n```bash\ndocker-compose restart\n```\n\n现在可以访问 http://laravel.test/ 看到你的`laravel`项目了！\n\n# Ps:\n**MySQL没有指定镜像源**\n```bash\ndocker-composer up -d mysql\nERROR: Service ‘mysql’ failed to build: Please provide a source image with `from` prior to commit\n```\n\n> 请更换docker的源。（阿里源可用）\n\n**MySQL连不上或者提示密码错误**\n```bash\n#2002 - php_network_getaddresses: getaddrinfo failed: Name does not resolve &mdash; The server is not responding (or the local server's socket is not correctly configured).\n```\n\n> 8.0默认加密方式导致的，更换MySQL版本。 <br/>\n> laradock/.evn MYSQL_VERSION=5.7 <br/>\n> docker-compose build mysql <br/>\n> 更改DATA_SAVE_PATH=~/.laradock/data目录权限。\n","source":"_posts/2018-03-12-Laradock .md","raw":"---\ntitle:  \"laradock到laravel\"\ndate: 2018-03-12 12:00:00\nupdated: 2018-03-12 12:00:00\ncomments: true\ncategories: 容器\ntags:\n    - Docker\n---\n\nDocker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。\n <!-- more -->\n\n### 前置依赖\n* Git\n* Docker（最新版本）\n* Docker-Compose\n\n```bash\n# step 1: 安装必要的一些系统工具\nsudo apt-get update\nsudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common\n# step 2: 安装GPG证书\ncurl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -\n# Step 3: 写入软件源信息\nsudo add-apt-repository \"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\"\n# Step 4: 更新并安装 Docker-CE\nsudo apt-get -y update\nsudo apt-get -y install docker-ce\n\n```\n\n### `laradock`\n1 -下载`laradock`\n```bash\ngit clone https://github.com/Laradock/laradock.git\n```\n2 -创建配置文件\n```bash\ncd laradock\ncp env-example .env\n```\n3 -更换docker源\n\n```bash\nsudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\"https://pg6cpimx.mirror.aliyuncs.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n4 -启动服务\n```bash\ndocker-compose up -d nginx mysql redis\n```\n5 -访问你的网站 http://127.0.0.1\n\n6 -停止容器\n```bash\ndocker-composer down\n```\n\n### `laravel`\n\n1 -查看容器并进入容器\n```bash\ndocker-compose ps\ndocker-compose exec workspace bash\n```\n2 -更改`composer`源\n```bash\n# 修改composer.json文件\n\"repositories\": {\n        \"packagist\": {\n            \"type\": \"composer\",\n            \"url\": \"https://packagist.phpcomposer.com\"\n        }\n    }\n```\n3 -`composer`安装`laravel`安装器\n```bash\ncomposer global require \"laravel/installer\"\n```\n4 -创建`laravel`项目`blog`\n```bash\n/root/.composer/vendor/bin/laravel new blog\n```\n5 -退出容器\n```bash\nexit\n```\n6 -配置域名并访问`laravel`\n\n```bash\n# 修改配置文件 laradock/nginx/sites/laravel.conf\ncd nginx/sites/\ncp laravel.conf.example laravel.conf\n# 修改配置\nroot /var/www/blog/public;\n# 修改本地hosts文件\nvi /etc/hosts\n# 添加\n127.0.0.1       laravel.test\n```\n7 -重启容器\n```bash\ndocker-compose restart\n```\n\n现在可以访问 http://laravel.test/ 看到你的`laravel`项目了！\n\n# Ps:\n**MySQL没有指定镜像源**\n```bash\ndocker-composer up -d mysql\nERROR: Service ‘mysql’ failed to build: Please provide a source image with `from` prior to commit\n```\n\n> 请更换docker的源。（阿里源可用）\n\n**MySQL连不上或者提示密码错误**\n```bash\n#2002 - php_network_getaddresses: getaddrinfo failed: Name does not resolve &mdash; The server is not responding (or the local server's socket is not correctly configured).\n```\n\n> 8.0默认加密方式导致的，更换MySQL版本。 <br/>\n> laradock/.evn MYSQL_VERSION=5.7 <br/>\n> docker-compose build mysql <br/>\n> 更改DATA_SAVE_PATH=~/.laradock/data目录权限。\n","slug":"2018-03-12-Laradock ","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1ql0002vy4rb9i8b6yv8","content":"<p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。<br> <a id=\"more\"></a></p>\n<h3 id=\"前置依赖\"><a href=\"#前置依赖\" class=\"headerlink\" title=\"前置依赖\"></a>前置依赖</h3><ul>\n<li>Git</li>\n<li>Docker（最新版本）</li>\n<li>Docker-Compose</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># step 1: 安装必要的一些系统工具</span></span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common</span><br><span class=\"line\"><span class=\"comment\"># step 2: 安装GPG证书</span></span><br><span class=\"line\">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class=\"line\"><span class=\"comment\"># Step 3: 写入软件源信息</span></span><br><span class=\"line\">sudo add-apt-repository <span class=\"string\">\"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class=\"variable\">$(lsb_release -cs)</span> stable\"</span></span><br><span class=\"line\"><span class=\"comment\"># Step 4: 更新并安装 Docker-CE</span></span><br><span class=\"line\">sudo apt-get -y update</span><br><span class=\"line\">sudo apt-get -y install docker-ce</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"laradock\"><a href=\"#laradock\" class=\"headerlink\" title=\"laradock\"></a><code>laradock</code></h3><p>1 -下载<code>laradock</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/Laradock/laradock.git</span><br></pre></td></tr></table></figure>\n\n<p>2 -创建配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> laradock</span><br><span class=\"line\">cp env-example .env</span><br></pre></td></tr></table></figure>\n\n<p>3 -更换docker源</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /etc/docker</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class=\"string\">'EOF'</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"registry-mirrors\"</span>: [<span class=\"string\">\"https://pg6cpimx.mirror.aliyuncs.com\"</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<p>4 -启动服务</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d nginx mysql redis</span><br></pre></td></tr></table></figure>\n\n<p>5 -访问你的网站 <a href=\"http://127.0.0.1\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1</a></p>\n<p>6 -停止容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-composer down</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"laravel\"><a href=\"#laravel\" class=\"headerlink\" title=\"laravel\"></a><code>laravel</code></h3><p>1 -查看容器并进入容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose ps</span><br><span class=\"line\">docker-compose <span class=\"built_in\">exec</span> workspace bash</span><br></pre></td></tr></table></figure>\n\n<p>2 -更改<code>composer</code>源</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改composer.json文件</span></span><br><span class=\"line\"><span class=\"string\">\"repositories\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"packagist\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"type\"</span>: <span class=\"string\">\"composer\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"url\"</span>: <span class=\"string\">\"https://packagist.phpcomposer.com\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>3 -<code>composer</code>安装<code>laravel</code>安装器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">composer global require <span class=\"string\">\"laravel/installer\"</span></span><br></pre></td></tr></table></figure>\n\n<p>4 -创建<code>laravel</code>项目<code>blog</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/.composer/vendor/bin/laravel new blog</span><br></pre></td></tr></table></figure>\n\n<p>5 -退出容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure>\n\n<p>6 -配置域名并访问<code>laravel</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改配置文件 laradock/nginx/sites/laravel.conf</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> nginx/sites/</span><br><span class=\"line\">cp laravel.conf.example laravel.conf</span><br><span class=\"line\"><span class=\"comment\"># 修改配置</span></span><br><span class=\"line\">root /var/www/blog/public;</span><br><span class=\"line\"><span class=\"comment\"># 修改本地hosts文件</span></span><br><span class=\"line\">vi /etc/hosts</span><br><span class=\"line\"><span class=\"comment\"># 添加</span></span><br><span class=\"line\">127.0.0.1       laravel.test</span><br></pre></td></tr></table></figure>\n\n<p>7 -重启容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose restart</span><br></pre></td></tr></table></figure>\n\n<p>现在可以访问 <a href=\"http://laravel.test/\" target=\"_blank\" rel=\"noopener\">http://laravel.test/</a> 看到你的<code>laravel</code>项目了！</p>\n<h1 id=\"Ps\"><a href=\"#Ps\" class=\"headerlink\" title=\"Ps:\"></a>Ps:</h1><p><strong>MySQL没有指定镜像源</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-composer up -d mysql</span><br><span class=\"line\">ERROR: Service ‘mysql’ failed to build: Please provide a <span class=\"built_in\">source</span> image with `from` prior to commit</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>请更换docker的源。（阿里源可用）</p>\n</blockquote>\n<p><strong>MySQL连不上或者提示密码错误</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#2002 - php_network_getaddresses: getaddrinfo failed: Name does not resolve &amp;mdash; The server is not responding (or the local server's socket is not correctly configured).</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>8.0默认加密方式导致的，更换MySQL版本。 <br><br>laradock/.evn MYSQL_VERSION=5.7 <br><br>docker-compose build mysql <br><br>更改DATA_SAVE_PATH=~/.laradock/data目录权限。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。<br>","more":"</p>\n<h3 id=\"前置依赖\"><a href=\"#前置依赖\" class=\"headerlink\" title=\"前置依赖\"></a>前置依赖</h3><ul>\n<li>Git</li>\n<li>Docker（最新版本）</li>\n<li>Docker-Compose</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># step 1: 安装必要的一些系统工具</span></span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common</span><br><span class=\"line\"><span class=\"comment\"># step 2: 安装GPG证书</span></span><br><span class=\"line\">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class=\"line\"><span class=\"comment\"># Step 3: 写入软件源信息</span></span><br><span class=\"line\">sudo add-apt-repository <span class=\"string\">\"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class=\"variable\">$(lsb_release -cs)</span> stable\"</span></span><br><span class=\"line\"><span class=\"comment\"># Step 4: 更新并安装 Docker-CE</span></span><br><span class=\"line\">sudo apt-get -y update</span><br><span class=\"line\">sudo apt-get -y install docker-ce</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"laradock\"><a href=\"#laradock\" class=\"headerlink\" title=\"laradock\"></a><code>laradock</code></h3><p>1 -下载<code>laradock</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/Laradock/laradock.git</span><br></pre></td></tr></table></figure>\n\n<p>2 -创建配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> laradock</span><br><span class=\"line\">cp env-example .env</span><br></pre></td></tr></table></figure>\n\n<p>3 -更换docker源</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /etc/docker</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class=\"string\">'EOF'</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"registry-mirrors\"</span>: [<span class=\"string\">\"https://pg6cpimx.mirror.aliyuncs.com\"</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<p>4 -启动服务</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d nginx mysql redis</span><br></pre></td></tr></table></figure>\n\n<p>5 -访问你的网站 <a href=\"http://127.0.0.1\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1</a></p>\n<p>6 -停止容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-composer down</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"laravel\"><a href=\"#laravel\" class=\"headerlink\" title=\"laravel\"></a><code>laravel</code></h3><p>1 -查看容器并进入容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose ps</span><br><span class=\"line\">docker-compose <span class=\"built_in\">exec</span> workspace bash</span><br></pre></td></tr></table></figure>\n\n<p>2 -更改<code>composer</code>源</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改composer.json文件</span></span><br><span class=\"line\"><span class=\"string\">\"repositories\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"packagist\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"type\"</span>: <span class=\"string\">\"composer\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"url\"</span>: <span class=\"string\">\"https://packagist.phpcomposer.com\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>3 -<code>composer</code>安装<code>laravel</code>安装器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">composer global require <span class=\"string\">\"laravel/installer\"</span></span><br></pre></td></tr></table></figure>\n\n<p>4 -创建<code>laravel</code>项目<code>blog</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/.composer/vendor/bin/laravel new blog</span><br></pre></td></tr></table></figure>\n\n<p>5 -退出容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure>\n\n<p>6 -配置域名并访问<code>laravel</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改配置文件 laradock/nginx/sites/laravel.conf</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> nginx/sites/</span><br><span class=\"line\">cp laravel.conf.example laravel.conf</span><br><span class=\"line\"><span class=\"comment\"># 修改配置</span></span><br><span class=\"line\">root /var/www/blog/public;</span><br><span class=\"line\"><span class=\"comment\"># 修改本地hosts文件</span></span><br><span class=\"line\">vi /etc/hosts</span><br><span class=\"line\"><span class=\"comment\"># 添加</span></span><br><span class=\"line\">127.0.0.1       laravel.test</span><br></pre></td></tr></table></figure>\n\n<p>7 -重启容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose restart</span><br></pre></td></tr></table></figure>\n\n<p>现在可以访问 <a href=\"http://laravel.test/\" target=\"_blank\" rel=\"noopener\">http://laravel.test/</a> 看到你的<code>laravel</code>项目了！</p>\n<h1 id=\"Ps\"><a href=\"#Ps\" class=\"headerlink\" title=\"Ps:\"></a>Ps:</h1><p><strong>MySQL没有指定镜像源</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-composer up -d mysql</span><br><span class=\"line\">ERROR: Service ‘mysql’ failed to build: Please provide a <span class=\"built_in\">source</span> image with `from` prior to commit</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>请更换docker的源。（阿里源可用）</p>\n</blockquote>\n<p><strong>MySQL连不上或者提示密码错误</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#2002 - php_network_getaddresses: getaddrinfo failed: Name does not resolve &amp;mdash; The server is not responding (or the local server's socket is not correctly configured).</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>8.0默认加密方式导致的，更换MySQL版本。 <br><br>laradock/.evn MYSQL_VERSION=5.7 <br><br>docker-compose build mysql <br><br>更改DATA_SAVE_PATH=~/.laradock/data目录权限。</p>\n</blockquote>"},{"title":"Apache内存溢出的分析与解决","date":"2018-06-13T07:00:00.000Z","updated":"2018-06-27T16:00:00.000Z","comments":1,"_content":"# 总结\nApache长时间占用内存大的问题的根本原因在MySQL查询时间过长。请开启**慢查询**功能，去解决!\n\n修改Apache治标不治本~\n\n <!-- more -->\n \n查看版本\n```bash\nhttpd -v\n\nServer version: Apache/2.4.29 (Unix)\nServer built:   Jan 11 2018 22:38:20\n```\n\n修改Apache在prefork工作模式参数\n```bash\nsudo vi /usr/local/httpd/conf/extra/httpd-mpm.conf\n```\n\n\n具体:\n```bash\n# prefork MPM\n<IfModule mpm_prefork_module>\nStartServers             5\n#apache启动时候默认开始的子进程数\nMinSpareServers          5\n#最小的闲置子进程数\nMaxSpareServers         10\n#最大的闲置子进程数\nMaxRequestWorkers      250\n#MaxRequestWorkers设置了允许同时的最大接入请求数量。任何超过MaxRequestWorkers限制的请求将进入等候队列在apache2.3.1以前的版本MaxRequestWorkers被称为MaxClients旧的名字仍旧被支持。\nMaxConnectionsPerChild   100  #重点!\n#设置的是每个子进程可处理的请求数。每个子进程在处理了“MaxConnectionsPerChild”个请求后将自动销毁。0意味着无限即子进程永不销毁。虽然缺省设为0可以使每个子进程处理更多的请求但如果设成非零值也有两点重要的好处1、可防止意外的内存泄漏。2、在服务器负载下降的时侯会自动减少子进程数。因此可根据服务器的负载来调整这个值。在Apache2.3.9之前称之为MaxRequestsPerChild。\n</IfModule>\n```\n\n重启apache\n```bash\n/etc/init.d/httpd restart\n```\n\n## 注1:\nMaxRequestWorkers是这些指令中最为重要的一个设定的是 Apache可以同时处理的请求是对Apache性能影响最大的参数。如果请求总数已达到这个值可通过`ps -ef|grep http|wc -l`来确认那么后面的请求就要排队直到某个已处理请求完毕。这就是系统资源还剩下很多而HTTP访问却很慢的主要原因。虽然理论上这个值越大可以处理的请求就越多建议将初始值设为(以Mb为单位的最大物理内存/2),然后根据负载情况进行动态调整。比如一台4G内存的机器那么初始值就是4000/2=2000。\ns\n## 注2:\nprefork 控制进程在最初建立“StartServers”个子进程后为了满足MinSpareServers设置的需要创建一个进程等待一秒钟继续创建两 个再等待一秒钟继续创建四个……如此按指数级增加创建的进程数最多达到每秒32个直到满足MinSpareServers设置的值为止。这种模式 可以不必在请求到来时再产生新的进程从而减小了系统开销以增加性能。MaxSpareServers设置了最大的空闲进程数如果空闲进程数大于这个 值Apache会自动kill掉一些多余进程。这个值不要设得过大但如果设的值比MinSpareServers小Apache会自动把其调整为 MinSpareServers+1。如果站点负载较大可考虑同时加大MinSpareServers和MaxSpareServers。  \n\n## 注3:\nServerLimit和MaxClientsMaxRequestWorkers有什么区别呢?\n\n是因为在apache1时代控制最大进程数只有MaxClients这个参数并且这个参数最大值为256并且是写死了的试图设置为超过256是无效的这是由于apache1时代的服务器硬件限制的。但是apache2时代由于服务器硬件的升级硬件已经不再是限制所以使用ServerLimit这个参数来控制最大进程数ServerLimit值>=MaxClient值才有效。ServerLimit要放在MaxClients之前值要不小于MaxClients。\n\n\n## 常用命令\n查看请求总数\n```bash\nps -ef|grep http|wc -l \n```\n\n查看平均负载(loadavg)\n```bash\n$cat /proc/loadavg \n```\n\n查看TCP连接数\n```bash\nnetstat -ant | grep :80 | wc -l \n```\n\n查看系统运行情况\n```bash\ntop \nshift + M \n```\n\n\n","source":"_posts/2018-06-27-OutOfMemory.md","raw":"---\ntitle: \"Apache内存溢出的分析与解决\"\ndate: 2018-06-12 27:00:00\nupdated: 2018-06-27 12:00:00\ncomments: true\ncategories: 服务器\ntags:\n    - Apache\n---\n# 总结\nApache长时间占用内存大的问题的根本原因在MySQL查询时间过长。请开启**慢查询**功能，去解决!\n\n修改Apache治标不治本~\n\n <!-- more -->\n \n查看版本\n```bash\nhttpd -v\n\nServer version: Apache/2.4.29 (Unix)\nServer built:   Jan 11 2018 22:38:20\n```\n\n修改Apache在prefork工作模式参数\n```bash\nsudo vi /usr/local/httpd/conf/extra/httpd-mpm.conf\n```\n\n\n具体:\n```bash\n# prefork MPM\n<IfModule mpm_prefork_module>\nStartServers             5\n#apache启动时候默认开始的子进程数\nMinSpareServers          5\n#最小的闲置子进程数\nMaxSpareServers         10\n#最大的闲置子进程数\nMaxRequestWorkers      250\n#MaxRequestWorkers设置了允许同时的最大接入请求数量。任何超过MaxRequestWorkers限制的请求将进入等候队列在apache2.3.1以前的版本MaxRequestWorkers被称为MaxClients旧的名字仍旧被支持。\nMaxConnectionsPerChild   100  #重点!\n#设置的是每个子进程可处理的请求数。每个子进程在处理了“MaxConnectionsPerChild”个请求后将自动销毁。0意味着无限即子进程永不销毁。虽然缺省设为0可以使每个子进程处理更多的请求但如果设成非零值也有两点重要的好处1、可防止意外的内存泄漏。2、在服务器负载下降的时侯会自动减少子进程数。因此可根据服务器的负载来调整这个值。在Apache2.3.9之前称之为MaxRequestsPerChild。\n</IfModule>\n```\n\n重启apache\n```bash\n/etc/init.d/httpd restart\n```\n\n## 注1:\nMaxRequestWorkers是这些指令中最为重要的一个设定的是 Apache可以同时处理的请求是对Apache性能影响最大的参数。如果请求总数已达到这个值可通过`ps -ef|grep http|wc -l`来确认那么后面的请求就要排队直到某个已处理请求完毕。这就是系统资源还剩下很多而HTTP访问却很慢的主要原因。虽然理论上这个值越大可以处理的请求就越多建议将初始值设为(以Mb为单位的最大物理内存/2),然后根据负载情况进行动态调整。比如一台4G内存的机器那么初始值就是4000/2=2000。\ns\n## 注2:\nprefork 控制进程在最初建立“StartServers”个子进程后为了满足MinSpareServers设置的需要创建一个进程等待一秒钟继续创建两 个再等待一秒钟继续创建四个……如此按指数级增加创建的进程数最多达到每秒32个直到满足MinSpareServers设置的值为止。这种模式 可以不必在请求到来时再产生新的进程从而减小了系统开销以增加性能。MaxSpareServers设置了最大的空闲进程数如果空闲进程数大于这个 值Apache会自动kill掉一些多余进程。这个值不要设得过大但如果设的值比MinSpareServers小Apache会自动把其调整为 MinSpareServers+1。如果站点负载较大可考虑同时加大MinSpareServers和MaxSpareServers。  \n\n## 注3:\nServerLimit和MaxClientsMaxRequestWorkers有什么区别呢?\n\n是因为在apache1时代控制最大进程数只有MaxClients这个参数并且这个参数最大值为256并且是写死了的试图设置为超过256是无效的这是由于apache1时代的服务器硬件限制的。但是apache2时代由于服务器硬件的升级硬件已经不再是限制所以使用ServerLimit这个参数来控制最大进程数ServerLimit值>=MaxClient值才有效。ServerLimit要放在MaxClients之前值要不小于MaxClients。\n\n\n## 常用命令\n查看请求总数\n```bash\nps -ef|grep http|wc -l \n```\n\n查看平均负载(loadavg)\n```bash\n$cat /proc/loadavg \n```\n\n查看TCP连接数\n```bash\nnetstat -ant | grep :80 | wc -l \n```\n\n查看系统运行情况\n```bash\ntop \nshift + M \n```\n\n\n","slug":"2018-06-27-OutOfMemory","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1ql10030y4rbm2nuxw04","content":"<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>Apache长时间占用内存大的问题的根本原因在MySQL查询时间过长。请开启<strong>慢查询</strong>功能，去解决!</p>\n<p>修改Apache治标不治本~</p>\n <a id=\"more\"></a>\n\n<p>查看版本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">httpd -v</span><br><span class=\"line\"></span><br><span class=\"line\">Server version: Apache/2.4.29 (Unix)</span><br><span class=\"line\">Server built:   Jan 11 2018 22:38:20</span><br></pre></td></tr></table></figure>\n\n<p>修改Apache在prefork工作模式参数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /usr/<span class=\"built_in\">local</span>/httpd/conf/extra/httpd-mpm.conf</span><br></pre></td></tr></table></figure>\n\n<p>具体:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># prefork MPM</span></span><br><span class=\"line\">&lt;IfModule mpm_prefork_module&gt;</span><br><span class=\"line\">StartServers             5</span><br><span class=\"line\"><span class=\"comment\">#apache启动时候默认开始的子进程数</span></span><br><span class=\"line\">MinSpareServers          5</span><br><span class=\"line\"><span class=\"comment\">#最小的闲置子进程数</span></span><br><span class=\"line\">MaxSpareServers         10</span><br><span class=\"line\"><span class=\"comment\">#最大的闲置子进程数</span></span><br><span class=\"line\">MaxRequestWorkers      250</span><br><span class=\"line\"><span class=\"comment\">#MaxRequestWorkers设置了允许同时的最大接入请求数量。任何超过MaxRequestWorkers限制的请求将进入等候队列在apache2.3.1以前的版本MaxRequestWorkers被称为MaxClients旧的名字仍旧被支持。</span></span><br><span class=\"line\">MaxConnectionsPerChild   100  <span class=\"comment\">#重点!</span></span><br><span class=\"line\"><span class=\"comment\">#设置的是每个子进程可处理的请求数。每个子进程在处理了“MaxConnectionsPerChild”个请求后将自动销毁。0意味着无限即子进程永不销毁。虽然缺省设为0可以使每个子进程处理更多的请求但如果设成非零值也有两点重要的好处1、可防止意外的内存泄漏。2、在服务器负载下降的时侯会自动减少子进程数。因此可根据服务器的负载来调整这个值。在Apache2.3.9之前称之为MaxRequestsPerChild。</span></span><br><span class=\"line\">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>\n\n<p>重启apache</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/httpd restart</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"注1\"><a href=\"#注1\" class=\"headerlink\" title=\"注1:\"></a>注1:</h2><p>MaxRequestWorkers是这些指令中最为重要的一个设定的是 Apache可以同时处理的请求是对Apache性能影响最大的参数。如果请求总数已达到这个值可通过<code>ps -ef|grep http|wc -l</code>来确认那么后面的请求就要排队直到某个已处理请求完毕。这就是系统资源还剩下很多而HTTP访问却很慢的主要原因。虽然理论上这个值越大可以处理的请求就越多建议将初始值设为(以Mb为单位的最大物理内存/2),然后根据负载情况进行动态调整。比如一台4G内存的机器那么初始值就是4000/2=2000。<br>s</p>\n<h2 id=\"注2\"><a href=\"#注2\" class=\"headerlink\" title=\"注2:\"></a>注2:</h2><p>prefork 控制进程在最初建立“StartServers”个子进程后为了满足MinSpareServers设置的需要创建一个进程等待一秒钟继续创建两 个再等待一秒钟继续创建四个……如此按指数级增加创建的进程数最多达到每秒32个直到满足MinSpareServers设置的值为止。这种模式 可以不必在请求到来时再产生新的进程从而减小了系统开销以增加性能。MaxSpareServers设置了最大的空闲进程数如果空闲进程数大于这个 值Apache会自动kill掉一些多余进程。这个值不要设得过大但如果设的值比MinSpareServers小Apache会自动把其调整为 MinSpareServers+1。如果站点负载较大可考虑同时加大MinSpareServers和MaxSpareServers。  </p>\n<h2 id=\"注3\"><a href=\"#注3\" class=\"headerlink\" title=\"注3:\"></a>注3:</h2><p>ServerLimit和MaxClientsMaxRequestWorkers有什么区别呢?</p>\n<p>是因为在apache1时代控制最大进程数只有MaxClients这个参数并且这个参数最大值为256并且是写死了的试图设置为超过256是无效的这是由于apache1时代的服务器硬件限制的。但是apache2时代由于服务器硬件的升级硬件已经不再是限制所以使用ServerLimit这个参数来控制最大进程数ServerLimit值&gt;=MaxClient值才有效。ServerLimit要放在MaxClients之前值要不小于MaxClients。</p>\n<h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><p>查看请求总数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef|grep http|wc -l</span><br></pre></td></tr></table></figure>\n\n<p>查看平均负载(loadavg)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$cat</span> /proc/loadavg</span><br></pre></td></tr></table></figure>\n\n<p>查看TCP连接数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -ant | grep :80 | wc -l</span><br></pre></td></tr></table></figure>\n\n<p>查看系统运行情况</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top </span><br><span class=\"line\"><span class=\"built_in\">shift</span> + M</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>Apache长时间占用内存大的问题的根本原因在MySQL查询时间过长。请开启<strong>慢查询</strong>功能，去解决!</p>\n<p>修改Apache治标不治本~</p>","more":"<p>查看版本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">httpd -v</span><br><span class=\"line\"></span><br><span class=\"line\">Server version: Apache/2.4.29 (Unix)</span><br><span class=\"line\">Server built:   Jan 11 2018 22:38:20</span><br></pre></td></tr></table></figure>\n\n<p>修改Apache在prefork工作模式参数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /usr/<span class=\"built_in\">local</span>/httpd/conf/extra/httpd-mpm.conf</span><br></pre></td></tr></table></figure>\n\n<p>具体:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># prefork MPM</span></span><br><span class=\"line\">&lt;IfModule mpm_prefork_module&gt;</span><br><span class=\"line\">StartServers             5</span><br><span class=\"line\"><span class=\"comment\">#apache启动时候默认开始的子进程数</span></span><br><span class=\"line\">MinSpareServers          5</span><br><span class=\"line\"><span class=\"comment\">#最小的闲置子进程数</span></span><br><span class=\"line\">MaxSpareServers         10</span><br><span class=\"line\"><span class=\"comment\">#最大的闲置子进程数</span></span><br><span class=\"line\">MaxRequestWorkers      250</span><br><span class=\"line\"><span class=\"comment\">#MaxRequestWorkers设置了允许同时的最大接入请求数量。任何超过MaxRequestWorkers限制的请求将进入等候队列在apache2.3.1以前的版本MaxRequestWorkers被称为MaxClients旧的名字仍旧被支持。</span></span><br><span class=\"line\">MaxConnectionsPerChild   100  <span class=\"comment\">#重点!</span></span><br><span class=\"line\"><span class=\"comment\">#设置的是每个子进程可处理的请求数。每个子进程在处理了“MaxConnectionsPerChild”个请求后将自动销毁。0意味着无限即子进程永不销毁。虽然缺省设为0可以使每个子进程处理更多的请求但如果设成非零值也有两点重要的好处1、可防止意外的内存泄漏。2、在服务器负载下降的时侯会自动减少子进程数。因此可根据服务器的负载来调整这个值。在Apache2.3.9之前称之为MaxRequestsPerChild。</span></span><br><span class=\"line\">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>\n\n<p>重启apache</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/httpd restart</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"注1\"><a href=\"#注1\" class=\"headerlink\" title=\"注1:\"></a>注1:</h2><p>MaxRequestWorkers是这些指令中最为重要的一个设定的是 Apache可以同时处理的请求是对Apache性能影响最大的参数。如果请求总数已达到这个值可通过<code>ps -ef|grep http|wc -l</code>来确认那么后面的请求就要排队直到某个已处理请求完毕。这就是系统资源还剩下很多而HTTP访问却很慢的主要原因。虽然理论上这个值越大可以处理的请求就越多建议将初始值设为(以Mb为单位的最大物理内存/2),然后根据负载情况进行动态调整。比如一台4G内存的机器那么初始值就是4000/2=2000。<br>s</p>\n<h2 id=\"注2\"><a href=\"#注2\" class=\"headerlink\" title=\"注2:\"></a>注2:</h2><p>prefork 控制进程在最初建立“StartServers”个子进程后为了满足MinSpareServers设置的需要创建一个进程等待一秒钟继续创建两 个再等待一秒钟继续创建四个……如此按指数级增加创建的进程数最多达到每秒32个直到满足MinSpareServers设置的值为止。这种模式 可以不必在请求到来时再产生新的进程从而减小了系统开销以增加性能。MaxSpareServers设置了最大的空闲进程数如果空闲进程数大于这个 值Apache会自动kill掉一些多余进程。这个值不要设得过大但如果设的值比MinSpareServers小Apache会自动把其调整为 MinSpareServers+1。如果站点负载较大可考虑同时加大MinSpareServers和MaxSpareServers。  </p>\n<h2 id=\"注3\"><a href=\"#注3\" class=\"headerlink\" title=\"注3:\"></a>注3:</h2><p>ServerLimit和MaxClientsMaxRequestWorkers有什么区别呢?</p>\n<p>是因为在apache1时代控制最大进程数只有MaxClients这个参数并且这个参数最大值为256并且是写死了的试图设置为超过256是无效的这是由于apache1时代的服务器硬件限制的。但是apache2时代由于服务器硬件的升级硬件已经不再是限制所以使用ServerLimit这个参数来控制最大进程数ServerLimit值&gt;=MaxClient值才有效。ServerLimit要放在MaxClients之前值要不小于MaxClients。</p>\n<h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><p>查看请求总数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef|grep http|wc -l</span><br></pre></td></tr></table></figure>\n\n<p>查看平均负载(loadavg)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$cat</span> /proc/loadavg</span><br></pre></td></tr></table></figure>\n\n<p>查看TCP连接数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -ant | grep :80 | wc -l</span><br></pre></td></tr></table></figure>\n\n<p>查看系统运行情况</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top </span><br><span class=\"line\"><span class=\"built_in\">shift</span> + M</span><br></pre></td></tr></table></figure>"},{"title":"PHP-数据结构(SAPI)","date":"2018-10-13T04:00:00.000Z","comments":1,"_content":"\n在PHP生命周期的各个阶段，一些与服务相关的操作都是通过SAPI接口实现。这些内置实现的物理位置在PHP源码的SAPI目录。这个目录存放了PHP对各个服务器抽象层的代码，例如命令行程序的实现，Apache的mod_php模块实现以及fastcgi的实现等等。\n <!-- more -->\n\n`SAPI`分别在`FPM`和`CLI`下是如何运行的？\n# SAPI\n```php\ntest.php\n<?php\n    $temp = $_POST;\n    print_r($temp);\n?>\n```\n* FPM\n```c\nstatic sapi_module_struct cgi_sapi_module = {\n    \"fpm_fcgi\",\n    ...\n    sapi_cgibin_ub_write,\n    sapi_cgibin_flush,\n    ...\n    sapi_cgi_read_post,\n    ...\n};\n```\n* CLI\n```c\nstatic sapi_module_struct cgi_sapi_module = {\n    \"cli\",\n    ...\n    sapi_cli_ub_write,\n    sapi_cli_flush,\n    ...\n    NULL,\n    ...\n};\n```\n### sapi模块结构体\n```c\nstruct _sapi_module_struct {\n    char *name;\n    char *pretty_name;\n    \n    int (*startup)(struct _sapi_module_struct *sapi_module);//PHP被调用的时候,这个函数会被调用执行\n    int (*shutdown)(struct _sapi_module_struct *sapi_module);//PHP调用结束的时候,这个函数会被调用执行\n\n    int (*activate)(void);//每个request开始时会执行,进行一些初始化,资源分配的事务\n    int (*deactivate)(void);//每个request结束时会执行\n\n    size_t (*ub_write)(const char *str, size_t str_length);//这个hanlder告诉了Zend,如何输出数据,对于mod_php来说,这个函数提供了一个向response数据写的接口,而CLI只是简单的写到stdout\n    void (*flush)(void *server_context);//这个是提供给zend的刷新缓存的函数句柄,对于CLI来说,只是简单的调用系统提供的fflush;\n    zend_stat_t *(*get_stat)(void);//这部分用来让Zend可以验证一个要执行脚本文件的state,从而判断文件是否据有执行权限等等.\n    char *(*getenv)(char *name, size_t name_len);//为Zend提供了一个根据name来查找环境变量的接口,对于mod_php5来说,当我们在脚本中调用getenv的时候,就会间接的调用这个句柄.CLI和CGI很类似,直接调用父级是Shell, 所以,只是简单的调用了系统提供的genenv:\n\n    void (*sapi_error)(int type, const char *error_msg, ...) ZEND_ATTRIBUTE_FORMAT(printf, 2, 3);//错误处理函数\n\n    int (*header_handler)(sapi_header_struct *sapi_header, sapi_header_op_enum op, sapi_headers_struct *sapi_headers);//这个函数会在我们调用PHP的header()函数的时候被调用.\n    int (*send_headers)(sapi_headers_struct *sapi_headers);//这个函数会在要真正发送header的时候被调用,一般来说,就是当有任何的输出要发送之前:\n    void (*send_header)(sapi_header_struct *sapi_header, void *server_context);//这个用来单独发送每一个header\n\n    size_t (*read_post)(char *buffer, size_t count_bytes);//这个句柄指明了如何获取POST的数据,CLI是从stdin中读取POST DATA的,\n    char *(*read_cookies)(void);//这个句柄指明了如何获取cookies的数据\n\n    void (*register_server_variables)(zval *track_vars_array);//这个函数用以给$_SERVER变量中添加变量,CLI在此函数中注册了PHP_SELF,SCRIPT_FILENAME等server变量:\n    void (*log_message)(char *message, int syslog_type_int);//用来输出错误信息,对于CLI来说,只是简单的输出到stderr\n    double (*get_request_time)(void);//获取请求时间,只有apach2自定义了,默认为获取当前时间\n    void (*terminate_process)(void);//没有任何SAPI用到,无用代码\n\n    //STANDARD_SAPI_MODULE_PROPERTIES\n    char *php_ini_path_override;\n    void (*default_post_reader)(void);\n    void (*treat_data)(int arg, char *str, zval *destArray);\n    char *executable_location;\n    int php_ini_ignore;\n    int php_ini_ignore_cwd;\n    int (*get_fd)(int *fd);\n    int (*force_http_10)(void);\n    int (*get_target_uid)(uid_t *);\n    int (*get_target_gid)(gid_t *);\n    unsigned int (*input_filter)(int arg, char *var, char **val, size_t val_len, size_t *new_val_len);\n    void (*ini_defaults)(HashTable *configuration_hash);\n    int phpinfo_as_text;\n    char *ini_entries;\n    const zend_function_entry *additional_functions;\n    unsigned int (*input_filter_init)(void);\n};```\n\n---\n\n## cli_sapi_module 的定义\n```c\nstatic sapi_module_struct cli_sapi_module = {\n    \"cli\",                            /* name */\n    \"Command Line Interface\",        /* pretty name */\n\n    php_cli_startup,                /* startup */\n    php_module_shutdown_wrapper,    /* shutdown */\n    NULL,                            /* activate */\n    sapi_cli_deactivate,            /* deactivate */\n\n    sapi_cli_ub_write,                /* unbuffered write */\n    sapi_cli_flush,                    /* flush */\n    NULL,                            /* get uid */\n    NULL,                            /* getenv */\n\n    php_error,                        /* error handler */\n    sapi_cli_header_handler,        /* header handler */\n    sapi_cli_send_headers,            /* send headers handler */\n    sapi_cli_send_header,            /* send header handler */\n\n    NULL,                            /* read POST data */\n    sapi_cli_read_cookies,          /* read Cookies */\n\n    sapi_cli_register_variables,    /* register server variables */\n    sapi_cli_log_message,            /* Log message */\n    NULL,                            /* Get request time */\n    NULL,                            /* Child terminate */\n\n    STANDARD_SAPI_MODULE_PROPERTIES\n};\n```","source":"_posts/2018-10-13-SAPI.md","raw":"---\ntitle: \"PHP-数据结构(SAPI)\"\ndate: 2018-10-13\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 内核\n---\n\n在PHP生命周期的各个阶段，一些与服务相关的操作都是通过SAPI接口实现。这些内置实现的物理位置在PHP源码的SAPI目录。这个目录存放了PHP对各个服务器抽象层的代码，例如命令行程序的实现，Apache的mod_php模块实现以及fastcgi的实现等等。\n <!-- more -->\n\n`SAPI`分别在`FPM`和`CLI`下是如何运行的？\n# SAPI\n```php\ntest.php\n<?php\n    $temp = $_POST;\n    print_r($temp);\n?>\n```\n* FPM\n```c\nstatic sapi_module_struct cgi_sapi_module = {\n    \"fpm_fcgi\",\n    ...\n    sapi_cgibin_ub_write,\n    sapi_cgibin_flush,\n    ...\n    sapi_cgi_read_post,\n    ...\n};\n```\n* CLI\n```c\nstatic sapi_module_struct cgi_sapi_module = {\n    \"cli\",\n    ...\n    sapi_cli_ub_write,\n    sapi_cli_flush,\n    ...\n    NULL,\n    ...\n};\n```\n### sapi模块结构体\n```c\nstruct _sapi_module_struct {\n    char *name;\n    char *pretty_name;\n    \n    int (*startup)(struct _sapi_module_struct *sapi_module);//PHP被调用的时候,这个函数会被调用执行\n    int (*shutdown)(struct _sapi_module_struct *sapi_module);//PHP调用结束的时候,这个函数会被调用执行\n\n    int (*activate)(void);//每个request开始时会执行,进行一些初始化,资源分配的事务\n    int (*deactivate)(void);//每个request结束时会执行\n\n    size_t (*ub_write)(const char *str, size_t str_length);//这个hanlder告诉了Zend,如何输出数据,对于mod_php来说,这个函数提供了一个向response数据写的接口,而CLI只是简单的写到stdout\n    void (*flush)(void *server_context);//这个是提供给zend的刷新缓存的函数句柄,对于CLI来说,只是简单的调用系统提供的fflush;\n    zend_stat_t *(*get_stat)(void);//这部分用来让Zend可以验证一个要执行脚本文件的state,从而判断文件是否据有执行权限等等.\n    char *(*getenv)(char *name, size_t name_len);//为Zend提供了一个根据name来查找环境变量的接口,对于mod_php5来说,当我们在脚本中调用getenv的时候,就会间接的调用这个句柄.CLI和CGI很类似,直接调用父级是Shell, 所以,只是简单的调用了系统提供的genenv:\n\n    void (*sapi_error)(int type, const char *error_msg, ...) ZEND_ATTRIBUTE_FORMAT(printf, 2, 3);//错误处理函数\n\n    int (*header_handler)(sapi_header_struct *sapi_header, sapi_header_op_enum op, sapi_headers_struct *sapi_headers);//这个函数会在我们调用PHP的header()函数的时候被调用.\n    int (*send_headers)(sapi_headers_struct *sapi_headers);//这个函数会在要真正发送header的时候被调用,一般来说,就是当有任何的输出要发送之前:\n    void (*send_header)(sapi_header_struct *sapi_header, void *server_context);//这个用来单独发送每一个header\n\n    size_t (*read_post)(char *buffer, size_t count_bytes);//这个句柄指明了如何获取POST的数据,CLI是从stdin中读取POST DATA的,\n    char *(*read_cookies)(void);//这个句柄指明了如何获取cookies的数据\n\n    void (*register_server_variables)(zval *track_vars_array);//这个函数用以给$_SERVER变量中添加变量,CLI在此函数中注册了PHP_SELF,SCRIPT_FILENAME等server变量:\n    void (*log_message)(char *message, int syslog_type_int);//用来输出错误信息,对于CLI来说,只是简单的输出到stderr\n    double (*get_request_time)(void);//获取请求时间,只有apach2自定义了,默认为获取当前时间\n    void (*terminate_process)(void);//没有任何SAPI用到,无用代码\n\n    //STANDARD_SAPI_MODULE_PROPERTIES\n    char *php_ini_path_override;\n    void (*default_post_reader)(void);\n    void (*treat_data)(int arg, char *str, zval *destArray);\n    char *executable_location;\n    int php_ini_ignore;\n    int php_ini_ignore_cwd;\n    int (*get_fd)(int *fd);\n    int (*force_http_10)(void);\n    int (*get_target_uid)(uid_t *);\n    int (*get_target_gid)(gid_t *);\n    unsigned int (*input_filter)(int arg, char *var, char **val, size_t val_len, size_t *new_val_len);\n    void (*ini_defaults)(HashTable *configuration_hash);\n    int phpinfo_as_text;\n    char *ini_entries;\n    const zend_function_entry *additional_functions;\n    unsigned int (*input_filter_init)(void);\n};```\n\n---\n\n## cli_sapi_module 的定义\n```c\nstatic sapi_module_struct cli_sapi_module = {\n    \"cli\",                            /* name */\n    \"Command Line Interface\",        /* pretty name */\n\n    php_cli_startup,                /* startup */\n    php_module_shutdown_wrapper,    /* shutdown */\n    NULL,                            /* activate */\n    sapi_cli_deactivate,            /* deactivate */\n\n    sapi_cli_ub_write,                /* unbuffered write */\n    sapi_cli_flush,                    /* flush */\n    NULL,                            /* get uid */\n    NULL,                            /* getenv */\n\n    php_error,                        /* error handler */\n    sapi_cli_header_handler,        /* header handler */\n    sapi_cli_send_headers,            /* send headers handler */\n    sapi_cli_send_header,            /* send header handler */\n\n    NULL,                            /* read POST data */\n    sapi_cli_read_cookies,          /* read Cookies */\n\n    sapi_cli_register_variables,    /* register server variables */\n    sapi_cli_log_message,            /* Log message */\n    NULL,                            /* Get request time */\n    NULL,                            /* Child terminate */\n\n    STANDARD_SAPI_MODULE_PROPERTIES\n};\n```","slug":"2018-10-13-SAPI","published":1,"updated":"2019-07-05T07:55:55.000Z","layout":"post","photos":[],"link":"","_id":"cjypn1ql20033y4rbw341rbrf","content":"<p>在PHP生命周期的各个阶段，一些与服务相关的操作都是通过SAPI接口实现。这些内置实现的物理位置在PHP源码的SAPI目录。这个目录存放了PHP对各个服务器抽象层的代码，例如命令行程序的实现，Apache的mod_php模块实现以及fastcgi的实现等等。<br> <a id=\"more\"></a></p>\n<p><code>SAPI</code>分别在<code>FPM</code>和<code>CLI</code>下是如何运行的？</p>\n<h1 id=\"SAPI\"><a href=\"#SAPI\" class=\"headerlink\" title=\"SAPI\"></a>SAPI</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test.php</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    $temp = $_POST;</span><br><span class=\"line\">    print_r($temp);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>FPM</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> sapi_module_struct cgi_sapi_module = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"fpm_fcgi\"</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    sapi_cgibin_ub_write,</span><br><span class=\"line\">    sapi_cgibin_flush,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    sapi_cgi_read_post,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>CLI</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> sapi_module_struct cgi_sapi_module = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"cli\"</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    sapi_cli_ub_write,</span><br><span class=\"line\">    sapi_cli_flush,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"sapi模块结构体\"><a href=\"#sapi模块结构体\" class=\"headerlink\" title=\"sapi模块结构体\"></a>sapi模块结构体</h3><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> _<span class=\"title\">sapi_module_struct</span> &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *name;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> *pretty_name;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*startup)(struct _sapi_module_struct *sapi_module);<span class=\"comment\">//PHP被调用的时候,这个函数会被调用执行</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*shutdown)(struct _sapi_module_struct *sapi_module);<span class=\"comment\">//PHP调用结束的时候,这个函数会被调用执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*activate)(<span class=\"keyword\">void</span>);<span class=\"comment\">//每个request开始时会执行,进行一些初始化,资源分配的事务</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*deactivate)(<span class=\"keyword\">void</span>);<span class=\"comment\">//每个request结束时会执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> (*ub_write)(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *str, <span class=\"keyword\">size_t</span> str_length);<span class=\"comment\">//这个hanlder告诉了Zend,如何输出数据,对于mod_php来说,这个函数提供了一个向response数据写的接口,而CLI只是简单的写到stdout</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*flush)(<span class=\"keyword\">void</span> *server_context);<span class=\"comment\">//这个是提供给zend的刷新缓存的函数句柄,对于CLI来说,只是简单的调用系统提供的fflush;</span></span><br><span class=\"line\">    <span class=\"keyword\">zend_stat_t</span> *(*get_stat)(<span class=\"keyword\">void</span>);<span class=\"comment\">//这部分用来让Zend可以验证一个要执行脚本文件的state,从而判断文件是否据有执行权限等等.</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *(*getenv)(<span class=\"keyword\">char</span> *name, <span class=\"keyword\">size_t</span> name_len);<span class=\"comment\">//为Zend提供了一个根据name来查找环境变量的接口,对于mod_php5来说,当我们在脚本中调用getenv的时候,就会间接的调用这个句柄.CLI和CGI很类似,直接调用父级是Shell, 所以,只是简单的调用了系统提供的genenv:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*sapi_error)(<span class=\"keyword\">int</span> type, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *error_msg, ...) ZEND_ATTRIBUTE_FORMAT(<span class=\"built_in\">printf</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>);<span class=\"comment\">//错误处理函数</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*header_handler)(sapi_header_struct *sapi_header, sapi_header_op_enum op, sapi_headers_struct *sapi_headers);<span class=\"comment\">//这个函数会在我们调用PHP的header()函数的时候被调用.</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*send_headers)(sapi_headers_struct *sapi_headers);<span class=\"comment\">//这个函数会在要真正发送header的时候被调用,一般来说,就是当有任何的输出要发送之前:</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*send_header)(sapi_header_struct *sapi_header, <span class=\"keyword\">void</span> *server_context);<span class=\"comment\">//这个用来单独发送每一个header</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> (*read_post)(<span class=\"keyword\">char</span> *buffer, <span class=\"keyword\">size_t</span> count_bytes);<span class=\"comment\">//这个句柄指明了如何获取POST的数据,CLI是从stdin中读取POST DATA的,</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *(*read_cookies)(<span class=\"keyword\">void</span>);<span class=\"comment\">//这个句柄指明了如何获取cookies的数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*register_server_variables)(zval *track_vars_array);<span class=\"comment\">//这个函数用以给$_SERVER变量中添加变量,CLI在此函数中注册了PHP_SELF,SCRIPT_FILENAME等server变量:</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*log_message)(<span class=\"keyword\">char</span> *message, <span class=\"keyword\">int</span> syslog_type_int);<span class=\"comment\">//用来输出错误信息,对于CLI来说,只是简单的输出到stderr</span></span><br><span class=\"line\">    <span class=\"keyword\">double</span> (*get_request_time)(<span class=\"keyword\">void</span>);<span class=\"comment\">//获取请求时间,只有apach2自定义了,默认为获取当前时间</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*terminate_process)(<span class=\"keyword\">void</span>);<span class=\"comment\">//没有任何SAPI用到,无用代码</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//STANDARD_SAPI_MODULE_PROPERTIES</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *php_ini_path_override;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*default_post_reader)(<span class=\"keyword\">void</span>);</span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*treat_data)(<span class=\"keyword\">int</span> arg, <span class=\"keyword\">char</span> *str, zval *destArray);</span><br><span class=\"line\">    <span class=\"keyword\">char</span> *executable_location;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> php_ini_ignore;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> php_ini_ignore_cwd;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*get_fd)(<span class=\"keyword\">int</span> *fd);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*force_http_10)(<span class=\"keyword\">void</span>);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*get_target_uid)(<span class=\"keyword\">uid_t</span> *);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*get_target_gid)(<span class=\"keyword\">gid_t</span> *);</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">unsigned</span> <span class=\"title\">int</span> <span class=\"params\">(*input_filter)</span><span class=\"params\">(<span class=\"keyword\">int</span> arg, <span class=\"keyword\">char</span> *var, <span class=\"keyword\">char</span> **val, <span class=\"keyword\">size_t</span> val_len, <span class=\"keyword\">size_t</span> *new_val_len)</span></span>;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*ini_defaults)(HashTable *configuration_hash);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> phpinfo_as_text;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> *ini_entries;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> zend_function_entry *additional_functions;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">unsigned</span> <span class=\"title\">int</span> <span class=\"params\">(*input_filter_init)</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"cli-sapi-module-的定义\"><a href=\"#cli-sapi-module-的定义\" class=\"headerlink\" title=\"cli_sapi_module 的定义\"></a>cli_sapi_module 的定义</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> sapi_module_struct cli_sapi_module = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"cli\"</span>,                            <span class=\"comment\">/* name */</span></span><br><span class=\"line\">    <span class=\"string\">\"Command Line Interface\"</span>,        <span class=\"comment\">/* pretty name */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    php_cli_startup,                <span class=\"comment\">/* startup */</span></span><br><span class=\"line\">    php_module_shutdown_wrapper,    <span class=\"comment\">/* shutdown */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* activate */</span></span><br><span class=\"line\">    sapi_cli_deactivate,            <span class=\"comment\">/* deactivate */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sapi_cli_ub_write,                <span class=\"comment\">/* unbuffered write */</span></span><br><span class=\"line\">    sapi_cli_flush,                    <span class=\"comment\">/* flush */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* get uid */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* getenv */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    php_error,                        <span class=\"comment\">/* error handler */</span></span><br><span class=\"line\">    sapi_cli_header_handler,        <span class=\"comment\">/* header handler */</span></span><br><span class=\"line\">    sapi_cli_send_headers,            <span class=\"comment\">/* send headers handler */</span></span><br><span class=\"line\">    sapi_cli_send_header,            <span class=\"comment\">/* send header handler */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* read POST data */</span></span><br><span class=\"line\">    sapi_cli_read_cookies,          <span class=\"comment\">/* read Cookies */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sapi_cli_register_variables,    <span class=\"comment\">/* register server variables */</span></span><br><span class=\"line\">    sapi_cli_log_message,            <span class=\"comment\">/* Log message */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* Get request time */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* Child terminate */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    STANDARD_SAPI_MODULE_PROPERTIES</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>在PHP生命周期的各个阶段，一些与服务相关的操作都是通过SAPI接口实现。这些内置实现的物理位置在PHP源码的SAPI目录。这个目录存放了PHP对各个服务器抽象层的代码，例如命令行程序的实现，Apache的mod_php模块实现以及fastcgi的实现等等。<br>","more":"</p>\n<p><code>SAPI</code>分别在<code>FPM</code>和<code>CLI</code>下是如何运行的？</p>\n<h1 id=\"SAPI\"><a href=\"#SAPI\" class=\"headerlink\" title=\"SAPI\"></a>SAPI</h1><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test.php</span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    $temp = $_POST;</span><br><span class=\"line\">    print_r($temp);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>FPM</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> sapi_module_struct cgi_sapi_module = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"fpm_fcgi\"</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    sapi_cgibin_ub_write,</span><br><span class=\"line\">    sapi_cgibin_flush,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    sapi_cgi_read_post,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>CLI</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> sapi_module_struct cgi_sapi_module = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"cli\"</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    sapi_cli_ub_write,</span><br><span class=\"line\">    sapi_cli_flush,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"sapi模块结构体\"><a href=\"#sapi模块结构体\" class=\"headerlink\" title=\"sapi模块结构体\"></a>sapi模块结构体</h3><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> _<span class=\"title\">sapi_module_struct</span> &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *name;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> *pretty_name;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*startup)(struct _sapi_module_struct *sapi_module);<span class=\"comment\">//PHP被调用的时候,这个函数会被调用执行</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*shutdown)(struct _sapi_module_struct *sapi_module);<span class=\"comment\">//PHP调用结束的时候,这个函数会被调用执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*activate)(<span class=\"keyword\">void</span>);<span class=\"comment\">//每个request开始时会执行,进行一些初始化,资源分配的事务</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*deactivate)(<span class=\"keyword\">void</span>);<span class=\"comment\">//每个request结束时会执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> (*ub_write)(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *str, <span class=\"keyword\">size_t</span> str_length);<span class=\"comment\">//这个hanlder告诉了Zend,如何输出数据,对于mod_php来说,这个函数提供了一个向response数据写的接口,而CLI只是简单的写到stdout</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*flush)(<span class=\"keyword\">void</span> *server_context);<span class=\"comment\">//这个是提供给zend的刷新缓存的函数句柄,对于CLI来说,只是简单的调用系统提供的fflush;</span></span><br><span class=\"line\">    <span class=\"keyword\">zend_stat_t</span> *(*get_stat)(<span class=\"keyword\">void</span>);<span class=\"comment\">//这部分用来让Zend可以验证一个要执行脚本文件的state,从而判断文件是否据有执行权限等等.</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *(*getenv)(<span class=\"keyword\">char</span> *name, <span class=\"keyword\">size_t</span> name_len);<span class=\"comment\">//为Zend提供了一个根据name来查找环境变量的接口,对于mod_php5来说,当我们在脚本中调用getenv的时候,就会间接的调用这个句柄.CLI和CGI很类似,直接调用父级是Shell, 所以,只是简单的调用了系统提供的genenv:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*sapi_error)(<span class=\"keyword\">int</span> type, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *error_msg, ...) ZEND_ATTRIBUTE_FORMAT(<span class=\"built_in\">printf</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>);<span class=\"comment\">//错误处理函数</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*header_handler)(sapi_header_struct *sapi_header, sapi_header_op_enum op, sapi_headers_struct *sapi_headers);<span class=\"comment\">//这个函数会在我们调用PHP的header()函数的时候被调用.</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*send_headers)(sapi_headers_struct *sapi_headers);<span class=\"comment\">//这个函数会在要真正发送header的时候被调用,一般来说,就是当有任何的输出要发送之前:</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*send_header)(sapi_header_struct *sapi_header, <span class=\"keyword\">void</span> *server_context);<span class=\"comment\">//这个用来单独发送每一个header</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> (*read_post)(<span class=\"keyword\">char</span> *buffer, <span class=\"keyword\">size_t</span> count_bytes);<span class=\"comment\">//这个句柄指明了如何获取POST的数据,CLI是从stdin中读取POST DATA的,</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *(*read_cookies)(<span class=\"keyword\">void</span>);<span class=\"comment\">//这个句柄指明了如何获取cookies的数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*register_server_variables)(zval *track_vars_array);<span class=\"comment\">//这个函数用以给$_SERVER变量中添加变量,CLI在此函数中注册了PHP_SELF,SCRIPT_FILENAME等server变量:</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*log_message)(<span class=\"keyword\">char</span> *message, <span class=\"keyword\">int</span> syslog_type_int);<span class=\"comment\">//用来输出错误信息,对于CLI来说,只是简单的输出到stderr</span></span><br><span class=\"line\">    <span class=\"keyword\">double</span> (*get_request_time)(<span class=\"keyword\">void</span>);<span class=\"comment\">//获取请求时间,只有apach2自定义了,默认为获取当前时间</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*terminate_process)(<span class=\"keyword\">void</span>);<span class=\"comment\">//没有任何SAPI用到,无用代码</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//STANDARD_SAPI_MODULE_PROPERTIES</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *php_ini_path_override;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*default_post_reader)(<span class=\"keyword\">void</span>);</span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*treat_data)(<span class=\"keyword\">int</span> arg, <span class=\"keyword\">char</span> *str, zval *destArray);</span><br><span class=\"line\">    <span class=\"keyword\">char</span> *executable_location;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> php_ini_ignore;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> php_ini_ignore_cwd;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*get_fd)(<span class=\"keyword\">int</span> *fd);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*force_http_10)(<span class=\"keyword\">void</span>);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*get_target_uid)(<span class=\"keyword\">uid_t</span> *);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> (*get_target_gid)(<span class=\"keyword\">gid_t</span> *);</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">unsigned</span> <span class=\"title\">int</span> <span class=\"params\">(*input_filter)</span><span class=\"params\">(<span class=\"keyword\">int</span> arg, <span class=\"keyword\">char</span> *var, <span class=\"keyword\">char</span> **val, <span class=\"keyword\">size_t</span> val_len, <span class=\"keyword\">size_t</span> *new_val_len)</span></span>;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> (*ini_defaults)(HashTable *configuration_hash);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> phpinfo_as_text;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> *ini_entries;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> zend_function_entry *additional_functions;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">unsigned</span> <span class=\"title\">int</span> <span class=\"params\">(*input_filter_init)</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span></span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"cli-sapi-module-的定义\"><a href=\"#cli-sapi-module-的定义\" class=\"headerlink\" title=\"cli_sapi_module 的定义\"></a>cli_sapi_module 的定义</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> sapi_module_struct cli_sapi_module = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"cli\"</span>,                            <span class=\"comment\">/* name */</span></span><br><span class=\"line\">    <span class=\"string\">\"Command Line Interface\"</span>,        <span class=\"comment\">/* pretty name */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    php_cli_startup,                <span class=\"comment\">/* startup */</span></span><br><span class=\"line\">    php_module_shutdown_wrapper,    <span class=\"comment\">/* shutdown */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* activate */</span></span><br><span class=\"line\">    sapi_cli_deactivate,            <span class=\"comment\">/* deactivate */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sapi_cli_ub_write,                <span class=\"comment\">/* unbuffered write */</span></span><br><span class=\"line\">    sapi_cli_flush,                    <span class=\"comment\">/* flush */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* get uid */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* getenv */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    php_error,                        <span class=\"comment\">/* error handler */</span></span><br><span class=\"line\">    sapi_cli_header_handler,        <span class=\"comment\">/* header handler */</span></span><br><span class=\"line\">    sapi_cli_send_headers,            <span class=\"comment\">/* send headers handler */</span></span><br><span class=\"line\">    sapi_cli_send_header,            <span class=\"comment\">/* send header handler */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* read POST data */</span></span><br><span class=\"line\">    sapi_cli_read_cookies,          <span class=\"comment\">/* read Cookies */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sapi_cli_register_variables,    <span class=\"comment\">/* register server variables */</span></span><br><span class=\"line\">    sapi_cli_log_message,            <span class=\"comment\">/* Log message */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* Get request time */</span></span><br><span class=\"line\">    <span class=\"literal\">NULL</span>,                            <span class=\"comment\">/* Child terminate */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    STANDARD_SAPI_MODULE_PROPERTIES</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>"},{"title":"PHP-扩展(Extensions)","date":"2018-08-20T04:00:00.000Z","comments":1,"_content":"\n# PHP资料\n\n>http://www.phpinternalsbook.com/\n\n\n## PHP下载\n* 官网下载:https://secure.php.net/downloads.php\n* GITHUB: http://github.com/php/php-src\n\n <!-- more -->\n\n## 构建依赖程序\n在继续之前,您可能应该与包管理器一起安装一些基本构建依赖项(默认情况下,您可能已经安装了前三个):\n* gcc或其他一些编译器套件.\n* libc-dev,它提供C标准库,包括头文件.\n* make,这是PHP使用的构建管理工具.\n* autoconf(2.59或更高版本),用于生成配置脚本.\n* automake(1.4或更高),它生成 Makefile.in文件.\n* libtool帮助管理共享库.\n* bison(2.4或更高版本),用于生成PHP解析器.\n* re2c(可选),用于生成PHP词法分析器.由于git存储库已经包含一个生成的词法分析器,所以只需要修改它就需要re2c.\n\n在Debian/Ubuntu上,您可以使用以下命令安装所有这些:\n`sudo apt-get install build-essential autoconf automake libtool bison re2c`\n\n## 配置选项讲解:`./configure --help | less`\n使用`--enable-NAME`和`--disable-NAME`开关编译哪些扩展和SAPI .\n\n如果扩展或SAPI具有外部依赖关系,则需要使用`--with-NAME`和`--without-NAME`.\n\n如果NAME所需的库 不在默认位置(例如,因为您自己编译),则可以使用`--with-NAME = DIR`指定其位置.\n\n如果选项是`--enable-NAME`或`--with-NAME`说明该选项默认是关闭的.如果是`--disable-NAME`或`--without-NAME`说明该选项默认是开启的.\n\n## 我们要进行的配置和编译命令:\n    ./configure --disable-all --enable-cli --enable-debug\n        (--enable-debug启用调试模式,具有多重效果:\n        编译将使用 -g运行以生成包括行号、变量的类型和作用域、函数名字、函数参数和函数的作用域等源文件特性的调试信息.\n        另外使用-O0,会让gcc编译时不对代码优化.\n        此外,调试模式定义了 ZEND_DEBUG宏,它将启动引擎中的各种调试助手.除其他事项外,还将报告内存泄漏以及某些数据结构的不正确使用.)\n    make -jN\n        (N为CPU数量,作用:make --help查看)\n\n## PHP内核源码目录结构\n    php-744.1.4\n    ├── build   //源码编译相关文件\n    └── ext     //官方扩展目录,包括了绝大多数PHP的函数的定义和实现\n    └── main    //PHP核心基本文件,这里和Zend引擎不一样,Zend引擎主要实现语言最核心的语言运行环境.\n    └── pear    //“PHP 扩展与应用仓库”,包含PEAR的核心文件.\n    └── sapi    //包含了各种服务器抽象层的代码,例如apache的mod_php,cgi,fastcgi以及fpm等等接口.\n    └── tests   //PHP的测试脚本集合,包含PHP各项功能的测试文件\n    └── TSRM    //PHP的线程安全是构建在TSRM库之上的,PHP实现中常见的*G宏通常是对TSRM的封装,TSRM(Thread Safe Resource Manager)线程安全资源管理器.\n    └── win32   //Windows平台相关的一些实现,比如sokcet的实现在Windows下和*Nix平台就不太一样,同时也包括了Windows下编译PHP相关的脚本.\n    └── Zend    //Zend引擎的实现目录,比如脚本的词法语法解析,opcode的执行以及扩展机制的实现等等.\n    └── .gdbinit            //gdb命令编写脚本   (gdb) source /home/laruence/package/php-5.2.14/.gdbinit       (gdb) zbacktrace\n    └── CODING_STANDARDS    //PHP编码标准\n    └── config.guess        //由automake产生,两个用于目标平台检测的脚本\n    └── config.log          //configure执行时生成的日志文件\n    └── config.nice         //configure执行时生成,记录了上次执行configure时带的详细参数\n    └── config.status       //configure执行时生成,实际调用编译工具构建软件的shell脚本\n    └── config.sub          //由automake产生,两个用于目标平台检测的脚本\n    └── configure           //配置并生成makefile\n    └── configure.in        //autoreconf创建,开发者维护,用于生成configure\n    └── CREDITS             //开发人员名单\n    └── EXTENSIONS          //扩展说明(维护状态,维护人员,版本,适用系统..)\n    └── LICENSE             //发布协议\n    └── php.ini-development //PHP开发环境示例配置文件\n    └── php.ini-production  //PHP生产环境示例配置文件\n    └── README.EXT_SKEL     //构建扩展脚本说明\n    └── README.GIT-RULES    //GIT提交时的规则\n    └── README.namespaces   //命名空间说明\n    └── README.PARAMETER_PARSING_API    //新的参数解析函数说明\n    └── README.REDIST.BINS              //PHP中引用到的其它程序协议说明\n    └── README.RELEASE_PROCESS          //PHP发布过程说明\n    └── README.SELF-CONTAINED-EXTENSIONS//创建一个内建的PHP扩展\n    └── README.STREAMS                  //PHP Streams(流概念) 说明\n    └── README.SUBMITTING_PATCH         //介绍如何提交PHP的增强功能或修补程序\n    └── README.TESTING                  //测试说明(run-tests.php)\n    └── README.TESTING2                 //测试说明(server-tests.php)\n    └── README.UNIX-BUILD-SYSTEM        //PHP编译系统V5概述\n    └── README.WIN32-BUILD-SYSTEM       //WIN32编译说明\n    └── run-test.php                    //测试脚本\n    └── server-test.php                 //测试脚本\n    └── sesrver-test-config.php         //测试脚本\n    └── UPGRADING                       //版本更新说明\n    └── UPGRADING.INTERNALS             //内部更新说明\n\n## PHP扩展分类\nPHP中的扩展分为两类:PHP扩展、Zend扩展,对内核而言这两个分别称之为:模块(module)、扩展(extension),我们主要介绍是PHP扩展,也就是模块.\n\n### 加载区别:\n* PHP扩展(又名PHP“模块”)使用“extension = test.so”行加载到INI文件中\n* Zend扩展使用“zend_extension = test.so”行加载到INI文件中\n\nZend扩展比PHP扩展更复杂,因为它们有更多的钩子,而且更接近Zend引擎及其虚拟机(整个PHP源代码中最复杂的部分).\nZend扩展例子如:OPCache,XDebug,phpdbg,Zend扩展通常用来处理两种任务:调试器和剖析器.如果您的目标是“只是”向PHP 添加一些新概念(函数,类,常量等),那么您将使用PHP扩展,但如果需要更改PHP的当前行为,可能Zend扩展将会更好.","source":"_posts/2018-08-20-PhpExtensions.md","raw":"---\ntitle: \"PHP-扩展(Extensions)\"\ndate: 2018-08-20\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 内核\n---\n\n# PHP资料\n\n>http://www.phpinternalsbook.com/\n\n\n## PHP下载\n* 官网下载:https://secure.php.net/downloads.php\n* GITHUB: http://github.com/php/php-src\n\n <!-- more -->\n\n## 构建依赖程序\n在继续之前,您可能应该与包管理器一起安装一些基本构建依赖项(默认情况下,您可能已经安装了前三个):\n* gcc或其他一些编译器套件.\n* libc-dev,它提供C标准库,包括头文件.\n* make,这是PHP使用的构建管理工具.\n* autoconf(2.59或更高版本),用于生成配置脚本.\n* automake(1.4或更高),它生成 Makefile.in文件.\n* libtool帮助管理共享库.\n* bison(2.4或更高版本),用于生成PHP解析器.\n* re2c(可选),用于生成PHP词法分析器.由于git存储库已经包含一个生成的词法分析器,所以只需要修改它就需要re2c.\n\n在Debian/Ubuntu上,您可以使用以下命令安装所有这些:\n`sudo apt-get install build-essential autoconf automake libtool bison re2c`\n\n## 配置选项讲解:`./configure --help | less`\n使用`--enable-NAME`和`--disable-NAME`开关编译哪些扩展和SAPI .\n\n如果扩展或SAPI具有外部依赖关系,则需要使用`--with-NAME`和`--without-NAME`.\n\n如果NAME所需的库 不在默认位置(例如,因为您自己编译),则可以使用`--with-NAME = DIR`指定其位置.\n\n如果选项是`--enable-NAME`或`--with-NAME`说明该选项默认是关闭的.如果是`--disable-NAME`或`--without-NAME`说明该选项默认是开启的.\n\n## 我们要进行的配置和编译命令:\n    ./configure --disable-all --enable-cli --enable-debug\n        (--enable-debug启用调试模式,具有多重效果:\n        编译将使用 -g运行以生成包括行号、变量的类型和作用域、函数名字、函数参数和函数的作用域等源文件特性的调试信息.\n        另外使用-O0,会让gcc编译时不对代码优化.\n        此外,调试模式定义了 ZEND_DEBUG宏,它将启动引擎中的各种调试助手.除其他事项外,还将报告内存泄漏以及某些数据结构的不正确使用.)\n    make -jN\n        (N为CPU数量,作用:make --help查看)\n\n## PHP内核源码目录结构\n    php-744.1.4\n    ├── build   //源码编译相关文件\n    └── ext     //官方扩展目录,包括了绝大多数PHP的函数的定义和实现\n    └── main    //PHP核心基本文件,这里和Zend引擎不一样,Zend引擎主要实现语言最核心的语言运行环境.\n    └── pear    //“PHP 扩展与应用仓库”,包含PEAR的核心文件.\n    └── sapi    //包含了各种服务器抽象层的代码,例如apache的mod_php,cgi,fastcgi以及fpm等等接口.\n    └── tests   //PHP的测试脚本集合,包含PHP各项功能的测试文件\n    └── TSRM    //PHP的线程安全是构建在TSRM库之上的,PHP实现中常见的*G宏通常是对TSRM的封装,TSRM(Thread Safe Resource Manager)线程安全资源管理器.\n    └── win32   //Windows平台相关的一些实现,比如sokcet的实现在Windows下和*Nix平台就不太一样,同时也包括了Windows下编译PHP相关的脚本.\n    └── Zend    //Zend引擎的实现目录,比如脚本的词法语法解析,opcode的执行以及扩展机制的实现等等.\n    └── .gdbinit            //gdb命令编写脚本   (gdb) source /home/laruence/package/php-5.2.14/.gdbinit       (gdb) zbacktrace\n    └── CODING_STANDARDS    //PHP编码标准\n    └── config.guess        //由automake产生,两个用于目标平台检测的脚本\n    └── config.log          //configure执行时生成的日志文件\n    └── config.nice         //configure执行时生成,记录了上次执行configure时带的详细参数\n    └── config.status       //configure执行时生成,实际调用编译工具构建软件的shell脚本\n    └── config.sub          //由automake产生,两个用于目标平台检测的脚本\n    └── configure           //配置并生成makefile\n    └── configure.in        //autoreconf创建,开发者维护,用于生成configure\n    └── CREDITS             //开发人员名单\n    └── EXTENSIONS          //扩展说明(维护状态,维护人员,版本,适用系统..)\n    └── LICENSE             //发布协议\n    └── php.ini-development //PHP开发环境示例配置文件\n    └── php.ini-production  //PHP生产环境示例配置文件\n    └── README.EXT_SKEL     //构建扩展脚本说明\n    └── README.GIT-RULES    //GIT提交时的规则\n    └── README.namespaces   //命名空间说明\n    └── README.PARAMETER_PARSING_API    //新的参数解析函数说明\n    └── README.REDIST.BINS              //PHP中引用到的其它程序协议说明\n    └── README.RELEASE_PROCESS          //PHP发布过程说明\n    └── README.SELF-CONTAINED-EXTENSIONS//创建一个内建的PHP扩展\n    └── README.STREAMS                  //PHP Streams(流概念) 说明\n    └── README.SUBMITTING_PATCH         //介绍如何提交PHP的增强功能或修补程序\n    └── README.TESTING                  //测试说明(run-tests.php)\n    └── README.TESTING2                 //测试说明(server-tests.php)\n    └── README.UNIX-BUILD-SYSTEM        //PHP编译系统V5概述\n    └── README.WIN32-BUILD-SYSTEM       //WIN32编译说明\n    └── run-test.php                    //测试脚本\n    └── server-test.php                 //测试脚本\n    └── sesrver-test-config.php         //测试脚本\n    └── UPGRADING                       //版本更新说明\n    └── UPGRADING.INTERNALS             //内部更新说明\n\n## PHP扩展分类\nPHP中的扩展分为两类:PHP扩展、Zend扩展,对内核而言这两个分别称之为:模块(module)、扩展(extension),我们主要介绍是PHP扩展,也就是模块.\n\n### 加载区别:\n* PHP扩展(又名PHP“模块”)使用“extension = test.so”行加载到INI文件中\n* Zend扩展使用“zend_extension = test.so”行加载到INI文件中\n\nZend扩展比PHP扩展更复杂,因为它们有更多的钩子,而且更接近Zend引擎及其虚拟机(整个PHP源代码中最复杂的部分).\nZend扩展例子如:OPCache,XDebug,phpdbg,Zend扩展通常用来处理两种任务:调试器和剖析器.如果您的目标是“只是”向PHP 添加一些新概念(函数,类,常量等),那么您将使用PHP扩展,但如果需要更改PHP的当前行为,可能Zend扩展将会更好.","slug":"2018-08-20-PhpExtensions","published":1,"updated":"2019-07-05T07:55:55.000Z","layout":"post","photos":[],"link":"","_id":"cjypn1ql40037y4rb93v70dpo","content":"<h1 id=\"PHP资料\"><a href=\"#PHP资料\" class=\"headerlink\" title=\"PHP资料\"></a>PHP资料</h1><blockquote>\n<p><a href=\"http://www.phpinternalsbook.com/\" target=\"_blank\" rel=\"noopener\">http://www.phpinternalsbook.com/</a></p>\n</blockquote>\n<h2 id=\"PHP下载\"><a href=\"#PHP下载\" class=\"headerlink\" title=\"PHP下载\"></a>PHP下载</h2><ul>\n<li><p>官网下载:<a href=\"https://secure.php.net/downloads.php\" target=\"_blank\" rel=\"noopener\">https://secure.php.net/downloads.php</a></p>\n</li>\n<li><p>GITHUB: <a href=\"http://github.com/php/php-src\" target=\"_blank\" rel=\"noopener\">http://github.com/php/php-src</a></p>\n<a id=\"more\"></a>\n\n</li>\n</ul>\n<h2 id=\"构建依赖程序\"><a href=\"#构建依赖程序\" class=\"headerlink\" title=\"构建依赖程序\"></a>构建依赖程序</h2><p>在继续之前,您可能应该与包管理器一起安装一些基本构建依赖项(默认情况下,您可能已经安装了前三个):</p>\n<ul>\n<li>gcc或其他一些编译器套件.</li>\n<li>libc-dev,它提供C标准库,包括头文件.</li>\n<li>make,这是PHP使用的构建管理工具.</li>\n<li>autoconf(2.59或更高版本),用于生成配置脚本.</li>\n<li>automake(1.4或更高),它生成 Makefile.in文件.</li>\n<li>libtool帮助管理共享库.</li>\n<li>bison(2.4或更高版本),用于生成PHP解析器.</li>\n<li>re2c(可选),用于生成PHP词法分析器.由于git存储库已经包含一个生成的词法分析器,所以只需要修改它就需要re2c.</li>\n</ul>\n<p>在Debian/Ubuntu上,您可以使用以下命令安装所有这些:<br><code>sudo apt-get install build-essential autoconf automake libtool bison re2c</code></p>\n<h2 id=\"配置选项讲解-configure-help-less\"><a href=\"#配置选项讲解-configure-help-less\" class=\"headerlink\" title=\"配置选项讲解:./configure --help | less\"></a>配置选项讲解:<code>./configure --help | less</code></h2><p>使用<code>--enable-NAME</code>和<code>--disable-NAME</code>开关编译哪些扩展和SAPI .</p>\n<p>如果扩展或SAPI具有外部依赖关系,则需要使用<code>--with-NAME</code>和<code>--without-NAME</code>.</p>\n<p>如果NAME所需的库 不在默认位置(例如,因为您自己编译),则可以使用<code>--with-NAME = DIR</code>指定其位置.</p>\n<p>如果选项是<code>--enable-NAME</code>或<code>--with-NAME</code>说明该选项默认是关闭的.如果是<code>--disable-NAME</code>或<code>--without-NAME</code>说明该选项默认是开启的.</p>\n<h2 id=\"我们要进行的配置和编译命令\"><a href=\"#我们要进行的配置和编译命令\" class=\"headerlink\" title=\"我们要进行的配置和编译命令:\"></a>我们要进行的配置和编译命令:</h2><pre><code>./configure --disable-all --enable-cli --enable-debug\n    (--enable-debug启用调试模式,具有多重效果:\n    编译将使用 -g运行以生成包括行号、变量的类型和作用域、函数名字、函数参数和函数的作用域等源文件特性的调试信息.\n    另外使用-O0,会让gcc编译时不对代码优化.\n    此外,调试模式定义了 ZEND_DEBUG宏,它将启动引擎中的各种调试助手.除其他事项外,还将报告内存泄漏以及某些数据结构的不正确使用.)\nmake -jN\n    (N为CPU数量,作用:make --help查看)</code></pre><h2 id=\"PHP内核源码目录结构\"><a href=\"#PHP内核源码目录结构\" class=\"headerlink\" title=\"PHP内核源码目录结构\"></a>PHP内核源码目录结构</h2><pre><code>php-744.1.4\n├── build   //源码编译相关文件\n└── ext     //官方扩展目录,包括了绝大多数PHP的函数的定义和实现\n└── main    //PHP核心基本文件,这里和Zend引擎不一样,Zend引擎主要实现语言最核心的语言运行环境.\n└── pear    //“PHP 扩展与应用仓库”,包含PEAR的核心文件.\n└── sapi    //包含了各种服务器抽象层的代码,例如apache的mod_php,cgi,fastcgi以及fpm等等接口.\n└── tests   //PHP的测试脚本集合,包含PHP各项功能的测试文件\n└── TSRM    //PHP的线程安全是构建在TSRM库之上的,PHP实现中常见的*G宏通常是对TSRM的封装,TSRM(Thread Safe Resource Manager)线程安全资源管理器.\n└── win32   //Windows平台相关的一些实现,比如sokcet的实现在Windows下和*Nix平台就不太一样,同时也包括了Windows下编译PHP相关的脚本.\n└── Zend    //Zend引擎的实现目录,比如脚本的词法语法解析,opcode的执行以及扩展机制的实现等等.\n└── .gdbinit            //gdb命令编写脚本   (gdb) source /home/laruence/package/php-5.2.14/.gdbinit       (gdb) zbacktrace\n└── CODING_STANDARDS    //PHP编码标准\n└── config.guess        //由automake产生,两个用于目标平台检测的脚本\n└── config.log          //configure执行时生成的日志文件\n└── config.nice         //configure执行时生成,记录了上次执行configure时带的详细参数\n└── config.status       //configure执行时生成,实际调用编译工具构建软件的shell脚本\n└── config.sub          //由automake产生,两个用于目标平台检测的脚本\n└── configure           //配置并生成makefile\n└── configure.in        //autoreconf创建,开发者维护,用于生成configure\n└── CREDITS             //开发人员名单\n└── EXTENSIONS          //扩展说明(维护状态,维护人员,版本,适用系统..)\n└── LICENSE             //发布协议\n└── php.ini-development //PHP开发环境示例配置文件\n└── php.ini-production  //PHP生产环境示例配置文件\n└── README.EXT_SKEL     //构建扩展脚本说明\n└── README.GIT-RULES    //GIT提交时的规则\n└── README.namespaces   //命名空间说明\n└── README.PARAMETER_PARSING_API    //新的参数解析函数说明\n└── README.REDIST.BINS              //PHP中引用到的其它程序协议说明\n└── README.RELEASE_PROCESS          //PHP发布过程说明\n└── README.SELF-CONTAINED-EXTENSIONS//创建一个内建的PHP扩展\n└── README.STREAMS                  //PHP Streams(流概念) 说明\n└── README.SUBMITTING_PATCH         //介绍如何提交PHP的增强功能或修补程序\n└── README.TESTING                  //测试说明(run-tests.php)\n└── README.TESTING2                 //测试说明(server-tests.php)\n└── README.UNIX-BUILD-SYSTEM        //PHP编译系统V5概述\n└── README.WIN32-BUILD-SYSTEM       //WIN32编译说明\n└── run-test.php                    //测试脚本\n└── server-test.php                 //测试脚本\n└── sesrver-test-config.php         //测试脚本\n└── UPGRADING                       //版本更新说明\n└── UPGRADING.INTERNALS             //内部更新说明</code></pre><h2 id=\"PHP扩展分类\"><a href=\"#PHP扩展分类\" class=\"headerlink\" title=\"PHP扩展分类\"></a>PHP扩展分类</h2><p>PHP中的扩展分为两类:PHP扩展、Zend扩展,对内核而言这两个分别称之为:模块(module)、扩展(extension),我们主要介绍是PHP扩展,也就是模块.</p>\n<h3 id=\"加载区别\"><a href=\"#加载区别\" class=\"headerlink\" title=\"加载区别:\"></a>加载区别:</h3><ul>\n<li>PHP扩展(又名PHP“模块”)使用“extension = test.so”行加载到INI文件中</li>\n<li>Zend扩展使用“zend_extension = test.so”行加载到INI文件中</li>\n</ul>\n<p>Zend扩展比PHP扩展更复杂,因为它们有更多的钩子,而且更接近Zend引擎及其虚拟机(整个PHP源代码中最复杂的部分).<br>Zend扩展例子如:OPCache,XDebug,phpdbg,Zend扩展通常用来处理两种任务:调试器和剖析器.如果您的目标是“只是”向PHP 添加一些新概念(函数,类,常量等),那么您将使用PHP扩展,但如果需要更改PHP的当前行为,可能Zend扩展将会更好.</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"PHP资料\"><a href=\"#PHP资料\" class=\"headerlink\" title=\"PHP资料\"></a>PHP资料</h1><blockquote>\n<p><a href=\"http://www.phpinternalsbook.com/\" target=\"_blank\" rel=\"noopener\">http://www.phpinternalsbook.com/</a></p>\n</blockquote>\n<h2 id=\"PHP下载\"><a href=\"#PHP下载\" class=\"headerlink\" title=\"PHP下载\"></a>PHP下载</h2><ul>\n<li><p>官网下载:<a href=\"https://secure.php.net/downloads.php\" target=\"_blank\" rel=\"noopener\">https://secure.php.net/downloads.php</a></p>\n</li>\n<li><p>GITHUB: <a href=\"http://github.com/php/php-src\" target=\"_blank\" rel=\"noopener\">http://github.com/php/php-src</a></p>","more":"</li>\n</ul>\n<h2 id=\"构建依赖程序\"><a href=\"#构建依赖程序\" class=\"headerlink\" title=\"构建依赖程序\"></a>构建依赖程序</h2><p>在继续之前,您可能应该与包管理器一起安装一些基本构建依赖项(默认情况下,您可能已经安装了前三个):</p>\n<ul>\n<li>gcc或其他一些编译器套件.</li>\n<li>libc-dev,它提供C标准库,包括头文件.</li>\n<li>make,这是PHP使用的构建管理工具.</li>\n<li>autoconf(2.59或更高版本),用于生成配置脚本.</li>\n<li>automake(1.4或更高),它生成 Makefile.in文件.</li>\n<li>libtool帮助管理共享库.</li>\n<li>bison(2.4或更高版本),用于生成PHP解析器.</li>\n<li>re2c(可选),用于生成PHP词法分析器.由于git存储库已经包含一个生成的词法分析器,所以只需要修改它就需要re2c.</li>\n</ul>\n<p>在Debian/Ubuntu上,您可以使用以下命令安装所有这些:<br><code>sudo apt-get install build-essential autoconf automake libtool bison re2c</code></p>\n<h2 id=\"配置选项讲解-configure-help-less\"><a href=\"#配置选项讲解-configure-help-less\" class=\"headerlink\" title=\"配置选项讲解:./configure --help | less\"></a>配置选项讲解:<code>./configure --help | less</code></h2><p>使用<code>--enable-NAME</code>和<code>--disable-NAME</code>开关编译哪些扩展和SAPI .</p>\n<p>如果扩展或SAPI具有外部依赖关系,则需要使用<code>--with-NAME</code>和<code>--without-NAME</code>.</p>\n<p>如果NAME所需的库 不在默认位置(例如,因为您自己编译),则可以使用<code>--with-NAME = DIR</code>指定其位置.</p>\n<p>如果选项是<code>--enable-NAME</code>或<code>--with-NAME</code>说明该选项默认是关闭的.如果是<code>--disable-NAME</code>或<code>--without-NAME</code>说明该选项默认是开启的.</p>\n<h2 id=\"我们要进行的配置和编译命令\"><a href=\"#我们要进行的配置和编译命令\" class=\"headerlink\" title=\"我们要进行的配置和编译命令:\"></a>我们要进行的配置和编译命令:</h2><pre><code>./configure --disable-all --enable-cli --enable-debug\n    (--enable-debug启用调试模式,具有多重效果:\n    编译将使用 -g运行以生成包括行号、变量的类型和作用域、函数名字、函数参数和函数的作用域等源文件特性的调试信息.\n    另外使用-O0,会让gcc编译时不对代码优化.\n    此外,调试模式定义了 ZEND_DEBUG宏,它将启动引擎中的各种调试助手.除其他事项外,还将报告内存泄漏以及某些数据结构的不正确使用.)\nmake -jN\n    (N为CPU数量,作用:make --help查看)</code></pre><h2 id=\"PHP内核源码目录结构\"><a href=\"#PHP内核源码目录结构\" class=\"headerlink\" title=\"PHP内核源码目录结构\"></a>PHP内核源码目录结构</h2><pre><code>php-744.1.4\n├── build   //源码编译相关文件\n└── ext     //官方扩展目录,包括了绝大多数PHP的函数的定义和实现\n└── main    //PHP核心基本文件,这里和Zend引擎不一样,Zend引擎主要实现语言最核心的语言运行环境.\n└── pear    //“PHP 扩展与应用仓库”,包含PEAR的核心文件.\n└── sapi    //包含了各种服务器抽象层的代码,例如apache的mod_php,cgi,fastcgi以及fpm等等接口.\n└── tests   //PHP的测试脚本集合,包含PHP各项功能的测试文件\n└── TSRM    //PHP的线程安全是构建在TSRM库之上的,PHP实现中常见的*G宏通常是对TSRM的封装,TSRM(Thread Safe Resource Manager)线程安全资源管理器.\n└── win32   //Windows平台相关的一些实现,比如sokcet的实现在Windows下和*Nix平台就不太一样,同时也包括了Windows下编译PHP相关的脚本.\n└── Zend    //Zend引擎的实现目录,比如脚本的词法语法解析,opcode的执行以及扩展机制的实现等等.\n└── .gdbinit            //gdb命令编写脚本   (gdb) source /home/laruence/package/php-5.2.14/.gdbinit       (gdb) zbacktrace\n└── CODING_STANDARDS    //PHP编码标准\n└── config.guess        //由automake产生,两个用于目标平台检测的脚本\n└── config.log          //configure执行时生成的日志文件\n└── config.nice         //configure执行时生成,记录了上次执行configure时带的详细参数\n└── config.status       //configure执行时生成,实际调用编译工具构建软件的shell脚本\n└── config.sub          //由automake产生,两个用于目标平台检测的脚本\n└── configure           //配置并生成makefile\n└── configure.in        //autoreconf创建,开发者维护,用于生成configure\n└── CREDITS             //开发人员名单\n└── EXTENSIONS          //扩展说明(维护状态,维护人员,版本,适用系统..)\n└── LICENSE             //发布协议\n└── php.ini-development //PHP开发环境示例配置文件\n└── php.ini-production  //PHP生产环境示例配置文件\n└── README.EXT_SKEL     //构建扩展脚本说明\n└── README.GIT-RULES    //GIT提交时的规则\n└── README.namespaces   //命名空间说明\n└── README.PARAMETER_PARSING_API    //新的参数解析函数说明\n└── README.REDIST.BINS              //PHP中引用到的其它程序协议说明\n└── README.RELEASE_PROCESS          //PHP发布过程说明\n└── README.SELF-CONTAINED-EXTENSIONS//创建一个内建的PHP扩展\n└── README.STREAMS                  //PHP Streams(流概念) 说明\n└── README.SUBMITTING_PATCH         //介绍如何提交PHP的增强功能或修补程序\n└── README.TESTING                  //测试说明(run-tests.php)\n└── README.TESTING2                 //测试说明(server-tests.php)\n└── README.UNIX-BUILD-SYSTEM        //PHP编译系统V5概述\n└── README.WIN32-BUILD-SYSTEM       //WIN32编译说明\n└── run-test.php                    //测试脚本\n└── server-test.php                 //测试脚本\n└── sesrver-test-config.php         //测试脚本\n└── UPGRADING                       //版本更新说明\n└── UPGRADING.INTERNALS             //内部更新说明</code></pre><h2 id=\"PHP扩展分类\"><a href=\"#PHP扩展分类\" class=\"headerlink\" title=\"PHP扩展分类\"></a>PHP扩展分类</h2><p>PHP中的扩展分为两类:PHP扩展、Zend扩展,对内核而言这两个分别称之为:模块(module)、扩展(extension),我们主要介绍是PHP扩展,也就是模块.</p>\n<h3 id=\"加载区别\"><a href=\"#加载区别\" class=\"headerlink\" title=\"加载区别:\"></a>加载区别:</h3><ul>\n<li>PHP扩展(又名PHP“模块”)使用“extension = test.so”行加载到INI文件中</li>\n<li>Zend扩展使用“zend_extension = test.so”行加载到INI文件中</li>\n</ul>\n<p>Zend扩展比PHP扩展更复杂,因为它们有更多的钩子,而且更接近Zend引擎及其虚拟机(整个PHP源代码中最复杂的部分).<br>Zend扩展例子如:OPCache,XDebug,phpdbg,Zend扩展通常用来处理两种任务:调试器和剖析器.如果您的目标是“只是”向PHP 添加一些新概念(函数,类,常量等),那么您将使用PHP扩展,但如果需要更改PHP的当前行为,可能Zend扩展将会更好.</p>"},{"title":"HEXO使用记录","date":"2019-06-06T04:00:00.000Z","comments":1,"_content":"Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。\n <!-- more -->\n\n更新yay\n```bash\n$ yay -Syy\n```\n### 下载  git nodejs npm\n```bash\n$  yay -S git nodejs npm\n$ git --version\n$ node -v\n$ npm -v\n```\n更换npm源\n```bash\n$ sudo npm install -g cnpm --registry=https://registry.npm.taobao.org\n```\n### 安装hexo\n```bash\n$ sudo cnpm install -g hexo-cli\n$ hexo -v\n```\n### 创建项目（blog）\n```bash\n$ hexo init blog\n$ cd blog\n#安装依赖\n$ npm install\n$ npm audit fix\n# 生成\n$ hexo g\n# 清缓存\n$ hexo clean\n# 部署\n$ hexo d\n# 启动\n$ hexo s\n```\n### 下载主题\n```bash\n$ git clone https://github.com/theme-next/hexo-theme-next themes/next\n# 配置主题\n$ vi _config.yml\n# 设置主题\ntheme : next\n# 设置语音\nlanguage: zh-CN\n# 设置头像\navatar:\n...\nurl: /images/avatar.png\n# 更新主题\n$ cd themes/next\n$ git pull\n# 开启标签/分类\n$ vi _config.yml\n  tags: /tags/ || tags\n  categories: /categories/ || th\n$ cd ../\n# 配置标签\n$ hexo new page tags\n$ vi hexo/source/tags/index.md\ntitle: 标签\ndate: 2014-12-22 12:39:04\ntype: \"tags\"\ncomments: false\n#配置分类\n$ hexo new page categories\n$ vi hexo/source/categories/index.md\ntitle: 分类\ndate: 2014-12-22 12:39:04\ntype: \"categories\"\ncomments: false\n```\n\n### github 发布\n```bash\n$ npm install hexo-deployer-git --save\n$ vi _config.yml\ndeploy：\n  type： git    \n  repo： <repository  url>   #https：//bitbucket.org/JohnSmith/johnsmith.bitbucket.io \n  branch： [branch]  #published \n  message： [message]   #leave this blank\n```\n\n\n","source":"_posts/2019-06-06-HEXO.md","raw":"---\ntitle: \"HEXO使用记录\"\ndate: 2019-06-06\ncomments: true\ncategories: JavaScript\ntags:\n    - HEXO\n---\nHexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。\n <!-- more -->\n\n更新yay\n```bash\n$ yay -Syy\n```\n### 下载  git nodejs npm\n```bash\n$  yay -S git nodejs npm\n$ git --version\n$ node -v\n$ npm -v\n```\n更换npm源\n```bash\n$ sudo npm install -g cnpm --registry=https://registry.npm.taobao.org\n```\n### 安装hexo\n```bash\n$ sudo cnpm install -g hexo-cli\n$ hexo -v\n```\n### 创建项目（blog）\n```bash\n$ hexo init blog\n$ cd blog\n#安装依赖\n$ npm install\n$ npm audit fix\n# 生成\n$ hexo g\n# 清缓存\n$ hexo clean\n# 部署\n$ hexo d\n# 启动\n$ hexo s\n```\n### 下载主题\n```bash\n$ git clone https://github.com/theme-next/hexo-theme-next themes/next\n# 配置主题\n$ vi _config.yml\n# 设置主题\ntheme : next\n# 设置语音\nlanguage: zh-CN\n# 设置头像\navatar:\n...\nurl: /images/avatar.png\n# 更新主题\n$ cd themes/next\n$ git pull\n# 开启标签/分类\n$ vi _config.yml\n  tags: /tags/ || tags\n  categories: /categories/ || th\n$ cd ../\n# 配置标签\n$ hexo new page tags\n$ vi hexo/source/tags/index.md\ntitle: 标签\ndate: 2014-12-22 12:39:04\ntype: \"tags\"\ncomments: false\n#配置分类\n$ hexo new page categories\n$ vi hexo/source/categories/index.md\ntitle: 分类\ndate: 2014-12-22 12:39:04\ntype: \"categories\"\ncomments: false\n```\n\n### github 发布\n```bash\n$ npm install hexo-deployer-git --save\n$ vi _config.yml\ndeploy：\n  type： git    \n  repo： <repository  url>   #https：//bitbucket.org/JohnSmith/johnsmith.bitbucket.io \n  branch： [branch]  #published \n  message： [message]   #leave this blank\n```\n\n\n","slug":"2019-06-06-HEXO","published":1,"updated":"2019-07-05T07:55:55.000Z","layout":"post","photos":[],"link":"","_id":"cjypn1ql5003by4rb4ot4s7rc","content":"<p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。<br> <a id=\"more\"></a></p>\n<p>更新yay</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -Syy</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载-git-nodejs-npm\"><a href=\"#下载-git-nodejs-npm\" class=\"headerlink\" title=\"下载  git nodejs npm\"></a>下载  git nodejs npm</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  yay -S git nodejs npm</span><br><span class=\"line\">$ git --version</span><br><span class=\"line\">$ node -v</span><br><span class=\"line\">$ npm -v</span><br></pre></td></tr></table></figure>\n\n<p>更换npm源</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装hexo\"><a href=\"#安装hexo\" class=\"headerlink\" title=\"安装hexo\"></a>安装hexo</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cnpm install -g hexo-cli</span><br><span class=\"line\">$ hexo -v</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建项目（blog）\"><a href=\"#创建项目（blog）\" class=\"headerlink\" title=\"创建项目（blog）\"></a>创建项目（blog）</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo init blog</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> blog</span><br><span class=\"line\"><span class=\"comment\">#安装依赖</span></span><br><span class=\"line\">$ npm install</span><br><span class=\"line\">$ npm audit fix</span><br><span class=\"line\"><span class=\"comment\"># 生成</span></span><br><span class=\"line\">$ hexo g</span><br><span class=\"line\"><span class=\"comment\"># 清缓存</span></span><br><span class=\"line\">$ hexo clean</span><br><span class=\"line\"><span class=\"comment\"># 部署</span></span><br><span class=\"line\">$ hexo d</span><br><span class=\"line\"><span class=\"comment\"># 启动</span></span><br><span class=\"line\">$ hexo s</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载主题\"><a href=\"#下载主题\" class=\"headerlink\" title=\"下载主题\"></a>下载主题</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/theme-next/hexo-theme-next themes/next</span><br><span class=\"line\"><span class=\"comment\"># 配置主题</span></span><br><span class=\"line\">$ vi _config.yml</span><br><span class=\"line\"><span class=\"comment\"># 设置主题</span></span><br><span class=\"line\">theme : next</span><br><span class=\"line\"><span class=\"comment\"># 设置语音</span></span><br><span class=\"line\">language: zh-CN</span><br><span class=\"line\"><span class=\"comment\"># 设置头像</span></span><br><span class=\"line\">avatar:</span><br><span class=\"line\">...</span><br><span class=\"line\">url: /images/avatar.png</span><br><span class=\"line\"><span class=\"comment\"># 更新主题</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> themes/next</span><br><span class=\"line\">$ git pull</span><br><span class=\"line\"><span class=\"comment\"># 开启标签/分类</span></span><br><span class=\"line\">$ vi _config.yml</span><br><span class=\"line\">  tags: /tags/ || tags</span><br><span class=\"line\">  categories: /categories/ || th</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> ../</span><br><span class=\"line\"><span class=\"comment\"># 配置标签</span></span><br><span class=\"line\">$ hexo new page tags</span><br><span class=\"line\">$ vi hexo/<span class=\"built_in\">source</span>/tags/index.md</span><br><span class=\"line\">title: 标签</span><br><span class=\"line\">date: 2014-12-22 12:39:04</span><br><span class=\"line\"><span class=\"built_in\">type</span>: <span class=\"string\">\"tags\"</span></span><br><span class=\"line\">comments: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\">#配置分类</span></span><br><span class=\"line\">$ hexo new page categories</span><br><span class=\"line\">$ vi hexo/<span class=\"built_in\">source</span>/categories/index.md</span><br><span class=\"line\">title: 分类</span><br><span class=\"line\">date: 2014-12-22 12:39:04</span><br><span class=\"line\"><span class=\"built_in\">type</span>: <span class=\"string\">\"categories\"</span></span><br><span class=\"line\">comments: <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"github-发布\"><a href=\"#github-发布\" class=\"headerlink\" title=\"github 发布\"></a>github 发布</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-deployer-git --save</span><br><span class=\"line\">$ vi _config.yml</span><br><span class=\"line\">deploy：</span><br><span class=\"line\">  <span class=\"built_in\">type</span>： git    </span><br><span class=\"line\">  repo： &lt;repository  url&gt;   <span class=\"comment\">#https：//bitbucket.org/JohnSmith/johnsmith.bitbucket.io </span></span><br><span class=\"line\">  branch： [branch]  <span class=\"comment\">#published </span></span><br><span class=\"line\">  message： [message]   <span class=\"comment\">#leave this blank</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。<br>","more":"</p>\n<p>更新yay</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -Syy</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载-git-nodejs-npm\"><a href=\"#下载-git-nodejs-npm\" class=\"headerlink\" title=\"下载  git nodejs npm\"></a>下载  git nodejs npm</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  yay -S git nodejs npm</span><br><span class=\"line\">$ git --version</span><br><span class=\"line\">$ node -v</span><br><span class=\"line\">$ npm -v</span><br></pre></td></tr></table></figure>\n\n<p>更换npm源</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装hexo\"><a href=\"#安装hexo\" class=\"headerlink\" title=\"安装hexo\"></a>安装hexo</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cnpm install -g hexo-cli</span><br><span class=\"line\">$ hexo -v</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建项目（blog）\"><a href=\"#创建项目（blog）\" class=\"headerlink\" title=\"创建项目（blog）\"></a>创建项目（blog）</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo init blog</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> blog</span><br><span class=\"line\"><span class=\"comment\">#安装依赖</span></span><br><span class=\"line\">$ npm install</span><br><span class=\"line\">$ npm audit fix</span><br><span class=\"line\"><span class=\"comment\"># 生成</span></span><br><span class=\"line\">$ hexo g</span><br><span class=\"line\"><span class=\"comment\"># 清缓存</span></span><br><span class=\"line\">$ hexo clean</span><br><span class=\"line\"><span class=\"comment\"># 部署</span></span><br><span class=\"line\">$ hexo d</span><br><span class=\"line\"><span class=\"comment\"># 启动</span></span><br><span class=\"line\">$ hexo s</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载主题\"><a href=\"#下载主题\" class=\"headerlink\" title=\"下载主题\"></a>下载主题</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/theme-next/hexo-theme-next themes/next</span><br><span class=\"line\"><span class=\"comment\"># 配置主题</span></span><br><span class=\"line\">$ vi _config.yml</span><br><span class=\"line\"><span class=\"comment\"># 设置主题</span></span><br><span class=\"line\">theme : next</span><br><span class=\"line\"><span class=\"comment\"># 设置语音</span></span><br><span class=\"line\">language: zh-CN</span><br><span class=\"line\"><span class=\"comment\"># 设置头像</span></span><br><span class=\"line\">avatar:</span><br><span class=\"line\">...</span><br><span class=\"line\">url: /images/avatar.png</span><br><span class=\"line\"><span class=\"comment\"># 更新主题</span></span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> themes/next</span><br><span class=\"line\">$ git pull</span><br><span class=\"line\"><span class=\"comment\"># 开启标签/分类</span></span><br><span class=\"line\">$ vi _config.yml</span><br><span class=\"line\">  tags: /tags/ || tags</span><br><span class=\"line\">  categories: /categories/ || th</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> ../</span><br><span class=\"line\"><span class=\"comment\"># 配置标签</span></span><br><span class=\"line\">$ hexo new page tags</span><br><span class=\"line\">$ vi hexo/<span class=\"built_in\">source</span>/tags/index.md</span><br><span class=\"line\">title: 标签</span><br><span class=\"line\">date: 2014-12-22 12:39:04</span><br><span class=\"line\"><span class=\"built_in\">type</span>: <span class=\"string\">\"tags\"</span></span><br><span class=\"line\">comments: <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\">#配置分类</span></span><br><span class=\"line\">$ hexo new page categories</span><br><span class=\"line\">$ vi hexo/<span class=\"built_in\">source</span>/categories/index.md</span><br><span class=\"line\">title: 分类</span><br><span class=\"line\">date: 2014-12-22 12:39:04</span><br><span class=\"line\"><span class=\"built_in\">type</span>: <span class=\"string\">\"categories\"</span></span><br><span class=\"line\">comments: <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"github-发布\"><a href=\"#github-发布\" class=\"headerlink\" title=\"github 发布\"></a>github 发布</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-deployer-git --save</span><br><span class=\"line\">$ vi _config.yml</span><br><span class=\"line\">deploy：</span><br><span class=\"line\">  <span class=\"built_in\">type</span>： git    </span><br><span class=\"line\">  repo： &lt;repository  url&gt;   <span class=\"comment\">#https：//bitbucket.org/JohnSmith/johnsmith.bitbucket.io </span></span><br><span class=\"line\">  branch： [branch]  <span class=\"comment\">#published </span></span><br><span class=\"line\">  message： [message]   <span class=\"comment\">#leave this blank</span></span><br></pre></td></tr></table></figure>"},{"title":"PHP-数据结构(ZVAL)","date":"2018-11-17T05:00:00.000Z","comments":1,"_content":"## 介绍\n\nPHP是弱类型语言,在PHP代码中声明或使用变量的时候,并不需要强制指明其数据类型.在PHP内核中定义的变量类型:\n <!-- more -->\n```c\n/* Zend/zend_type.h : line 304 */\n#define IS_UNDEF                    0\n#define IS_NULL                        1\n...\n#define IS_PTR                        17\n#define _IS_ERROR                    20\n```\n\n## zval\nPHP底层设计了一个zval(“Zend value”的缩写)的数据结构,可以用来表示任意类型的PHP值,因此,它可能是所有PHP中最重要的结构.本节介绍zvals及其使用背后的基本概念.\n\n```c\n/* Zend/zend_type.h */\ntypedef union _zend_value {\n...\n} zend_value;\nstruct _zval_struct {\n...\n};\n```\n虽然看起来变得好大, 但其实你仔细看, 全部都是联合体, 这个新的zval在64位环境下,现在只需要16个字节(2个指针size), 它主要分为俩个部分, value和扩充字段, 而扩充字段又分为u1和u2俩个部分, 其中u1是type info, u2是各种辅助字.\n其中value部分, 是一个size_t大小(一个指针大小), 可以保存一个指针, 或者一个long, 或者一个double.\n而type info部分则保存了这个zval的类型. 扩充辅助字段则会在多个其他地方使用, 比如next, 就用在取代Hashtable中原来的拉链指针, 这部分会在以后介绍HashTable的时候再来详解.\n\n从PHP7开始, 对于在zval的value字段中能保存下的值, 就不再对他们进行引用计数了, 而是在拷贝的时候直接赋值, 这样就省掉了大量的引用计数相关的操作, 这部分类型有:\n    IS_LONG\n    IS_DOUBLE\n当然对于那种根本没有值, 只有类型的类型, 也不需要引用计数了:\n    IS_NULL\n    IS_FALSE\n    IS_TRUE\n而对于复杂类型, 一个size_t保存不下的, 那么我们就用value来保存一个指针, 这个指针指向这个具体的值, 引用计数也随之作用于这个值上, 而不在是作用于zval上了.\n\n\n所以, 在PHP7开始, 我们移除了MAKE_STD_ZVAL/ALLOC_ZVAL宏, 不再支持存堆内存上申请zval. 函数内部使用的zval要么来自外面输入, 要么使用在栈上分配的临时zval.\n\n### 操作zval\n\n对zval的操作定义了很多宏,这维持了一个抽象层次,使意图更清晰,将来的PHP版本zval的内部改变了还可以兼容.\n```c\n//不正确\nzval zv = ...\nif (zv_ptr->type == IS_LONG) {\n    php_printf(\"此变量为长整形,值为 %ld\\n\", zv->value.lval);\n} else ...\n\n//推荐使用宏操作,\nzval  zv  = ...\nif  (Z_TYPE zv ) ==  IS_LONG ) {\n    php_printf (“此变量为长整形,值为 ％ld \\ n ” , Z_LVAL_P zv ));\n}  else  ...\n\n//宏有_P后缀表示操作的是zval指针\nZ_TYPE(zv);                 // 获取zval类型 = zv.type\nZ_TYPE_P(zv_ptr);           // 获取指针指向的zval类型= zv_ptr->type\n\n```\n\n#### zval.value 相关宏\n```code\n    No. 名称                 变量名       含义                        访问宏\n    1   zend_long           lval        整数(integer)                Z_LVAL(zval)\n    2   double              dval        浮動小数点数(float/double)    Z_DVAL(zval)\n    3   zend_refcounted     *counted    引用计数                      Z_COUNTED(zval)\n    4   zend_string         *str        字符串                       Z_STR(zval)\n    5   zend_array          *arr        数组                         Z_ARR(zval)\n    6   zend_object         *obj        对象                         Z_OBJ(zval)\n    7   zend_resource       *res        资源                         Z_RES(zval)\n    8   zend_reference      *ref        引用                         Z_REF(zval)\n    9   zend_ast_ref        *ast        抽象構文木                    Z_AST(zval)\n    10  zval                *zv         zval指针                     Z_INDIRECT(zval)\n    11  void                *ptr        任意类型指针                  Z_PTR(zval)\n    12  zend_class_entry    *ce         类                          Z_CE(zval)\n    13  zend_function       *func       函数                         Z_FUNC(zval)\n```\n#### zval 相关宏\n```code\n    ZVAL_UNDEF(z): 表示zval被销毁\n    ZVAL_NULL(z): 设置为NULL\n    ZVAL_FALSE(z): 设置为false\n    ZVAL_TRUE(z): 设置为true\n    ZVAL_BOOL(z, b): 设置为布尔型,b为IS_TRUE、IS_FALSE,与上面两个等价\n    ZVAL_LONG(z, l): 设置为整形,l类型为zend_long,如:zval z; ZVAL_LONG(&z, 88);\n    ZVAL_DOUBLE(z, d): 设置为浮点型,d类型为double\n    ZVAL_STR(z, s): 设置字符串,将z的value设置为s,s类型为zend_string*,不会增加s的refcount,支持interned strings\n    ZVAL_NEW_STR(z, s): 同ZVAL_STR(z, s),s为普通字符串,不支持interned strings\n    ZVAL_STR_COPY(z, s): 将s拷贝到z的value,s类型为zend_string*,同ZVAL_STR(z, s),这里会增加s的refcount\n    ZVAL_ARR(z, a): 设置为数组,a类型为zend_array*\n    ZVAL_NEW_ARR(z): 新分配一个数组,主动分配一个zend_array\n    ZVAL_NEW_PERSISTENT_ARR(z): 创建持久化数组,通过malloc分配,需要手动释放\n    ZVAL_OBJ(z, o): 设置为对象,o类型为zend_object*\n    ZVAL_RES(z, r): 设置为资源,r类型为zend_resource*\n    ZVAL_NEW_RES(z, h, p, t): 新创建一个资源,h为资源handle,t为type,p为资源ptr指向结构\n    ZVAL_REF(z, r): 设置为引用,r类型为zend_reference*\n    ZVAL_NEW_EMPTY_REF(z): 新创建一个空引用,没有设置具体引用的value\n    ZVAL_NEW_REF(z, r): 新创建一个引用,r为引用的值,类型为zval*\n```\n### 在代码中查看zval\n\n## 参考资料:\n    https://github.com/pangudashu/php7-internal/blob/master/7/var.md\n    https://net-newbie.com/phpext/7-zval.html\n    https://github.com/laruence/php7-internal/blob/master/zval.md\n","source":"_posts/2018-11-17-ZVAL.md","raw":"---\ntitle: \"PHP-数据结构(ZVAL)\"\ndate: 2018-11-17\ncomments: true\ncategories: PHP\ntags:\n    - PHP\n    - 内核\n---\n## 介绍\n\nPHP是弱类型语言,在PHP代码中声明或使用变量的时候,并不需要强制指明其数据类型.在PHP内核中定义的变量类型:\n <!-- more -->\n```c\n/* Zend/zend_type.h : line 304 */\n#define IS_UNDEF                    0\n#define IS_NULL                        1\n...\n#define IS_PTR                        17\n#define _IS_ERROR                    20\n```\n\n## zval\nPHP底层设计了一个zval(“Zend value”的缩写)的数据结构,可以用来表示任意类型的PHP值,因此,它可能是所有PHP中最重要的结构.本节介绍zvals及其使用背后的基本概念.\n\n```c\n/* Zend/zend_type.h */\ntypedef union _zend_value {\n...\n} zend_value;\nstruct _zval_struct {\n...\n};\n```\n虽然看起来变得好大, 但其实你仔细看, 全部都是联合体, 这个新的zval在64位环境下,现在只需要16个字节(2个指针size), 它主要分为俩个部分, value和扩充字段, 而扩充字段又分为u1和u2俩个部分, 其中u1是type info, u2是各种辅助字.\n其中value部分, 是一个size_t大小(一个指针大小), 可以保存一个指针, 或者一个long, 或者一个double.\n而type info部分则保存了这个zval的类型. 扩充辅助字段则会在多个其他地方使用, 比如next, 就用在取代Hashtable中原来的拉链指针, 这部分会在以后介绍HashTable的时候再来详解.\n\n从PHP7开始, 对于在zval的value字段中能保存下的值, 就不再对他们进行引用计数了, 而是在拷贝的时候直接赋值, 这样就省掉了大量的引用计数相关的操作, 这部分类型有:\n    IS_LONG\n    IS_DOUBLE\n当然对于那种根本没有值, 只有类型的类型, 也不需要引用计数了:\n    IS_NULL\n    IS_FALSE\n    IS_TRUE\n而对于复杂类型, 一个size_t保存不下的, 那么我们就用value来保存一个指针, 这个指针指向这个具体的值, 引用计数也随之作用于这个值上, 而不在是作用于zval上了.\n\n\n所以, 在PHP7开始, 我们移除了MAKE_STD_ZVAL/ALLOC_ZVAL宏, 不再支持存堆内存上申请zval. 函数内部使用的zval要么来自外面输入, 要么使用在栈上分配的临时zval.\n\n### 操作zval\n\n对zval的操作定义了很多宏,这维持了一个抽象层次,使意图更清晰,将来的PHP版本zval的内部改变了还可以兼容.\n```c\n//不正确\nzval zv = ...\nif (zv_ptr->type == IS_LONG) {\n    php_printf(\"此变量为长整形,值为 %ld\\n\", zv->value.lval);\n} else ...\n\n//推荐使用宏操作,\nzval  zv  = ...\nif  (Z_TYPE zv ) ==  IS_LONG ) {\n    php_printf (“此变量为长整形,值为 ％ld \\ n ” , Z_LVAL_P zv ));\n}  else  ...\n\n//宏有_P后缀表示操作的是zval指针\nZ_TYPE(zv);                 // 获取zval类型 = zv.type\nZ_TYPE_P(zv_ptr);           // 获取指针指向的zval类型= zv_ptr->type\n\n```\n\n#### zval.value 相关宏\n```code\n    No. 名称                 变量名       含义                        访问宏\n    1   zend_long           lval        整数(integer)                Z_LVAL(zval)\n    2   double              dval        浮動小数点数(float/double)    Z_DVAL(zval)\n    3   zend_refcounted     *counted    引用计数                      Z_COUNTED(zval)\n    4   zend_string         *str        字符串                       Z_STR(zval)\n    5   zend_array          *arr        数组                         Z_ARR(zval)\n    6   zend_object         *obj        对象                         Z_OBJ(zval)\n    7   zend_resource       *res        资源                         Z_RES(zval)\n    8   zend_reference      *ref        引用                         Z_REF(zval)\n    9   zend_ast_ref        *ast        抽象構文木                    Z_AST(zval)\n    10  zval                *zv         zval指针                     Z_INDIRECT(zval)\n    11  void                *ptr        任意类型指针                  Z_PTR(zval)\n    12  zend_class_entry    *ce         类                          Z_CE(zval)\n    13  zend_function       *func       函数                         Z_FUNC(zval)\n```\n#### zval 相关宏\n```code\n    ZVAL_UNDEF(z): 表示zval被销毁\n    ZVAL_NULL(z): 设置为NULL\n    ZVAL_FALSE(z): 设置为false\n    ZVAL_TRUE(z): 设置为true\n    ZVAL_BOOL(z, b): 设置为布尔型,b为IS_TRUE、IS_FALSE,与上面两个等价\n    ZVAL_LONG(z, l): 设置为整形,l类型为zend_long,如:zval z; ZVAL_LONG(&z, 88);\n    ZVAL_DOUBLE(z, d): 设置为浮点型,d类型为double\n    ZVAL_STR(z, s): 设置字符串,将z的value设置为s,s类型为zend_string*,不会增加s的refcount,支持interned strings\n    ZVAL_NEW_STR(z, s): 同ZVAL_STR(z, s),s为普通字符串,不支持interned strings\n    ZVAL_STR_COPY(z, s): 将s拷贝到z的value,s类型为zend_string*,同ZVAL_STR(z, s),这里会增加s的refcount\n    ZVAL_ARR(z, a): 设置为数组,a类型为zend_array*\n    ZVAL_NEW_ARR(z): 新分配一个数组,主动分配一个zend_array\n    ZVAL_NEW_PERSISTENT_ARR(z): 创建持久化数组,通过malloc分配,需要手动释放\n    ZVAL_OBJ(z, o): 设置为对象,o类型为zend_object*\n    ZVAL_RES(z, r): 设置为资源,r类型为zend_resource*\n    ZVAL_NEW_RES(z, h, p, t): 新创建一个资源,h为资源handle,t为type,p为资源ptr指向结构\n    ZVAL_REF(z, r): 设置为引用,r类型为zend_reference*\n    ZVAL_NEW_EMPTY_REF(z): 新创建一个空引用,没有设置具体引用的value\n    ZVAL_NEW_REF(z, r): 新创建一个引用,r为引用的值,类型为zval*\n```\n### 在代码中查看zval\n\n## 参考资料:\n    https://github.com/pangudashu/php7-internal/blob/master/7/var.md\n    https://net-newbie.com/phpext/7-zval.html\n    https://github.com/laruence/php7-internal/blob/master/zval.md\n","slug":"2018-11-17-ZVAL","published":1,"updated":"2019-07-05T07:55:55.000Z","layout":"post","photos":[],"link":"","_id":"cjypn1ql6003fy4rboli7fkal","content":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>PHP是弱类型语言,在PHP代码中声明或使用变量的时候,并不需要强制指明其数据类型.在PHP内核中定义的变量类型:<br> <a id=\"more\"></a></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Zend/zend_type.h : line 304 */</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> IS_UNDEF                    0</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> IS_NULL                        1</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> IS_PTR                        17</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _IS_ERROR                    20</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"zval\"><a href=\"#zval\" class=\"headerlink\" title=\"zval\"></a>zval</h2><p>PHP底层设计了一个zval(“Zend value”的缩写)的数据结构,可以用来表示任意类型的PHP值,因此,它可能是所有PHP中最重要的结构.本节介绍zvals及其使用背后的基本概念.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Zend/zend_type.h */</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">union</span> _zend_value &#123;</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125; zend_value;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> _<span class=\"title\">zval_struct</span> &#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>虽然看起来变得好大, 但其实你仔细看, 全部都是联合体, 这个新的zval在64位环境下,现在只需要16个字节(2个指针size), 它主要分为俩个部分, value和扩充字段, 而扩充字段又分为u1和u2俩个部分, 其中u1是type info, u2是各种辅助字.<br>其中value部分, 是一个size_t大小(一个指针大小), 可以保存一个指针, 或者一个long, 或者一个double.<br>而type info部分则保存了这个zval的类型. 扩充辅助字段则会在多个其他地方使用, 比如next, 就用在取代Hashtable中原来的拉链指针, 这部分会在以后介绍HashTable的时候再来详解.</p>\n<p>从PHP7开始, 对于在zval的value字段中能保存下的值, 就不再对他们进行引用计数了, 而是在拷贝的时候直接赋值, 这样就省掉了大量的引用计数相关的操作, 这部分类型有:<br>    IS_LONG<br>    IS_DOUBLE<br>当然对于那种根本没有值, 只有类型的类型, 也不需要引用计数了:<br>    IS_NULL<br>    IS_FALSE<br>    IS_TRUE<br>而对于复杂类型, 一个size_t保存不下的, 那么我们就用value来保存一个指针, 这个指针指向这个具体的值, 引用计数也随之作用于这个值上, 而不在是作用于zval上了.</p>\n<p>所以, 在PHP7开始, 我们移除了MAKE_STD_ZVAL/ALLOC_ZVAL宏, 不再支持存堆内存上申请zval. 函数内部使用的zval要么来自外面输入, 要么使用在栈上分配的临时zval.</p>\n<h3 id=\"操作zval\"><a href=\"#操作zval\" class=\"headerlink\" title=\"操作zval\"></a>操作zval</h3><p>对zval的操作定义了很多宏,这维持了一个抽象层次,使意图更清晰,将来的PHP版本zval的内部改变了还可以兼容.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//不正确</span></span><br><span class=\"line\">zval zv = ...</span><br><span class=\"line\"><span class=\"keyword\">if</span> (zv_ptr-&gt;type == IS_LONG) &#123;</span><br><span class=\"line\">    php_printf(<span class=\"string\">\"此变量为长整形,值为 %ld\\n\"</span>, zv-&gt;value.lval);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//推荐使用宏操作,</span></span><br><span class=\"line\">zval  zv  = ...</span><br><span class=\"line\"><span class=\"keyword\">if</span>  (Z_TYPE zv ) ==  IS_LONG ) &#123;</span><br><span class=\"line\">    php_printf (“此变量为长整形,值为 ％ld \\ n ” , Z_LVAL_P zv ));</span><br><span class=\"line\">&#125;  <span class=\"keyword\">else</span>  ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//宏有_P后缀表示操作的是zval指针</span></span><br><span class=\"line\">Z_TYPE(zv);                 <span class=\"comment\">// 获取zval类型 = zv.type</span></span><br><span class=\"line\">Z_TYPE_P(zv_ptr);           <span class=\"comment\">// 获取指针指向的zval类型= zv_ptr-&gt;type</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"zval-value-相关宏\"><a href=\"#zval-value-相关宏\" class=\"headerlink\" title=\"zval.value 相关宏\"></a>zval.value 相关宏</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">No. 名称                 变量名       含义                        访问宏</span><br><span class=\"line\">1   zend_long           lval        整数(integer)                Z_LVAL(zval)</span><br><span class=\"line\">2   double              dval        浮動小数点数(float/double)    Z_DVAL(zval)</span><br><span class=\"line\">3   zend_refcounted     *counted    引用计数                      Z_COUNTED(zval)</span><br><span class=\"line\">4   zend_string         *str        字符串                       Z_STR(zval)</span><br><span class=\"line\">5   zend_array          *arr        数组                         Z_ARR(zval)</span><br><span class=\"line\">6   zend_object         *obj        对象                         Z_OBJ(zval)</span><br><span class=\"line\">7   zend_resource       *res        资源                         Z_RES(zval)</span><br><span class=\"line\">8   zend_reference      *ref        引用                         Z_REF(zval)</span><br><span class=\"line\">9   zend_ast_ref        *ast        抽象構文木                    Z_AST(zval)</span><br><span class=\"line\">10  zval                *zv         zval指针                     Z_INDIRECT(zval)</span><br><span class=\"line\">11  void                *ptr        任意类型指针                  Z_PTR(zval)</span><br><span class=\"line\">12  zend_class_entry    *ce         类                          Z_CE(zval)</span><br><span class=\"line\">13  zend_function       *func       函数                         Z_FUNC(zval)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"zval-相关宏\"><a href=\"#zval-相关宏\" class=\"headerlink\" title=\"zval 相关宏\"></a>zval 相关宏</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ZVAL_UNDEF(z): 表示zval被销毁</span><br><span class=\"line\">ZVAL_NULL(z): 设置为NULL</span><br><span class=\"line\">ZVAL_FALSE(z): 设置为false</span><br><span class=\"line\">ZVAL_TRUE(z): 设置为true</span><br><span class=\"line\">ZVAL_BOOL(z, b): 设置为布尔型,b为IS_TRUE、IS_FALSE,与上面两个等价</span><br><span class=\"line\">ZVAL_LONG(z, l): 设置为整形,l类型为zend_long,如:zval z; ZVAL_LONG(&amp;z, 88);</span><br><span class=\"line\">ZVAL_DOUBLE(z, d): 设置为浮点型,d类型为double</span><br><span class=\"line\">ZVAL_STR(z, s): 设置字符串,将z的value设置为s,s类型为zend_string*,不会增加s的refcount,支持interned strings</span><br><span class=\"line\">ZVAL_NEW_STR(z, s): 同ZVAL_STR(z, s),s为普通字符串,不支持interned strings</span><br><span class=\"line\">ZVAL_STR_COPY(z, s): 将s拷贝到z的value,s类型为zend_string*,同ZVAL_STR(z, s),这里会增加s的refcount</span><br><span class=\"line\">ZVAL_ARR(z, a): 设置为数组,a类型为zend_array*</span><br><span class=\"line\">ZVAL_NEW_ARR(z): 新分配一个数组,主动分配一个zend_array</span><br><span class=\"line\">ZVAL_NEW_PERSISTENT_ARR(z): 创建持久化数组,通过malloc分配,需要手动释放</span><br><span class=\"line\">ZVAL_OBJ(z, o): 设置为对象,o类型为zend_object*</span><br><span class=\"line\">ZVAL_RES(z, r): 设置为资源,r类型为zend_resource*</span><br><span class=\"line\">ZVAL_NEW_RES(z, h, p, t): 新创建一个资源,h为资源handle,t为type,p为资源ptr指向结构</span><br><span class=\"line\">ZVAL_REF(z, r): 设置为引用,r类型为zend_reference*</span><br><span class=\"line\">ZVAL_NEW_EMPTY_REF(z): 新创建一个空引用,没有设置具体引用的value</span><br><span class=\"line\">ZVAL_NEW_REF(z, r): 新创建一个引用,r为引用的值,类型为zval*</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在代码中查看zval\"><a href=\"#在代码中查看zval\" class=\"headerlink\" title=\"在代码中查看zval\"></a>在代码中查看zval</h3><h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料:\"></a>参考资料:</h2><pre><code>https://github.com/pangudashu/php7-internal/blob/master/7/var.md\nhttps://net-newbie.com/phpext/7-zval.html\nhttps://github.com/laruence/php7-internal/blob/master/zval.md</code></pre>","site":{"data":{}},"excerpt":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>PHP是弱类型语言,在PHP代码中声明或使用变量的时候,并不需要强制指明其数据类型.在PHP内核中定义的变量类型:<br>","more":"</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Zend/zend_type.h : line 304 */</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> IS_UNDEF                    0</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> IS_NULL                        1</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> IS_PTR                        17</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _IS_ERROR                    20</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"zval\"><a href=\"#zval\" class=\"headerlink\" title=\"zval\"></a>zval</h2><p>PHP底层设计了一个zval(“Zend value”的缩写)的数据结构,可以用来表示任意类型的PHP值,因此,它可能是所有PHP中最重要的结构.本节介绍zvals及其使用背后的基本概念.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* Zend/zend_type.h */</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">union</span> _zend_value &#123;</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125; zend_value;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> _<span class=\"title\">zval_struct</span> &#123;</span></span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>虽然看起来变得好大, 但其实你仔细看, 全部都是联合体, 这个新的zval在64位环境下,现在只需要16个字节(2个指针size), 它主要分为俩个部分, value和扩充字段, 而扩充字段又分为u1和u2俩个部分, 其中u1是type info, u2是各种辅助字.<br>其中value部分, 是一个size_t大小(一个指针大小), 可以保存一个指针, 或者一个long, 或者一个double.<br>而type info部分则保存了这个zval的类型. 扩充辅助字段则会在多个其他地方使用, 比如next, 就用在取代Hashtable中原来的拉链指针, 这部分会在以后介绍HashTable的时候再来详解.</p>\n<p>从PHP7开始, 对于在zval的value字段中能保存下的值, 就不再对他们进行引用计数了, 而是在拷贝的时候直接赋值, 这样就省掉了大量的引用计数相关的操作, 这部分类型有:<br>    IS_LONG<br>    IS_DOUBLE<br>当然对于那种根本没有值, 只有类型的类型, 也不需要引用计数了:<br>    IS_NULL<br>    IS_FALSE<br>    IS_TRUE<br>而对于复杂类型, 一个size_t保存不下的, 那么我们就用value来保存一个指针, 这个指针指向这个具体的值, 引用计数也随之作用于这个值上, 而不在是作用于zval上了.</p>\n<p>所以, 在PHP7开始, 我们移除了MAKE_STD_ZVAL/ALLOC_ZVAL宏, 不再支持存堆内存上申请zval. 函数内部使用的zval要么来自外面输入, 要么使用在栈上分配的临时zval.</p>\n<h3 id=\"操作zval\"><a href=\"#操作zval\" class=\"headerlink\" title=\"操作zval\"></a>操作zval</h3><p>对zval的操作定义了很多宏,这维持了一个抽象层次,使意图更清晰,将来的PHP版本zval的内部改变了还可以兼容.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//不正确</span></span><br><span class=\"line\">zval zv = ...</span><br><span class=\"line\"><span class=\"keyword\">if</span> (zv_ptr-&gt;type == IS_LONG) &#123;</span><br><span class=\"line\">    php_printf(<span class=\"string\">\"此变量为长整形,值为 %ld\\n\"</span>, zv-&gt;value.lval);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//推荐使用宏操作,</span></span><br><span class=\"line\">zval  zv  = ...</span><br><span class=\"line\"><span class=\"keyword\">if</span>  (Z_TYPE zv ) ==  IS_LONG ) &#123;</span><br><span class=\"line\">    php_printf (“此变量为长整形,值为 ％ld \\ n ” , Z_LVAL_P zv ));</span><br><span class=\"line\">&#125;  <span class=\"keyword\">else</span>  ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//宏有_P后缀表示操作的是zval指针</span></span><br><span class=\"line\">Z_TYPE(zv);                 <span class=\"comment\">// 获取zval类型 = zv.type</span></span><br><span class=\"line\">Z_TYPE_P(zv_ptr);           <span class=\"comment\">// 获取指针指向的zval类型= zv_ptr-&gt;type</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"zval-value-相关宏\"><a href=\"#zval-value-相关宏\" class=\"headerlink\" title=\"zval.value 相关宏\"></a>zval.value 相关宏</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">No. 名称                 变量名       含义                        访问宏</span><br><span class=\"line\">1   zend_long           lval        整数(integer)                Z_LVAL(zval)</span><br><span class=\"line\">2   double              dval        浮動小数点数(float/double)    Z_DVAL(zval)</span><br><span class=\"line\">3   zend_refcounted     *counted    引用计数                      Z_COUNTED(zval)</span><br><span class=\"line\">4   zend_string         *str        字符串                       Z_STR(zval)</span><br><span class=\"line\">5   zend_array          *arr        数组                         Z_ARR(zval)</span><br><span class=\"line\">6   zend_object         *obj        对象                         Z_OBJ(zval)</span><br><span class=\"line\">7   zend_resource       *res        资源                         Z_RES(zval)</span><br><span class=\"line\">8   zend_reference      *ref        引用                         Z_REF(zval)</span><br><span class=\"line\">9   zend_ast_ref        *ast        抽象構文木                    Z_AST(zval)</span><br><span class=\"line\">10  zval                *zv         zval指针                     Z_INDIRECT(zval)</span><br><span class=\"line\">11  void                *ptr        任意类型指针                  Z_PTR(zval)</span><br><span class=\"line\">12  zend_class_entry    *ce         类                          Z_CE(zval)</span><br><span class=\"line\">13  zend_function       *func       函数                         Z_FUNC(zval)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"zval-相关宏\"><a href=\"#zval-相关宏\" class=\"headerlink\" title=\"zval 相关宏\"></a>zval 相关宏</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ZVAL_UNDEF(z): 表示zval被销毁</span><br><span class=\"line\">ZVAL_NULL(z): 设置为NULL</span><br><span class=\"line\">ZVAL_FALSE(z): 设置为false</span><br><span class=\"line\">ZVAL_TRUE(z): 设置为true</span><br><span class=\"line\">ZVAL_BOOL(z, b): 设置为布尔型,b为IS_TRUE、IS_FALSE,与上面两个等价</span><br><span class=\"line\">ZVAL_LONG(z, l): 设置为整形,l类型为zend_long,如:zval z; ZVAL_LONG(&amp;z, 88);</span><br><span class=\"line\">ZVAL_DOUBLE(z, d): 设置为浮点型,d类型为double</span><br><span class=\"line\">ZVAL_STR(z, s): 设置字符串,将z的value设置为s,s类型为zend_string*,不会增加s的refcount,支持interned strings</span><br><span class=\"line\">ZVAL_NEW_STR(z, s): 同ZVAL_STR(z, s),s为普通字符串,不支持interned strings</span><br><span class=\"line\">ZVAL_STR_COPY(z, s): 将s拷贝到z的value,s类型为zend_string*,同ZVAL_STR(z, s),这里会增加s的refcount</span><br><span class=\"line\">ZVAL_ARR(z, a): 设置为数组,a类型为zend_array*</span><br><span class=\"line\">ZVAL_NEW_ARR(z): 新分配一个数组,主动分配一个zend_array</span><br><span class=\"line\">ZVAL_NEW_PERSISTENT_ARR(z): 创建持久化数组,通过malloc分配,需要手动释放</span><br><span class=\"line\">ZVAL_OBJ(z, o): 设置为对象,o类型为zend_object*</span><br><span class=\"line\">ZVAL_RES(z, r): 设置为资源,r类型为zend_resource*</span><br><span class=\"line\">ZVAL_NEW_RES(z, h, p, t): 新创建一个资源,h为资源handle,t为type,p为资源ptr指向结构</span><br><span class=\"line\">ZVAL_REF(z, r): 设置为引用,r类型为zend_reference*</span><br><span class=\"line\">ZVAL_NEW_EMPTY_REF(z): 新创建一个空引用,没有设置具体引用的value</span><br><span class=\"line\">ZVAL_NEW_REF(z, r): 新创建一个引用,r为引用的值,类型为zval*</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在代码中查看zval\"><a href=\"#在代码中查看zval\" class=\"headerlink\" title=\"在代码中查看zval\"></a>在代码中查看zval</h3><h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料:\"></a>参考资料:</h2><pre><code>https://github.com/pangudashu/php7-internal/blob/master/7/var.md\nhttps://net-newbie.com/phpext/7-zval.html\nhttps://github.com/laruence/php7-internal/blob/master/zval.md</code></pre>"},{"title":"manjaro系统使用记录","date":"2019-06-05T04:00:00.000Z","comments":1,"_content":"Manjaro是一款基于Arch Linux、对用户友好、全球排名第1的Linux发行版。\n\n在Linux圈，Arch的确是一个异常强大的发行版。它有3个无与伦比的优势：\n* 滚动更新可以使软件保持最新；\n* AUR软件仓库有着世界上最齐全的Linux软件\n* 丰富的wiki和活跃的社区让所有问题都可以快速得到满意的答案。\n <!-- more -->\n\n\n 查看版本\n ```bash\n$ screenfetch\n```\n>错误：无法注册 ‘archlinuxcn’ 数据库 (数据库已登记)\n ```bash\n$ sudo vi /etc/pacman.conf \n```\n\n添加源\n ```bash\n$ sudo pacman-mirrors -i -c China -m rank\n```\n\n增加`archlinuxcn`库和`antergos`库\n ```bash\n$ echo -e \"\\n[archlinuxcn]\\nSigLevel = TrustAll\\nServer = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/\\$arch\\n\\n[antergos]\\nSigLevel = TrustAll\\nServer = https://mirrors.tuna.tsinghua.edu.cn/antergos/\\$repo/\\$arch\\n\"|sudo tee -a /etc/pacman.conf\n```\n更新\n ```bash\n$ sudo pacman -Syy\n```\n\n安装`archlinuxcn`签名钥匙&`antergos`签名钥匙\n ```bash\n$ sudo pacman -S --noconfirm archlinuxcn-keyring antergos-keyring\n```\n\n### 安装搜狗输入法\n ```bash\n$ sudo pacman -S --noconfirm fcitx-im fcitx-configtool fcitx-sogoupinyin\n```\n\n配置搜狗变量\n ```bash\n$ sudo echo -e \"export GTK_IM_MODULE=fcitx\\nexport QT_IM_MODULE=fcitx\\nexport XMODIFIERS=@im=fcitx\">>~/.xprofile\n```\n\n>  错误：搜狗输入法异常！请删除.config/SogouPY 并重启\n ```bash\n$ sogou-qimpanel\n```\n> sogou-qimpanel: error while loading shared libraries: libfcitx-qt.so.0: cannot open shared object file: No such file or directory\n ```bash\n$ sudo pacman -S fcitx-qt4\n```\n### 安装快照工具\n ```bash\n$ sudo pacman -S timeshift\n```\n\n安装git\n ```bash\n$ sudo pacman -S git\n$ git config --global user.name \"ziv\" \n$ git config --global user.email \"abc.ziv@hotmail.com\"\n```\n\n### 安装谷歌浏览器\n ```bash\n$ sudo pacman -S google-chrome \n```\n### 安装AUR助手yay\n ```bash\n $ sudo pacman -S yay\n# 手动编译\n$ git clone https://aur.archlinux.org/yay.git\n$ cd yay\n$ makepkg -si\n# 安装\n$ yay -S `软件`\n# 更新\n$ yay -Ss\n# 卸载\n$ yay -Rs `软件`\n```\n### 安装网易云音乐\n ```bash\n$ yay -S netease-cloud-music\n```\n\n### 安装oh-my-zsh\n ```bash\n$ wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O - | sh\n# 切换zsh\n$ chsh -s /bin/zsh\n# 查看主题\n$ ls ~/.oh-my-zsh/themes\n# 自动提示插件zsh-autosuggestions\n$ git clone git://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions\n# 语法高亮zsh-syntax-highlighting使用以下命令安装\n$ git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n# 修改主题 配置插件\n$vi ~/.zshrc\nplugins=(git zsh-syntax-highlighting  zsh-autosuggestions)\nZSH_THEME=\"主题\" 推荐：steeef\n# 更新配置\n$ source ~/.zshrc \n```\n#### incr也是zsh自动补全插件\n\n1. 下载自动补全插件http://mimosa-pudica.net/src/incr-0.2.zsh\n2. 放到oh-my-zsh的插件库中\n.oh-my-zsh/plugins/创建incr文件夹放到该文件夹中\n3. 在.zshrc中添加\n在.zshrc文件末尾添加下面这行\nsource ~/.oh-my-zsh/plugins/incr/incr*.zsh\n4. 重启命令行\n\n### 安装印象笔记\n ```bash\n$ yay -S nixnote2\n# 设置\nFile->Add Another User\nserver Yinxiang Biji\nTools->Synchronize\n```\n\n### 安装debtap（转换deb工具）\n ```bash\n$ yay -S debtap\n# 更新debtap数据库\n$ debtap -u\n# 转换deb包\n$ debtap -q 安装包.deb\n# 执行安装\n$ yay -U 安装包.pkg.tar.xz\n```\n\n### 安装TIM\n ```bash\n$ yay -S deepin.com.qq.office \n```\n\n### 安装微信\n ```bash\n$ sudo yay -S electronic-wechat\n```\n\n更改英文目录\n ```bash\n$ sudo pacman -S xdg-user-dirs-gtk\n$ export LANG=en_US\n$ xdg-user-dirs-gtk-update\n$ #然后会有个窗口提示语言更改，更新名称即可\n$ export LANG=zh_CN.UTF-8\n$ #然后重启电脑如果提示语言更改，保留旧的名称即可\n```\n### 安装截图工具flameshot\n```\n$ yay -S flameshot\n\n```\n\n### 安装thunderbird邮箱\n ```bash\n$ yay -S thunderbird\n```\n\n### 安装VScode\n ```bash\n$ yay -S visual-studio-code-bin\n```\n\n### 安装baiduPCS-web(百度网盘WEB版本)\n下载地址：https://github.com/liuzhuoling2011/baidupcs-web/releases\n ```bash\ncd #到软件所在的目录\nchmod a+x BaiduPCS-Go\n./BaiduPCS-Go\n```\n\n### 安装shadowsocks\n```bash\n$ yay -S shadowsocks-qt5 # 输入2\n```\n#### 系统代理\n系统设置 ->  代理 -> Use manually specified proxy cofinguration -> SOCKS Proxy:127.0.0.1 Prot:1080\n#### 浏览器代理\n以 Chrome 为例，安装 SwitchyOmega 插件代理。\n\nGithub 下载 SwitchyOmega：https://github.com/FelisCatus/SwitchyOmega/releases/\n\nChrome 打开 chrome://extensions/，把插件托进去安装。","source":"_posts/2019-06-05-manjaro.md","raw":"---\ntitle: \"manjaro系统使用记录\"\ndate: 2019-06-05\ncomments: true\ncategories: 系统\ntags:\n    - manjaro\n---\nManjaro是一款基于Arch Linux、对用户友好、全球排名第1的Linux发行版。\n\n在Linux圈，Arch的确是一个异常强大的发行版。它有3个无与伦比的优势：\n* 滚动更新可以使软件保持最新；\n* AUR软件仓库有着世界上最齐全的Linux软件\n* 丰富的wiki和活跃的社区让所有问题都可以快速得到满意的答案。\n <!-- more -->\n\n\n 查看版本\n ```bash\n$ screenfetch\n```\n>错误：无法注册 ‘archlinuxcn’ 数据库 (数据库已登记)\n ```bash\n$ sudo vi /etc/pacman.conf \n```\n\n添加源\n ```bash\n$ sudo pacman-mirrors -i -c China -m rank\n```\n\n增加`archlinuxcn`库和`antergos`库\n ```bash\n$ echo -e \"\\n[archlinuxcn]\\nSigLevel = TrustAll\\nServer = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/\\$arch\\n\\n[antergos]\\nSigLevel = TrustAll\\nServer = https://mirrors.tuna.tsinghua.edu.cn/antergos/\\$repo/\\$arch\\n\"|sudo tee -a /etc/pacman.conf\n```\n更新\n ```bash\n$ sudo pacman -Syy\n```\n\n安装`archlinuxcn`签名钥匙&`antergos`签名钥匙\n ```bash\n$ sudo pacman -S --noconfirm archlinuxcn-keyring antergos-keyring\n```\n\n### 安装搜狗输入法\n ```bash\n$ sudo pacman -S --noconfirm fcitx-im fcitx-configtool fcitx-sogoupinyin\n```\n\n配置搜狗变量\n ```bash\n$ sudo echo -e \"export GTK_IM_MODULE=fcitx\\nexport QT_IM_MODULE=fcitx\\nexport XMODIFIERS=@im=fcitx\">>~/.xprofile\n```\n\n>  错误：搜狗输入法异常！请删除.config/SogouPY 并重启\n ```bash\n$ sogou-qimpanel\n```\n> sogou-qimpanel: error while loading shared libraries: libfcitx-qt.so.0: cannot open shared object file: No such file or directory\n ```bash\n$ sudo pacman -S fcitx-qt4\n```\n### 安装快照工具\n ```bash\n$ sudo pacman -S timeshift\n```\n\n安装git\n ```bash\n$ sudo pacman -S git\n$ git config --global user.name \"ziv\" \n$ git config --global user.email \"abc.ziv@hotmail.com\"\n```\n\n### 安装谷歌浏览器\n ```bash\n$ sudo pacman -S google-chrome \n```\n### 安装AUR助手yay\n ```bash\n $ sudo pacman -S yay\n# 手动编译\n$ git clone https://aur.archlinux.org/yay.git\n$ cd yay\n$ makepkg -si\n# 安装\n$ yay -S `软件`\n# 更新\n$ yay -Ss\n# 卸载\n$ yay -Rs `软件`\n```\n### 安装网易云音乐\n ```bash\n$ yay -S netease-cloud-music\n```\n\n### 安装oh-my-zsh\n ```bash\n$ wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O - | sh\n# 切换zsh\n$ chsh -s /bin/zsh\n# 查看主题\n$ ls ~/.oh-my-zsh/themes\n# 自动提示插件zsh-autosuggestions\n$ git clone git://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions\n# 语法高亮zsh-syntax-highlighting使用以下命令安装\n$ git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n# 修改主题 配置插件\n$vi ~/.zshrc\nplugins=(git zsh-syntax-highlighting  zsh-autosuggestions)\nZSH_THEME=\"主题\" 推荐：steeef\n# 更新配置\n$ source ~/.zshrc \n```\n#### incr也是zsh自动补全插件\n\n1. 下载自动补全插件http://mimosa-pudica.net/src/incr-0.2.zsh\n2. 放到oh-my-zsh的插件库中\n.oh-my-zsh/plugins/创建incr文件夹放到该文件夹中\n3. 在.zshrc中添加\n在.zshrc文件末尾添加下面这行\nsource ~/.oh-my-zsh/plugins/incr/incr*.zsh\n4. 重启命令行\n\n### 安装印象笔记\n ```bash\n$ yay -S nixnote2\n# 设置\nFile->Add Another User\nserver Yinxiang Biji\nTools->Synchronize\n```\n\n### 安装debtap（转换deb工具）\n ```bash\n$ yay -S debtap\n# 更新debtap数据库\n$ debtap -u\n# 转换deb包\n$ debtap -q 安装包.deb\n# 执行安装\n$ yay -U 安装包.pkg.tar.xz\n```\n\n### 安装TIM\n ```bash\n$ yay -S deepin.com.qq.office \n```\n\n### 安装微信\n ```bash\n$ sudo yay -S electronic-wechat\n```\n\n更改英文目录\n ```bash\n$ sudo pacman -S xdg-user-dirs-gtk\n$ export LANG=en_US\n$ xdg-user-dirs-gtk-update\n$ #然后会有个窗口提示语言更改，更新名称即可\n$ export LANG=zh_CN.UTF-8\n$ #然后重启电脑如果提示语言更改，保留旧的名称即可\n```\n### 安装截图工具flameshot\n```\n$ yay -S flameshot\n\n```\n\n### 安装thunderbird邮箱\n ```bash\n$ yay -S thunderbird\n```\n\n### 安装VScode\n ```bash\n$ yay -S visual-studio-code-bin\n```\n\n### 安装baiduPCS-web(百度网盘WEB版本)\n下载地址：https://github.com/liuzhuoling2011/baidupcs-web/releases\n ```bash\ncd #到软件所在的目录\nchmod a+x BaiduPCS-Go\n./BaiduPCS-Go\n```\n\n### 安装shadowsocks\n```bash\n$ yay -S shadowsocks-qt5 # 输入2\n```\n#### 系统代理\n系统设置 ->  代理 -> Use manually specified proxy cofinguration -> SOCKS Proxy:127.0.0.1 Prot:1080\n#### 浏览器代理\n以 Chrome 为例，安装 SwitchyOmega 插件代理。\n\nGithub 下载 SwitchyOmega：https://github.com/FelisCatus/SwitchyOmega/releases/\n\nChrome 打开 chrome://extensions/，把插件托进去安装。","slug":"2019-06-05-manjaro","published":1,"updated":"2019-07-05T07:55:55.000Z","layout":"post","photos":[],"link":"","_id":"cjypn1ql7003jy4rbaeqr9ior","content":"<p>Manjaro是一款基于Arch Linux、对用户友好、全球排名第1的Linux发行版。</p>\n<p>在Linux圈，Arch的确是一个异常强大的发行版。它有3个无与伦比的优势：</p>\n<ul>\n<li>滚动更新可以使软件保持最新；</li>\n<li>AUR软件仓库有着世界上最齐全的Linux软件</li>\n<li>丰富的wiki和活跃的社区让所有问题都可以快速得到满意的答案。<a id=\"more\"></a>\n\n\n</li>\n</ul>\n<p> 查看版本<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ screenfetch</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>错误：无法注册 ‘archlinuxcn’ 数据库 (数据库已登记)<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo vi /etc/pacman.conf</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<p>添加源<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman-mirrors -i -c China -m rank</span><br></pre></td></tr></table></figure></p>\n<p>增加<code>archlinuxcn</code>库和<code>antergos</code>库<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n[archlinuxcn]\\nSigLevel = TrustAll\\nServer = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/\\$arch\\n\\n[antergos]\\nSigLevel = TrustAll\\nServer = https://mirrors.tuna.tsinghua.edu.cn/antergos/\\$repo/\\$arch\\n\"</span>|sudo tee -a /etc/pacman.conf</span><br></pre></td></tr></table></figure></p>\n<p>更新<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -Syy</span><br></pre></td></tr></table></figure></p>\n<p>安装<code>archlinuxcn</code>签名钥匙&amp;<code>antergos</code>签名钥匙<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S --noconfirm archlinuxcn-keyring antergos-keyring</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"安装搜狗输入法\"><a href=\"#安装搜狗输入法\" class=\"headerlink\" title=\"安装搜狗输入法\"></a>安装搜狗输入法</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S --noconfirm fcitx-im fcitx-configtool fcitx-sogoupinyin</span><br></pre></td></tr></table></figure>\n\n<p>配置搜狗变量<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo <span class=\"built_in\">echo</span> -e <span class=\"string\">\"export GTK_IM_MODULE=fcitx\\nexport QT_IM_MODULE=fcitx\\nexport XMODIFIERS=@im=fcitx\"</span>&gt;&gt;~/.xprofile</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p> 错误：搜狗输入法异常！请删除.config/SogouPY 并重启<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sogou-qimpanel</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<blockquote>\n<p>sogou-qimpanel: error while loading shared libraries: libfcitx-qt.so.0: cannot open shared object file: No such file or directory<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S fcitx-qt4</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h3 id=\"安装快照工具\"><a href=\"#安装快照工具\" class=\"headerlink\" title=\"安装快照工具\"></a>安装快照工具</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S timeshift</span><br></pre></td></tr></table></figure>\n\n<p>安装git<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S git</span><br><span class=\"line\">$ git config --global user.name <span class=\"string\">\"ziv\"</span> </span><br><span class=\"line\">$ git config --global user.email <span class=\"string\">\"abc.ziv@hotmail.com\"</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"安装谷歌浏览器\"><a href=\"#安装谷歌浏览器\" class=\"headerlink\" title=\"安装谷歌浏览器\"></a>安装谷歌浏览器</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S google-chrome</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装AUR助手yay\"><a href=\"#安装AUR助手yay\" class=\"headerlink\" title=\"安装AUR助手yay\"></a>安装AUR助手yay</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> $ sudo pacman -S yay</span><br><span class=\"line\"><span class=\"comment\"># 手动编译</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://aur.archlinux.org/yay.git</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> yay</span><br><span class=\"line\">$ makepkg -si</span><br><span class=\"line\"><span class=\"comment\"># 安装</span></span><br><span class=\"line\">$ yay -S `软件`</span><br><span class=\"line\"><span class=\"comment\"># 更新</span></span><br><span class=\"line\">$ yay -Ss</span><br><span class=\"line\"><span class=\"comment\"># 卸载</span></span><br><span class=\"line\">$ yay -Rs `软件`</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装网易云音乐\"><a href=\"#安装网易云音乐\" class=\"headerlink\" title=\"安装网易云音乐\"></a>安装网易云音乐</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S netease-cloud-music</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装oh-my-zsh\"><a href=\"#安装oh-my-zsh\" class=\"headerlink\" title=\"安装oh-my-zsh\"></a>安装oh-my-zsh</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O - | sh</span><br><span class=\"line\"><span class=\"comment\"># 切换zsh</span></span><br><span class=\"line\">$ chsh -s /bin/zsh</span><br><span class=\"line\"><span class=\"comment\"># 查看主题</span></span><br><span class=\"line\">$ ls ~/.oh-my-zsh/themes</span><br><span class=\"line\"><span class=\"comment\"># 自动提示插件zsh-autosuggestions</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> git://github.com/zsh-users/zsh-autosuggestions <span class=\"variable\">$ZSH_CUSTOM</span>/plugins/zsh-autosuggestions</span><br><span class=\"line\"><span class=\"comment\"># 语法高亮zsh-syntax-highlighting使用以下命令安装</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class=\"variable\">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class=\"line\"><span class=\"comment\"># 修改主题 配置插件</span></span><br><span class=\"line\"><span class=\"variable\">$vi</span> ~/.zshrc</span><br><span class=\"line\">plugins=(git zsh-syntax-highlighting  zsh-autosuggestions)</span><br><span class=\"line\">ZSH_THEME=<span class=\"string\">\"主题\"</span> 推荐：steeef</span><br><span class=\"line\"><span class=\"comment\"># 更新配置</span></span><br><span class=\"line\">$ <span class=\"built_in\">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"incr也是zsh自动补全插件\"><a href=\"#incr也是zsh自动补全插件\" class=\"headerlink\" title=\"incr也是zsh自动补全插件\"></a>incr也是zsh自动补全插件</h4><ol>\n<li>下载自动补全插件<a href=\"http://mimosa-pudica.net/src/incr-0.2.zsh\" target=\"_blank\" rel=\"noopener\">http://mimosa-pudica.net/src/incr-0.2.zsh</a></li>\n<li>放到oh-my-zsh的插件库中<br>.oh-my-zsh/plugins/创建incr文件夹放到该文件夹中</li>\n<li>在.zshrc中添加<br>在.zshrc文件末尾添加下面这行<br>source ~/.oh-my-zsh/plugins/incr/incr*.zsh</li>\n<li>重启命令行</li>\n</ol>\n<h3 id=\"安装印象笔记\"><a href=\"#安装印象笔记\" class=\"headerlink\" title=\"安装印象笔记\"></a>安装印象笔记</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S nixnote2</span><br><span class=\"line\"><span class=\"comment\"># 设置</span></span><br><span class=\"line\">File-&gt;Add Another User</span><br><span class=\"line\">server Yinxiang Biji</span><br><span class=\"line\">Tools-&gt;Synchronize</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装debtap（转换deb工具）\"><a href=\"#安装debtap（转换deb工具）\" class=\"headerlink\" title=\"安装debtap（转换deb工具）\"></a>安装debtap（转换deb工具）</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S debtap</span><br><span class=\"line\"><span class=\"comment\"># 更新debtap数据库</span></span><br><span class=\"line\">$ debtap -u</span><br><span class=\"line\"><span class=\"comment\"># 转换deb包</span></span><br><span class=\"line\">$ debtap -q 安装包.deb</span><br><span class=\"line\"><span class=\"comment\"># 执行安装</span></span><br><span class=\"line\">$ yay -U 安装包.pkg.tar.xz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装TIM\"><a href=\"#安装TIM\" class=\"headerlink\" title=\"安装TIM\"></a>安装TIM</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S deepin.com.qq.office</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装微信\"><a href=\"#安装微信\" class=\"headerlink\" title=\"安装微信\"></a>安装微信</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo yay -S electronic-wechat</span><br></pre></td></tr></table></figure>\n\n<p>更改英文目录<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S xdg-user-dirs-gtk</span><br><span class=\"line\">$ <span class=\"built_in\">export</span> LANG=en_US</span><br><span class=\"line\">$ xdg-user-dirs-gtk-update</span><br><span class=\"line\">$ <span class=\"comment\">#然后会有个窗口提示语言更改，更新名称即可</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> LANG=zh_CN.UTF-8</span><br><span class=\"line\">$ <span class=\"comment\">#然后重启电脑如果提示语言更改，保留旧的名称即可</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"安装截图工具flameshot\"><a href=\"#安装截图工具flameshot\" class=\"headerlink\" title=\"安装截图工具flameshot\"></a>安装截图工具flameshot</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S flameshot</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装thunderbird邮箱\"><a href=\"#安装thunderbird邮箱\" class=\"headerlink\" title=\"安装thunderbird邮箱\"></a>安装thunderbird邮箱</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S thunderbird</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装VScode\"><a href=\"#安装VScode\" class=\"headerlink\" title=\"安装VScode\"></a>安装VScode</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S visual-studio-code-bin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装baiduPCS-web-百度网盘WEB版本\"><a href=\"#安装baiduPCS-web-百度网盘WEB版本\" class=\"headerlink\" title=\"安装baiduPCS-web(百度网盘WEB版本)\"></a>安装baiduPCS-web(百度网盘WEB版本)</h3><p>下载地址：<a href=\"https://github.com/liuzhuoling2011/baidupcs-web/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/liuzhuoling2011/baidupcs-web/releases</a><br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"comment\">#到软件所在的目录</span></span><br><span class=\"line\">chmod a+x BaiduPCS-Go</span><br><span class=\"line\">./BaiduPCS-Go</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"安装shadowsocks\"><a href=\"#安装shadowsocks\" class=\"headerlink\" title=\"安装shadowsocks\"></a>安装shadowsocks</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S shadowsocks-qt5 <span class=\"comment\"># 输入2</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"系统代理\"><a href=\"#系统代理\" class=\"headerlink\" title=\"系统代理\"></a>系统代理</h4><p>系统设置 -&gt;  代理 -&gt; Use manually specified proxy cofinguration -&gt; SOCKS Proxy:127.0.0.1 Prot:1080</p>\n<h4 id=\"浏览器代理\"><a href=\"#浏览器代理\" class=\"headerlink\" title=\"浏览器代理\"></a>浏览器代理</h4><p>以 Chrome 为例，安装 SwitchyOmega 插件代理。</p>\n<p>Github 下载 SwitchyOmega：<a href=\"https://github.com/FelisCatus/SwitchyOmega/releases/\" target=\"_blank\" rel=\"noopener\">https://github.com/FelisCatus/SwitchyOmega/releases/</a></p>\n<p>Chrome 打开 chrome://extensions/，把插件托进去安装。</p>\n","site":{"data":{}},"excerpt":"<p>Manjaro是一款基于Arch Linux、对用户友好、全球排名第1的Linux发行版。</p>\n<p>在Linux圈，Arch的确是一个异常强大的发行版。它有3个无与伦比的优势：</p>\n<ul>\n<li>滚动更新可以使软件保持最新；</li>\n<li>AUR软件仓库有着世界上最齐全的Linux软件</li>\n<li>丰富的wiki和活跃的社区让所有问题都可以快速得到满意的答案。","more":"</li>\n</ul>\n<p> 查看版本<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ screenfetch</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>错误：无法注册 ‘archlinuxcn’ 数据库 (数据库已登记)<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo vi /etc/pacman.conf</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<p>添加源<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman-mirrors -i -c China -m rank</span><br></pre></td></tr></table></figure></p>\n<p>增加<code>archlinuxcn</code>库和<code>antergos</code>库<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n[archlinuxcn]\\nSigLevel = TrustAll\\nServer = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/\\$arch\\n\\n[antergos]\\nSigLevel = TrustAll\\nServer = https://mirrors.tuna.tsinghua.edu.cn/antergos/\\$repo/\\$arch\\n\"</span>|sudo tee -a /etc/pacman.conf</span><br></pre></td></tr></table></figure></p>\n<p>更新<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -Syy</span><br></pre></td></tr></table></figure></p>\n<p>安装<code>archlinuxcn</code>签名钥匙&amp;<code>antergos</code>签名钥匙<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S --noconfirm archlinuxcn-keyring antergos-keyring</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"安装搜狗输入法\"><a href=\"#安装搜狗输入法\" class=\"headerlink\" title=\"安装搜狗输入法\"></a>安装搜狗输入法</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S --noconfirm fcitx-im fcitx-configtool fcitx-sogoupinyin</span><br></pre></td></tr></table></figure>\n\n<p>配置搜狗变量<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo <span class=\"built_in\">echo</span> -e <span class=\"string\">\"export GTK_IM_MODULE=fcitx\\nexport QT_IM_MODULE=fcitx\\nexport XMODIFIERS=@im=fcitx\"</span>&gt;&gt;~/.xprofile</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p> 错误：搜狗输入法异常！请删除.config/SogouPY 并重启<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sogou-qimpanel</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<blockquote>\n<p>sogou-qimpanel: error while loading shared libraries: libfcitx-qt.so.0: cannot open shared object file: No such file or directory<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S fcitx-qt4</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h3 id=\"安装快照工具\"><a href=\"#安装快照工具\" class=\"headerlink\" title=\"安装快照工具\"></a>安装快照工具</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S timeshift</span><br></pre></td></tr></table></figure>\n\n<p>安装git<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S git</span><br><span class=\"line\">$ git config --global user.name <span class=\"string\">\"ziv\"</span> </span><br><span class=\"line\">$ git config --global user.email <span class=\"string\">\"abc.ziv@hotmail.com\"</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"安装谷歌浏览器\"><a href=\"#安装谷歌浏览器\" class=\"headerlink\" title=\"安装谷歌浏览器\"></a>安装谷歌浏览器</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S google-chrome</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装AUR助手yay\"><a href=\"#安装AUR助手yay\" class=\"headerlink\" title=\"安装AUR助手yay\"></a>安装AUR助手yay</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> $ sudo pacman -S yay</span><br><span class=\"line\"><span class=\"comment\"># 手动编译</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://aur.archlinux.org/yay.git</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> yay</span><br><span class=\"line\">$ makepkg -si</span><br><span class=\"line\"><span class=\"comment\"># 安装</span></span><br><span class=\"line\">$ yay -S `软件`</span><br><span class=\"line\"><span class=\"comment\"># 更新</span></span><br><span class=\"line\">$ yay -Ss</span><br><span class=\"line\"><span class=\"comment\"># 卸载</span></span><br><span class=\"line\">$ yay -Rs `软件`</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装网易云音乐\"><a href=\"#安装网易云音乐\" class=\"headerlink\" title=\"安装网易云音乐\"></a>安装网易云音乐</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S netease-cloud-music</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装oh-my-zsh\"><a href=\"#安装oh-my-zsh\" class=\"headerlink\" title=\"安装oh-my-zsh\"></a>安装oh-my-zsh</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O - | sh</span><br><span class=\"line\"><span class=\"comment\"># 切换zsh</span></span><br><span class=\"line\">$ chsh -s /bin/zsh</span><br><span class=\"line\"><span class=\"comment\"># 查看主题</span></span><br><span class=\"line\">$ ls ~/.oh-my-zsh/themes</span><br><span class=\"line\"><span class=\"comment\"># 自动提示插件zsh-autosuggestions</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> git://github.com/zsh-users/zsh-autosuggestions <span class=\"variable\">$ZSH_CUSTOM</span>/plugins/zsh-autosuggestions</span><br><span class=\"line\"><span class=\"comment\"># 语法高亮zsh-syntax-highlighting使用以下命令安装</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class=\"variable\">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class=\"line\"><span class=\"comment\"># 修改主题 配置插件</span></span><br><span class=\"line\"><span class=\"variable\">$vi</span> ~/.zshrc</span><br><span class=\"line\">plugins=(git zsh-syntax-highlighting  zsh-autosuggestions)</span><br><span class=\"line\">ZSH_THEME=<span class=\"string\">\"主题\"</span> 推荐：steeef</span><br><span class=\"line\"><span class=\"comment\"># 更新配置</span></span><br><span class=\"line\">$ <span class=\"built_in\">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"incr也是zsh自动补全插件\"><a href=\"#incr也是zsh自动补全插件\" class=\"headerlink\" title=\"incr也是zsh自动补全插件\"></a>incr也是zsh自动补全插件</h4><ol>\n<li>下载自动补全插件<a href=\"http://mimosa-pudica.net/src/incr-0.2.zsh\" target=\"_blank\" rel=\"noopener\">http://mimosa-pudica.net/src/incr-0.2.zsh</a></li>\n<li>放到oh-my-zsh的插件库中<br>.oh-my-zsh/plugins/创建incr文件夹放到该文件夹中</li>\n<li>在.zshrc中添加<br>在.zshrc文件末尾添加下面这行<br>source ~/.oh-my-zsh/plugins/incr/incr*.zsh</li>\n<li>重启命令行</li>\n</ol>\n<h3 id=\"安装印象笔记\"><a href=\"#安装印象笔记\" class=\"headerlink\" title=\"安装印象笔记\"></a>安装印象笔记</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S nixnote2</span><br><span class=\"line\"><span class=\"comment\"># 设置</span></span><br><span class=\"line\">File-&gt;Add Another User</span><br><span class=\"line\">server Yinxiang Biji</span><br><span class=\"line\">Tools-&gt;Synchronize</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装debtap（转换deb工具）\"><a href=\"#安装debtap（转换deb工具）\" class=\"headerlink\" title=\"安装debtap（转换deb工具）\"></a>安装debtap（转换deb工具）</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S debtap</span><br><span class=\"line\"><span class=\"comment\"># 更新debtap数据库</span></span><br><span class=\"line\">$ debtap -u</span><br><span class=\"line\"><span class=\"comment\"># 转换deb包</span></span><br><span class=\"line\">$ debtap -q 安装包.deb</span><br><span class=\"line\"><span class=\"comment\"># 执行安装</span></span><br><span class=\"line\">$ yay -U 安装包.pkg.tar.xz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装TIM\"><a href=\"#安装TIM\" class=\"headerlink\" title=\"安装TIM\"></a>安装TIM</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S deepin.com.qq.office</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装微信\"><a href=\"#安装微信\" class=\"headerlink\" title=\"安装微信\"></a>安装微信</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo yay -S electronic-wechat</span><br></pre></td></tr></table></figure>\n\n<p>更改英文目录<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pacman -S xdg-user-dirs-gtk</span><br><span class=\"line\">$ <span class=\"built_in\">export</span> LANG=en_US</span><br><span class=\"line\">$ xdg-user-dirs-gtk-update</span><br><span class=\"line\">$ <span class=\"comment\">#然后会有个窗口提示语言更改，更新名称即可</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> LANG=zh_CN.UTF-8</span><br><span class=\"line\">$ <span class=\"comment\">#然后重启电脑如果提示语言更改，保留旧的名称即可</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"安装截图工具flameshot\"><a href=\"#安装截图工具flameshot\" class=\"headerlink\" title=\"安装截图工具flameshot\"></a>安装截图工具flameshot</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S flameshot</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装thunderbird邮箱\"><a href=\"#安装thunderbird邮箱\" class=\"headerlink\" title=\"安装thunderbird邮箱\"></a>安装thunderbird邮箱</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S thunderbird</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装VScode\"><a href=\"#安装VScode\" class=\"headerlink\" title=\"安装VScode\"></a>安装VScode</h3> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S visual-studio-code-bin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装baiduPCS-web-百度网盘WEB版本\"><a href=\"#安装baiduPCS-web-百度网盘WEB版本\" class=\"headerlink\" title=\"安装baiduPCS-web(百度网盘WEB版本)\"></a>安装baiduPCS-web(百度网盘WEB版本)</h3><p>下载地址：<a href=\"https://github.com/liuzhuoling2011/baidupcs-web/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/liuzhuoling2011/baidupcs-web/releases</a><br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"comment\">#到软件所在的目录</span></span><br><span class=\"line\">chmod a+x BaiduPCS-Go</span><br><span class=\"line\">./BaiduPCS-Go</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"安装shadowsocks\"><a href=\"#安装shadowsocks\" class=\"headerlink\" title=\"安装shadowsocks\"></a>安装shadowsocks</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yay -S shadowsocks-qt5 <span class=\"comment\"># 输入2</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"系统代理\"><a href=\"#系统代理\" class=\"headerlink\" title=\"系统代理\"></a>系统代理</h4><p>系统设置 -&gt;  代理 -&gt; Use manually specified proxy cofinguration -&gt; SOCKS Proxy:127.0.0.1 Prot:1080</p>\n<h4 id=\"浏览器代理\"><a href=\"#浏览器代理\" class=\"headerlink\" title=\"浏览器代理\"></a>浏览器代理</h4><p>以 Chrome 为例，安装 SwitchyOmega 插件代理。</p>\n<p>Github 下载 SwitchyOmega：<a href=\"https://github.com/FelisCatus/SwitchyOmega/releases/\" target=\"_blank\" rel=\"noopener\">https://github.com/FelisCatus/SwitchyOmega/releases/</a></p>\n<p>Chrome 打开 chrome://extensions/，把插件托进去安装。</p>"},{"title":"大型网站架构的特点及演化","date":"2019-06-18T04:00:00.000Z","comments":1,"_content":"# 大型网站的特点\n* `高并发`、`大流量`：PV(page view)量巨大\n* `高可用`：7*24小时不间断服务\n* `海量数据`：需要存储、管理海量数据，需要使用大量服务器\n* 用户`分布广泛`，网络情况复杂：网络运营商\n* `安全`环境恶劣：黑客的攻击\n* 需求`快速变更`，发布频繁：快速适应市场，满足用户需求\n* `渐进式`发展：与传统软件产品或企业应用系统一开始就规划好全部的功能和非功能需求不同，几乎所有的大型互联网网站都是从一个小网站开始的，渐进地发展起来的\n <!-- more -->\n\n# 大型网站架构演化过程\n\n## 初始阶段的网站架构\n<img src=\"/images/Framework/001.png\">\n在初始阶段，访问量并不大，所以应用程序、数据库、文件等所有的资源都在一台服务器上。\n\n## 应用服务和数据服务分离\n<img src=\"/images/Framework/002.png\">\n随着业务的发展，就会发现一台服务器抗不过来了，所以将应用服务器与数据（文件、数据库）服务器分离。三台服务器对硬件资源的要求各不相同：应用服务器需要更快的CPU，文件服务器需要更大的磁盘和带宽，数据库服务器需要更快速的磁盘和更大的内存。分离之后，三个服务器各司其职，也方便针对性的优化。\n\n## 使用缓存改善网站性能\n<img src=\"/images/Framework/003.png\">\n缓存的使用无处不在，缓存的根本目的是加快访问速度。当数据库的访问压力过大的时候，就可以考虑使用缓存了。网站使用的缓存可以分为两种: 缓存在应用服务器上的本地缓存和缓存在专门的分布式缓存服务器上的远程缓存。\n\n## 使用应用服务器集群改善网站的并发处理能力\n<img src=\"/images/Framework/004.png\">\n随着业务的发展，单个应用服务器一定会成为瓶颈，应用服务器实现集群是网站可伸缩集群架构设计中较为简单成熟的一种。后面也会提到，将应用服务器设计为无状态的（没有需要保存的上下文信息），就可以通过增加机器，使用负载均衡来scale out。\n\n## 数据库读写分离\n<img src=\"/images/Framework/005.png\">\n即使使用了缓存，但在缓存未命中、或者缓存服务时效的情况下，还是需要访问数据库，这个时候就需要数据库的读写分离：主库提供写操作，从库提供读服务。注意，在上图中增加了一个数据访问模块，可以对应用层透明数据库的主从分离信息。\n\n## 使用反向代理和CDN 加速网站晌应\n<img src=\"/images/Framework/006.png\">\nCDN和反向代理其实都是缓存，区别在于CDN 部署在网络提供商的机房；而反向代理则部署在网站的中心机房。使用CDN 和反向代理的目的都是尽旱返回数据给用户， 一方面加快用户访问速度，另一方面也减轻后端服务器的负载压力。\n\n## 使用分布式文件系统和分布式数据库系统\n<img src=\"/images/Framework/007.png\">\n单个物理机的磁盘是有限的，单个关系数据库的处理能力也是有上限的，所以需要分布式文件存储与分布式数据库。当然，也需要”统一数据访问模块“，使得应用层不用关心文件、数据的具体位置。值得一提的事，关系型数据库自身并没有很好的水平扩展方案，因此一般都需要一个数据库代理层，如cobar、mycat。\n\n## 使用NoSQL 和搜索引擎\n<img src=\"/images/Framework/008.png\">\n很多应用并一定适合用关系数据库存储，更加灵活的NoSql能更加方便的解决一些问题，而且NoSQL天然就支持分布式。专门的搜索引擎在提供更优质服务的同时，也大大减轻了数据库的压力。\n\n## 业务拆分\n<img src=\"/images/Framework/009.png\">\n将一个网站拆分成许多不同的应用， 每个应用独立部署维护。应用之间可以通过一个超链接建立关系(在首页上的导航链接每个都指向不同的应用地址) ，也可以通过消息队列进行数据分发， 当然最多的还是通过访问同一个数据存储系统来构成一个关联的完整系统\n\n## 分布式服务\n<img src=\"/images/Framework/010.png\">\n既然每一个应用系统都需要执行许多相同的业务操作， 比如用户管理、商品管理等，那么可以将这些共用的业务提取出来，独立部署。\n\n通过服务的分布式，各个应用能更好的独立发展，实现了从依赖模块到依赖服务的过渡。将通用的公共服务独立出来，也方便做服务管控，比如对各个应用的服务请求进行监控，在高峰时期限制、关闭某些应用的访问等。\n\n# 大型网站架构价值观与设计误区\n\n## 价值观\n\n#### 核心价值\n\n随网站所需灵活应对，大型网站不是从无到有一步就搭建好一个大型网站，而是能够伴随小型网站业务的渐进发展，慢慢地演化成一个大型网站。\n\n#### 驱动力量\n\n网站的业务发展—业务成就了技术，事业成就了人，而不是相反。\n\n## 设计误区\n\n1. 一味追随大公司的解决方案。\n\n2. 为了技术而技术，常见问题。\n\n3. 企图用技术解决所有问题：技术是用来解决业务问题的，而业务的问题，也可以通过业务的手段去解决。\n\n","source":"_posts/2019-06-18-TechnicalArchitectureofLargeWebsite01.md","raw":"---\ntitle: \"大型网站架构的特点及演化\"\ndate: 2019-06-18\ncomments: true\ncategories: 架构\ntags:\n    - watch\n---\n# 大型网站的特点\n* `高并发`、`大流量`：PV(page view)量巨大\n* `高可用`：7*24小时不间断服务\n* `海量数据`：需要存储、管理海量数据，需要使用大量服务器\n* 用户`分布广泛`，网络情况复杂：网络运营商\n* `安全`环境恶劣：黑客的攻击\n* 需求`快速变更`，发布频繁：快速适应市场，满足用户需求\n* `渐进式`发展：与传统软件产品或企业应用系统一开始就规划好全部的功能和非功能需求不同，几乎所有的大型互联网网站都是从一个小网站开始的，渐进地发展起来的\n <!-- more -->\n\n# 大型网站架构演化过程\n\n## 初始阶段的网站架构\n<img src=\"/images/Framework/001.png\">\n在初始阶段，访问量并不大，所以应用程序、数据库、文件等所有的资源都在一台服务器上。\n\n## 应用服务和数据服务分离\n<img src=\"/images/Framework/002.png\">\n随着业务的发展，就会发现一台服务器抗不过来了，所以将应用服务器与数据（文件、数据库）服务器分离。三台服务器对硬件资源的要求各不相同：应用服务器需要更快的CPU，文件服务器需要更大的磁盘和带宽，数据库服务器需要更快速的磁盘和更大的内存。分离之后，三个服务器各司其职，也方便针对性的优化。\n\n## 使用缓存改善网站性能\n<img src=\"/images/Framework/003.png\">\n缓存的使用无处不在，缓存的根本目的是加快访问速度。当数据库的访问压力过大的时候，就可以考虑使用缓存了。网站使用的缓存可以分为两种: 缓存在应用服务器上的本地缓存和缓存在专门的分布式缓存服务器上的远程缓存。\n\n## 使用应用服务器集群改善网站的并发处理能力\n<img src=\"/images/Framework/004.png\">\n随着业务的发展，单个应用服务器一定会成为瓶颈，应用服务器实现集群是网站可伸缩集群架构设计中较为简单成熟的一种。后面也会提到，将应用服务器设计为无状态的（没有需要保存的上下文信息），就可以通过增加机器，使用负载均衡来scale out。\n\n## 数据库读写分离\n<img src=\"/images/Framework/005.png\">\n即使使用了缓存，但在缓存未命中、或者缓存服务时效的情况下，还是需要访问数据库，这个时候就需要数据库的读写分离：主库提供写操作，从库提供读服务。注意，在上图中增加了一个数据访问模块，可以对应用层透明数据库的主从分离信息。\n\n## 使用反向代理和CDN 加速网站晌应\n<img src=\"/images/Framework/006.png\">\nCDN和反向代理其实都是缓存，区别在于CDN 部署在网络提供商的机房；而反向代理则部署在网站的中心机房。使用CDN 和反向代理的目的都是尽旱返回数据给用户， 一方面加快用户访问速度，另一方面也减轻后端服务器的负载压力。\n\n## 使用分布式文件系统和分布式数据库系统\n<img src=\"/images/Framework/007.png\">\n单个物理机的磁盘是有限的，单个关系数据库的处理能力也是有上限的，所以需要分布式文件存储与分布式数据库。当然，也需要”统一数据访问模块“，使得应用层不用关心文件、数据的具体位置。值得一提的事，关系型数据库自身并没有很好的水平扩展方案，因此一般都需要一个数据库代理层，如cobar、mycat。\n\n## 使用NoSQL 和搜索引擎\n<img src=\"/images/Framework/008.png\">\n很多应用并一定适合用关系数据库存储，更加灵活的NoSql能更加方便的解决一些问题，而且NoSQL天然就支持分布式。专门的搜索引擎在提供更优质服务的同时，也大大减轻了数据库的压力。\n\n## 业务拆分\n<img src=\"/images/Framework/009.png\">\n将一个网站拆分成许多不同的应用， 每个应用独立部署维护。应用之间可以通过一个超链接建立关系(在首页上的导航链接每个都指向不同的应用地址) ，也可以通过消息队列进行数据分发， 当然最多的还是通过访问同一个数据存储系统来构成一个关联的完整系统\n\n## 分布式服务\n<img src=\"/images/Framework/010.png\">\n既然每一个应用系统都需要执行许多相同的业务操作， 比如用户管理、商品管理等，那么可以将这些共用的业务提取出来，独立部署。\n\n通过服务的分布式，各个应用能更好的独立发展，实现了从依赖模块到依赖服务的过渡。将通用的公共服务独立出来，也方便做服务管控，比如对各个应用的服务请求进行监控，在高峰时期限制、关闭某些应用的访问等。\n\n# 大型网站架构价值观与设计误区\n\n## 价值观\n\n#### 核心价值\n\n随网站所需灵活应对，大型网站不是从无到有一步就搭建好一个大型网站，而是能够伴随小型网站业务的渐进发展，慢慢地演化成一个大型网站。\n\n#### 驱动力量\n\n网站的业务发展—业务成就了技术，事业成就了人，而不是相反。\n\n## 设计误区\n\n1. 一味追随大公司的解决方案。\n\n2. 为了技术而技术，常见问题。\n\n3. 企图用技术解决所有问题：技术是用来解决业务问题的，而业务的问题，也可以通过业务的手段去解决。\n\n","slug":"2019-06-18-TechnicalArchitectureofLargeWebsite01","published":1,"updated":"2019-07-05T07:55:55.000Z","layout":"post","photos":[],"link":"","_id":"cjypn1ql8003my4rby1zy3l2x","content":"<h1 id=\"大型网站的特点\"><a href=\"#大型网站的特点\" class=\"headerlink\" title=\"大型网站的特点\"></a>大型网站的特点</h1><ul>\n<li><code>高并发</code>、<code>大流量</code>：PV(page view)量巨大</li>\n<li><code>高可用</code>：7*24小时不间断服务</li>\n<li><code>海量数据</code>：需要存储、管理海量数据，需要使用大量服务器</li>\n<li>用户<code>分布广泛</code>，网络情况复杂：网络运营商</li>\n<li><code>安全</code>环境恶劣：黑客的攻击</li>\n<li>需求<code>快速变更</code>，发布频繁：快速适应市场，满足用户需求</li>\n<li><code>渐进式</code>发展：与传统软件产品或企业应用系统一开始就规划好全部的功能和非功能需求不同，几乎所有的大型互联网网站都是从一个小网站开始的，渐进地发展起来的<a id=\"more\"></a>\n\n</li>\n</ul>\n<h1 id=\"大型网站架构演化过程\"><a href=\"#大型网站架构演化过程\" class=\"headerlink\" title=\"大型网站架构演化过程\"></a>大型网站架构演化过程</h1><h2 id=\"初始阶段的网站架构\"><a href=\"#初始阶段的网站架构\" class=\"headerlink\" title=\"初始阶段的网站架构\"></a>初始阶段的网站架构</h2><img src=\"/images/Framework/001.png\">\n在初始阶段，访问量并不大，所以应用程序、数据库、文件等所有的资源都在一台服务器上。\n\n<h2 id=\"应用服务和数据服务分离\"><a href=\"#应用服务和数据服务分离\" class=\"headerlink\" title=\"应用服务和数据服务分离\"></a>应用服务和数据服务分离</h2><img src=\"/images/Framework/002.png\">\n随着业务的发展，就会发现一台服务器抗不过来了，所以将应用服务器与数据（文件、数据库）服务器分离。三台服务器对硬件资源的要求各不相同：应用服务器需要更快的CPU，文件服务器需要更大的磁盘和带宽，数据库服务器需要更快速的磁盘和更大的内存。分离之后，三个服务器各司其职，也方便针对性的优化。\n\n<h2 id=\"使用缓存改善网站性能\"><a href=\"#使用缓存改善网站性能\" class=\"headerlink\" title=\"使用缓存改善网站性能\"></a>使用缓存改善网站性能</h2><img src=\"/images/Framework/003.png\">\n缓存的使用无处不在，缓存的根本目的是加快访问速度。当数据库的访问压力过大的时候，就可以考虑使用缓存了。网站使用的缓存可以分为两种: 缓存在应用服务器上的本地缓存和缓存在专门的分布式缓存服务器上的远程缓存。\n\n<h2 id=\"使用应用服务器集群改善网站的并发处理能力\"><a href=\"#使用应用服务器集群改善网站的并发处理能力\" class=\"headerlink\" title=\"使用应用服务器集群改善网站的并发处理能力\"></a>使用应用服务器集群改善网站的并发处理能力</h2><img src=\"/images/Framework/004.png\">\n随着业务的发展，单个应用服务器一定会成为瓶颈，应用服务器实现集群是网站可伸缩集群架构设计中较为简单成熟的一种。后面也会提到，将应用服务器设计为无状态的（没有需要保存的上下文信息），就可以通过增加机器，使用负载均衡来scale out。\n\n<h2 id=\"数据库读写分离\"><a href=\"#数据库读写分离\" class=\"headerlink\" title=\"数据库读写分离\"></a>数据库读写分离</h2><img src=\"/images/Framework/005.png\">\n即使使用了缓存，但在缓存未命中、或者缓存服务时效的情况下，还是需要访问数据库，这个时候就需要数据库的读写分离：主库提供写操作，从库提供读服务。注意，在上图中增加了一个数据访问模块，可以对应用层透明数据库的主从分离信息。\n\n<h2 id=\"使用反向代理和CDN-加速网站晌应\"><a href=\"#使用反向代理和CDN-加速网站晌应\" class=\"headerlink\" title=\"使用反向代理和CDN 加速网站晌应\"></a>使用反向代理和CDN 加速网站晌应</h2><img src=\"/images/Framework/006.png\">\nCDN和反向代理其实都是缓存，区别在于CDN 部署在网络提供商的机房；而反向代理则部署在网站的中心机房。使用CDN 和反向代理的目的都是尽旱返回数据给用户， 一方面加快用户访问速度，另一方面也减轻后端服务器的负载压力。\n\n<h2 id=\"使用分布式文件系统和分布式数据库系统\"><a href=\"#使用分布式文件系统和分布式数据库系统\" class=\"headerlink\" title=\"使用分布式文件系统和分布式数据库系统\"></a>使用分布式文件系统和分布式数据库系统</h2><img src=\"/images/Framework/007.png\">\n单个物理机的磁盘是有限的，单个关系数据库的处理能力也是有上限的，所以需要分布式文件存储与分布式数据库。当然，也需要”统一数据访问模块“，使得应用层不用关心文件、数据的具体位置。值得一提的事，关系型数据库自身并没有很好的水平扩展方案，因此一般都需要一个数据库代理层，如cobar、mycat。\n\n<h2 id=\"使用NoSQL-和搜索引擎\"><a href=\"#使用NoSQL-和搜索引擎\" class=\"headerlink\" title=\"使用NoSQL 和搜索引擎\"></a>使用NoSQL 和搜索引擎</h2><img src=\"/images/Framework/008.png\">\n很多应用并一定适合用关系数据库存储，更加灵活的NoSql能更加方便的解决一些问题，而且NoSQL天然就支持分布式。专门的搜索引擎在提供更优质服务的同时，也大大减轻了数据库的压力。\n\n<h2 id=\"业务拆分\"><a href=\"#业务拆分\" class=\"headerlink\" title=\"业务拆分\"></a>业务拆分</h2><img src=\"/images/Framework/009.png\">\n将一个网站拆分成许多不同的应用， 每个应用独立部署维护。应用之间可以通过一个超链接建立关系(在首页上的导航链接每个都指向不同的应用地址) ，也可以通过消息队列进行数据分发， 当然最多的还是通过访问同一个数据存储系统来构成一个关联的完整系统\n\n<h2 id=\"分布式服务\"><a href=\"#分布式服务\" class=\"headerlink\" title=\"分布式服务\"></a>分布式服务</h2><img src=\"/images/Framework/010.png\">\n既然每一个应用系统都需要执行许多相同的业务操作， 比如用户管理、商品管理等，那么可以将这些共用的业务提取出来，独立部署。\n\n<p>通过服务的分布式，各个应用能更好的独立发展，实现了从依赖模块到依赖服务的过渡。将通用的公共服务独立出来，也方便做服务管控，比如对各个应用的服务请求进行监控，在高峰时期限制、关闭某些应用的访问等。</p>\n<h1 id=\"大型网站架构价值观与设计误区\"><a href=\"#大型网站架构价值观与设计误区\" class=\"headerlink\" title=\"大型网站架构价值观与设计误区\"></a>大型网站架构价值观与设计误区</h1><h2 id=\"价值观\"><a href=\"#价值观\" class=\"headerlink\" title=\"价值观\"></a>价值观</h2><h4 id=\"核心价值\"><a href=\"#核心价值\" class=\"headerlink\" title=\"核心价值\"></a>核心价值</h4><p>随网站所需灵活应对，大型网站不是从无到有一步就搭建好一个大型网站，而是能够伴随小型网站业务的渐进发展，慢慢地演化成一个大型网站。</p>\n<h4 id=\"驱动力量\"><a href=\"#驱动力量\" class=\"headerlink\" title=\"驱动力量\"></a>驱动力量</h4><p>网站的业务发展—业务成就了技术，事业成就了人，而不是相反。</p>\n<h2 id=\"设计误区\"><a href=\"#设计误区\" class=\"headerlink\" title=\"设计误区\"></a>设计误区</h2><ol>\n<li><p>一味追随大公司的解决方案。</p>\n</li>\n<li><p>为了技术而技术，常见问题。</p>\n</li>\n<li><p>企图用技术解决所有问题：技术是用来解决业务问题的，而业务的问题，也可以通过业务的手段去解决。</p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<h1 id=\"大型网站的特点\"><a href=\"#大型网站的特点\" class=\"headerlink\" title=\"大型网站的特点\"></a>大型网站的特点</h1><ul>\n<li><code>高并发</code>、<code>大流量</code>：PV(page view)量巨大</li>\n<li><code>高可用</code>：7*24小时不间断服务</li>\n<li><code>海量数据</code>：需要存储、管理海量数据，需要使用大量服务器</li>\n<li>用户<code>分布广泛</code>，网络情况复杂：网络运营商</li>\n<li><code>安全</code>环境恶劣：黑客的攻击</li>\n<li>需求<code>快速变更</code>，发布频繁：快速适应市场，满足用户需求</li>\n<li><code>渐进式</code>发展：与传统软件产品或企业应用系统一开始就规划好全部的功能和非功能需求不同，几乎所有的大型互联网网站都是从一个小网站开始的，渐进地发展起来的","more":"</li>\n</ul>\n<h1 id=\"大型网站架构演化过程\"><a href=\"#大型网站架构演化过程\" class=\"headerlink\" title=\"大型网站架构演化过程\"></a>大型网站架构演化过程</h1><h2 id=\"初始阶段的网站架构\"><a href=\"#初始阶段的网站架构\" class=\"headerlink\" title=\"初始阶段的网站架构\"></a>初始阶段的网站架构</h2><img src=\"/images/Framework/001.png\">\n在初始阶段，访问量并不大，所以应用程序、数据库、文件等所有的资源都在一台服务器上。\n\n<h2 id=\"应用服务和数据服务分离\"><a href=\"#应用服务和数据服务分离\" class=\"headerlink\" title=\"应用服务和数据服务分离\"></a>应用服务和数据服务分离</h2><img src=\"/images/Framework/002.png\">\n随着业务的发展，就会发现一台服务器抗不过来了，所以将应用服务器与数据（文件、数据库）服务器分离。三台服务器对硬件资源的要求各不相同：应用服务器需要更快的CPU，文件服务器需要更大的磁盘和带宽，数据库服务器需要更快速的磁盘和更大的内存。分离之后，三个服务器各司其职，也方便针对性的优化。\n\n<h2 id=\"使用缓存改善网站性能\"><a href=\"#使用缓存改善网站性能\" class=\"headerlink\" title=\"使用缓存改善网站性能\"></a>使用缓存改善网站性能</h2><img src=\"/images/Framework/003.png\">\n缓存的使用无处不在，缓存的根本目的是加快访问速度。当数据库的访问压力过大的时候，就可以考虑使用缓存了。网站使用的缓存可以分为两种: 缓存在应用服务器上的本地缓存和缓存在专门的分布式缓存服务器上的远程缓存。\n\n<h2 id=\"使用应用服务器集群改善网站的并发处理能力\"><a href=\"#使用应用服务器集群改善网站的并发处理能力\" class=\"headerlink\" title=\"使用应用服务器集群改善网站的并发处理能力\"></a>使用应用服务器集群改善网站的并发处理能力</h2><img src=\"/images/Framework/004.png\">\n随着业务的发展，单个应用服务器一定会成为瓶颈，应用服务器实现集群是网站可伸缩集群架构设计中较为简单成熟的一种。后面也会提到，将应用服务器设计为无状态的（没有需要保存的上下文信息），就可以通过增加机器，使用负载均衡来scale out。\n\n<h2 id=\"数据库读写分离\"><a href=\"#数据库读写分离\" class=\"headerlink\" title=\"数据库读写分离\"></a>数据库读写分离</h2><img src=\"/images/Framework/005.png\">\n即使使用了缓存，但在缓存未命中、或者缓存服务时效的情况下，还是需要访问数据库，这个时候就需要数据库的读写分离：主库提供写操作，从库提供读服务。注意，在上图中增加了一个数据访问模块，可以对应用层透明数据库的主从分离信息。\n\n<h2 id=\"使用反向代理和CDN-加速网站晌应\"><a href=\"#使用反向代理和CDN-加速网站晌应\" class=\"headerlink\" title=\"使用反向代理和CDN 加速网站晌应\"></a>使用反向代理和CDN 加速网站晌应</h2><img src=\"/images/Framework/006.png\">\nCDN和反向代理其实都是缓存，区别在于CDN 部署在网络提供商的机房；而反向代理则部署在网站的中心机房。使用CDN 和反向代理的目的都是尽旱返回数据给用户， 一方面加快用户访问速度，另一方面也减轻后端服务器的负载压力。\n\n<h2 id=\"使用分布式文件系统和分布式数据库系统\"><a href=\"#使用分布式文件系统和分布式数据库系统\" class=\"headerlink\" title=\"使用分布式文件系统和分布式数据库系统\"></a>使用分布式文件系统和分布式数据库系统</h2><img src=\"/images/Framework/007.png\">\n单个物理机的磁盘是有限的，单个关系数据库的处理能力也是有上限的，所以需要分布式文件存储与分布式数据库。当然，也需要”统一数据访问模块“，使得应用层不用关心文件、数据的具体位置。值得一提的事，关系型数据库自身并没有很好的水平扩展方案，因此一般都需要一个数据库代理层，如cobar、mycat。\n\n<h2 id=\"使用NoSQL-和搜索引擎\"><a href=\"#使用NoSQL-和搜索引擎\" class=\"headerlink\" title=\"使用NoSQL 和搜索引擎\"></a>使用NoSQL 和搜索引擎</h2><img src=\"/images/Framework/008.png\">\n很多应用并一定适合用关系数据库存储，更加灵活的NoSql能更加方便的解决一些问题，而且NoSQL天然就支持分布式。专门的搜索引擎在提供更优质服务的同时，也大大减轻了数据库的压力。\n\n<h2 id=\"业务拆分\"><a href=\"#业务拆分\" class=\"headerlink\" title=\"业务拆分\"></a>业务拆分</h2><img src=\"/images/Framework/009.png\">\n将一个网站拆分成许多不同的应用， 每个应用独立部署维护。应用之间可以通过一个超链接建立关系(在首页上的导航链接每个都指向不同的应用地址) ，也可以通过消息队列进行数据分发， 当然最多的还是通过访问同一个数据存储系统来构成一个关联的完整系统\n\n<h2 id=\"分布式服务\"><a href=\"#分布式服务\" class=\"headerlink\" title=\"分布式服务\"></a>分布式服务</h2><img src=\"/images/Framework/010.png\">\n既然每一个应用系统都需要执行许多相同的业务操作， 比如用户管理、商品管理等，那么可以将这些共用的业务提取出来，独立部署。\n\n<p>通过服务的分布式，各个应用能更好的独立发展，实现了从依赖模块到依赖服务的过渡。将通用的公共服务独立出来，也方便做服务管控，比如对各个应用的服务请求进行监控，在高峰时期限制、关闭某些应用的访问等。</p>\n<h1 id=\"大型网站架构价值观与设计误区\"><a href=\"#大型网站架构价值观与设计误区\" class=\"headerlink\" title=\"大型网站架构价值观与设计误区\"></a>大型网站架构价值观与设计误区</h1><h2 id=\"价值观\"><a href=\"#价值观\" class=\"headerlink\" title=\"价值观\"></a>价值观</h2><h4 id=\"核心价值\"><a href=\"#核心价值\" class=\"headerlink\" title=\"核心价值\"></a>核心价值</h4><p>随网站所需灵活应对，大型网站不是从无到有一步就搭建好一个大型网站，而是能够伴随小型网站业务的渐进发展，慢慢地演化成一个大型网站。</p>\n<h4 id=\"驱动力量\"><a href=\"#驱动力量\" class=\"headerlink\" title=\"驱动力量\"></a>驱动力量</h4><p>网站的业务发展—业务成就了技术，事业成就了人，而不是相反。</p>\n<h2 id=\"设计误区\"><a href=\"#设计误区\" class=\"headerlink\" title=\"设计误区\"></a>设计误区</h2><ol>\n<li><p>一味追随大公司的解决方案。</p>\n</li>\n<li><p>为了技术而技术，常见问题。</p>\n</li>\n<li><p>企图用技术解决所有问题：技术是用来解决业务问题的，而业务的问题，也可以通过业务的手段去解决。</p>\n</li>\n</ol>"},{"title":"ubuntu18.04优化","date":"2019-06-23T04:00:00.000Z","comments":1,"_content":"\nLinux 系统用来用去还是发现ubuntu用的最舒服，毕竟用了从14.04 一直用到了18.04 。用了三年多了。下面就直接记录下。我这边优化系统的全部命令，方便下次装机使用。\n <!-- more -->\n\n# 更换源\n\n## 重命名源\n```bash\n$ sudo mv /etc/apt/sources.list  /etc/apt/sources.list.mv\n```\n### 建立阿里源\n```bash\n$ sudo vi /etc/apt/sources.list\n```\n复制以下内容\n``` bash\ndeb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse\n```\n\n## 更新源\n```bash\n$ sudo apt update && sudo apt upgrade\n```\n\n# 改目录名称\n```bash\n$ export LANG=en_US\n$ xdg-user-dirs-gtk-update\n```\n\n# 下载git\n``` bash\n$ apt install git\n```\n\n## 配置git\n```bash\n$ git config --global user.name \"ziv\" \n$ git config --global user.email \"abc.ziv@hotmail.com\"\n```\n\n## 配置SSH秘钥\n```bash\n$ ssh-keygen -t rsa -C \"abc.ziv@hotmail.com\"\n$ cat ~/.ssh/id_rsa.pub\n```\n\n# 安装VSCode\n```bahs\n$ wget https://vscode.cdn.azure.cn/stable/c7d83e57cd18f18026a8162d042843bda1bcf21f/code_1.35.1-1560350270_amd64.deb\n$ sudo dpkg -i code_1.35.1-1560350270_amd64.deb\n```\n\n# 安装 搜狗拼音\n```bash\n$ wget http://cdn2.ime.sogou.com/dl/index/1524572264/sogoupinyin_2.2.0.0108_amd64.deb\n$ sudo dpkg -i sogoupinyin_2.2.0.0108_amd64.deb\n```\n## 安装搜狗拼音依赖\n```bash\n$ sudo apt install -f\n$ locale\n$ check-language-suppor\n## 把出现的所有依赖都安装\n$ sudo reboot\n```\n\n# 安装谷歌浏览器\n```bash\n$ wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb\n$ sudo dpkg -i google-chrome-stable_current_amd64.deb\n```\n\n# 安装oh-my-zsh\n```bash\n$ sudo apt-get install zsh\n$ chsh -s /bin/zsh \n$ sudo vi /etc/passwd\n## 把第一行的/bin/bash改成/bin/zsh，这个是root用户的\n## 把最后一行的/bin/bash改成/bin/zsh，这个应该是每台电脑的登录用户名+计算机名组成的。\n$ sh -c \"$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)\"\n$ sudo reboot\n# 查看主题\n$ ls ~/.oh-my-zsh/themes\n# 自动提示插件zsh-autosuggestions\n$ git clone git://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions\n# 语法高亮zsh-syntax-highlighting使用以下命令安装\n$ git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n# 修改主题 配置插件\n$ vi ~/.zshrc\nplugins=(git zsh-syntax-highlighting  zsh-autosuggestions)\nZSH_THEME=\"主题\" 推荐：steeef ys\n# 更新配置\n$ source ~/.zshrc\n```\n\n# 安装shadowsocks-qt5 \n```bash\n$ sudo add-apt-repository ppa:hzwhuang/ss-qt5\n$ vi /etc/apt/sources.list.d/hzwhuang-ubuntu-ss-qt5-bionic.list\n## bionic(18.04版本代号)改成xenial(16.04版本代号)\n$ sudo apt update\n$ sudo apt install shadowsocks-qt5\n```\n\n# 安装百度网盘\n```bash\n$ wget https://github.com/liuzhuoling2011/baidupcs-web/releases/download/3.6.7/BaiduPCS-Go-3.6.7-linux-amd64.zip\n$ unzip BaiduPCS-Go-3.6.7-linux-amd64.zip\n```\n\n# 安装thunderbird邮箱\n```bash\nsudo apt install thunderbird\n```\n\n# 安装印象笔记\n```bash\nsudo apt install nixnote2 -y\n```\n\n# 安装flameshot截图工具\n```bash\nwget https://github.com/lupoDharkael/flameshot/releases/download/v0.6.0/flameshot_0.6.0_bionic_x86_64.deb\nsudo dpkg -i flameshot_0.6.0_bionic_x86_64.deb\n```\n\n# 安装rememberthemilk\n```bash\nwget https://www.rememberthemilk.com/download/linux/debian/pool/main/r/rememberthemilk/rememberthemilk_1.1.13_amd64.deb\nsudo dpkg -i rememberthemilk_1.1.13_amd64.deb\nsudo apt install -f\n```\n\n# WPS\n```bash\nwget https://wdl1.cache.wps.cn/wps/download/ep/Linux2019/8392/wps-office_11.1.0.8392_amd64.deb\nsudo dpkg -i wps-office_11.1.0.8392_amd64.deb\n```","source":"_posts/2019-06-23-ubuntu.md","raw":"---\ntitle: \"ubuntu18.04优化\"\ndate: 2019-06-23\ncomments: true\ncategories: 系统\ntags:\n    - ubuntu\n---\n\nLinux 系统用来用去还是发现ubuntu用的最舒服，毕竟用了从14.04 一直用到了18.04 。用了三年多了。下面就直接记录下。我这边优化系统的全部命令，方便下次装机使用。\n <!-- more -->\n\n# 更换源\n\n## 重命名源\n```bash\n$ sudo mv /etc/apt/sources.list  /etc/apt/sources.list.mv\n```\n### 建立阿里源\n```bash\n$ sudo vi /etc/apt/sources.list\n```\n复制以下内容\n``` bash\ndeb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse\n```\n\n## 更新源\n```bash\n$ sudo apt update && sudo apt upgrade\n```\n\n# 改目录名称\n```bash\n$ export LANG=en_US\n$ xdg-user-dirs-gtk-update\n```\n\n# 下载git\n``` bash\n$ apt install git\n```\n\n## 配置git\n```bash\n$ git config --global user.name \"ziv\" \n$ git config --global user.email \"abc.ziv@hotmail.com\"\n```\n\n## 配置SSH秘钥\n```bash\n$ ssh-keygen -t rsa -C \"abc.ziv@hotmail.com\"\n$ cat ~/.ssh/id_rsa.pub\n```\n\n# 安装VSCode\n```bahs\n$ wget https://vscode.cdn.azure.cn/stable/c7d83e57cd18f18026a8162d042843bda1bcf21f/code_1.35.1-1560350270_amd64.deb\n$ sudo dpkg -i code_1.35.1-1560350270_amd64.deb\n```\n\n# 安装 搜狗拼音\n```bash\n$ wget http://cdn2.ime.sogou.com/dl/index/1524572264/sogoupinyin_2.2.0.0108_amd64.deb\n$ sudo dpkg -i sogoupinyin_2.2.0.0108_amd64.deb\n```\n## 安装搜狗拼音依赖\n```bash\n$ sudo apt install -f\n$ locale\n$ check-language-suppor\n## 把出现的所有依赖都安装\n$ sudo reboot\n```\n\n# 安装谷歌浏览器\n```bash\n$ wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb\n$ sudo dpkg -i google-chrome-stable_current_amd64.deb\n```\n\n# 安装oh-my-zsh\n```bash\n$ sudo apt-get install zsh\n$ chsh -s /bin/zsh \n$ sudo vi /etc/passwd\n## 把第一行的/bin/bash改成/bin/zsh，这个是root用户的\n## 把最后一行的/bin/bash改成/bin/zsh，这个应该是每台电脑的登录用户名+计算机名组成的。\n$ sh -c \"$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)\"\n$ sudo reboot\n# 查看主题\n$ ls ~/.oh-my-zsh/themes\n# 自动提示插件zsh-autosuggestions\n$ git clone git://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions\n# 语法高亮zsh-syntax-highlighting使用以下命令安装\n$ git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n# 修改主题 配置插件\n$ vi ~/.zshrc\nplugins=(git zsh-syntax-highlighting  zsh-autosuggestions)\nZSH_THEME=\"主题\" 推荐：steeef ys\n# 更新配置\n$ source ~/.zshrc\n```\n\n# 安装shadowsocks-qt5 \n```bash\n$ sudo add-apt-repository ppa:hzwhuang/ss-qt5\n$ vi /etc/apt/sources.list.d/hzwhuang-ubuntu-ss-qt5-bionic.list\n## bionic(18.04版本代号)改成xenial(16.04版本代号)\n$ sudo apt update\n$ sudo apt install shadowsocks-qt5\n```\n\n# 安装百度网盘\n```bash\n$ wget https://github.com/liuzhuoling2011/baidupcs-web/releases/download/3.6.7/BaiduPCS-Go-3.6.7-linux-amd64.zip\n$ unzip BaiduPCS-Go-3.6.7-linux-amd64.zip\n```\n\n# 安装thunderbird邮箱\n```bash\nsudo apt install thunderbird\n```\n\n# 安装印象笔记\n```bash\nsudo apt install nixnote2 -y\n```\n\n# 安装flameshot截图工具\n```bash\nwget https://github.com/lupoDharkael/flameshot/releases/download/v0.6.0/flameshot_0.6.0_bionic_x86_64.deb\nsudo dpkg -i flameshot_0.6.0_bionic_x86_64.deb\n```\n\n# 安装rememberthemilk\n```bash\nwget https://www.rememberthemilk.com/download/linux/debian/pool/main/r/rememberthemilk/rememberthemilk_1.1.13_amd64.deb\nsudo dpkg -i rememberthemilk_1.1.13_amd64.deb\nsudo apt install -f\n```\n\n# WPS\n```bash\nwget https://wdl1.cache.wps.cn/wps/download/ep/Linux2019/8392/wps-office_11.1.0.8392_amd64.deb\nsudo dpkg -i wps-office_11.1.0.8392_amd64.deb\n```","slug":"2019-06-23-ubuntu","published":1,"updated":"2019-07-05T07:55:55.000Z","layout":"post","photos":[],"link":"","_id":"cjypn1qla003ry4rbdl9erj4c","content":"<p>Linux 系统用来用去还是发现ubuntu用的最舒服，毕竟用了从14.04 一直用到了18.04 。用了三年多了。下面就直接记录下。我这边优化系统的全部命令，方便下次装机使用。<br> <a id=\"more\"></a></p>\n<h1 id=\"更换源\"><a href=\"#更换源\" class=\"headerlink\" title=\"更换源\"></a>更换源</h1><h2 id=\"重命名源\"><a href=\"#重命名源\" class=\"headerlink\" title=\"重命名源\"></a>重命名源</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo mv /etc/apt/sources.list  /etc/apt/sources.list.mv</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"建立阿里源\"><a href=\"#建立阿里源\" class=\"headerlink\" title=\"建立阿里源\"></a>建立阿里源</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo vi /etc/apt/sources.list</span><br></pre></td></tr></table></figure>\n\n<p>复制以下内容</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"更新源\"><a href=\"#更新源\" class=\"headerlink\" title=\"更新源\"></a>更新源</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt update &amp;&amp; sudo apt upgrade</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"改目录名称\"><a href=\"#改目录名称\" class=\"headerlink\" title=\"改目录名称\"></a>改目录名称</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">export</span> LANG=en_US</span><br><span class=\"line\">$ xdg-user-dirs-gtk-update</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"下载git\"><a href=\"#下载git\" class=\"headerlink\" title=\"下载git\"></a>下载git</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ apt install git</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置git\"><a href=\"#配置git\" class=\"headerlink\" title=\"配置git\"></a>配置git</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --global user.name <span class=\"string\">\"ziv\"</span> </span><br><span class=\"line\">$ git config --global user.email <span class=\"string\">\"abc.ziv@hotmail.com\"</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置SSH秘钥\"><a href=\"#配置SSH秘钥\" class=\"headerlink\" title=\"配置SSH秘钥\"></a>配置SSH秘钥</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh-keygen -t rsa -C <span class=\"string\">\"abc.ziv@hotmail.com\"</span></span><br><span class=\"line\">$ cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装VSCode\"><a href=\"#安装VSCode\" class=\"headerlink\" title=\"安装VSCode\"></a>安装VSCode</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://vscode.cdn.azure.cn/stable/c7d83e57cd18f18026a8162d042843bda1bcf21f/code_1.35.1-1560350270_amd64.deb</span><br><span class=\"line\">$ sudo dpkg -i code_1.35.1-1560350270_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装-搜狗拼音\"><a href=\"#安装-搜狗拼音\" class=\"headerlink\" title=\"安装 搜狗拼音\"></a>安装 搜狗拼音</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget http://cdn2.ime.sogou.com/dl/index/1524572264/sogoupinyin_2.2.0.0108_amd64.deb</span><br><span class=\"line\">$ sudo dpkg -i sogoupinyin_2.2.0.0108_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装搜狗拼音依赖\"><a href=\"#安装搜狗拼音依赖\" class=\"headerlink\" title=\"安装搜狗拼音依赖\"></a>安装搜狗拼音依赖</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt install -f</span><br><span class=\"line\">$ locale</span><br><span class=\"line\">$ check-language-suppor</span><br><span class=\"line\"><span class=\"comment\">## 把出现的所有依赖都安装</span></span><br><span class=\"line\">$ sudo reboot</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装谷歌浏览器\"><a href=\"#安装谷歌浏览器\" class=\"headerlink\" title=\"安装谷歌浏览器\"></a>安装谷歌浏览器</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb</span><br><span class=\"line\">$ sudo dpkg -i google-chrome-stable_current_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装oh-my-zsh\"><a href=\"#安装oh-my-zsh\" class=\"headerlink\" title=\"安装oh-my-zsh\"></a>安装oh-my-zsh</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install zsh</span><br><span class=\"line\">$ chsh -s /bin/zsh </span><br><span class=\"line\">$ sudo vi /etc/passwd</span><br><span class=\"line\"><span class=\"comment\">## 把第一行的/bin/bash改成/bin/zsh，这个是root用户的</span></span><br><span class=\"line\"><span class=\"comment\">## 把最后一行的/bin/bash改成/bin/zsh，这个应该是每台电脑的登录用户名+计算机名组成的。</span></span><br><span class=\"line\">$ sh -c <span class=\"string\">\"<span class=\"variable\">$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)</span>\"</span></span><br><span class=\"line\">$ sudo reboot</span><br><span class=\"line\"><span class=\"comment\"># 查看主题</span></span><br><span class=\"line\">$ ls ~/.oh-my-zsh/themes</span><br><span class=\"line\"><span class=\"comment\"># 自动提示插件zsh-autosuggestions</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> git://github.com/zsh-users/zsh-autosuggestions <span class=\"variable\">$ZSH_CUSTOM</span>/plugins/zsh-autosuggestions</span><br><span class=\"line\"><span class=\"comment\"># 语法高亮zsh-syntax-highlighting使用以下命令安装</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class=\"variable\">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class=\"line\"><span class=\"comment\"># 修改主题 配置插件</span></span><br><span class=\"line\">$ vi ~/.zshrc</span><br><span class=\"line\">plugins=(git zsh-syntax-highlighting  zsh-autosuggestions)</span><br><span class=\"line\">ZSH_THEME=<span class=\"string\">\"主题\"</span> 推荐：steeef ys</span><br><span class=\"line\"><span class=\"comment\"># 更新配置</span></span><br><span class=\"line\">$ <span class=\"built_in\">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装shadowsocks-qt5\"><a href=\"#安装shadowsocks-qt5\" class=\"headerlink\" title=\"安装shadowsocks-qt5\"></a>安装shadowsocks-qt5</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo add-apt-repository ppa:hzwhuang/ss-qt5</span><br><span class=\"line\">$ vi /etc/apt/sources.list.d/hzwhuang-ubuntu-ss-qt5-bionic.list</span><br><span class=\"line\"><span class=\"comment\">## bionic(18.04版本代号)改成xenial(16.04版本代号)</span></span><br><span class=\"line\">$ sudo apt update</span><br><span class=\"line\">$ sudo apt install shadowsocks-qt5</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装百度网盘\"><a href=\"#安装百度网盘\" class=\"headerlink\" title=\"安装百度网盘\"></a>安装百度网盘</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://github.com/liuzhuoling2011/baidupcs-web/releases/download/3.6.7/BaiduPCS-Go-3.6.7-linux-amd64.zip</span><br><span class=\"line\">$ unzip BaiduPCS-Go-3.6.7-linux-amd64.zip</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装thunderbird邮箱\"><a href=\"#安装thunderbird邮箱\" class=\"headerlink\" title=\"安装thunderbird邮箱\"></a>安装thunderbird邮箱</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install thunderbird</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装印象笔记\"><a href=\"#安装印象笔记\" class=\"headerlink\" title=\"安装印象笔记\"></a>安装印象笔记</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install nixnote2 -y</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装flameshot截图工具\"><a href=\"#安装flameshot截图工具\" class=\"headerlink\" title=\"安装flameshot截图工具\"></a>安装flameshot截图工具</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/lupoDharkael/flameshot/releases/download/v0.6.0/flameshot_0.6.0_bionic_x86_64.deb</span><br><span class=\"line\">sudo dpkg -i flameshot_0.6.0_bionic_x86_64.deb</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装rememberthemilk\"><a href=\"#安装rememberthemilk\" class=\"headerlink\" title=\"安装rememberthemilk\"></a>安装rememberthemilk</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://www.rememberthemilk.com/download/linux/debian/pool/main/r/rememberthemilk/rememberthemilk_1.1.13_amd64.deb</span><br><span class=\"line\">sudo dpkg -i rememberthemilk_1.1.13_amd64.deb</span><br><span class=\"line\">sudo apt install -f</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"WPS\"><a href=\"#WPS\" class=\"headerlink\" title=\"WPS\"></a>WPS</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://wdl1.cache.wps.cn/wps/download/ep/Linux2019/8392/wps-office_11.1.0.8392_amd64.deb</span><br><span class=\"line\">sudo dpkg -i wps-office_11.1.0.8392_amd64.deb</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>Linux 系统用来用去还是发现ubuntu用的最舒服，毕竟用了从14.04 一直用到了18.04 。用了三年多了。下面就直接记录下。我这边优化系统的全部命令，方便下次装机使用。<br>","more":"</p>\n<h1 id=\"更换源\"><a href=\"#更换源\" class=\"headerlink\" title=\"更换源\"></a>更换源</h1><h2 id=\"重命名源\"><a href=\"#重命名源\" class=\"headerlink\" title=\"重命名源\"></a>重命名源</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo mv /etc/apt/sources.list  /etc/apt/sources.list.mv</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"建立阿里源\"><a href=\"#建立阿里源\" class=\"headerlink\" title=\"建立阿里源\"></a>建立阿里源</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo vi /etc/apt/sources.list</span><br></pre></td></tr></table></figure>\n\n<p>复制以下内容</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"更新源\"><a href=\"#更新源\" class=\"headerlink\" title=\"更新源\"></a>更新源</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt update &amp;&amp; sudo apt upgrade</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"改目录名称\"><a href=\"#改目录名称\" class=\"headerlink\" title=\"改目录名称\"></a>改目录名称</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">export</span> LANG=en_US</span><br><span class=\"line\">$ xdg-user-dirs-gtk-update</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"下载git\"><a href=\"#下载git\" class=\"headerlink\" title=\"下载git\"></a>下载git</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ apt install git</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置git\"><a href=\"#配置git\" class=\"headerlink\" title=\"配置git\"></a>配置git</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --global user.name <span class=\"string\">\"ziv\"</span> </span><br><span class=\"line\">$ git config --global user.email <span class=\"string\">\"abc.ziv@hotmail.com\"</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置SSH秘钥\"><a href=\"#配置SSH秘钥\" class=\"headerlink\" title=\"配置SSH秘钥\"></a>配置SSH秘钥</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh-keygen -t rsa -C <span class=\"string\">\"abc.ziv@hotmail.com\"</span></span><br><span class=\"line\">$ cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装VSCode\"><a href=\"#安装VSCode\" class=\"headerlink\" title=\"安装VSCode\"></a>安装VSCode</h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://vscode.cdn.azure.cn/stable/c7d83e57cd18f18026a8162d042843bda1bcf21f/code_1.35.1-1560350270_amd64.deb</span><br><span class=\"line\">$ sudo dpkg -i code_1.35.1-1560350270_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装-搜狗拼音\"><a href=\"#安装-搜狗拼音\" class=\"headerlink\" title=\"安装 搜狗拼音\"></a>安装 搜狗拼音</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget http://cdn2.ime.sogou.com/dl/index/1524572264/sogoupinyin_2.2.0.0108_amd64.deb</span><br><span class=\"line\">$ sudo dpkg -i sogoupinyin_2.2.0.0108_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装搜狗拼音依赖\"><a href=\"#安装搜狗拼音依赖\" class=\"headerlink\" title=\"安装搜狗拼音依赖\"></a>安装搜狗拼音依赖</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt install -f</span><br><span class=\"line\">$ locale</span><br><span class=\"line\">$ check-language-suppor</span><br><span class=\"line\"><span class=\"comment\">## 把出现的所有依赖都安装</span></span><br><span class=\"line\">$ sudo reboot</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装谷歌浏览器\"><a href=\"#安装谷歌浏览器\" class=\"headerlink\" title=\"安装谷歌浏览器\"></a>安装谷歌浏览器</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb</span><br><span class=\"line\">$ sudo dpkg -i google-chrome-stable_current_amd64.deb</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装oh-my-zsh\"><a href=\"#安装oh-my-zsh\" class=\"headerlink\" title=\"安装oh-my-zsh\"></a>安装oh-my-zsh</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install zsh</span><br><span class=\"line\">$ chsh -s /bin/zsh </span><br><span class=\"line\">$ sudo vi /etc/passwd</span><br><span class=\"line\"><span class=\"comment\">## 把第一行的/bin/bash改成/bin/zsh，这个是root用户的</span></span><br><span class=\"line\"><span class=\"comment\">## 把最后一行的/bin/bash改成/bin/zsh，这个应该是每台电脑的登录用户名+计算机名组成的。</span></span><br><span class=\"line\">$ sh -c <span class=\"string\">\"<span class=\"variable\">$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)</span>\"</span></span><br><span class=\"line\">$ sudo reboot</span><br><span class=\"line\"><span class=\"comment\"># 查看主题</span></span><br><span class=\"line\">$ ls ~/.oh-my-zsh/themes</span><br><span class=\"line\"><span class=\"comment\"># 自动提示插件zsh-autosuggestions</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> git://github.com/zsh-users/zsh-autosuggestions <span class=\"variable\">$ZSH_CUSTOM</span>/plugins/zsh-autosuggestions</span><br><span class=\"line\"><span class=\"comment\"># 语法高亮zsh-syntax-highlighting使用以下命令安装</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class=\"variable\">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class=\"line\"><span class=\"comment\"># 修改主题 配置插件</span></span><br><span class=\"line\">$ vi ~/.zshrc</span><br><span class=\"line\">plugins=(git zsh-syntax-highlighting  zsh-autosuggestions)</span><br><span class=\"line\">ZSH_THEME=<span class=\"string\">\"主题\"</span> 推荐：steeef ys</span><br><span class=\"line\"><span class=\"comment\"># 更新配置</span></span><br><span class=\"line\">$ <span class=\"built_in\">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装shadowsocks-qt5\"><a href=\"#安装shadowsocks-qt5\" class=\"headerlink\" title=\"安装shadowsocks-qt5\"></a>安装shadowsocks-qt5</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo add-apt-repository ppa:hzwhuang/ss-qt5</span><br><span class=\"line\">$ vi /etc/apt/sources.list.d/hzwhuang-ubuntu-ss-qt5-bionic.list</span><br><span class=\"line\"><span class=\"comment\">## bionic(18.04版本代号)改成xenial(16.04版本代号)</span></span><br><span class=\"line\">$ sudo apt update</span><br><span class=\"line\">$ sudo apt install shadowsocks-qt5</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装百度网盘\"><a href=\"#安装百度网盘\" class=\"headerlink\" title=\"安装百度网盘\"></a>安装百度网盘</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget https://github.com/liuzhuoling2011/baidupcs-web/releases/download/3.6.7/BaiduPCS-Go-3.6.7-linux-amd64.zip</span><br><span class=\"line\">$ unzip BaiduPCS-Go-3.6.7-linux-amd64.zip</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装thunderbird邮箱\"><a href=\"#安装thunderbird邮箱\" class=\"headerlink\" title=\"安装thunderbird邮箱\"></a>安装thunderbird邮箱</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install thunderbird</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装印象笔记\"><a href=\"#安装印象笔记\" class=\"headerlink\" title=\"安装印象笔记\"></a>安装印象笔记</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install nixnote2 -y</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装flameshot截图工具\"><a href=\"#安装flameshot截图工具\" class=\"headerlink\" title=\"安装flameshot截图工具\"></a>安装flameshot截图工具</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/lupoDharkael/flameshot/releases/download/v0.6.0/flameshot_0.6.0_bionic_x86_64.deb</span><br><span class=\"line\">sudo dpkg -i flameshot_0.6.0_bionic_x86_64.deb</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装rememberthemilk\"><a href=\"#安装rememberthemilk\" class=\"headerlink\" title=\"安装rememberthemilk\"></a>安装rememberthemilk</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://www.rememberthemilk.com/download/linux/debian/pool/main/r/rememberthemilk/rememberthemilk_1.1.13_amd64.deb</span><br><span class=\"line\">sudo dpkg -i rememberthemilk_1.1.13_amd64.deb</span><br><span class=\"line\">sudo apt install -f</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"WPS\"><a href=\"#WPS\" class=\"headerlink\" title=\"WPS\"></a>WPS</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://wdl1.cache.wps.cn/wps/download/ep/Linux2019/8392/wps-office_11.1.0.8392_amd64.deb</span><br><span class=\"line\">sudo dpkg -i wps-office_11.1.0.8392_amd64.deb</span><br></pre></td></tr></table></figure>"},{"title":"旋转字符串","date":"2016-12-13T17:00:00.000Z","updated":"2016-12-13T17:00:00.000Z","comments":1,"_content":"## 题目描述\n\n**给定一个字符串，要求把字符串前面的若干个字符移动到字符串的尾部，如把字符串“abcdef”前面的2个字符'a'和'b'移动到字符串的尾部，使得原字符串变成字符串“cdefab”。请写一个函数完成此功能。禁止使用字符串函数!**\n\n<!-- more -->\n\n## 分析与解法\n\n将一个字符串分成X和Y两个部分，在每部分字符串上定义反转操作，如X^T，即把X的所有字符反转（如，X=\"abc\"，那么X^T=\"cba\"），那么就得到下面的结论：(X^TY^T)^T=YX，显然就解决了字符串的反转问题。\n\n例如，字符串 abcdef ，若要让cdef翻转到ab的前头，只要按照下述3个步骤操作即可：\n\n* 首先将原字符串分为两个部分，即X:ab，Y:cdef；\n* 将X反转，X->X^T，即得：ab->ba；将Y反转，Y->Y^T，即得：cdef->fedc。\n* 反转上述步骤得到的结果字符串X^TY^T，即反转字符串cbafed的两部分（ba和fedc）给予反转，bafedc得到cdefab，形式化表示为(X^TY^T)^T=YX，这就实现了整个反转。\n\n~~~ php\n\n\tfunction ReverseString(&$s, $from, $to)\n\t{\n\t\twhile ($from < $to) {\n\t\t\t$t = $s[$from];\n\t\t\t$s[$from++] = $s[$to];\n\t\t\t$s[$to--] = $t;\n\t\t}\n\t}\n\n\tfunction LeftRotateString(&$s,$n,$m)\n\t{\n\t\t$m %= $n;               \n\t\tReverseString($s, 0, $m - 1);\n\t\t// echo $s; //bacdef\n\t\tReverseString($s, $m, $n - 1);\n\t\t// echo $s; //bafedc\n\t\tReverseString($s, 0, $n - 1);\n\t\t// echo $s; //cdefab\n\t}\n\n\t$String = 'abcdef';\n\t$n = 6;\n\t$m = 2;\n\tLeftRotateString($String,$n,$m);\n\t// echo $String; //cdefab\n    \n~~~\n\n## 举一反三\n* 链表翻转。给出一个链表和一个数k，比如，链表为1→2→3→4→5→6，k=2，则翻转后2→1→6→5→4→3，若k=3，翻转后3→2→1→6→5→4，若k=4，翻转后4→3→2→1→6→5，用程序实现。\n\n* 编写程序，在原字符串中把字符串尾部的m个字符移动到字符串的头部，要求：长度为n的字符串操作时间复杂度为O(n)，空间复杂度为O(1)。 例如，原字符串为”Ilovebaofeng”，m=7，输出结果为：”baofengIlove”。\n\n* 反转上述步骤得到的结果字符串X^TY^T，即反转字符串cbafed的两部分（cba和fed）给予反转，cbafed得到defabc，形式化表示为(X^TY^T)^T=YX，这就实现了整个反转。\n\t\n","source":"_posts/2016-12-13-ReverseString.md","raw":"---\ntitle:  \"旋转字符串\"\ndate: 2016-12-13 12:00:00\nupdated: 2016-12-13 12:00:00\ncomments: true\ncategories: 算法\ntags:\n    - PHP\n    - 算法\n---\n## 题目描述\n\n**给定一个字符串，要求把字符串前面的若干个字符移动到字符串的尾部，如把字符串“abcdef”前面的2个字符'a'和'b'移动到字符串的尾部，使得原字符串变成字符串“cdefab”。请写一个函数完成此功能。禁止使用字符串函数!**\n\n<!-- more -->\n\n## 分析与解法\n\n将一个字符串分成X和Y两个部分，在每部分字符串上定义反转操作，如X^T，即把X的所有字符反转（如，X=\"abc\"，那么X^T=\"cba\"），那么就得到下面的结论：(X^TY^T)^T=YX，显然就解决了字符串的反转问题。\n\n例如，字符串 abcdef ，若要让cdef翻转到ab的前头，只要按照下述3个步骤操作即可：\n\n* 首先将原字符串分为两个部分，即X:ab，Y:cdef；\n* 将X反转，X->X^T，即得：ab->ba；将Y反转，Y->Y^T，即得：cdef->fedc。\n* 反转上述步骤得到的结果字符串X^TY^T，即反转字符串cbafed的两部分（ba和fedc）给予反转，bafedc得到cdefab，形式化表示为(X^TY^T)^T=YX，这就实现了整个反转。\n\n~~~ php\n\n\tfunction ReverseString(&$s, $from, $to)\n\t{\n\t\twhile ($from < $to) {\n\t\t\t$t = $s[$from];\n\t\t\t$s[$from++] = $s[$to];\n\t\t\t$s[$to--] = $t;\n\t\t}\n\t}\n\n\tfunction LeftRotateString(&$s,$n,$m)\n\t{\n\t\t$m %= $n;               \n\t\tReverseString($s, 0, $m - 1);\n\t\t// echo $s; //bacdef\n\t\tReverseString($s, $m, $n - 1);\n\t\t// echo $s; //bafedc\n\t\tReverseString($s, 0, $n - 1);\n\t\t// echo $s; //cdefab\n\t}\n\n\t$String = 'abcdef';\n\t$n = 6;\n\t$m = 2;\n\tLeftRotateString($String,$n,$m);\n\t// echo $String; //cdefab\n    \n~~~\n\n## 举一反三\n* 链表翻转。给出一个链表和一个数k，比如，链表为1→2→3→4→5→6，k=2，则翻转后2→1→6→5→4→3，若k=3，翻转后3→2→1→6→5→4，若k=4，翻转后4→3→2→1→6→5，用程序实现。\n\n* 编写程序，在原字符串中把字符串尾部的m个字符移动到字符串的头部，要求：长度为n的字符串操作时间复杂度为O(n)，空间复杂度为O(1)。 例如，原字符串为”Ilovebaofeng”，m=7，输出结果为：”baofengIlove”。\n\n* 反转上述步骤得到的结果字符串X^TY^T，即反转字符串cbafed的两部分（cba和fed）给予反转，cbafed得到defabc，形式化表示为(X^TY^T)^T=YX，这就实现了整个反转。\n\t\n","slug":"2016-12-13-ReverseString","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qlb003uy4rbta0rc44a","content":"<h2 id=\"题目描述\"><a href=\"#题目描述\" class=\"headerlink\" title=\"题目描述\"></a>题目描述</h2><p><strong>给定一个字符串，要求把字符串前面的若干个字符移动到字符串的尾部，如把字符串“abcdef”前面的2个字符’a’和’b’移动到字符串的尾部，使得原字符串变成字符串“cdefab”。请写一个函数完成此功能。禁止使用字符串函数!</strong></p>\n<a id=\"more\"></a>\n\n<h2 id=\"分析与解法\"><a href=\"#分析与解法\" class=\"headerlink\" title=\"分析与解法\"></a>分析与解法</h2><p>将一个字符串分成X和Y两个部分，在每部分字符串上定义反转操作，如X^T，即把X的所有字符反转（如，X=”abc”，那么X^T=”cba”），那么就得到下面的结论：(X^TY^T)^T=YX，显然就解决了字符串的反转问题。</p>\n<p>例如，字符串 abcdef ，若要让cdef翻转到ab的前头，只要按照下述3个步骤操作即可：</p>\n<ul>\n<li>首先将原字符串分为两个部分，即X:ab，Y:cdef；</li>\n<li>将X反转，X-&gt;X^T，即得：ab-&gt;ba；将Y反转，Y-&gt;Y^T，即得：cdef-&gt;fedc。</li>\n<li>反转上述步骤得到的结果字符串X^TY^T，即反转字符串cbafed的两部分（ba和fedc）给予反转，bafedc得到cdefab，形式化表示为(X^TY^T)^T=YX，这就实现了整个反转。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ReverseString</span><span class=\"params\">(&amp;$s, $from, $to)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> ($from &lt; $to) &#123;</span><br><span class=\"line\">\t\t$t = $s[$from];</span><br><span class=\"line\">\t\t$s[$from++] = $s[$to];</span><br><span class=\"line\">\t\t$s[$to--] = $t;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">LeftRotateString</span><span class=\"params\">(&amp;$s,$n,$m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t$m %= $n;               </span><br><span class=\"line\">\tReverseString($s, <span class=\"number\">0</span>, $m - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// echo $s; //bacdef</span></span><br><span class=\"line\">\tReverseString($s, $m, $n - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// echo $s; //bafedc</span></span><br><span class=\"line\">\tReverseString($s, <span class=\"number\">0</span>, $n - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// echo $s; //cdefab</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$String = <span class=\"string\">'abcdef'</span>;</span><br><span class=\"line\">$n = <span class=\"number\">6</span>;</span><br><span class=\"line\">$m = <span class=\"number\">2</span>;</span><br><span class=\"line\">LeftRotateString($String,$n,$m);</span><br><span class=\"line\"><span class=\"comment\">// echo $String; //cdefab</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"举一反三\"><a href=\"#举一反三\" class=\"headerlink\" title=\"举一反三\"></a>举一反三</h2><ul>\n<li><p>链表翻转。给出一个链表和一个数k，比如，链表为1→2→3→4→5→6，k=2，则翻转后2→1→6→5→4→3，若k=3，翻转后3→2→1→6→5→4，若k=4，翻转后4→3→2→1→6→5，用程序实现。</p>\n</li>\n<li><p>编写程序，在原字符串中把字符串尾部的m个字符移动到字符串的头部，要求：长度为n的字符串操作时间复杂度为O(n)，空间复杂度为O(1)。 例如，原字符串为”Ilovebaofeng”，m=7，输出结果为：”baofengIlove”。</p>\n</li>\n<li><p>反转上述步骤得到的结果字符串X^TY^T，即反转字符串cbafed的两部分（cba和fed）给予反转，cbafed得到defabc，形式化表示为(X^TY^T)^T=YX，这就实现了整个反转。</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"题目描述\"><a href=\"#题目描述\" class=\"headerlink\" title=\"题目描述\"></a>题目描述</h2><p><strong>给定一个字符串，要求把字符串前面的若干个字符移动到字符串的尾部，如把字符串“abcdef”前面的2个字符’a’和’b’移动到字符串的尾部，使得原字符串变成字符串“cdefab”。请写一个函数完成此功能。禁止使用字符串函数!</strong></p>","more":"<h2 id=\"分析与解法\"><a href=\"#分析与解法\" class=\"headerlink\" title=\"分析与解法\"></a>分析与解法</h2><p>将一个字符串分成X和Y两个部分，在每部分字符串上定义反转操作，如X^T，即把X的所有字符反转（如，X=”abc”，那么X^T=”cba”），那么就得到下面的结论：(X^TY^T)^T=YX，显然就解决了字符串的反转问题。</p>\n<p>例如，字符串 abcdef ，若要让cdef翻转到ab的前头，只要按照下述3个步骤操作即可：</p>\n<ul>\n<li>首先将原字符串分为两个部分，即X:ab，Y:cdef；</li>\n<li>将X反转，X-&gt;X^T，即得：ab-&gt;ba；将Y反转，Y-&gt;Y^T，即得：cdef-&gt;fedc。</li>\n<li>反转上述步骤得到的结果字符串X^TY^T，即反转字符串cbafed的两部分（ba和fedc）给予反转，bafedc得到cdefab，形式化表示为(X^TY^T)^T=YX，这就实现了整个反转。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ReverseString</span><span class=\"params\">(&amp;$s, $from, $to)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> ($from &lt; $to) &#123;</span><br><span class=\"line\">\t\t$t = $s[$from];</span><br><span class=\"line\">\t\t$s[$from++] = $s[$to];</span><br><span class=\"line\">\t\t$s[$to--] = $t;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">LeftRotateString</span><span class=\"params\">(&amp;$s,$n,$m)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t$m %= $n;               </span><br><span class=\"line\">\tReverseString($s, <span class=\"number\">0</span>, $m - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// echo $s; //bacdef</span></span><br><span class=\"line\">\tReverseString($s, $m, $n - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// echo $s; //bafedc</span></span><br><span class=\"line\">\tReverseString($s, <span class=\"number\">0</span>, $n - <span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// echo $s; //cdefab</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$String = <span class=\"string\">'abcdef'</span>;</span><br><span class=\"line\">$n = <span class=\"number\">6</span>;</span><br><span class=\"line\">$m = <span class=\"number\">2</span>;</span><br><span class=\"line\">LeftRotateString($String,$n,$m);</span><br><span class=\"line\"><span class=\"comment\">// echo $String; //cdefab</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"举一反三\"><a href=\"#举一反三\" class=\"headerlink\" title=\"举一反三\"></a>举一反三</h2><ul>\n<li><p>链表翻转。给出一个链表和一个数k，比如，链表为1→2→3→4→5→6，k=2，则翻转后2→1→6→5→4→3，若k=3，翻转后3→2→1→6→5→4，若k=4，翻转后4→3→2→1→6→5，用程序实现。</p>\n</li>\n<li><p>编写程序，在原字符串中把字符串尾部的m个字符移动到字符串的头部，要求：长度为n的字符串操作时间复杂度为O(n)，空间复杂度为O(1)。 例如，原字符串为”Ilovebaofeng”，m=7，输出结果为：”baofengIlove”。</p>\n</li>\n<li><p>反转上述步骤得到的结果字符串X^TY^T，即反转字符串cbafed的两部分（cba和fed）给予反转，cbafed得到defabc，形式化表示为(X^TY^T)^T=YX，这就实现了整个反转。</p>\n</li>\n</ul>"},{"title":"MySQL存储过程","date":"2017-05-10T16:00:00.000Z","updated":"2017-05-10T16:00:00.000Z","comments":1,"_content":"\n# 优缺点\n\n### 优点\n* 在生产环境下，可以通过直接修改存储过程的方式修改业务逻辑（或bug），而不用重启服务器。但这一点便利被许多人滥用了。有人直接就在正式服务器上修改存储过程，而没有经过完整的测试，后果非常严重。\n* 执行速度快。存储过程经过编译之后会比单独一条一条执行要快。但这个效率真是没太大影响。如果是要做大数据量的导入、同步，我们可以用其它手段。\n* 减少网络传输。存储过程直接就在数据库服务器上跑，所有的数据访问都在服务器内部进行，不需要传输数据到其它终端。但我们的应付服务器通常与数据库是在同一内网，大数据的访问的瓶颈会是硬盘的速度，而不是网速。\n* 能够解决presentation与数据之间的差异，说得文艺青年点就是解决OO模型与二维数据持久化之间的阻抗。领域模型和数据模型的设计可能不是同一个人（一个是SA，另一个是DBA），两者的分歧可能会很大——这不奇怪，一个是以OO的思想来设计，一个是结构化的数据来设计，大家互不妥协——你说为了软件的弹性必须这么设计，他说为了效率必须那样设计，为了抹平鸿沟，就用存储过程来做数据存储的逻辑映射（把属性映射到字段）。好吧，台下已经有同学在叨咕ORM了。\n* 方便DBA优化。所有的SQL集中在一个地方，DBA会很高兴。这一点算是ORM的软肋。不过按照CQRS框架的思想，查询是用存储过程还是ORM，还真不是问题——DBA对数据库的优化，ORM一样会受益。况且放在ORM中还能用二级缓存，有些时候效率还会更高。\n     <!-- more -->\n\n### 缺点\n* SQL本身是一种结构化查询语言，加上了一些控制（赋值、循环和异常处理等），但不是OO的，本质上还是过程化的，面对复杂的业务逻辑，过程化的处理会很吃力。这一点算致命伤。\n* 不便于调试。基本上没有较好的调试器，很多时候是用print来调试，但用这种方法调试长达数百行的存储过程简直是噩梦。好吧，这一点不算啥，C#/Java一样能写出噩梦般的代码。\n* 没办法应用缓存。虽然有全局临时表之类的方法可以做缓存，但同样加重了数据库的负担。如果缓存并发严重，经常要加锁，那效率实在堪忧。\n* 无法适应数据库的切割（水平或垂直切割）。数据库切割之后，存储过程并不清楚数据存储在哪个数据库中.\n\n     \n# 基本语法\n\n### 一.创建存储过程\n```sql\ncreate procedure sp_name()\nbegin\n......\nend\n```\n### 二.调用存储过程\n* 基本语法：**call sp_name()**\n* 注意：存储过程名称后面必须加括号，哪怕该存储过程没有参数传递\n\n### 三.删除存储过程\n* 基本语法：**drop procedure sp_name()**\n* 注意事项: 不能在一个存储过程中删除另一个存储过程，只能调用另一个存储过程\n\n### 四.其他常用命令\n\n* **show procedure status**\n* 显示数据库中所有存储的存储过程基本信息，包括所属数据库，存储过程名称，创建时间等\n\n* **show create procedure sp_name**\n* 显示某一个MySQL存储过程的详细信息\n\n\n## 数据类型及运算符\n\n### 一、基本数据类型\n\n### 二、变量：\n\n自定义变量：**DECLARE   a INT ; SET a=100;**\n\n可用以下语句代替：**DECLARE a INT DEFAULT 100;**\n\n变量分为**用户变量**和**系统变量**，**系统变量**又分为**会话**和**全局级变量**\n\n**用户变量**：用户变量名一般以@开头，滥用用户变量会导致程序难以理解及管理\n\n* 1、 在mysql客户端使用用户变量\n```sql\nmysql> SELECT 'Hello World' into @x;\nmysql> SELECT @x;\n\nmysql> SET @y='Goodbye Cruel World';\nmysql> select @y;\n\nmysql> SET @z=1+2+3;\nmysql> select @z;\n```\n\n* 2、 在存储过程中使用用户变量\n```sql\nmysql> CREATE PROCEDURE GreetWorld( ) SELECT CONCAT(@greeting,' World');\nmysql> SET @greeting='Hello';\nmysql> CALL GreetWorld( );\n```\n\n* 3、 在存储过程间传递全局范围的用户变量\n```sql\nmysql> CREATE PROCEDURE p1( )   SET @last_procedure='p1';\nmysql> CREATE PROCEDURE p2( ) SELECT CONCAT('Last procedure was ',@last_procedure);\nmysql> CALL p1( );\nmysql> CALL p2( );\n```\n\n### 三、运算符：\n* 1.算术运算符\n\n~~~\n+     加   SET var1=2+2;       4\n-     减   SET var2=3-2;       1\n*     乘   SET var3=3*2;       6\n/     除   SET var4=10/3;      3.3333\nDIV   整除 SET var5=10 DIV 3;  3\n%     取模 SET var6=10%3 ;     1\n~~~\n* 2.比较运算符\n\n~~~\n>            大于 1>2 False\n<            小于 2<1 False\n<=           小于等于 2<=2 True\n>=           大于等于 3>=2 True\nBETWEEN      在两值之间 5 BETWEEN 1 AND 10 True\nNOT BETWEEN  不在两值之间 5 NOT BETWEEN 1 AND 10 False\nIN           在集合中 5 IN (1,2,3,4) False\nNOT IN       不在集合中 5 NOT IN (1,2,3,4) True\n=            等于 2=3 False\n<>, !=       不等于 2<>3 False\n<=>          严格比较两个NULL值是否相等 NULL<=>NULL True\nLIKE         简单模式匹配 \"Guy Harrison\" LIKE \"Guy%\" True\nREGEXP       正则式匹配 \"Guy Harrison\" REGEXP \"[Gg]reg\" False\nIS NULL      为空 0 IS NULL False\nIS NOT NULL  不为空 0 IS NOT NULL True\n~~~\n* 3.逻辑运算符\n\n* 4.位运算符\n\n~~~\n|   或\n&   与\n<<  左移位\n>>  右移位\n~   非(单目运算，按位取反)\n~~~\n**注释：**\n/* 注释内容 */ 一般用于多行注释\n\n# 流程控制\n### 一、顺序结构\n### 二、分支结构\n```sql\nif 条件 then\nelse \nend if;\n```\n### 三、循环结构\n**while循环**\n```sql\nSET counter = 0;   \nWHILE counter != 10 DO   \n    SET counter = counter+1;   \nEND WHILE;   \n```\n**loop循环**\n```sql\nSET counter = 0;   \nmy_simple_loop: LOOP   \n    SET counter = counter+1;   \n    IF counter = 10 THEN   \n        LEAVE my_simple_loop;   \n    END IF;   \nEND LOOP my_simple_loop;   \n```\n**repeat until循环**\n```sql\nSET counter = 0;   \nREPEAT   \n    SET counter = counter+1;   \nUNTIL counter = 10 END REPEAT;   \n```\n**注：**\n区块定义，常用\n~~~\nbegin\n......\nend;\n~~~\n也可以给区块起别名，如：\n~~~\nlable:begin\n...........\nend lable;\n~~~\n可以用leave lable;\n\n跳出区块，执行区块以后的代码 begin和end如同C语言中的{ 和 }。\n\n# 输入和输出\n\nmysql存储过程的参数用在存储过程的定义，共有三种参数类型,**IN,OUT,INOUT**\n~~~\nCreate procedure|function([[IN |OUT |INOUT ] 参数名 数据类形...])\n~~~\n**IN 输入参数**\n* 表示该参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值\n\n**OUT 输出参数**\n* 该值可在存储过程内部被改变，并可返回\n\n**INOUT 输入输出参数**\n* 调用时指定，并且可被改变和返回\n\n**IN参数例子：**\n```sql\nCREATE PROCEDURE sp_demo_in_parameter(IN p_in INT)\nBEGIN\nSELECT p_in; /*查询输入参数*/\nSET p_in=2; /*修改*/\nselect p_in;/*查看修改后的值*/\nEND;\n执行结果:\nmysql> set @p_in=1\nmysql> call sp_demo_in_parameter(@p_in)\n略\nmysql> select @p_in;\n略\n```\n以上可以看出，p_in虽然在存储过程中被修改，但并不影响@p_id的值\n\n**OUT参数例子**\n```sql\nCREATE PROCEDURE sp_demo_out_parameter(out p_in INT)\nBEGIN\nSELECT p_in;\nSET p_in=2; \nselect p_in;\nEND;\n执行结果:\nmysql> set @p_in=1\nmysql> call sp_demo_out_parameter(@p_in)\n略\nmysql> select @p_in;\n略\n```\n**INOUT参数例子：** \n```sql\nCREATE PROCEDURE sp_demo_inout_parameter(inout p_in INT)\nBEGIN\nSELECT p_in;\nSET p_in=2; \nselect p_in;\nEND;\n执行结果:\nmysql> set @p_in=1\nmysql> call sp_demo_inout_parameter(@p_in)\n略\nmysql> select @p_in;\n略\n```\n\n# 函数库\n\nmysql存储过程基本函数包括：**字符串类型**，**数值类型**，**日期类型**\n\n### 一、字符串类\n~~~\nCHARSET(str) //返回字串字符集\nCONCAT (string2 [,… ]) //连接字串\nINSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0\nLCASE (string2 ) //转换成小写\nLEFT (string2 ,length ) //从string2中的左边起取length个字符\nLENGTH (string ) //string长度\nLOAD_FILE (file_name ) //从文件读取内容\nLOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置\nLPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length\nLTRIM (string2 ) //去除前端空格\nREPEAT (string2 ,count ) //重复count次\nREPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str\nRPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length\nRTRIM (string2 ) //去除后端空格\nSTRCMP (string1 ,string2 ) //逐字符比较两字串大小,\nSUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,\n注：mysql中处理字符串时，默认第一个字符下标为1，即参数position必须大于等于1\nmysql> select substring(’abcd’,0,2);\n+———————–+\n| substring(’abcd’,0,2) |\n+———————–+\n|                       |\n+———————–+\n1 row in set (0.00 sec)\n\nmysql> select substring(’abcd’,1,2);\n+———————–+\n| substring(’abcd’,1,2) |\n+———————–+\n| ab                    |\n+———————–+\n1 row in set (0.02 sec)\n\nTRIM([[BOTH|LEADING|TRAILING] [padding] FROM]string2) //去除指定位置的指定字符\nUCASE (string2 ) //转换成大写\nRIGHT(string2,length) //取string2最后length个字符\nSPACE(count) //生成count个空格\n~~~\n### 二、数值类型\n~~~\nABS (number2 ) //绝对值\nBIN (decimal_number ) //十进制转二进制\nCEILING (number2 ) //向上取整\nCONV(number2,from_base,to_base) //进制转换\nFLOOR (number2 ) //向下取整\nFORMAT (number,decimal_places ) //保留小数位数\nHEX (DecimalNumber ) //转十六进制\n注：HEX()中可传入字符串，则返回其ASC-11码，如HEX(’DEF’)返回4142143\n也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19\nLEAST (number , number2 [,..]) //求最小值\nMOD (numerator ,denominator ) //求余\nPOWER (number ,power ) //求指数\nRAND([seed]) //随机数\nROUND (number [,decimals ]) //四舍五入,decimals为小数位数]\n\n注：返回类型并非均为整数，如：\n\n(1)默认变为整形值\nmysql> select round(1.23);\n+————-+\n| round(1.23) |\n+————-+\n|           1 |\n+————-+\n1 row in set (0.00 sec)\n\nmysql> select round(1.56);\n+————-+\n| round(1.56) |\n+————-+\n|           2 |\n+————-+\n1 row in set (0.00 sec)\n\n(2)可以设定小数位数，返回浮点型数据\n\nmysql> select round(1.567,2);\n+—————-+\n| round(1.567,2) |\n+—————-+\n|           1.57 |\n+—————-+\n1 row in set (0.00 sec)\n\nSIGN (number2 ) //返回符号,正负或0\nSQRT(number2) //开平方\n~~~\n### 三、日期类型\n~~~\nADDTIME (date2 ,time_interval ) //将time_interval加到date2\nCONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区\nCURRENT_DATE ( ) //当前日期\nCURRENT_TIME ( ) //当前时间\nCURRENT_TIMESTAMP ( ) //当前时间戳\nDATE (datetime ) //返回datetime的日期部分\nDATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间\nDATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime\nDATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间\nDATEDIFF (date1 ,date2 ) //两个日期差\nDAY (date ) //返回日期的天\nDAYNAME (date ) //英文星期\nDAYOFWEEK (date ) //星期(1-7) ,1为星期天\nDAYOFYEAR (date ) //一年中的第几天\nEXTRACT (interval_name FROM date ) //从date中提取日期的指定部分\nMAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串\nMAKETIME (hour ,minute ,second ) //生成时间串\nMONTHNAME (date ) //英文月份名\nNOW ( ) //当前时间\nSEC_TO_TIME (seconds ) //秒数转成时间\nSTR_TO_DATE (string ,format ) //字串转成时间,以format格式显示\nTIMEDIFF (datetime1 ,datetime2 ) //两个时间差\nTIME_TO_SEC (time ) //时间转秒数]\nWEEK (date_time [,start_of_week ]) //第几周\nYEAR (datetime ) //年份\nDAYOFMONTH(datetime) //月的第几天\nHOUR(datetime) //小时\nLAST_DAY(date) //date的月的最后日期\nMICROSECOND(datetime) //微秒\nMONTH(datetime) //月\nMINUTE(datetime) //分\n~~~\n* 注：可用在INTERVAL中的类型：**DAY ,DAY_HOUR ,DAY_MINUTE ,DAY_SECOND ,HOUR ,HOUR_MINUTE ,HOUR_SECOND ,MINUTE ,MINUTE_SECOND,MONTH ,SECOND ,YEAR**\n```sql\nDECLARE variable_name [,variable_name...] datatype [DEFAULT value];\n```\n其中，datatype为mysql的数据类型，如:**INT, FLOAT, DATE, VARCHAR(length)**\n\n**实例：**\n```sql\nDECLARE l_int INT unsigned default 4000000;\nDECLARE l_numeric NUMERIC(8,2) DEFAULT 9.95;\nDECLARE l_date DATE DEFAULT '1999-12-31';\nDECLARE l_datetime DATETIME DEFAULT '1999-12-31 23:59:59';\nDECLARE l_varchar VARCHAR(255) DEFAULT 'This will not be padded';\n```\n\n","source":"_posts/2017-05-10-mysqlStoredProcedure.md","raw":"---\ntitle:  \"MySQL存储过程\"\ndate: 2017-05-10  12:00:00\nupdated: 2017-05-10  12:00:00\ncomments: true\ncategories: 数据库\ntags:\n    - MySQL\n---\n\n# 优缺点\n\n### 优点\n* 在生产环境下，可以通过直接修改存储过程的方式修改业务逻辑（或bug），而不用重启服务器。但这一点便利被许多人滥用了。有人直接就在正式服务器上修改存储过程，而没有经过完整的测试，后果非常严重。\n* 执行速度快。存储过程经过编译之后会比单独一条一条执行要快。但这个效率真是没太大影响。如果是要做大数据量的导入、同步，我们可以用其它手段。\n* 减少网络传输。存储过程直接就在数据库服务器上跑，所有的数据访问都在服务器内部进行，不需要传输数据到其它终端。但我们的应付服务器通常与数据库是在同一内网，大数据的访问的瓶颈会是硬盘的速度，而不是网速。\n* 能够解决presentation与数据之间的差异，说得文艺青年点就是解决OO模型与二维数据持久化之间的阻抗。领域模型和数据模型的设计可能不是同一个人（一个是SA，另一个是DBA），两者的分歧可能会很大——这不奇怪，一个是以OO的思想来设计，一个是结构化的数据来设计，大家互不妥协——你说为了软件的弹性必须这么设计，他说为了效率必须那样设计，为了抹平鸿沟，就用存储过程来做数据存储的逻辑映射（把属性映射到字段）。好吧，台下已经有同学在叨咕ORM了。\n* 方便DBA优化。所有的SQL集中在一个地方，DBA会很高兴。这一点算是ORM的软肋。不过按照CQRS框架的思想，查询是用存储过程还是ORM，还真不是问题——DBA对数据库的优化，ORM一样会受益。况且放在ORM中还能用二级缓存，有些时候效率还会更高。\n     <!-- more -->\n\n### 缺点\n* SQL本身是一种结构化查询语言，加上了一些控制（赋值、循环和异常处理等），但不是OO的，本质上还是过程化的，面对复杂的业务逻辑，过程化的处理会很吃力。这一点算致命伤。\n* 不便于调试。基本上没有较好的调试器，很多时候是用print来调试，但用这种方法调试长达数百行的存储过程简直是噩梦。好吧，这一点不算啥，C#/Java一样能写出噩梦般的代码。\n* 没办法应用缓存。虽然有全局临时表之类的方法可以做缓存，但同样加重了数据库的负担。如果缓存并发严重，经常要加锁，那效率实在堪忧。\n* 无法适应数据库的切割（水平或垂直切割）。数据库切割之后，存储过程并不清楚数据存储在哪个数据库中.\n\n     \n# 基本语法\n\n### 一.创建存储过程\n```sql\ncreate procedure sp_name()\nbegin\n......\nend\n```\n### 二.调用存储过程\n* 基本语法：**call sp_name()**\n* 注意：存储过程名称后面必须加括号，哪怕该存储过程没有参数传递\n\n### 三.删除存储过程\n* 基本语法：**drop procedure sp_name()**\n* 注意事项: 不能在一个存储过程中删除另一个存储过程，只能调用另一个存储过程\n\n### 四.其他常用命令\n\n* **show procedure status**\n* 显示数据库中所有存储的存储过程基本信息，包括所属数据库，存储过程名称，创建时间等\n\n* **show create procedure sp_name**\n* 显示某一个MySQL存储过程的详细信息\n\n\n## 数据类型及运算符\n\n### 一、基本数据类型\n\n### 二、变量：\n\n自定义变量：**DECLARE   a INT ; SET a=100;**\n\n可用以下语句代替：**DECLARE a INT DEFAULT 100;**\n\n变量分为**用户变量**和**系统变量**，**系统变量**又分为**会话**和**全局级变量**\n\n**用户变量**：用户变量名一般以@开头，滥用用户变量会导致程序难以理解及管理\n\n* 1、 在mysql客户端使用用户变量\n```sql\nmysql> SELECT 'Hello World' into @x;\nmysql> SELECT @x;\n\nmysql> SET @y='Goodbye Cruel World';\nmysql> select @y;\n\nmysql> SET @z=1+2+3;\nmysql> select @z;\n```\n\n* 2、 在存储过程中使用用户变量\n```sql\nmysql> CREATE PROCEDURE GreetWorld( ) SELECT CONCAT(@greeting,' World');\nmysql> SET @greeting='Hello';\nmysql> CALL GreetWorld( );\n```\n\n* 3、 在存储过程间传递全局范围的用户变量\n```sql\nmysql> CREATE PROCEDURE p1( )   SET @last_procedure='p1';\nmysql> CREATE PROCEDURE p2( ) SELECT CONCAT('Last procedure was ',@last_procedure);\nmysql> CALL p1( );\nmysql> CALL p2( );\n```\n\n### 三、运算符：\n* 1.算术运算符\n\n~~~\n+     加   SET var1=2+2;       4\n-     减   SET var2=3-2;       1\n*     乘   SET var3=3*2;       6\n/     除   SET var4=10/3;      3.3333\nDIV   整除 SET var5=10 DIV 3;  3\n%     取模 SET var6=10%3 ;     1\n~~~\n* 2.比较运算符\n\n~~~\n>            大于 1>2 False\n<            小于 2<1 False\n<=           小于等于 2<=2 True\n>=           大于等于 3>=2 True\nBETWEEN      在两值之间 5 BETWEEN 1 AND 10 True\nNOT BETWEEN  不在两值之间 5 NOT BETWEEN 1 AND 10 False\nIN           在集合中 5 IN (1,2,3,4) False\nNOT IN       不在集合中 5 NOT IN (1,2,3,4) True\n=            等于 2=3 False\n<>, !=       不等于 2<>3 False\n<=>          严格比较两个NULL值是否相等 NULL<=>NULL True\nLIKE         简单模式匹配 \"Guy Harrison\" LIKE \"Guy%\" True\nREGEXP       正则式匹配 \"Guy Harrison\" REGEXP \"[Gg]reg\" False\nIS NULL      为空 0 IS NULL False\nIS NOT NULL  不为空 0 IS NOT NULL True\n~~~\n* 3.逻辑运算符\n\n* 4.位运算符\n\n~~~\n|   或\n&   与\n<<  左移位\n>>  右移位\n~   非(单目运算，按位取反)\n~~~\n**注释：**\n/* 注释内容 */ 一般用于多行注释\n\n# 流程控制\n### 一、顺序结构\n### 二、分支结构\n```sql\nif 条件 then\nelse \nend if;\n```\n### 三、循环结构\n**while循环**\n```sql\nSET counter = 0;   \nWHILE counter != 10 DO   \n    SET counter = counter+1;   \nEND WHILE;   \n```\n**loop循环**\n```sql\nSET counter = 0;   \nmy_simple_loop: LOOP   \n    SET counter = counter+1;   \n    IF counter = 10 THEN   \n        LEAVE my_simple_loop;   \n    END IF;   \nEND LOOP my_simple_loop;   \n```\n**repeat until循环**\n```sql\nSET counter = 0;   \nREPEAT   \n    SET counter = counter+1;   \nUNTIL counter = 10 END REPEAT;   \n```\n**注：**\n区块定义，常用\n~~~\nbegin\n......\nend;\n~~~\n也可以给区块起别名，如：\n~~~\nlable:begin\n...........\nend lable;\n~~~\n可以用leave lable;\n\n跳出区块，执行区块以后的代码 begin和end如同C语言中的{ 和 }。\n\n# 输入和输出\n\nmysql存储过程的参数用在存储过程的定义，共有三种参数类型,**IN,OUT,INOUT**\n~~~\nCreate procedure|function([[IN |OUT |INOUT ] 参数名 数据类形...])\n~~~\n**IN 输入参数**\n* 表示该参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值\n\n**OUT 输出参数**\n* 该值可在存储过程内部被改变，并可返回\n\n**INOUT 输入输出参数**\n* 调用时指定，并且可被改变和返回\n\n**IN参数例子：**\n```sql\nCREATE PROCEDURE sp_demo_in_parameter(IN p_in INT)\nBEGIN\nSELECT p_in; /*查询输入参数*/\nSET p_in=2; /*修改*/\nselect p_in;/*查看修改后的值*/\nEND;\n执行结果:\nmysql> set @p_in=1\nmysql> call sp_demo_in_parameter(@p_in)\n略\nmysql> select @p_in;\n略\n```\n以上可以看出，p_in虽然在存储过程中被修改，但并不影响@p_id的值\n\n**OUT参数例子**\n```sql\nCREATE PROCEDURE sp_demo_out_parameter(out p_in INT)\nBEGIN\nSELECT p_in;\nSET p_in=2; \nselect p_in;\nEND;\n执行结果:\nmysql> set @p_in=1\nmysql> call sp_demo_out_parameter(@p_in)\n略\nmysql> select @p_in;\n略\n```\n**INOUT参数例子：** \n```sql\nCREATE PROCEDURE sp_demo_inout_parameter(inout p_in INT)\nBEGIN\nSELECT p_in;\nSET p_in=2; \nselect p_in;\nEND;\n执行结果:\nmysql> set @p_in=1\nmysql> call sp_demo_inout_parameter(@p_in)\n略\nmysql> select @p_in;\n略\n```\n\n# 函数库\n\nmysql存储过程基本函数包括：**字符串类型**，**数值类型**，**日期类型**\n\n### 一、字符串类\n~~~\nCHARSET(str) //返回字串字符集\nCONCAT (string2 [,… ]) //连接字串\nINSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0\nLCASE (string2 ) //转换成小写\nLEFT (string2 ,length ) //从string2中的左边起取length个字符\nLENGTH (string ) //string长度\nLOAD_FILE (file_name ) //从文件读取内容\nLOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置\nLPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length\nLTRIM (string2 ) //去除前端空格\nREPEAT (string2 ,count ) //重复count次\nREPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str\nRPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length\nRTRIM (string2 ) //去除后端空格\nSTRCMP (string1 ,string2 ) //逐字符比较两字串大小,\nSUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,\n注：mysql中处理字符串时，默认第一个字符下标为1，即参数position必须大于等于1\nmysql> select substring(’abcd’,0,2);\n+———————–+\n| substring(’abcd’,0,2) |\n+———————–+\n|                       |\n+———————–+\n1 row in set (0.00 sec)\n\nmysql> select substring(’abcd’,1,2);\n+———————–+\n| substring(’abcd’,1,2) |\n+———————–+\n| ab                    |\n+———————–+\n1 row in set (0.02 sec)\n\nTRIM([[BOTH|LEADING|TRAILING] [padding] FROM]string2) //去除指定位置的指定字符\nUCASE (string2 ) //转换成大写\nRIGHT(string2,length) //取string2最后length个字符\nSPACE(count) //生成count个空格\n~~~\n### 二、数值类型\n~~~\nABS (number2 ) //绝对值\nBIN (decimal_number ) //十进制转二进制\nCEILING (number2 ) //向上取整\nCONV(number2,from_base,to_base) //进制转换\nFLOOR (number2 ) //向下取整\nFORMAT (number,decimal_places ) //保留小数位数\nHEX (DecimalNumber ) //转十六进制\n注：HEX()中可传入字符串，则返回其ASC-11码，如HEX(’DEF’)返回4142143\n也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19\nLEAST (number , number2 [,..]) //求最小值\nMOD (numerator ,denominator ) //求余\nPOWER (number ,power ) //求指数\nRAND([seed]) //随机数\nROUND (number [,decimals ]) //四舍五入,decimals为小数位数]\n\n注：返回类型并非均为整数，如：\n\n(1)默认变为整形值\nmysql> select round(1.23);\n+————-+\n| round(1.23) |\n+————-+\n|           1 |\n+————-+\n1 row in set (0.00 sec)\n\nmysql> select round(1.56);\n+————-+\n| round(1.56) |\n+————-+\n|           2 |\n+————-+\n1 row in set (0.00 sec)\n\n(2)可以设定小数位数，返回浮点型数据\n\nmysql> select round(1.567,2);\n+—————-+\n| round(1.567,2) |\n+—————-+\n|           1.57 |\n+—————-+\n1 row in set (0.00 sec)\n\nSIGN (number2 ) //返回符号,正负或0\nSQRT(number2) //开平方\n~~~\n### 三、日期类型\n~~~\nADDTIME (date2 ,time_interval ) //将time_interval加到date2\nCONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区\nCURRENT_DATE ( ) //当前日期\nCURRENT_TIME ( ) //当前时间\nCURRENT_TIMESTAMP ( ) //当前时间戳\nDATE (datetime ) //返回datetime的日期部分\nDATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间\nDATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime\nDATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间\nDATEDIFF (date1 ,date2 ) //两个日期差\nDAY (date ) //返回日期的天\nDAYNAME (date ) //英文星期\nDAYOFWEEK (date ) //星期(1-7) ,1为星期天\nDAYOFYEAR (date ) //一年中的第几天\nEXTRACT (interval_name FROM date ) //从date中提取日期的指定部分\nMAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串\nMAKETIME (hour ,minute ,second ) //生成时间串\nMONTHNAME (date ) //英文月份名\nNOW ( ) //当前时间\nSEC_TO_TIME (seconds ) //秒数转成时间\nSTR_TO_DATE (string ,format ) //字串转成时间,以format格式显示\nTIMEDIFF (datetime1 ,datetime2 ) //两个时间差\nTIME_TO_SEC (time ) //时间转秒数]\nWEEK (date_time [,start_of_week ]) //第几周\nYEAR (datetime ) //年份\nDAYOFMONTH(datetime) //月的第几天\nHOUR(datetime) //小时\nLAST_DAY(date) //date的月的最后日期\nMICROSECOND(datetime) //微秒\nMONTH(datetime) //月\nMINUTE(datetime) //分\n~~~\n* 注：可用在INTERVAL中的类型：**DAY ,DAY_HOUR ,DAY_MINUTE ,DAY_SECOND ,HOUR ,HOUR_MINUTE ,HOUR_SECOND ,MINUTE ,MINUTE_SECOND,MONTH ,SECOND ,YEAR**\n```sql\nDECLARE variable_name [,variable_name...] datatype [DEFAULT value];\n```\n其中，datatype为mysql的数据类型，如:**INT, FLOAT, DATE, VARCHAR(length)**\n\n**实例：**\n```sql\nDECLARE l_int INT unsigned default 4000000;\nDECLARE l_numeric NUMERIC(8,2) DEFAULT 9.95;\nDECLARE l_date DATE DEFAULT '1999-12-31';\nDECLARE l_datetime DATETIME DEFAULT '1999-12-31 23:59:59';\nDECLARE l_varchar VARCHAR(255) DEFAULT 'This will not be padded';\n```\n\n","slug":"2017-05-10-mysqlStoredProcedure","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qlw005by4rbpvud3ap2","content":"<h1 id=\"优缺点\"><a href=\"#优缺点\" class=\"headerlink\" title=\"优缺点\"></a>优缺点</h1><h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>在生产环境下，可以通过直接修改存储过程的方式修改业务逻辑（或bug），而不用重启服务器。但这一点便利被许多人滥用了。有人直接就在正式服务器上修改存储过程，而没有经过完整的测试，后果非常严重。</li>\n<li>执行速度快。存储过程经过编译之后会比单独一条一条执行要快。但这个效率真是没太大影响。如果是要做大数据量的导入、同步，我们可以用其它手段。</li>\n<li>减少网络传输。存储过程直接就在数据库服务器上跑，所有的数据访问都在服务器内部进行，不需要传输数据到其它终端。但我们的应付服务器通常与数据库是在同一内网，大数据的访问的瓶颈会是硬盘的速度，而不是网速。</li>\n<li>能够解决presentation与数据之间的差异，说得文艺青年点就是解决OO模型与二维数据持久化之间的阻抗。领域模型和数据模型的设计可能不是同一个人（一个是SA，另一个是DBA），两者的分歧可能会很大——这不奇怪，一个是以OO的思想来设计，一个是结构化的数据来设计，大家互不妥协——你说为了软件的弹性必须这么设计，他说为了效率必须那样设计，为了抹平鸿沟，就用存储过程来做数据存储的逻辑映射（把属性映射到字段）。好吧，台下已经有同学在叨咕ORM了。</li>\n<li>方便DBA优化。所有的SQL集中在一个地方，DBA会很高兴。这一点算是ORM的软肋。不过按照CQRS框架的思想，查询是用存储过程还是ORM，还真不是问题——DBA对数据库的优化，ORM一样会受益。况且放在ORM中还能用二级缓存，有些时候效率还会更高。   <a id=\"more\"></a>\n\n</li>\n</ul>\n<h3 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>SQL本身是一种结构化查询语言，加上了一些控制（赋值、循环和异常处理等），但不是OO的，本质上还是过程化的，面对复杂的业务逻辑，过程化的处理会很吃力。这一点算致命伤。</li>\n<li>不便于调试。基本上没有较好的调试器，很多时候是用print来调试，但用这种方法调试长达数百行的存储过程简直是噩梦。好吧，这一点不算啥，C#/Java一样能写出噩梦般的代码。</li>\n<li>没办法应用缓存。虽然有全局临时表之类的方法可以做缓存，但同样加重了数据库的负担。如果缓存并发严重，经常要加锁，那效率实在堪忧。</li>\n<li>无法适应数据库的切割（水平或垂直切割）。数据库切割之后，存储过程并不清楚数据存储在哪个数据库中.</li>\n</ul>\n<h1 id=\"基本语法\"><a href=\"#基本语法\" class=\"headerlink\" title=\"基本语法\"></a>基本语法</h1><h3 id=\"一-创建存储过程\"><a href=\"#一-创建存储过程\" class=\"headerlink\" title=\"一.创建存储过程\"></a>一.创建存储过程</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> sp_name()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">......</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二-调用存储过程\"><a href=\"#二-调用存储过程\" class=\"headerlink\" title=\"二.调用存储过程\"></a>二.调用存储过程</h3><ul>\n<li>基本语法：<strong>call sp_name()</strong></li>\n<li>注意：存储过程名称后面必须加括号，哪怕该存储过程没有参数传递</li>\n</ul>\n<h3 id=\"三-删除存储过程\"><a href=\"#三-删除存储过程\" class=\"headerlink\" title=\"三.删除存储过程\"></a>三.删除存储过程</h3><ul>\n<li>基本语法：<strong>drop procedure sp_name()</strong></li>\n<li>注意事项: 不能在一个存储过程中删除另一个存储过程，只能调用另一个存储过程</li>\n</ul>\n<h3 id=\"四-其他常用命令\"><a href=\"#四-其他常用命令\" class=\"headerlink\" title=\"四.其他常用命令\"></a>四.其他常用命令</h3><ul>\n<li><p><strong>show procedure status</strong></p>\n</li>\n<li><p>显示数据库中所有存储的存储过程基本信息，包括所属数据库，存储过程名称，创建时间等</p>\n</li>\n<li><p><strong>show create procedure sp_name</strong></p>\n</li>\n<li><p>显示某一个MySQL存储过程的详细信息</p>\n</li>\n</ul>\n<h2 id=\"数据类型及运算符\"><a href=\"#数据类型及运算符\" class=\"headerlink\" title=\"数据类型及运算符\"></a>数据类型及运算符</h2><h3 id=\"一、基本数据类型\"><a href=\"#一、基本数据类型\" class=\"headerlink\" title=\"一、基本数据类型\"></a>一、基本数据类型</h3><h3 id=\"二、变量：\"><a href=\"#二、变量：\" class=\"headerlink\" title=\"二、变量：\"></a>二、变量：</h3><p>自定义变量：<strong>DECLARE   a INT ; SET a=100;</strong></p>\n<p>可用以下语句代替：<strong>DECLARE a INT DEFAULT 100;</strong></p>\n<p>变量分为<strong>用户变量</strong>和<strong>系统变量</strong>，<strong>系统变量</strong>又分为<strong>会话</strong>和<strong>全局级变量</strong></p>\n<p><strong>用户变量</strong>：用户变量名一般以@开头，滥用用户变量会导致程序难以理解及管理</p>\n<ul>\n<li><p>1、 在mysql客户端使用用户变量</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SELECT 'Hello World' into @x;</span><br><span class=\"line\">mysql&gt; SELECT @x;</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; SET @y='Goodbye Cruel World';</span><br><span class=\"line\">mysql&gt; select @y;</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; SET @z=1+2+3;</span><br><span class=\"line\">mysql&gt; select @z;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2、 在存储过程中使用用户变量</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; CREATE PROCEDURE GreetWorld( ) SELECT CONCAT(@greeting,' World');</span><br><span class=\"line\">mysql&gt; SET @greeting='Hello';</span><br><span class=\"line\">mysql&gt; CALL GreetWorld( );</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>3、 在存储过程间传递全局范围的用户变量</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; CREATE PROCEDURE p1( )   SET @last_procedure='p1';</span><br><span class=\"line\">mysql&gt; CREATE PROCEDURE p2( ) SELECT CONCAT('Last procedure was ',@last_procedure);</span><br><span class=\"line\">mysql&gt; CALL p1( );</span><br><span class=\"line\">mysql&gt; CALL p2( );</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"三、运算符：\"><a href=\"#三、运算符：\" class=\"headerlink\" title=\"三、运算符：\"></a>三、运算符：</h3><ul>\n<li>1.算术运算符</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+     加   SET var1=2+2;       4</span><br><span class=\"line\">-     减   SET var2=3-2;       1</span><br><span class=\"line\">*     乘   SET var3=3*2;       6</span><br><span class=\"line\">/     除   SET var4=10/3;      3.3333</span><br><span class=\"line\">DIV   整除 SET var5=10 DIV 3;  3</span><br><span class=\"line\">%     取模 SET var6=10%3 ;     1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>2.比较运算符</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;            大于 1&gt;2 False</span><br><span class=\"line\">&lt;            小于 2&lt;1 False</span><br><span class=\"line\">&lt;=           小于等于 2&lt;=2 True</span><br><span class=\"line\">&gt;=           大于等于 3&gt;=2 True</span><br><span class=\"line\">BETWEEN      在两值之间 5 BETWEEN 1 AND 10 True</span><br><span class=\"line\">NOT BETWEEN  不在两值之间 5 NOT BETWEEN 1 AND 10 False</span><br><span class=\"line\">IN           在集合中 5 IN (1,2,3,4) False</span><br><span class=\"line\">NOT IN       不在集合中 5 NOT IN (1,2,3,4) True</span><br><span class=\"line\">=            等于 2=3 False</span><br><span class=\"line\">&lt;&gt;, !=       不等于 2&lt;&gt;3 False</span><br><span class=\"line\">&lt;=&gt;          严格比较两个NULL值是否相等 NULL&lt;=&gt;NULL True</span><br><span class=\"line\">LIKE         简单模式匹配 &quot;Guy Harrison&quot; LIKE &quot;Guy%&quot; True</span><br><span class=\"line\">REGEXP       正则式匹配 &quot;Guy Harrison&quot; REGEXP &quot;[Gg]reg&quot; False</span><br><span class=\"line\">IS NULL      为空 0 IS NULL False</span><br><span class=\"line\">IS NOT NULL  不为空 0 IS NOT NULL True</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>3.逻辑运算符</p>\n</li>\n<li><p>4.位运算符</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">|   或</span><br><span class=\"line\">&amp;   与</span><br><span class=\"line\">&lt;&lt;  左移位</span><br><span class=\"line\">&gt;&gt;  右移位</span><br><span class=\"line\">~   非(单目运算，按位取反)</span><br></pre></td></tr></table></figure>\n\n<p><strong>注释：</strong><br>/* 注释内容 */ 一般用于多行注释</p>\n<h1 id=\"流程控制\"><a href=\"#流程控制\" class=\"headerlink\" title=\"流程控制\"></a>流程控制</h1><h3 id=\"一、顺序结构\"><a href=\"#一、顺序结构\" class=\"headerlink\" title=\"一、顺序结构\"></a>一、顺序结构</h3><h3 id=\"二、分支结构\"><a href=\"#二、分支结构\" class=\"headerlink\" title=\"二、分支结构\"></a>二、分支结构</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if 条件 then</span><br><span class=\"line\">else </span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">if</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"三、循环结构\"><a href=\"#三、循环结构\" class=\"headerlink\" title=\"三、循环结构\"></a>三、循环结构</h3><p><strong>while循环</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> counter = <span class=\"number\">0</span>;   </span><br><span class=\"line\">WHILE counter != 10 <span class=\"keyword\">DO</span>   </span><br><span class=\"line\">    <span class=\"keyword\">SET</span> counter = counter+<span class=\"number\">1</span>;   </span><br><span class=\"line\"><span class=\"keyword\">END</span> <span class=\"keyword\">WHILE</span>;</span><br></pre></td></tr></table></figure>\n\n<p><strong>loop循环</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> counter = <span class=\"number\">0</span>;   </span><br><span class=\"line\">my_simple_loop: LOOP   </span><br><span class=\"line\">    <span class=\"keyword\">SET</span> counter = counter+<span class=\"number\">1</span>;   </span><br><span class=\"line\">    IF counter = 10 THEN   </span><br><span class=\"line\">        LEAVE my_simple_loop;   </span><br><span class=\"line\">    <span class=\"keyword\">END</span> <span class=\"keyword\">IF</span>;   </span><br><span class=\"line\"><span class=\"keyword\">END</span> <span class=\"keyword\">LOOP</span> my_simple_loop;</span><br></pre></td></tr></table></figure>\n\n<p><strong>repeat until循环</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> counter = <span class=\"number\">0</span>;   </span><br><span class=\"line\">REPEAT   </span><br><span class=\"line\">    <span class=\"keyword\">SET</span> counter = counter+<span class=\"number\">1</span>;   </span><br><span class=\"line\">UNTIL counter = 10 <span class=\"keyword\">END</span> <span class=\"keyword\">REPEAT</span>;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注：</strong><br>区块定义，常用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">begin</span><br><span class=\"line\">......</span><br><span class=\"line\">end;</span><br></pre></td></tr></table></figure>\n\n<p>也可以给区块起别名，如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lable:begin</span><br><span class=\"line\">...........</span><br><span class=\"line\">end lable;</span><br></pre></td></tr></table></figure>\n\n<p>可以用leave lable;</p>\n<p>跳出区块，执行区块以后的代码 begin和end如同C语言中的{ 和 }。</p>\n<h1 id=\"输入和输出\"><a href=\"#输入和输出\" class=\"headerlink\" title=\"输入和输出\"></a>输入和输出</h1><p>mysql存储过程的参数用在存储过程的定义，共有三种参数类型,<strong>IN,OUT,INOUT</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Create procedure|function([[IN |OUT |INOUT ] 参数名 数据类形...])</span><br></pre></td></tr></table></figure>\n\n<p><strong>IN 输入参数</strong></p>\n<ul>\n<li>表示该参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值</li>\n</ul>\n<p><strong>OUT 输出参数</strong></p>\n<ul>\n<li>该值可在存储过程内部被改变，并可返回</li>\n</ul>\n<p><strong>INOUT 输入输出参数</strong></p>\n<ul>\n<li>调用时指定，并且可被改变和返回</li>\n</ul>\n<p><strong>IN参数例子：</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> sp_demo_in_parameter(<span class=\"keyword\">IN</span> p_in <span class=\"built_in\">INT</span>)</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> p_in; <span class=\"comment\">/*查询输入参数*/</span></span><br><span class=\"line\"><span class=\"keyword\">SET</span> p_in=<span class=\"number\">2</span>; <span class=\"comment\">/*修改*/</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> p_in;<span class=\"comment\">/*查看修改后的值*/</span></span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\">执行结果:</span><br><span class=\"line\">mysql&gt; set @p_in=1</span><br><span class=\"line\">mysql&gt; call sp_demo_in_parameter(@p_in)</span><br><span class=\"line\">略</span><br><span class=\"line\">mysql&gt; select @p_in;</span><br><span class=\"line\">略</span><br></pre></td></tr></table></figure>\n\n<p>以上可以看出，p_in虽然在存储过程中被修改，但并不影响@p_id的值</p>\n<p><strong>OUT参数例子</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> sp_demo_out_parameter(<span class=\"keyword\">out</span> p_in <span class=\"built_in\">INT</span>)</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> p_in;</span><br><span class=\"line\"><span class=\"keyword\">SET</span> p_in=<span class=\"number\">2</span>; </span><br><span class=\"line\"><span class=\"keyword\">select</span> p_in;</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\">执行结果:</span><br><span class=\"line\">mysql&gt; set @p_in=1</span><br><span class=\"line\">mysql&gt; call sp_demo_out_parameter(@p_in)</span><br><span class=\"line\">略</span><br><span class=\"line\">mysql&gt; select @p_in;</span><br><span class=\"line\">略</span><br></pre></td></tr></table></figure>\n\n<p><strong>INOUT参数例子：</strong> </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> sp_demo_inout_parameter(inout p_in <span class=\"built_in\">INT</span>)</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> p_in;</span><br><span class=\"line\"><span class=\"keyword\">SET</span> p_in=<span class=\"number\">2</span>; </span><br><span class=\"line\"><span class=\"keyword\">select</span> p_in;</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\">执行结果:</span><br><span class=\"line\">mysql&gt; set @p_in=1</span><br><span class=\"line\">mysql&gt; call sp_demo_inout_parameter(@p_in)</span><br><span class=\"line\">略</span><br><span class=\"line\">mysql&gt; select @p_in;</span><br><span class=\"line\">略</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"函数库\"><a href=\"#函数库\" class=\"headerlink\" title=\"函数库\"></a>函数库</h1><p>mysql存储过程基本函数包括：<strong>字符串类型</strong>，<strong>数值类型</strong>，<strong>日期类型</strong></p>\n<h3 id=\"一、字符串类\"><a href=\"#一、字符串类\" class=\"headerlink\" title=\"一、字符串类\"></a>一、字符串类</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CHARSET(str) //返回字串字符集</span><br><span class=\"line\">CONCAT (string2 [,… ]) //连接字串</span><br><span class=\"line\">INSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0</span><br><span class=\"line\">LCASE (string2 ) //转换成小写</span><br><span class=\"line\">LEFT (string2 ,length ) //从string2中的左边起取length个字符</span><br><span class=\"line\">LENGTH (string ) //string长度</span><br><span class=\"line\">LOAD_FILE (file_name ) //从文件读取内容</span><br><span class=\"line\">LOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置</span><br><span class=\"line\">LPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length</span><br><span class=\"line\">LTRIM (string2 ) //去除前端空格</span><br><span class=\"line\">REPEAT (string2 ,count ) //重复count次</span><br><span class=\"line\">REPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str</span><br><span class=\"line\">RPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length</span><br><span class=\"line\">RTRIM (string2 ) //去除后端空格</span><br><span class=\"line\">STRCMP (string1 ,string2 ) //逐字符比较两字串大小,</span><br><span class=\"line\">SUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,</span><br><span class=\"line\">注：mysql中处理字符串时，默认第一个字符下标为1，即参数position必须大于等于1</span><br><span class=\"line\">mysql&gt; select substring(’abcd’,0,2);</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">| substring(’abcd’,0,2) |</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">|                       |</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; select substring(’abcd’,1,2);</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">| substring(’abcd’,1,2) |</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">| ab                    |</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">1 row in set (0.02 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">TRIM([[BOTH|LEADING|TRAILING] [padding] FROM]string2) //去除指定位置的指定字符</span><br><span class=\"line\">UCASE (string2 ) //转换成大写</span><br><span class=\"line\">RIGHT(string2,length) //取string2最后length个字符</span><br><span class=\"line\">SPACE(count) //生成count个空格</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二、数值类型\"><a href=\"#二、数值类型\" class=\"headerlink\" title=\"二、数值类型\"></a>二、数值类型</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ABS (number2 ) //绝对值</span><br><span class=\"line\">BIN (decimal_number ) //十进制转二进制</span><br><span class=\"line\">CEILING (number2 ) //向上取整</span><br><span class=\"line\">CONV(number2,from_base,to_base) //进制转换</span><br><span class=\"line\">FLOOR (number2 ) //向下取整</span><br><span class=\"line\">FORMAT (number,decimal_places ) //保留小数位数</span><br><span class=\"line\">HEX (DecimalNumber ) //转十六进制</span><br><span class=\"line\">注：HEX()中可传入字符串，则返回其ASC-11码，如HEX(’DEF’)返回4142143</span><br><span class=\"line\">也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19</span><br><span class=\"line\">LEAST (number , number2 [,..]) //求最小值</span><br><span class=\"line\">MOD (numerator ,denominator ) //求余</span><br><span class=\"line\">POWER (number ,power ) //求指数</span><br><span class=\"line\">RAND([seed]) //随机数</span><br><span class=\"line\">ROUND (number [,decimals ]) //四舍五入,decimals为小数位数]</span><br><span class=\"line\"></span><br><span class=\"line\">注：返回类型并非均为整数，如：</span><br><span class=\"line\"></span><br><span class=\"line\">(1)默认变为整形值</span><br><span class=\"line\">mysql&gt; select round(1.23);</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">| round(1.23) |</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">|           1 |</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; select round(1.56);</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">| round(1.56) |</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">|           2 |</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">(2)可以设定小数位数，返回浮点型数据</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; select round(1.567,2);</span><br><span class=\"line\">+—————-+</span><br><span class=\"line\">| round(1.567,2) |</span><br><span class=\"line\">+—————-+</span><br><span class=\"line\">|           1.57 |</span><br><span class=\"line\">+—————-+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">SIGN (number2 ) //返回符号,正负或0</span><br><span class=\"line\">SQRT(number2) //开平方</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"三、日期类型\"><a href=\"#三、日期类型\" class=\"headerlink\" title=\"三、日期类型\"></a>三、日期类型</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ADDTIME (date2 ,time_interval ) //将time_interval加到date2</span><br><span class=\"line\">CONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区</span><br><span class=\"line\">CURRENT_DATE ( ) //当前日期</span><br><span class=\"line\">CURRENT_TIME ( ) //当前时间</span><br><span class=\"line\">CURRENT_TIMESTAMP ( ) //当前时间戳</span><br><span class=\"line\">DATE (datetime ) //返回datetime的日期部分</span><br><span class=\"line\">DATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间</span><br><span class=\"line\">DATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime</span><br><span class=\"line\">DATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间</span><br><span class=\"line\">DATEDIFF (date1 ,date2 ) //两个日期差</span><br><span class=\"line\">DAY (date ) //返回日期的天</span><br><span class=\"line\">DAYNAME (date ) //英文星期</span><br><span class=\"line\">DAYOFWEEK (date ) //星期(1-7) ,1为星期天</span><br><span class=\"line\">DAYOFYEAR (date ) //一年中的第几天</span><br><span class=\"line\">EXTRACT (interval_name FROM date ) //从date中提取日期的指定部分</span><br><span class=\"line\">MAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串</span><br><span class=\"line\">MAKETIME (hour ,minute ,second ) //生成时间串</span><br><span class=\"line\">MONTHNAME (date ) //英文月份名</span><br><span class=\"line\">NOW ( ) //当前时间</span><br><span class=\"line\">SEC_TO_TIME (seconds ) //秒数转成时间</span><br><span class=\"line\">STR_TO_DATE (string ,format ) //字串转成时间,以format格式显示</span><br><span class=\"line\">TIMEDIFF (datetime1 ,datetime2 ) //两个时间差</span><br><span class=\"line\">TIME_TO_SEC (time ) //时间转秒数]</span><br><span class=\"line\">WEEK (date_time [,start_of_week ]) //第几周</span><br><span class=\"line\">YEAR (datetime ) //年份</span><br><span class=\"line\">DAYOFMONTH(datetime) //月的第几天</span><br><span class=\"line\">HOUR(datetime) //小时</span><br><span class=\"line\">LAST_DAY(date) //date的月的最后日期</span><br><span class=\"line\">MICROSECOND(datetime) //微秒</span><br><span class=\"line\">MONTH(datetime) //月</span><br><span class=\"line\">MINUTE(datetime) //分</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>注：可用在INTERVAL中的类型：<strong>DAY ,DAY_HOUR ,DAY_MINUTE ,DAY_SECOND ,HOUR ,HOUR_MINUTE ,HOUR_SECOND ,MINUTE ,MINUTE_SECOND,MONTH ,SECOND ,YEAR</strong><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span> variable_name [,variable_name...] datatype [<span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">value</span>];</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<p>其中，datatype为mysql的数据类型，如:<strong>INT, FLOAT, DATE, VARCHAR(length)</strong></p>\n<p><strong>实例：</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_int <span class=\"built_in\">INT</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">default</span> <span class=\"number\">4000000</span>;</span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_numeric <span class=\"built_in\">NUMERIC</span>(<span class=\"number\">8</span>,<span class=\"number\">2</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"number\">9.95</span>;</span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_date <span class=\"built_in\">DATE</span> <span class=\"keyword\">DEFAULT</span> <span class=\"string\">'1999-12-31'</span>;</span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_datetime DATETIME <span class=\"keyword\">DEFAULT</span> <span class=\"string\">'1999-12-31 23:59:59'</span>;</span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_varchar <span class=\"built_in\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"string\">'This will not be padded'</span>;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h1 id=\"优缺点\"><a href=\"#优缺点\" class=\"headerlink\" title=\"优缺点\"></a>优缺点</h1><h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>在生产环境下，可以通过直接修改存储过程的方式修改业务逻辑（或bug），而不用重启服务器。但这一点便利被许多人滥用了。有人直接就在正式服务器上修改存储过程，而没有经过完整的测试，后果非常严重。</li>\n<li>执行速度快。存储过程经过编译之后会比单独一条一条执行要快。但这个效率真是没太大影响。如果是要做大数据量的导入、同步，我们可以用其它手段。</li>\n<li>减少网络传输。存储过程直接就在数据库服务器上跑，所有的数据访问都在服务器内部进行，不需要传输数据到其它终端。但我们的应付服务器通常与数据库是在同一内网，大数据的访问的瓶颈会是硬盘的速度，而不是网速。</li>\n<li>能够解决presentation与数据之间的差异，说得文艺青年点就是解决OO模型与二维数据持久化之间的阻抗。领域模型和数据模型的设计可能不是同一个人（一个是SA，另一个是DBA），两者的分歧可能会很大——这不奇怪，一个是以OO的思想来设计，一个是结构化的数据来设计，大家互不妥协——你说为了软件的弹性必须这么设计，他说为了效率必须那样设计，为了抹平鸿沟，就用存储过程来做数据存储的逻辑映射（把属性映射到字段）。好吧，台下已经有同学在叨咕ORM了。</li>\n<li>方便DBA优化。所有的SQL集中在一个地方，DBA会很高兴。这一点算是ORM的软肋。不过按照CQRS框架的思想，查询是用存储过程还是ORM，还真不是问题——DBA对数据库的优化，ORM一样会受益。况且放在ORM中还能用二级缓存，有些时候效率还会更高。","more":"</li>\n</ul>\n<h3 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>SQL本身是一种结构化查询语言，加上了一些控制（赋值、循环和异常处理等），但不是OO的，本质上还是过程化的，面对复杂的业务逻辑，过程化的处理会很吃力。这一点算致命伤。</li>\n<li>不便于调试。基本上没有较好的调试器，很多时候是用print来调试，但用这种方法调试长达数百行的存储过程简直是噩梦。好吧，这一点不算啥，C#/Java一样能写出噩梦般的代码。</li>\n<li>没办法应用缓存。虽然有全局临时表之类的方法可以做缓存，但同样加重了数据库的负担。如果缓存并发严重，经常要加锁，那效率实在堪忧。</li>\n<li>无法适应数据库的切割（水平或垂直切割）。数据库切割之后，存储过程并不清楚数据存储在哪个数据库中.</li>\n</ul>\n<h1 id=\"基本语法\"><a href=\"#基本语法\" class=\"headerlink\" title=\"基本语法\"></a>基本语法</h1><h3 id=\"一-创建存储过程\"><a href=\"#一-创建存储过程\" class=\"headerlink\" title=\"一.创建存储过程\"></a>一.创建存储过程</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> sp_name()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">......</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二-调用存储过程\"><a href=\"#二-调用存储过程\" class=\"headerlink\" title=\"二.调用存储过程\"></a>二.调用存储过程</h3><ul>\n<li>基本语法：<strong>call sp_name()</strong></li>\n<li>注意：存储过程名称后面必须加括号，哪怕该存储过程没有参数传递</li>\n</ul>\n<h3 id=\"三-删除存储过程\"><a href=\"#三-删除存储过程\" class=\"headerlink\" title=\"三.删除存储过程\"></a>三.删除存储过程</h3><ul>\n<li>基本语法：<strong>drop procedure sp_name()</strong></li>\n<li>注意事项: 不能在一个存储过程中删除另一个存储过程，只能调用另一个存储过程</li>\n</ul>\n<h3 id=\"四-其他常用命令\"><a href=\"#四-其他常用命令\" class=\"headerlink\" title=\"四.其他常用命令\"></a>四.其他常用命令</h3><ul>\n<li><p><strong>show procedure status</strong></p>\n</li>\n<li><p>显示数据库中所有存储的存储过程基本信息，包括所属数据库，存储过程名称，创建时间等</p>\n</li>\n<li><p><strong>show create procedure sp_name</strong></p>\n</li>\n<li><p>显示某一个MySQL存储过程的详细信息</p>\n</li>\n</ul>\n<h2 id=\"数据类型及运算符\"><a href=\"#数据类型及运算符\" class=\"headerlink\" title=\"数据类型及运算符\"></a>数据类型及运算符</h2><h3 id=\"一、基本数据类型\"><a href=\"#一、基本数据类型\" class=\"headerlink\" title=\"一、基本数据类型\"></a>一、基本数据类型</h3><h3 id=\"二、变量：\"><a href=\"#二、变量：\" class=\"headerlink\" title=\"二、变量：\"></a>二、变量：</h3><p>自定义变量：<strong>DECLARE   a INT ; SET a=100;</strong></p>\n<p>可用以下语句代替：<strong>DECLARE a INT DEFAULT 100;</strong></p>\n<p>变量分为<strong>用户变量</strong>和<strong>系统变量</strong>，<strong>系统变量</strong>又分为<strong>会话</strong>和<strong>全局级变量</strong></p>\n<p><strong>用户变量</strong>：用户变量名一般以@开头，滥用用户变量会导致程序难以理解及管理</p>\n<ul>\n<li><p>1、 在mysql客户端使用用户变量</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SELECT 'Hello World' into @x;</span><br><span class=\"line\">mysql&gt; SELECT @x;</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; SET @y='Goodbye Cruel World';</span><br><span class=\"line\">mysql&gt; select @y;</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; SET @z=1+2+3;</span><br><span class=\"line\">mysql&gt; select @z;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2、 在存储过程中使用用户变量</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; CREATE PROCEDURE GreetWorld( ) SELECT CONCAT(@greeting,' World');</span><br><span class=\"line\">mysql&gt; SET @greeting='Hello';</span><br><span class=\"line\">mysql&gt; CALL GreetWorld( );</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>3、 在存储过程间传递全局范围的用户变量</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; CREATE PROCEDURE p1( )   SET @last_procedure='p1';</span><br><span class=\"line\">mysql&gt; CREATE PROCEDURE p2( ) SELECT CONCAT('Last procedure was ',@last_procedure);</span><br><span class=\"line\">mysql&gt; CALL p1( );</span><br><span class=\"line\">mysql&gt; CALL p2( );</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"三、运算符：\"><a href=\"#三、运算符：\" class=\"headerlink\" title=\"三、运算符：\"></a>三、运算符：</h3><ul>\n<li>1.算术运算符</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+     加   SET var1=2+2;       4</span><br><span class=\"line\">-     减   SET var2=3-2;       1</span><br><span class=\"line\">*     乘   SET var3=3*2;       6</span><br><span class=\"line\">/     除   SET var4=10/3;      3.3333</span><br><span class=\"line\">DIV   整除 SET var5=10 DIV 3;  3</span><br><span class=\"line\">%     取模 SET var6=10%3 ;     1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>2.比较运算符</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;            大于 1&gt;2 False</span><br><span class=\"line\">&lt;            小于 2&lt;1 False</span><br><span class=\"line\">&lt;=           小于等于 2&lt;=2 True</span><br><span class=\"line\">&gt;=           大于等于 3&gt;=2 True</span><br><span class=\"line\">BETWEEN      在两值之间 5 BETWEEN 1 AND 10 True</span><br><span class=\"line\">NOT BETWEEN  不在两值之间 5 NOT BETWEEN 1 AND 10 False</span><br><span class=\"line\">IN           在集合中 5 IN (1,2,3,4) False</span><br><span class=\"line\">NOT IN       不在集合中 5 NOT IN (1,2,3,4) True</span><br><span class=\"line\">=            等于 2=3 False</span><br><span class=\"line\">&lt;&gt;, !=       不等于 2&lt;&gt;3 False</span><br><span class=\"line\">&lt;=&gt;          严格比较两个NULL值是否相等 NULL&lt;=&gt;NULL True</span><br><span class=\"line\">LIKE         简单模式匹配 &quot;Guy Harrison&quot; LIKE &quot;Guy%&quot; True</span><br><span class=\"line\">REGEXP       正则式匹配 &quot;Guy Harrison&quot; REGEXP &quot;[Gg]reg&quot; False</span><br><span class=\"line\">IS NULL      为空 0 IS NULL False</span><br><span class=\"line\">IS NOT NULL  不为空 0 IS NOT NULL True</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>3.逻辑运算符</p>\n</li>\n<li><p>4.位运算符</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">|   或</span><br><span class=\"line\">&amp;   与</span><br><span class=\"line\">&lt;&lt;  左移位</span><br><span class=\"line\">&gt;&gt;  右移位</span><br><span class=\"line\">~   非(单目运算，按位取反)</span><br></pre></td></tr></table></figure>\n\n<p><strong>注释：</strong><br>/* 注释内容 */ 一般用于多行注释</p>\n<h1 id=\"流程控制\"><a href=\"#流程控制\" class=\"headerlink\" title=\"流程控制\"></a>流程控制</h1><h3 id=\"一、顺序结构\"><a href=\"#一、顺序结构\" class=\"headerlink\" title=\"一、顺序结构\"></a>一、顺序结构</h3><h3 id=\"二、分支结构\"><a href=\"#二、分支结构\" class=\"headerlink\" title=\"二、分支结构\"></a>二、分支结构</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if 条件 then</span><br><span class=\"line\">else </span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"keyword\">if</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"三、循环结构\"><a href=\"#三、循环结构\" class=\"headerlink\" title=\"三、循环结构\"></a>三、循环结构</h3><p><strong>while循环</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> counter = <span class=\"number\">0</span>;   </span><br><span class=\"line\">WHILE counter != 10 <span class=\"keyword\">DO</span>   </span><br><span class=\"line\">    <span class=\"keyword\">SET</span> counter = counter+<span class=\"number\">1</span>;   </span><br><span class=\"line\"><span class=\"keyword\">END</span> <span class=\"keyword\">WHILE</span>;</span><br></pre></td></tr></table></figure>\n\n<p><strong>loop循环</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> counter = <span class=\"number\">0</span>;   </span><br><span class=\"line\">my_simple_loop: LOOP   </span><br><span class=\"line\">    <span class=\"keyword\">SET</span> counter = counter+<span class=\"number\">1</span>;   </span><br><span class=\"line\">    IF counter = 10 THEN   </span><br><span class=\"line\">        LEAVE my_simple_loop;   </span><br><span class=\"line\">    <span class=\"keyword\">END</span> <span class=\"keyword\">IF</span>;   </span><br><span class=\"line\"><span class=\"keyword\">END</span> <span class=\"keyword\">LOOP</span> my_simple_loop;</span><br></pre></td></tr></table></figure>\n\n<p><strong>repeat until循环</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> counter = <span class=\"number\">0</span>;   </span><br><span class=\"line\">REPEAT   </span><br><span class=\"line\">    <span class=\"keyword\">SET</span> counter = counter+<span class=\"number\">1</span>;   </span><br><span class=\"line\">UNTIL counter = 10 <span class=\"keyword\">END</span> <span class=\"keyword\">REPEAT</span>;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注：</strong><br>区块定义，常用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">begin</span><br><span class=\"line\">......</span><br><span class=\"line\">end;</span><br></pre></td></tr></table></figure>\n\n<p>也可以给区块起别名，如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lable:begin</span><br><span class=\"line\">...........</span><br><span class=\"line\">end lable;</span><br></pre></td></tr></table></figure>\n\n<p>可以用leave lable;</p>\n<p>跳出区块，执行区块以后的代码 begin和end如同C语言中的{ 和 }。</p>\n<h1 id=\"输入和输出\"><a href=\"#输入和输出\" class=\"headerlink\" title=\"输入和输出\"></a>输入和输出</h1><p>mysql存储过程的参数用在存储过程的定义，共有三种参数类型,<strong>IN,OUT,INOUT</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Create procedure|function([[IN |OUT |INOUT ] 参数名 数据类形...])</span><br></pre></td></tr></table></figure>\n\n<p><strong>IN 输入参数</strong></p>\n<ul>\n<li>表示该参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值</li>\n</ul>\n<p><strong>OUT 输出参数</strong></p>\n<ul>\n<li>该值可在存储过程内部被改变，并可返回</li>\n</ul>\n<p><strong>INOUT 输入输出参数</strong></p>\n<ul>\n<li>调用时指定，并且可被改变和返回</li>\n</ul>\n<p><strong>IN参数例子：</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> sp_demo_in_parameter(<span class=\"keyword\">IN</span> p_in <span class=\"built_in\">INT</span>)</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> p_in; <span class=\"comment\">/*查询输入参数*/</span></span><br><span class=\"line\"><span class=\"keyword\">SET</span> p_in=<span class=\"number\">2</span>; <span class=\"comment\">/*修改*/</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> p_in;<span class=\"comment\">/*查看修改后的值*/</span></span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\">执行结果:</span><br><span class=\"line\">mysql&gt; set @p_in=1</span><br><span class=\"line\">mysql&gt; call sp_demo_in_parameter(@p_in)</span><br><span class=\"line\">略</span><br><span class=\"line\">mysql&gt; select @p_in;</span><br><span class=\"line\">略</span><br></pre></td></tr></table></figure>\n\n<p>以上可以看出，p_in虽然在存储过程中被修改，但并不影响@p_id的值</p>\n<p><strong>OUT参数例子</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> sp_demo_out_parameter(<span class=\"keyword\">out</span> p_in <span class=\"built_in\">INT</span>)</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> p_in;</span><br><span class=\"line\"><span class=\"keyword\">SET</span> p_in=<span class=\"number\">2</span>; </span><br><span class=\"line\"><span class=\"keyword\">select</span> p_in;</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\">执行结果:</span><br><span class=\"line\">mysql&gt; set @p_in=1</span><br><span class=\"line\">mysql&gt; call sp_demo_out_parameter(@p_in)</span><br><span class=\"line\">略</span><br><span class=\"line\">mysql&gt; select @p_in;</span><br><span class=\"line\">略</span><br></pre></td></tr></table></figure>\n\n<p><strong>INOUT参数例子：</strong> </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> sp_demo_inout_parameter(inout p_in <span class=\"built_in\">INT</span>)</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> p_in;</span><br><span class=\"line\"><span class=\"keyword\">SET</span> p_in=<span class=\"number\">2</span>; </span><br><span class=\"line\"><span class=\"keyword\">select</span> p_in;</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\">执行结果:</span><br><span class=\"line\">mysql&gt; set @p_in=1</span><br><span class=\"line\">mysql&gt; call sp_demo_inout_parameter(@p_in)</span><br><span class=\"line\">略</span><br><span class=\"line\">mysql&gt; select @p_in;</span><br><span class=\"line\">略</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"函数库\"><a href=\"#函数库\" class=\"headerlink\" title=\"函数库\"></a>函数库</h1><p>mysql存储过程基本函数包括：<strong>字符串类型</strong>，<strong>数值类型</strong>，<strong>日期类型</strong></p>\n<h3 id=\"一、字符串类\"><a href=\"#一、字符串类\" class=\"headerlink\" title=\"一、字符串类\"></a>一、字符串类</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CHARSET(str) //返回字串字符集</span><br><span class=\"line\">CONCAT (string2 [,… ]) //连接字串</span><br><span class=\"line\">INSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0</span><br><span class=\"line\">LCASE (string2 ) //转换成小写</span><br><span class=\"line\">LEFT (string2 ,length ) //从string2中的左边起取length个字符</span><br><span class=\"line\">LENGTH (string ) //string长度</span><br><span class=\"line\">LOAD_FILE (file_name ) //从文件读取内容</span><br><span class=\"line\">LOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置</span><br><span class=\"line\">LPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length</span><br><span class=\"line\">LTRIM (string2 ) //去除前端空格</span><br><span class=\"line\">REPEAT (string2 ,count ) //重复count次</span><br><span class=\"line\">REPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str</span><br><span class=\"line\">RPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length</span><br><span class=\"line\">RTRIM (string2 ) //去除后端空格</span><br><span class=\"line\">STRCMP (string1 ,string2 ) //逐字符比较两字串大小,</span><br><span class=\"line\">SUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,</span><br><span class=\"line\">注：mysql中处理字符串时，默认第一个字符下标为1，即参数position必须大于等于1</span><br><span class=\"line\">mysql&gt; select substring(’abcd’,0,2);</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">| substring(’abcd’,0,2) |</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">|                       |</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; select substring(’abcd’,1,2);</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">| substring(’abcd’,1,2) |</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">| ab                    |</span><br><span class=\"line\">+———————–+</span><br><span class=\"line\">1 row in set (0.02 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">TRIM([[BOTH|LEADING|TRAILING] [padding] FROM]string2) //去除指定位置的指定字符</span><br><span class=\"line\">UCASE (string2 ) //转换成大写</span><br><span class=\"line\">RIGHT(string2,length) //取string2最后length个字符</span><br><span class=\"line\">SPACE(count) //生成count个空格</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二、数值类型\"><a href=\"#二、数值类型\" class=\"headerlink\" title=\"二、数值类型\"></a>二、数值类型</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ABS (number2 ) //绝对值</span><br><span class=\"line\">BIN (decimal_number ) //十进制转二进制</span><br><span class=\"line\">CEILING (number2 ) //向上取整</span><br><span class=\"line\">CONV(number2,from_base,to_base) //进制转换</span><br><span class=\"line\">FLOOR (number2 ) //向下取整</span><br><span class=\"line\">FORMAT (number,decimal_places ) //保留小数位数</span><br><span class=\"line\">HEX (DecimalNumber ) //转十六进制</span><br><span class=\"line\">注：HEX()中可传入字符串，则返回其ASC-11码，如HEX(’DEF’)返回4142143</span><br><span class=\"line\">也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19</span><br><span class=\"line\">LEAST (number , number2 [,..]) //求最小值</span><br><span class=\"line\">MOD (numerator ,denominator ) //求余</span><br><span class=\"line\">POWER (number ,power ) //求指数</span><br><span class=\"line\">RAND([seed]) //随机数</span><br><span class=\"line\">ROUND (number [,decimals ]) //四舍五入,decimals为小数位数]</span><br><span class=\"line\"></span><br><span class=\"line\">注：返回类型并非均为整数，如：</span><br><span class=\"line\"></span><br><span class=\"line\">(1)默认变为整形值</span><br><span class=\"line\">mysql&gt; select round(1.23);</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">| round(1.23) |</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">|           1 |</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; select round(1.56);</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">| round(1.56) |</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">|           2 |</span><br><span class=\"line\">+————-+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">(2)可以设定小数位数，返回浮点型数据</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; select round(1.567,2);</span><br><span class=\"line\">+—————-+</span><br><span class=\"line\">| round(1.567,2) |</span><br><span class=\"line\">+—————-+</span><br><span class=\"line\">|           1.57 |</span><br><span class=\"line\">+—————-+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">SIGN (number2 ) //返回符号,正负或0</span><br><span class=\"line\">SQRT(number2) //开平方</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"三、日期类型\"><a href=\"#三、日期类型\" class=\"headerlink\" title=\"三、日期类型\"></a>三、日期类型</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ADDTIME (date2 ,time_interval ) //将time_interval加到date2</span><br><span class=\"line\">CONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区</span><br><span class=\"line\">CURRENT_DATE ( ) //当前日期</span><br><span class=\"line\">CURRENT_TIME ( ) //当前时间</span><br><span class=\"line\">CURRENT_TIMESTAMP ( ) //当前时间戳</span><br><span class=\"line\">DATE (datetime ) //返回datetime的日期部分</span><br><span class=\"line\">DATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间</span><br><span class=\"line\">DATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime</span><br><span class=\"line\">DATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间</span><br><span class=\"line\">DATEDIFF (date1 ,date2 ) //两个日期差</span><br><span class=\"line\">DAY (date ) //返回日期的天</span><br><span class=\"line\">DAYNAME (date ) //英文星期</span><br><span class=\"line\">DAYOFWEEK (date ) //星期(1-7) ,1为星期天</span><br><span class=\"line\">DAYOFYEAR (date ) //一年中的第几天</span><br><span class=\"line\">EXTRACT (interval_name FROM date ) //从date中提取日期的指定部分</span><br><span class=\"line\">MAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串</span><br><span class=\"line\">MAKETIME (hour ,minute ,second ) //生成时间串</span><br><span class=\"line\">MONTHNAME (date ) //英文月份名</span><br><span class=\"line\">NOW ( ) //当前时间</span><br><span class=\"line\">SEC_TO_TIME (seconds ) //秒数转成时间</span><br><span class=\"line\">STR_TO_DATE (string ,format ) //字串转成时间,以format格式显示</span><br><span class=\"line\">TIMEDIFF (datetime1 ,datetime2 ) //两个时间差</span><br><span class=\"line\">TIME_TO_SEC (time ) //时间转秒数]</span><br><span class=\"line\">WEEK (date_time [,start_of_week ]) //第几周</span><br><span class=\"line\">YEAR (datetime ) //年份</span><br><span class=\"line\">DAYOFMONTH(datetime) //月的第几天</span><br><span class=\"line\">HOUR(datetime) //小时</span><br><span class=\"line\">LAST_DAY(date) //date的月的最后日期</span><br><span class=\"line\">MICROSECOND(datetime) //微秒</span><br><span class=\"line\">MONTH(datetime) //月</span><br><span class=\"line\">MINUTE(datetime) //分</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>注：可用在INTERVAL中的类型：<strong>DAY ,DAY_HOUR ,DAY_MINUTE ,DAY_SECOND ,HOUR ,HOUR_MINUTE ,HOUR_SECOND ,MINUTE ,MINUTE_SECOND,MONTH ,SECOND ,YEAR</strong><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span> variable_name [,variable_name...] datatype [<span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">value</span>];</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<p>其中，datatype为mysql的数据类型，如:<strong>INT, FLOAT, DATE, VARCHAR(length)</strong></p>\n<p><strong>实例：</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_int <span class=\"built_in\">INT</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">default</span> <span class=\"number\">4000000</span>;</span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_numeric <span class=\"built_in\">NUMERIC</span>(<span class=\"number\">8</span>,<span class=\"number\">2</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"number\">9.95</span>;</span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_date <span class=\"built_in\">DATE</span> <span class=\"keyword\">DEFAULT</span> <span class=\"string\">'1999-12-31'</span>;</span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_datetime DATETIME <span class=\"keyword\">DEFAULT</span> <span class=\"string\">'1999-12-31 23:59:59'</span>;</span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span> l_varchar <span class=\"built_in\">VARCHAR</span>(<span class=\"number\">255</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"string\">'This will not be padded'</span>;</span><br></pre></td></tr></table></figure>"},{"title":"Vultr VPS搭建SS(ShadowSocks)教程","date":"2018-06-12T16:00:00.000Z","updated":"2018-06-12T16:00:00.000Z","comments":1,"_content":"<meta name=\"referrer\" content=\"no-referrer\" />\n\n## 国外服务器的购买\n这里我选择的是[Vultr](https://www.vultr.com/)，对比了很多国外的服务器，这个蛮靠谱的，且搭建成功后看youtube1080p完全无压力。\n\n## Vultr服务器价格\nVultr服务器按小时计费,最低0.004美元/h,算起来2.5美元/月，且destory掉服务器是不收费的，所以不用担心如果暂时没有使用还一直扣费的问题，如下图所示：\n <!-- more -->\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-5a37a53b4fb0aacb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n最低价格的服务器是512M的内存，500G的带宽，只能说99%的情况下完全够用了！\n\n## 注册Vultr\n\n首先打开[Vultr](https://www.vultr.com/)链接，点击**Create Account**\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-a393d98c540c2923.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 充值Vultr\n\n注册完成之后就是充值，Vultr提供4种充值方式，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-2b240230b4a8c30a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n这里我选择支付宝，因为方便快捷，但是最低消费10美元，也不多，60多人民币，如下图：\n\n## 选择VPS的位置\n\n首先，位置很重要！我们如何选择呢，当然有科学的办法，ping它！\n\nVultr的服务器有很多位置，下面我测试的东京节点和新加坡节点的数据如下：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-7192d20013fdb116.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-685cbb5130cd6a27.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n这么看来还是东京的节点速度比较好，当然这个因人而异，在中国不同的地理位置访问国外不同位置的服务器速度也不一样。（下面提供了下载地址,下载下来双击运行即可）。\n\n测速脚本下载地址：[点我下载 测速.bat](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2F%25E6%25B5%258B%25E9%2580%259F.bat)\n\n脚本内容如下：\n~~~\n@echo off\necho ===========================================\necho 东京\nping hnd-jp-ping.vultr.com\n\necho ============================================\necho 新加坡\nping sgp-ping.vultr.com\n\necho ===========================================\necho (AU) Sydney, Australia[悉尼]\nping syd-au-ping.vultr.com\n\necho ===========================================\necho 德国 法兰克福\nping fra-de-ping.vultr.com\n\necho ===========================================\necho 荷兰 阿姆斯特丹\nping ams-nl-ping.vultr.com\n\necho ===========================================\necho 英国 伦敦\nping lon-gb-ping.vultr.com\n\necho ===========================================\necho 法国 巴黎\nping par-fr-ping.vultr.com\n\necho ===========================================\necho 美东 华盛顿州 西雅图\nping wa-us-ping.vultr.com\n\necho ===========================================\necho 美西 加州 硅谷\nping sjo-ca-us-ping.vultr.com\n\necho ===========================================\necho 美西 加州 洛杉矶\nping lax-ca-us-ping.vultr.com\n\necho ===========================================\necho 美东 芝加哥\nChicago, Illinois[美东 芝加哥]\nping il-us-ping.vultr.com\n\necho ===========================================\necho 美中 德克萨斯州 达拉斯\nping tx-us-ping.vultr.com\n\necho ===========================================\necho 美东 新泽西\nping nj-us-ping.vultr.com\n\necho ===========================================\necho 美东 乔治亚州 亚特兰大\nping ga-us-ping.vultr.com\n\necho ===========================================\necho 美东 佛罗里达州 迈阿密\nping fl-us-ping.vultr.com   \npause\n~~~\n\n## 创建VPS\n\n左侧菜单栏Servers，点击+，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-ee1d05af94ce2141.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n选择VPS的位置，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-eab85cb6568d8de9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n选择操作系统和价格，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-03fb9399994d0fed.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n点击最下面的Deploy Now，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-32fe2a620e144c34.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n创建成功\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-9ccd708aa1da7171.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## VPS的信息\n\n安装成功之后，点击Manage\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-8dc96ccd0c6d8ead.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n可以看到你购买的VPS的信息，如下图所示：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-094f80d577b336b3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\nping一下ip地址，100ms多一点，这个速度相当可以了，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-6dcffcba340bfed9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 下载Shell\n\n当然是选择先连接它了，我们选择的工具是XShell。下载地址：[Xshell下载](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FXshell5.zip)\n\n下载完成之后安装，下一步即可\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-efd55f89d73a3a4e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624)\n\n接着选择免费为家庭/学校\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-d152b4a16ce5395f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624)\n\n语言选择中文：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-7732828642a07ccf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624)\n\n## 连接VPS\n\n打开Xshell，选择文件->新建，输入VPS的IP，IP地址就在Vultr的管理页面上，如下图所示：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-e9aab3ea6cd1a961.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/667)\n\n点击确定，输入用户名，默认应该为root，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-59a57a713d8295e3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/398)\n\n接着输入密码：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-7f5bb802df979df0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/504)\n\n连接成功：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-1e4faf8294542487.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 快速搭建ShadowSocks(二选一)\n\n### 一键安装\n\n在Xshell中依次运行以下命令\n\n~~~\nwget --no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh\n\nchmod +x shadowsocks.sh\n\n./shadowsocks.sh 2>&1 | tee shadowsocks.log\n~~~\n\n接着按照提醒输入你的密码，端口和加密方式，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-74a7d62e2e94d543.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-fa86ce3db77be186.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n然后可以去听首歌~，成功安装之后有你配置的信息显示，记住这些信息，然后跳过下面的手动安装部分，直接去看客户端连接部分即可，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-199ab70c25fde457.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/568)\n\n>以上脚本来源于秋水逸冰\n\n### 手动安装\n\n在XShell的控制台输入：\n\n~~~\ncurl \"https://bootstrap.pypa.io/get-pip.py\" -o \"get-pip.py\"\n\npython get-pip.py\n~~~\n\n一个个的来，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-9de77734fd2714b1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 安装ShadowSocks\n~~~\npip install --upgrade pip\n\npip install shadowsocks\n~~~\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-332ba1a059cbd935.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 创建ShadowSocks配置文件\n\n### 单端口\n\n~~~\nvi /etc/shadowsocks.json\n~~~\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-56854846c8968c5a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n输入以下内容，然后点ESC后输入:wq保存退出\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-cb48bdd4f6ec44ea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n~~~\n{\n  \"server\": \"0.0.0.0\",\n  \"server_port\": 2018,\n  \"password\": \"12345678\",\n  \"method\": \"aes-256-cfb\"\n}\n~~~\n\n### 多端口\n\n（可选，配置了单端口就不要配置这个）多端口的配置文件如下：\n\n~~~\n{\n    \"server\": \"0.0.0.0\",\n    \"port_password\": {\n        \"8381\": \"password1\",\n        \"8382\": \"password2\",\n        \"8383\": \"password3\",\n        \"8384\": \"password4\"\n    },\n    \"timeout\": 300,\n    \"method\": \"aes-256-cfb\"\n}\n~~~\n\n## 配置防火墙\n~~~\nsystemctl stop firewalld.service\n~~~\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-b59307a636a059b2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/457)\n\n启动ShadowSocks服务\n\n~~~\nssserver -c /etc/shadowsocks.json -d start\n~~~\n![图片](https://upload-images.jianshu.io/upload_images/3883542-06dd9301c164b087.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/650)\n\n下面的是关闭，启动成功之后不要执行\n\n## 关闭ShadowSocks服务\n\n~~~\nssserver -c /etc/shadowsocks.json -d stop\n~~~\n\n# 连接ShadowSocks，体会科学上网的魅力\n\n## Windows客户端\n\n下载地址：[Shadowsocks](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FShadowsocks-4.0.7.zip)\n\n下载完成之后解压打开，如下图所示：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-b4f235178abfb563.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/578)\n\n按照你自己的配置完成之后，点击确定，然后在托盘中右键这个小飞机，启动系统代理\n，灰色的小飞机就会亮起来，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-e77cc63c73aa05dd.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/324)\n\n然后就可以畅游网络了~\n\n测试地址：\n\n* [谷歌](https://link.jianshu.com/?t=https%3A%2F%2Fwww.google.com.hk%2F)\n* [Youtube](https://link.jianshu.com/?t=https%3A%2F%2Fwww.youtube.com%2F)\n* [推特](https://link.jianshu.com/?t=https%3A%2F%2Ftwitter.com%2F%3Flang%3Dzh-cn)\n\n## 安卓连接\n下载地址：[shadowsocks.apk](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2Fshadowsocks.apk)\n\n配置和windows差不多，配置完成后点击右上角的开启按钮即可，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-f59bade6d27f4fdc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/473)\n\n## IOS连接\n参考链接：http://www.360doc.com/content/17/0614/06/37032448_662846097.shtml\n\n## MAC 连接\n[ShadowsocksX-2.6.3.dmg](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FShadowsocksX-2.6.3.dmg)\n","source":"_posts/2018-06-12-VPS.md","raw":"---\ntitle: \"Vultr VPS搭建SS(ShadowSocks)教程\"\ndate: 2018-06-12 12:00:00\nupdated: 2018-06-12 12:00:00\ncomments: true\ncategories: 服务器\ntags:\n    - watch\n---\n<meta name=\"referrer\" content=\"no-referrer\" />\n\n## 国外服务器的购买\n这里我选择的是[Vultr](https://www.vultr.com/)，对比了很多国外的服务器，这个蛮靠谱的，且搭建成功后看youtube1080p完全无压力。\n\n## Vultr服务器价格\nVultr服务器按小时计费,最低0.004美元/h,算起来2.5美元/月，且destory掉服务器是不收费的，所以不用担心如果暂时没有使用还一直扣费的问题，如下图所示：\n <!-- more -->\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-5a37a53b4fb0aacb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n最低价格的服务器是512M的内存，500G的带宽，只能说99%的情况下完全够用了！\n\n## 注册Vultr\n\n首先打开[Vultr](https://www.vultr.com/)链接，点击**Create Account**\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-a393d98c540c2923.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 充值Vultr\n\n注册完成之后就是充值，Vultr提供4种充值方式，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-2b240230b4a8c30a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n这里我选择支付宝，因为方便快捷，但是最低消费10美元，也不多，60多人民币，如下图：\n\n## 选择VPS的位置\n\n首先，位置很重要！我们如何选择呢，当然有科学的办法，ping它！\n\nVultr的服务器有很多位置，下面我测试的东京节点和新加坡节点的数据如下：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-7192d20013fdb116.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-685cbb5130cd6a27.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n这么看来还是东京的节点速度比较好，当然这个因人而异，在中国不同的地理位置访问国外不同位置的服务器速度也不一样。（下面提供了下载地址,下载下来双击运行即可）。\n\n测速脚本下载地址：[点我下载 测速.bat](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2F%25E6%25B5%258B%25E9%2580%259F.bat)\n\n脚本内容如下：\n~~~\n@echo off\necho ===========================================\necho 东京\nping hnd-jp-ping.vultr.com\n\necho ============================================\necho 新加坡\nping sgp-ping.vultr.com\n\necho ===========================================\necho (AU) Sydney, Australia[悉尼]\nping syd-au-ping.vultr.com\n\necho ===========================================\necho 德国 法兰克福\nping fra-de-ping.vultr.com\n\necho ===========================================\necho 荷兰 阿姆斯特丹\nping ams-nl-ping.vultr.com\n\necho ===========================================\necho 英国 伦敦\nping lon-gb-ping.vultr.com\n\necho ===========================================\necho 法国 巴黎\nping par-fr-ping.vultr.com\n\necho ===========================================\necho 美东 华盛顿州 西雅图\nping wa-us-ping.vultr.com\n\necho ===========================================\necho 美西 加州 硅谷\nping sjo-ca-us-ping.vultr.com\n\necho ===========================================\necho 美西 加州 洛杉矶\nping lax-ca-us-ping.vultr.com\n\necho ===========================================\necho 美东 芝加哥\nChicago, Illinois[美东 芝加哥]\nping il-us-ping.vultr.com\n\necho ===========================================\necho 美中 德克萨斯州 达拉斯\nping tx-us-ping.vultr.com\n\necho ===========================================\necho 美东 新泽西\nping nj-us-ping.vultr.com\n\necho ===========================================\necho 美东 乔治亚州 亚特兰大\nping ga-us-ping.vultr.com\n\necho ===========================================\necho 美东 佛罗里达州 迈阿密\nping fl-us-ping.vultr.com   \npause\n~~~\n\n## 创建VPS\n\n左侧菜单栏Servers，点击+，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-ee1d05af94ce2141.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n选择VPS的位置，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-eab85cb6568d8de9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n选择操作系统和价格，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-03fb9399994d0fed.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n点击最下面的Deploy Now，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-32fe2a620e144c34.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n创建成功\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-9ccd708aa1da7171.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## VPS的信息\n\n安装成功之后，点击Manage\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-8dc96ccd0c6d8ead.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n可以看到你购买的VPS的信息，如下图所示：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-094f80d577b336b3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\nping一下ip地址，100ms多一点，这个速度相当可以了，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-6dcffcba340bfed9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 下载Shell\n\n当然是选择先连接它了，我们选择的工具是XShell。下载地址：[Xshell下载](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FXshell5.zip)\n\n下载完成之后安装，下一步即可\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-efd55f89d73a3a4e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624)\n\n接着选择免费为家庭/学校\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-d152b4a16ce5395f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624)\n\n语言选择中文：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-7732828642a07ccf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624)\n\n## 连接VPS\n\n打开Xshell，选择文件->新建，输入VPS的IP，IP地址就在Vultr的管理页面上，如下图所示：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-e9aab3ea6cd1a961.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/667)\n\n点击确定，输入用户名，默认应该为root，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-59a57a713d8295e3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/398)\n\n接着输入密码：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-7f5bb802df979df0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/504)\n\n连接成功：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-1e4faf8294542487.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 快速搭建ShadowSocks(二选一)\n\n### 一键安装\n\n在Xshell中依次运行以下命令\n\n~~~\nwget --no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh\n\nchmod +x shadowsocks.sh\n\n./shadowsocks.sh 2>&1 | tee shadowsocks.log\n~~~\n\n接着按照提醒输入你的密码，端口和加密方式，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-74a7d62e2e94d543.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-fa86ce3db77be186.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n然后可以去听首歌~，成功安装之后有你配置的信息显示，记住这些信息，然后跳过下面的手动安装部分，直接去看客户端连接部分即可，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-199ab70c25fde457.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/568)\n\n>以上脚本来源于秋水逸冰\n\n### 手动安装\n\n在XShell的控制台输入：\n\n~~~\ncurl \"https://bootstrap.pypa.io/get-pip.py\" -o \"get-pip.py\"\n\npython get-pip.py\n~~~\n\n一个个的来，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-9de77734fd2714b1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 安装ShadowSocks\n~~~\npip install --upgrade pip\n\npip install shadowsocks\n~~~\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-332ba1a059cbd935.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n## 创建ShadowSocks配置文件\n\n### 单端口\n\n~~~\nvi /etc/shadowsocks.json\n~~~\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-56854846c8968c5a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n输入以下内容，然后点ESC后输入:wq保存退出\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-cb48bdd4f6ec44ea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)\n\n~~~\n{\n  \"server\": \"0.0.0.0\",\n  \"server_port\": 2018,\n  \"password\": \"12345678\",\n  \"method\": \"aes-256-cfb\"\n}\n~~~\n\n### 多端口\n\n（可选，配置了单端口就不要配置这个）多端口的配置文件如下：\n\n~~~\n{\n    \"server\": \"0.0.0.0\",\n    \"port_password\": {\n        \"8381\": \"password1\",\n        \"8382\": \"password2\",\n        \"8383\": \"password3\",\n        \"8384\": \"password4\"\n    },\n    \"timeout\": 300,\n    \"method\": \"aes-256-cfb\"\n}\n~~~\n\n## 配置防火墙\n~~~\nsystemctl stop firewalld.service\n~~~\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-b59307a636a059b2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/457)\n\n启动ShadowSocks服务\n\n~~~\nssserver -c /etc/shadowsocks.json -d start\n~~~\n![图片](https://upload-images.jianshu.io/upload_images/3883542-06dd9301c164b087.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/650)\n\n下面的是关闭，启动成功之后不要执行\n\n## 关闭ShadowSocks服务\n\n~~~\nssserver -c /etc/shadowsocks.json -d stop\n~~~\n\n# 连接ShadowSocks，体会科学上网的魅力\n\n## Windows客户端\n\n下载地址：[Shadowsocks](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FShadowsocks-4.0.7.zip)\n\n下载完成之后解压打开，如下图所示：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-b4f235178abfb563.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/578)\n\n按照你自己的配置完成之后，点击确定，然后在托盘中右键这个小飞机，启动系统代理\n，灰色的小飞机就会亮起来，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-e77cc63c73aa05dd.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/324)\n\n然后就可以畅游网络了~\n\n测试地址：\n\n* [谷歌](https://link.jianshu.com/?t=https%3A%2F%2Fwww.google.com.hk%2F)\n* [Youtube](https://link.jianshu.com/?t=https%3A%2F%2Fwww.youtube.com%2F)\n* [推特](https://link.jianshu.com/?t=https%3A%2F%2Ftwitter.com%2F%3Flang%3Dzh-cn)\n\n## 安卓连接\n下载地址：[shadowsocks.apk](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2Fshadowsocks.apk)\n\n配置和windows差不多，配置完成后点击右上角的开启按钮即可，如下图：\n\n![图片](https://upload-images.jianshu.io/upload_images/3883542-f59bade6d27f4fdc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/473)\n\n## IOS连接\n参考链接：http://www.360doc.com/content/17/0614/06/37032448_662846097.shtml\n\n## MAC 连接\n[ShadowsocksX-2.6.3.dmg](https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FShadowsocksX-2.6.3.dmg)\n","slug":"2018-06-12-VPS","published":1,"layout":"post","photos":[],"link":"","_id":"cjypn1qlx005cy4rb1h26vi6f","content":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h2 id=\"国外服务器的购买\"><a href=\"#国外服务器的购买\" class=\"headerlink\" title=\"国外服务器的购买\"></a>国外服务器的购买</h2><p>这里我选择的是<a href=\"https://www.vultr.com/\" target=\"_blank\" rel=\"noopener\">Vultr</a>，对比了很多国外的服务器，这个蛮靠谱的，且搭建成功后看youtube1080p完全无压力。</p>\n<h2 id=\"Vultr服务器价格\"><a href=\"#Vultr服务器价格\" class=\"headerlink\" title=\"Vultr服务器价格\"></a>Vultr服务器价格</h2><p>Vultr服务器按小时计费,最低0.004美元/h,算起来2.5美元/月，且destory掉服务器是不收费的，所以不用担心如果暂时没有使用还一直扣费的问题，如下图所示：<br> <a id=\"more\"></a></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-5a37a53b4fb0aacb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>最低价格的服务器是512M的内存，500G的带宽，只能说99%的情况下完全够用了！</p>\n<h2 id=\"注册Vultr\"><a href=\"#注册Vultr\" class=\"headerlink\" title=\"注册Vultr\"></a>注册Vultr</h2><p>首先打开<a href=\"https://www.vultr.com/\" target=\"_blank\" rel=\"noopener\">Vultr</a>链接，点击<strong>Create Account</strong></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-a393d98c540c2923.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"充值Vultr\"><a href=\"#充值Vultr\" class=\"headerlink\" title=\"充值Vultr\"></a>充值Vultr</h2><p>注册完成之后就是充值，Vultr提供4种充值方式，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-2b240230b4a8c30a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>这里我选择支付宝，因为方便快捷，但是最低消费10美元，也不多，60多人民币，如下图：</p>\n<h2 id=\"选择VPS的位置\"><a href=\"#选择VPS的位置\" class=\"headerlink\" title=\"选择VPS的位置\"></a>选择VPS的位置</h2><p>首先，位置很重要！我们如何选择呢，当然有科学的办法，ping它！</p>\n<p>Vultr的服务器有很多位置，下面我测试的东京节点和新加坡节点的数据如下：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-7192d20013fdb116.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-685cbb5130cd6a27.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>这么看来还是东京的节点速度比较好，当然这个因人而异，在中国不同的地理位置访问国外不同位置的服务器速度也不一样。（下面提供了下载地址,下载下来双击运行即可）。</p>\n<p>测速脚本下载地址：<a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2F%25E6%25B5%258B%25E9%2580%259F.bat\" target=\"_blank\" rel=\"noopener\">点我下载 测速.bat</a></p>\n<p>脚本内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@echo off</span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 东京</span><br><span class=\"line\">ping hnd-jp-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ============================================</span><br><span class=\"line\">echo 新加坡</span><br><span class=\"line\">ping sgp-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo (AU) Sydney, Australia[悉尼]</span><br><span class=\"line\">ping syd-au-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 德国 法兰克福</span><br><span class=\"line\">ping fra-de-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 荷兰 阿姆斯特丹</span><br><span class=\"line\">ping ams-nl-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 英国 伦敦</span><br><span class=\"line\">ping lon-gb-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 法国 巴黎</span><br><span class=\"line\">ping par-fr-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 华盛顿州 西雅图</span><br><span class=\"line\">ping wa-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美西 加州 硅谷</span><br><span class=\"line\">ping sjo-ca-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美西 加州 洛杉矶</span><br><span class=\"line\">ping lax-ca-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 芝加哥</span><br><span class=\"line\">Chicago, Illinois[美东 芝加哥]</span><br><span class=\"line\">ping il-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美中 德克萨斯州 达拉斯</span><br><span class=\"line\">ping tx-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 新泽西</span><br><span class=\"line\">ping nj-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 乔治亚州 亚特兰大</span><br><span class=\"line\">ping ga-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 佛罗里达州 迈阿密</span><br><span class=\"line\">ping fl-us-ping.vultr.com   </span><br><span class=\"line\">pause</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建VPS\"><a href=\"#创建VPS\" class=\"headerlink\" title=\"创建VPS\"></a>创建VPS</h2><p>左侧菜单栏Servers，点击+，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-ee1d05af94ce2141.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>选择VPS的位置，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-eab85cb6568d8de9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>选择操作系统和价格，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-03fb9399994d0fed.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>点击最下面的Deploy Now，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-32fe2a620e144c34.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>创建成功</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-9ccd708aa1da7171.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"VPS的信息\"><a href=\"#VPS的信息\" class=\"headerlink\" title=\"VPS的信息\"></a>VPS的信息</h2><p>安装成功之后，点击Manage</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-8dc96ccd0c6d8ead.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>可以看到你购买的VPS的信息，如下图所示：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-094f80d577b336b3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>ping一下ip地址，100ms多一点，这个速度相当可以了，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-6dcffcba340bfed9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"下载Shell\"><a href=\"#下载Shell\" class=\"headerlink\" title=\"下载Shell\"></a>下载Shell</h2><p>当然是选择先连接它了，我们选择的工具是XShell。下载地址：<a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FXshell5.zip\" target=\"_blank\" rel=\"noopener\">Xshell下载</a></p>\n<p>下载完成之后安装，下一步即可</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-efd55f89d73a3a4e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624\" alt=\"图片\"></p>\n<p>接着选择免费为家庭/学校</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-d152b4a16ce5395f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624\" alt=\"图片\"></p>\n<p>语言选择中文：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-7732828642a07ccf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624\" alt=\"图片\"></p>\n<h2 id=\"连接VPS\"><a href=\"#连接VPS\" class=\"headerlink\" title=\"连接VPS\"></a>连接VPS</h2><p>打开Xshell，选择文件-&gt;新建，输入VPS的IP，IP地址就在Vultr的管理页面上，如下图所示：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-e9aab3ea6cd1a961.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/667\" alt=\"图片\"></p>\n<p>点击确定，输入用户名，默认应该为root，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-59a57a713d8295e3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/398\" alt=\"图片\"></p>\n<p>接着输入密码：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-7f5bb802df979df0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/504\" alt=\"图片\"></p>\n<p>连接成功：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-1e4faf8294542487.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"快速搭建ShadowSocks-二选一\"><a href=\"#快速搭建ShadowSocks-二选一\" class=\"headerlink\" title=\"快速搭建ShadowSocks(二选一)\"></a>快速搭建ShadowSocks(二选一)</h2><h3 id=\"一键安装\"><a href=\"#一键安装\" class=\"headerlink\" title=\"一键安装\"></a>一键安装</h3><p>在Xshell中依次运行以下命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh</span><br><span class=\"line\"></span><br><span class=\"line\">chmod +x shadowsocks.sh</span><br><span class=\"line\"></span><br><span class=\"line\">./shadowsocks.sh 2&gt;&amp;1 | tee shadowsocks.log</span><br></pre></td></tr></table></figure>\n\n<p>接着按照提醒输入你的密码，端口和加密方式，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-74a7d62e2e94d543.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-fa86ce3db77be186.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>然后可以去听首歌~，成功安装之后有你配置的信息显示，记住这些信息，然后跳过下面的手动安装部分，直接去看客户端连接部分即可，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-199ab70c25fde457.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/568\" alt=\"图片\"></p>\n<blockquote>\n<p>以上脚本来源于秋水逸冰</p>\n</blockquote>\n<h3 id=\"手动安装\"><a href=\"#手动安装\" class=\"headerlink\" title=\"手动安装\"></a>手动安装</h3><p>在XShell的控制台输入：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">python get-pip.py</span><br></pre></td></tr></table></figure>\n\n<p>一个个的来，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-9de77734fd2714b1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"安装ShadowSocks\"><a href=\"#安装ShadowSocks\" class=\"headerlink\" title=\"安装ShadowSocks\"></a>安装ShadowSocks</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install --upgrade pip</span><br><span class=\"line\"></span><br><span class=\"line\">pip install shadowsocks</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-332ba1a059cbd935.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"创建ShadowSocks配置文件\"><a href=\"#创建ShadowSocks配置文件\" class=\"headerlink\" title=\"创建ShadowSocks配置文件\"></a>创建ShadowSocks配置文件</h2><h3 id=\"单端口\"><a href=\"#单端口\" class=\"headerlink\" title=\"单端口\"></a>单端口</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-56854846c8968c5a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>输入以下内容，然后点ESC后输入:wq保存退出</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-cb48bdd4f6ec44ea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;server&quot;: &quot;0.0.0.0&quot;,</span><br><span class=\"line\">  &quot;server_port&quot;: 2018,</span><br><span class=\"line\">  &quot;password&quot;: &quot;12345678&quot;,</span><br><span class=\"line\">  &quot;method&quot;: &quot;aes-256-cfb&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多端口\"><a href=\"#多端口\" class=\"headerlink\" title=\"多端口\"></a>多端口</h3><p>（可选，配置了单端口就不要配置这个）多端口的配置文件如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;server&quot;: &quot;0.0.0.0&quot;,</span><br><span class=\"line\">    &quot;port_password&quot;: &#123;</span><br><span class=\"line\">        &quot;8381&quot;: &quot;password1&quot;,</span><br><span class=\"line\">        &quot;8382&quot;: &quot;password2&quot;,</span><br><span class=\"line\">        &quot;8383&quot;: &quot;password3&quot;,</span><br><span class=\"line\">        &quot;8384&quot;: &quot;password4&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;timeout&quot;: 300,</span><br><span class=\"line\">    &quot;method&quot;: &quot;aes-256-cfb&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置防火墙\"><a href=\"#配置防火墙\" class=\"headerlink\" title=\"配置防火墙\"></a>配置防火墙</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-b59307a636a059b2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/457\" alt=\"图片\"></p>\n<p>启动ShadowSocks服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssserver -c /etc/shadowsocks.json -d start</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-06dd9301c164b087.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/650\" alt=\"图片\"></p>\n<p>下面的是关闭，启动成功之后不要执行</p>\n<h2 id=\"关闭ShadowSocks服务\"><a href=\"#关闭ShadowSocks服务\" class=\"headerlink\" title=\"关闭ShadowSocks服务\"></a>关闭ShadowSocks服务</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssserver -c /etc/shadowsocks.json -d stop</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"连接ShadowSocks，体会科学上网的魅力\"><a href=\"#连接ShadowSocks，体会科学上网的魅力\" class=\"headerlink\" title=\"连接ShadowSocks，体会科学上网的魅力\"></a>连接ShadowSocks，体会科学上网的魅力</h1><h2 id=\"Windows客户端\"><a href=\"#Windows客户端\" class=\"headerlink\" title=\"Windows客户端\"></a>Windows客户端</h2><p>下载地址：<a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FShadowsocks-4.0.7.zip\" target=\"_blank\" rel=\"noopener\">Shadowsocks</a></p>\n<p>下载完成之后解压打开，如下图所示：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-b4f235178abfb563.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/578\" alt=\"图片\"></p>\n<p>按照你自己的配置完成之后，点击确定，然后在托盘中右键这个小飞机，启动系统代理<br>，灰色的小飞机就会亮起来，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-e77cc63c73aa05dd.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/324\" alt=\"图片\"></p>\n<p>然后就可以畅游网络了~</p>\n<p>测试地址：</p>\n<ul>\n<li><a href=\"https://link.jianshu.com/?t=https%3A%2F%2Fwww.google.com.hk%2F\" target=\"_blank\" rel=\"noopener\">谷歌</a></li>\n<li><a href=\"https://link.jianshu.com/?t=https%3A%2F%2Fwww.youtube.com%2F\" target=\"_blank\" rel=\"noopener\">Youtube</a></li>\n<li><a href=\"https://link.jianshu.com/?t=https%3A%2F%2Ftwitter.com%2F%3Flang%3Dzh-cn\" target=\"_blank\" rel=\"noopener\">推特</a></li>\n</ul>\n<h2 id=\"安卓连接\"><a href=\"#安卓连接\" class=\"headerlink\" title=\"安卓连接\"></a>安卓连接</h2><p>下载地址：<a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2Fshadowsocks.apk\" target=\"_blank\" rel=\"noopener\">shadowsocks.apk</a></p>\n<p>配置和windows差不多，配置完成后点击右上角的开启按钮即可，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-f59bade6d27f4fdc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/473\" alt=\"图片\"></p>\n<h2 id=\"IOS连接\"><a href=\"#IOS连接\" class=\"headerlink\" title=\"IOS连接\"></a>IOS连接</h2><p>参考链接：<a href=\"http://www.360doc.com/content/17/0614/06/37032448_662846097.shtml\" target=\"_blank\" rel=\"noopener\">http://www.360doc.com/content/17/0614/06/37032448_662846097.shtml</a></p>\n<h2 id=\"MAC-连接\"><a href=\"#MAC-连接\" class=\"headerlink\" title=\"MAC 连接\"></a>MAC 连接</h2><p><a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FShadowsocksX-2.6.3.dmg\" target=\"_blank\" rel=\"noopener\">ShadowsocksX-2.6.3.dmg</a></p>\n","site":{"data":{}},"excerpt":"<meta name=\"referrer\" content=\"no-referrer\">\n\n<h2 id=\"国外服务器的购买\"><a href=\"#国外服务器的购买\" class=\"headerlink\" title=\"国外服务器的购买\"></a>国外服务器的购买</h2><p>这里我选择的是<a href=\"https://www.vultr.com/\" target=\"_blank\" rel=\"noopener\">Vultr</a>，对比了很多国外的服务器，这个蛮靠谱的，且搭建成功后看youtube1080p完全无压力。</p>\n<h2 id=\"Vultr服务器价格\"><a href=\"#Vultr服务器价格\" class=\"headerlink\" title=\"Vultr服务器价格\"></a>Vultr服务器价格</h2><p>Vultr服务器按小时计费,最低0.004美元/h,算起来2.5美元/月，且destory掉服务器是不收费的，所以不用担心如果暂时没有使用还一直扣费的问题，如下图所示：<br>","more":"</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-5a37a53b4fb0aacb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>最低价格的服务器是512M的内存，500G的带宽，只能说99%的情况下完全够用了！</p>\n<h2 id=\"注册Vultr\"><a href=\"#注册Vultr\" class=\"headerlink\" title=\"注册Vultr\"></a>注册Vultr</h2><p>首先打开<a href=\"https://www.vultr.com/\" target=\"_blank\" rel=\"noopener\">Vultr</a>链接，点击<strong>Create Account</strong></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-a393d98c540c2923.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"充值Vultr\"><a href=\"#充值Vultr\" class=\"headerlink\" title=\"充值Vultr\"></a>充值Vultr</h2><p>注册完成之后就是充值，Vultr提供4种充值方式，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-2b240230b4a8c30a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>这里我选择支付宝，因为方便快捷，但是最低消费10美元，也不多，60多人民币，如下图：</p>\n<h2 id=\"选择VPS的位置\"><a href=\"#选择VPS的位置\" class=\"headerlink\" title=\"选择VPS的位置\"></a>选择VPS的位置</h2><p>首先，位置很重要！我们如何选择呢，当然有科学的办法，ping它！</p>\n<p>Vultr的服务器有很多位置，下面我测试的东京节点和新加坡节点的数据如下：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-7192d20013fdb116.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-685cbb5130cd6a27.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>这么看来还是东京的节点速度比较好，当然这个因人而异，在中国不同的地理位置访问国外不同位置的服务器速度也不一样。（下面提供了下载地址,下载下来双击运行即可）。</p>\n<p>测速脚本下载地址：<a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2F%25E6%25B5%258B%25E9%2580%259F.bat\" target=\"_blank\" rel=\"noopener\">点我下载 测速.bat</a></p>\n<p>脚本内容如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@echo off</span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 东京</span><br><span class=\"line\">ping hnd-jp-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ============================================</span><br><span class=\"line\">echo 新加坡</span><br><span class=\"line\">ping sgp-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo (AU) Sydney, Australia[悉尼]</span><br><span class=\"line\">ping syd-au-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 德国 法兰克福</span><br><span class=\"line\">ping fra-de-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 荷兰 阿姆斯特丹</span><br><span class=\"line\">ping ams-nl-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 英国 伦敦</span><br><span class=\"line\">ping lon-gb-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 法国 巴黎</span><br><span class=\"line\">ping par-fr-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 华盛顿州 西雅图</span><br><span class=\"line\">ping wa-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美西 加州 硅谷</span><br><span class=\"line\">ping sjo-ca-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美西 加州 洛杉矶</span><br><span class=\"line\">ping lax-ca-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 芝加哥</span><br><span class=\"line\">Chicago, Illinois[美东 芝加哥]</span><br><span class=\"line\">ping il-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美中 德克萨斯州 达拉斯</span><br><span class=\"line\">ping tx-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 新泽西</span><br><span class=\"line\">ping nj-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 乔治亚州 亚特兰大</span><br><span class=\"line\">ping ga-us-ping.vultr.com</span><br><span class=\"line\"></span><br><span class=\"line\">echo ===========================================</span><br><span class=\"line\">echo 美东 佛罗里达州 迈阿密</span><br><span class=\"line\">ping fl-us-ping.vultr.com   </span><br><span class=\"line\">pause</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建VPS\"><a href=\"#创建VPS\" class=\"headerlink\" title=\"创建VPS\"></a>创建VPS</h2><p>左侧菜单栏Servers，点击+，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-ee1d05af94ce2141.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>选择VPS的位置，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-eab85cb6568d8de9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>选择操作系统和价格，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-03fb9399994d0fed.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>点击最下面的Deploy Now，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-32fe2a620e144c34.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>创建成功</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-9ccd708aa1da7171.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"VPS的信息\"><a href=\"#VPS的信息\" class=\"headerlink\" title=\"VPS的信息\"></a>VPS的信息</h2><p>安装成功之后，点击Manage</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-8dc96ccd0c6d8ead.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>可以看到你购买的VPS的信息，如下图所示：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-094f80d577b336b3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>ping一下ip地址，100ms多一点，这个速度相当可以了，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-6dcffcba340bfed9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"下载Shell\"><a href=\"#下载Shell\" class=\"headerlink\" title=\"下载Shell\"></a>下载Shell</h2><p>当然是选择先连接它了，我们选择的工具是XShell。下载地址：<a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FXshell5.zip\" target=\"_blank\" rel=\"noopener\">Xshell下载</a></p>\n<p>下载完成之后安装，下一步即可</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-efd55f89d73a3a4e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624\" alt=\"图片\"></p>\n<p>接着选择免费为家庭/学校</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-d152b4a16ce5395f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624\" alt=\"图片\"></p>\n<p>语言选择中文：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-7732828642a07ccf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/624\" alt=\"图片\"></p>\n<h2 id=\"连接VPS\"><a href=\"#连接VPS\" class=\"headerlink\" title=\"连接VPS\"></a>连接VPS</h2><p>打开Xshell，选择文件-&gt;新建，输入VPS的IP，IP地址就在Vultr的管理页面上，如下图所示：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-e9aab3ea6cd1a961.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/667\" alt=\"图片\"></p>\n<p>点击确定，输入用户名，默认应该为root，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-59a57a713d8295e3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/398\" alt=\"图片\"></p>\n<p>接着输入密码：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-7f5bb802df979df0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/504\" alt=\"图片\"></p>\n<p>连接成功：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-1e4faf8294542487.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"快速搭建ShadowSocks-二选一\"><a href=\"#快速搭建ShadowSocks-二选一\" class=\"headerlink\" title=\"快速搭建ShadowSocks(二选一)\"></a>快速搭建ShadowSocks(二选一)</h2><h3 id=\"一键安装\"><a href=\"#一键安装\" class=\"headerlink\" title=\"一键安装\"></a>一键安装</h3><p>在Xshell中依次运行以下命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh</span><br><span class=\"line\"></span><br><span class=\"line\">chmod +x shadowsocks.sh</span><br><span class=\"line\"></span><br><span class=\"line\">./shadowsocks.sh 2&gt;&amp;1 | tee shadowsocks.log</span><br></pre></td></tr></table></figure>\n\n<p>接着按照提醒输入你的密码，端口和加密方式，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-74a7d62e2e94d543.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-fa86ce3db77be186.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>然后可以去听首歌~，成功安装之后有你配置的信息显示，记住这些信息，然后跳过下面的手动安装部分，直接去看客户端连接部分即可，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-199ab70c25fde457.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/568\" alt=\"图片\"></p>\n<blockquote>\n<p>以上脚本来源于秋水逸冰</p>\n</blockquote>\n<h3 id=\"手动安装\"><a href=\"#手动安装\" class=\"headerlink\" title=\"手动安装\"></a>手动安装</h3><p>在XShell的控制台输入：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">python get-pip.py</span><br></pre></td></tr></table></figure>\n\n<p>一个个的来，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-9de77734fd2714b1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"安装ShadowSocks\"><a href=\"#安装ShadowSocks\" class=\"headerlink\" title=\"安装ShadowSocks\"></a>安装ShadowSocks</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install --upgrade pip</span><br><span class=\"line\"></span><br><span class=\"line\">pip install shadowsocks</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-332ba1a059cbd935.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<h2 id=\"创建ShadowSocks配置文件\"><a href=\"#创建ShadowSocks配置文件\" class=\"headerlink\" title=\"创建ShadowSocks配置文件\"></a>创建ShadowSocks配置文件</h2><h3 id=\"单端口\"><a href=\"#单端口\" class=\"headerlink\" title=\"单端口\"></a>单端口</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-56854846c8968c5a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<p>输入以下内容，然后点ESC后输入:wq保存退出</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-cb48bdd4f6ec44ea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700\" alt=\"图片\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;server&quot;: &quot;0.0.0.0&quot;,</span><br><span class=\"line\">  &quot;server_port&quot;: 2018,</span><br><span class=\"line\">  &quot;password&quot;: &quot;12345678&quot;,</span><br><span class=\"line\">  &quot;method&quot;: &quot;aes-256-cfb&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多端口\"><a href=\"#多端口\" class=\"headerlink\" title=\"多端口\"></a>多端口</h3><p>（可选，配置了单端口就不要配置这个）多端口的配置文件如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;server&quot;: &quot;0.0.0.0&quot;,</span><br><span class=\"line\">    &quot;port_password&quot;: &#123;</span><br><span class=\"line\">        &quot;8381&quot;: &quot;password1&quot;,</span><br><span class=\"line\">        &quot;8382&quot;: &quot;password2&quot;,</span><br><span class=\"line\">        &quot;8383&quot;: &quot;password3&quot;,</span><br><span class=\"line\">        &quot;8384&quot;: &quot;password4&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;timeout&quot;: 300,</span><br><span class=\"line\">    &quot;method&quot;: &quot;aes-256-cfb&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置防火墙\"><a href=\"#配置防火墙\" class=\"headerlink\" title=\"配置防火墙\"></a>配置防火墙</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-b59307a636a059b2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/457\" alt=\"图片\"></p>\n<p>启动ShadowSocks服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssserver -c /etc/shadowsocks.json -d start</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-06dd9301c164b087.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/650\" alt=\"图片\"></p>\n<p>下面的是关闭，启动成功之后不要执行</p>\n<h2 id=\"关闭ShadowSocks服务\"><a href=\"#关闭ShadowSocks服务\" class=\"headerlink\" title=\"关闭ShadowSocks服务\"></a>关闭ShadowSocks服务</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssserver -c /etc/shadowsocks.json -d stop</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"连接ShadowSocks，体会科学上网的魅力\"><a href=\"#连接ShadowSocks，体会科学上网的魅力\" class=\"headerlink\" title=\"连接ShadowSocks，体会科学上网的魅力\"></a>连接ShadowSocks，体会科学上网的魅力</h1><h2 id=\"Windows客户端\"><a href=\"#Windows客户端\" class=\"headerlink\" title=\"Windows客户端\"></a>Windows客户端</h2><p>下载地址：<a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FShadowsocks-4.0.7.zip\" target=\"_blank\" rel=\"noopener\">Shadowsocks</a></p>\n<p>下载完成之后解压打开，如下图所示：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-b4f235178abfb563.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/578\" alt=\"图片\"></p>\n<p>按照你自己的配置完成之后，点击确定，然后在托盘中右键这个小飞机，启动系统代理<br>，灰色的小飞机就会亮起来，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-e77cc63c73aa05dd.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/324\" alt=\"图片\"></p>\n<p>然后就可以畅游网络了~</p>\n<p>测试地址：</p>\n<ul>\n<li><a href=\"https://link.jianshu.com/?t=https%3A%2F%2Fwww.google.com.hk%2F\" target=\"_blank\" rel=\"noopener\">谷歌</a></li>\n<li><a href=\"https://link.jianshu.com/?t=https%3A%2F%2Fwww.youtube.com%2F\" target=\"_blank\" rel=\"noopener\">Youtube</a></li>\n<li><a href=\"https://link.jianshu.com/?t=https%3A%2F%2Ftwitter.com%2F%3Flang%3Dzh-cn\" target=\"_blank\" rel=\"noopener\">推特</a></li>\n</ul>\n<h2 id=\"安卓连接\"><a href=\"#安卓连接\" class=\"headerlink\" title=\"安卓连接\"></a>安卓连接</h2><p>下载地址：<a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2Fshadowsocks.apk\" target=\"_blank\" rel=\"noopener\">shadowsocks.apk</a></p>\n<p>配置和windows差不多，配置完成后点击右上角的开启按钮即可，如下图：</p>\n<p><img src=\"https://upload-images.jianshu.io/upload_images/3883542-f59bade6d27f4fdc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/473\" alt=\"图片\"></p>\n<h2 id=\"IOS连接\"><a href=\"#IOS连接\" class=\"headerlink\" title=\"IOS连接\"></a>IOS连接</h2><p>参考链接：<a href=\"http://www.360doc.com/content/17/0614/06/37032448_662846097.shtml\" target=\"_blank\" rel=\"noopener\">http://www.360doc.com/content/17/0614/06/37032448_662846097.shtml</a></p>\n<h2 id=\"MAC-连接\"><a href=\"#MAC-连接\" class=\"headerlink\" title=\"MAC 连接\"></a>MAC 连接</h2><p><a href=\"https://link.jianshu.com/?t=http%3A%2F%2Fp1hy9syru.bkt.clouddn.com%2FShadowsocksX-2.6.3.dmg\" target=\"_blank\" rel=\"noopener\">ShadowsocksX-2.6.3.dmg</a></p>"},{"title":"Kubernetes vs Docker Swarm","date":"2019-06-24T04:00:00.000Z","comments":1,"_content":"\nKubernetes and Docker Swarm are probably two most commonly used tools to deploy containers inside a cluster. Both are created as helper tools that can be used to manage a cluster of containers and treat all servers as a single unit. However, they differ greatly in their approach.\n <!-- more -->\n\n[文章转载](https://www.oschina.net/translate/docker-clustering-tools-compared-kubernetes-vs-docker-swarm?cmp)\n\nKubernetes and Docker Swarm are probably two most commonly used tools to deploy containers inside a cluster. Both are created as helper tools that can be used to manage a cluster of containers and treat all servers as a single unit. However, they differ greatly in their approach.\n\n# Kubernetes\n\nKubernetes is based on Google’s experience of many years working with Linux containers. It is, in a way, a replica of what Google has been doing for a long time but, this time, adapted to Docker. That approach is great in many ways, most important being that they used their experience from the start. If you started using Kubernetes around Docker version 1.0 (or earlier), the experience with Kubernetes was great. It solved many of the problems that Docker itself had. We could mount persistent volumes that would allow us to move containers without loosing data, it used flannel to create networking between containers, it has load balancer integrated, it uses etcd for service discovery, and so on. However, Kubernetes comes at a cost. It uses a different CLI, different API and different YAML definitions. In other words, you cannot use Docker CLI nor you can use Docker Compose to define containers. Everything needs to be done from scratch exclusively for Kubernetes. It’s as if the tool was not written for Docker (which is partly true). Kubernetes brought clustering to a new level but at the expense of usability and steep learning curve.\n\n# Docker Swarm\n\nDocker Swarm took a different approach. It is a native clustering for Docker. The best part is that it exposes standard Docker API meaning that any tool that you used to communicate with Docker (Docker CLI, Docker Compose, Dokku, Krane, and so on) can work equally well with Docker Swarm. That in itself is both an advantage and a disadvantage at the same time. Being able to use familiar tools of your own choosing is great but for the same reasons we are bound by the limitations of Docker API. If the API doesn’t support something, there is no way around it through Swarm API and some clever tricks need to be performed.\n\nWe’ll explore those two tools in more details based on their setup and features they provide for running containers in a cluster.\n\n\n\n## Setting Up\n\nSetting up Docker Swarm is easy, straightforward and flexible. All we have to do is install one of the service discovery tools and run the swarm container on all nodes. Since the distribution itself is packed as a Docker container, it works in the same way no matter the operating system. We run the swarm container, expose a port and inform it about the address of the service discovery. It could hardly be easier than that. We can even start using it without any service discovery tool, see whether we like it and when our usage of it becomes more serious, add etcd, Consul or some of the other supported tools.\n\nKubernetes setup is quite more complicated and obfuscated. Installation instructions differ from OS to OS and provider to provider. Each OS or a hosting provider comes with its own set of instructions each of them having a separate maintenance team with a separate set of problems. As example, if you choose to try it out with Vagrant, you are stuck with Fedora. That does not mean that you cannot run it with Vagrant and, let’s say, Ubuntu or CoreOS. You can, but you need to start searching for instructions outside the official Kubernetes Getting Started page. Whatever your needs are, it’s likely that the community has the solution but you still need to spend some time searching for it and hoping that it works from the first attempt. The bigger problem is that the installation relies on a bash script. That would not be a big deal in itself if we would not live in the era where configuration management is a must. We might not want to run a script but make Kubernetes be part of our Puppet, Chef or Ansible definitions. Again, this can be overcome as well. You can find Ansible playbooks for running Kubernetes or you can write your own. None of those issues are a big problem but, when compared with Swarm, they are a bit painful. With Docker we were supposed not to have installation instructions (aside from a few docker run arguments). We were supposed to run containers. Swarm fulfils that promise and Kubernetes doesn’t.\n\nWhile some might not care about which discovery tool is used, I love the simplicity behind Swarm and the logic “batteries included but removable”. Everything works out-of-the-box but we still have the option to substitute one component with the other. Unlike Swarm, Kubernetes is opinionated tool. You need to live with the choices it made for you. If you want to use Kubernetes, you have to use etcd. I’m not trying to say that etcd is bad (quite contrary) but if you prefer, for example, to use Consul you’re in a very complicated situation and would need to use one for Kubernetes and the other for the rest of your service discovery needs. Another thing I dislike about Kubernetes is its need to know things in advance, before the setup. You need to tell it the addresses of all your nodes, which role each of them has, how many minions there are in the cluster and so on. With Swarm, we just bring up a node and tell it to join the network. Nothing needs to be set in advance since the information about the cluster is propagated through gossip.\n\nSet up might not be the most important difference between those tools. No matter which tool you choose, sooner or later everything will be up and running and you’ll forget any trouble you might have had during the process. You might say that we should not choose one tool over the other only because one is easier to set up. Fair enough. Let’s move on and speak about differences in how you define containers that should be run with those tools.\n\n## Running Containers\n\nHow do you define all the arguments needed for running Docker containers with Swarm? You don’t! Actually, you do but not in any form or way different from the way you were defining them before Swarm. If you are used to run containers through Docker CLI, you can continue using it with (almost) the same commands. If you prefer to use Docker Compose to run containers, you can continue using it to run them inside the Swarm cluster. Whichever way you’re used to run your containers, chances are that you can continue doing the same with Swarm but on a much larger scale.\n\nKubernetes requires you to learn its CLI and configurations. You cannot use docker-compose.yml definitions you created earlier. You’ll have to create Kubernetes equivalents. You cannot use Docker CLI commands you learned before. You’ll have to learn Kubernetes CLI and, likely, make sure that the whole organization learns it as well.\n\nNo matter which tool you choose for deployments to your cluster, chances are you are already familiar with Docker. You are probably already used to Docker Compose as a way to define arguments for the containers you’ll run. If you played with it for more than a few hours, you are using it as a substitute for Docker CLI. You run containers with it, tail their logs, scale them, and so on. On the other hand, you might be a hard-core Docker user who does not like Docker Compose and prefer running everything through Docker CLI or you might have your own bash scripts that run containers for you. No matter what you choose, it should work with Docker Swarm.\n\nIf you adopt Kubernetes, be prepared to have multiple definitions of the same thing. You will need Docker Compose to run your containers outside Kubernetes. Developers will continue needing to run containers on their laptops, your staging environments might or might not be a big cluster, and so on. In other words, once you adopt Docker, Docker Compose or Docker CLI are unavoidable. You have to use them one way or another. Once you start using Kubernetes you will discover that all your Docker Compose definitions (or whatever else you might be using) need to be translated to Kubernetes way of describing things and, from there on, you will have to maintain both. With Kubernetes everything will have to be duplicated resulting in higher cost of maintenance. And it’s not only about duplicated configurations. Commands you’ll run outside of the cluster will be different from those inside the cluster. All those Docker commands you learned and love will have to get their Kubernetes equivalents inside the cluster.\n\nGuys behind Kubernetes are not trying to make your life miserable by forcing you to do things “their way”. The reason for such big differences is in a different approaches Swarm and Kubernetes are using to tackle the same problem. Swarm team decided to match their API with the one from Docker. As a result, we have (almost) full compatibility. Almost everything we can do with Docker we can do with Swarm as well only on a much larger scale. There’s nothing new to do, no configurations to be duplicated and nothing new to learn. No matter whether you use Docker CLI directly or go through Swarm, API is (more or less) the same. The negative side of that story is that if there is something you’d like Swarm to do and that something is not part of the Docker API, you’re in for a disappointment. Let us simplify this a bit. If you’re looking for a tool for deploying containers in a cluster that will use Docker API, Swarm is the solution. On the other hand, if you want a tool that will overcome Docker limitations, you should go with Kubernetes. It is power (Kubernetes) against simplicity (Swarm). Or, at least, that’s how it was until recently. But, I’m jumping ahead of myself.\n\nThe only question unanswered is what those limitations are. Two of the major ones were networking and persistent volumes. Until Docker Swarm release 1.0 we could not link containers running on different servers. Actually, we still cannot link them but now we have multi-host networking to help us connect containers running on different servers. It is a very powerful feature. Kubernetes used flannel to accomplish networking and now, since the Docker release 1.9, that feature is available as part of Docker CLI.\n\nAnother problem were persistent volumes. Docker introduced them in release 1.9. Until recently, if you persist a volume, that container was tied to the server that volume resides. It could not be moved around without, again, resorting to some nasty tricks like copying volume directory from one server to another. That in itself is a slow operation that defies the goals of tools like Swarm. Besides, even if you have time to copy a volume from one to the other server, you do not know where to copy since clustering tools tend to treat your whole datacenter as a single entity. You containers will be deployed to a location most suitable for them (least number of containers running, most CPUs or memory available, and so on). Now we have persistent volumes supported by Docker natively.\n\nBoth networking and persistent volumes problems were one of the features supported by Kubernetes for quite some time and the reason why many were choosing it over Swarm. That advantage disappeared with Docker release 1.9.\n\n## The Choice\n\nWhen trying to make a choice between Docker Swarm and Kubernetes, think in following terms. Do you want to depend on Docker itself solving problems related to clustering. If you do, choose Swarm. If something is not supported by Docker it will be unlikely that it will be supported by Swarm since it relies on Docker API. On the other hand, if you want a tool that works around Docker limitations, Kubernetes might be the right one for you. Kubernetes was not built around Docker but is based on Google’s experience with containers. It is opinionated and tries to do things in its own way.\n\nThe real question is whether Kubernetes’ way of doing things, which is quite different from how we use Docker, is overshadowed by advantages it gives. Or, should we place our bets into Docker itself and hope that it will solve those problems? Before you answer those questions, take a look at the release 1.9. We got persistent volumes and software networking. We also got unless-stopped restart policy that will manage our unwanted failures. Now there are three things less of a difference between Kubernetes and Swarm. Actually, these days there are very few advantages Kubernetes has over Swarm. On the other hand, Swarm uses Docker API meaning that you get to keep all your commands and Docker Compose configurations. Personally, I’m placing my bets on Docker engine getting improvements and Docker Swarm running on top of it. The difference between the two is very small. Both are production ready but Swarm is easier to set up, easier to use and we get to keep everything we built before moving to the cluster; there is no duplication between cluster and non-cluster configurations.\n\nMy recommendation is to go with Docker Swarm. Kubernetes is too opinionated, hard to set up, too different from Docker CLI/API and at the same time it doesn’t have real advantages over Swarm since the Docker release 1.9. That doesn’t mean that there are no features available in Kubernetes that are not supported by Swarm. There are feature differences in both directions. However, those differences are, in my opinion, not major ones and the gap is getting smaller with each Docker release. Actually, for many use cases there is no gap at all while Docker Swarm is easier to set up, learn and use.","source":"_posts/2019-06-24-k8sVSswarm.md","raw":"---\ntitle: \"Kubernetes vs Docker Swarm\"\ndate: 2019-06-24\ncomments: true\ncategories: 容器\ntags:\n    - watch\n---\n\nKubernetes and Docker Swarm are probably two most commonly used tools to deploy containers inside a cluster. Both are created as helper tools that can be used to manage a cluster of containers and treat all servers as a single unit. However, they differ greatly in their approach.\n <!-- more -->\n\n[文章转载](https://www.oschina.net/translate/docker-clustering-tools-compared-kubernetes-vs-docker-swarm?cmp)\n\nKubernetes and Docker Swarm are probably two most commonly used tools to deploy containers inside a cluster. Both are created as helper tools that can be used to manage a cluster of containers and treat all servers as a single unit. However, they differ greatly in their approach.\n\n# Kubernetes\n\nKubernetes is based on Google’s experience of many years working with Linux containers. It is, in a way, a replica of what Google has been doing for a long time but, this time, adapted to Docker. That approach is great in many ways, most important being that they used their experience from the start. If you started using Kubernetes around Docker version 1.0 (or earlier), the experience with Kubernetes was great. It solved many of the problems that Docker itself had. We could mount persistent volumes that would allow us to move containers without loosing data, it used flannel to create networking between containers, it has load balancer integrated, it uses etcd for service discovery, and so on. However, Kubernetes comes at a cost. It uses a different CLI, different API and different YAML definitions. In other words, you cannot use Docker CLI nor you can use Docker Compose to define containers. Everything needs to be done from scratch exclusively for Kubernetes. It’s as if the tool was not written for Docker (which is partly true). Kubernetes brought clustering to a new level but at the expense of usability and steep learning curve.\n\n# Docker Swarm\n\nDocker Swarm took a different approach. It is a native clustering for Docker. The best part is that it exposes standard Docker API meaning that any tool that you used to communicate with Docker (Docker CLI, Docker Compose, Dokku, Krane, and so on) can work equally well with Docker Swarm. That in itself is both an advantage and a disadvantage at the same time. Being able to use familiar tools of your own choosing is great but for the same reasons we are bound by the limitations of Docker API. If the API doesn’t support something, there is no way around it through Swarm API and some clever tricks need to be performed.\n\nWe’ll explore those two tools in more details based on their setup and features they provide for running containers in a cluster.\n\n\n\n## Setting Up\n\nSetting up Docker Swarm is easy, straightforward and flexible. All we have to do is install one of the service discovery tools and run the swarm container on all nodes. Since the distribution itself is packed as a Docker container, it works in the same way no matter the operating system. We run the swarm container, expose a port and inform it about the address of the service discovery. It could hardly be easier than that. We can even start using it without any service discovery tool, see whether we like it and when our usage of it becomes more serious, add etcd, Consul or some of the other supported tools.\n\nKubernetes setup is quite more complicated and obfuscated. Installation instructions differ from OS to OS and provider to provider. Each OS or a hosting provider comes with its own set of instructions each of them having a separate maintenance team with a separate set of problems. As example, if you choose to try it out with Vagrant, you are stuck with Fedora. That does not mean that you cannot run it with Vagrant and, let’s say, Ubuntu or CoreOS. You can, but you need to start searching for instructions outside the official Kubernetes Getting Started page. Whatever your needs are, it’s likely that the community has the solution but you still need to spend some time searching for it and hoping that it works from the first attempt. The bigger problem is that the installation relies on a bash script. That would not be a big deal in itself if we would not live in the era where configuration management is a must. We might not want to run a script but make Kubernetes be part of our Puppet, Chef or Ansible definitions. Again, this can be overcome as well. You can find Ansible playbooks for running Kubernetes or you can write your own. None of those issues are a big problem but, when compared with Swarm, they are a bit painful. With Docker we were supposed not to have installation instructions (aside from a few docker run arguments). We were supposed to run containers. Swarm fulfils that promise and Kubernetes doesn’t.\n\nWhile some might not care about which discovery tool is used, I love the simplicity behind Swarm and the logic “batteries included but removable”. Everything works out-of-the-box but we still have the option to substitute one component with the other. Unlike Swarm, Kubernetes is opinionated tool. You need to live with the choices it made for you. If you want to use Kubernetes, you have to use etcd. I’m not trying to say that etcd is bad (quite contrary) but if you prefer, for example, to use Consul you’re in a very complicated situation and would need to use one for Kubernetes and the other for the rest of your service discovery needs. Another thing I dislike about Kubernetes is its need to know things in advance, before the setup. You need to tell it the addresses of all your nodes, which role each of them has, how many minions there are in the cluster and so on. With Swarm, we just bring up a node and tell it to join the network. Nothing needs to be set in advance since the information about the cluster is propagated through gossip.\n\nSet up might not be the most important difference between those tools. No matter which tool you choose, sooner or later everything will be up and running and you’ll forget any trouble you might have had during the process. You might say that we should not choose one tool over the other only because one is easier to set up. Fair enough. Let’s move on and speak about differences in how you define containers that should be run with those tools.\n\n## Running Containers\n\nHow do you define all the arguments needed for running Docker containers with Swarm? You don’t! Actually, you do but not in any form or way different from the way you were defining them before Swarm. If you are used to run containers through Docker CLI, you can continue using it with (almost) the same commands. If you prefer to use Docker Compose to run containers, you can continue using it to run them inside the Swarm cluster. Whichever way you’re used to run your containers, chances are that you can continue doing the same with Swarm but on a much larger scale.\n\nKubernetes requires you to learn its CLI and configurations. You cannot use docker-compose.yml definitions you created earlier. You’ll have to create Kubernetes equivalents. You cannot use Docker CLI commands you learned before. You’ll have to learn Kubernetes CLI and, likely, make sure that the whole organization learns it as well.\n\nNo matter which tool you choose for deployments to your cluster, chances are you are already familiar with Docker. You are probably already used to Docker Compose as a way to define arguments for the containers you’ll run. If you played with it for more than a few hours, you are using it as a substitute for Docker CLI. You run containers with it, tail their logs, scale them, and so on. On the other hand, you might be a hard-core Docker user who does not like Docker Compose and prefer running everything through Docker CLI or you might have your own bash scripts that run containers for you. No matter what you choose, it should work with Docker Swarm.\n\nIf you adopt Kubernetes, be prepared to have multiple definitions of the same thing. You will need Docker Compose to run your containers outside Kubernetes. Developers will continue needing to run containers on their laptops, your staging environments might or might not be a big cluster, and so on. In other words, once you adopt Docker, Docker Compose or Docker CLI are unavoidable. You have to use them one way or another. Once you start using Kubernetes you will discover that all your Docker Compose definitions (or whatever else you might be using) need to be translated to Kubernetes way of describing things and, from there on, you will have to maintain both. With Kubernetes everything will have to be duplicated resulting in higher cost of maintenance. And it’s not only about duplicated configurations. Commands you’ll run outside of the cluster will be different from those inside the cluster. All those Docker commands you learned and love will have to get their Kubernetes equivalents inside the cluster.\n\nGuys behind Kubernetes are not trying to make your life miserable by forcing you to do things “their way”. The reason for such big differences is in a different approaches Swarm and Kubernetes are using to tackle the same problem. Swarm team decided to match their API with the one from Docker. As a result, we have (almost) full compatibility. Almost everything we can do with Docker we can do with Swarm as well only on a much larger scale. There’s nothing new to do, no configurations to be duplicated and nothing new to learn. No matter whether you use Docker CLI directly or go through Swarm, API is (more or less) the same. The negative side of that story is that if there is something you’d like Swarm to do and that something is not part of the Docker API, you’re in for a disappointment. Let us simplify this a bit. If you’re looking for a tool for deploying containers in a cluster that will use Docker API, Swarm is the solution. On the other hand, if you want a tool that will overcome Docker limitations, you should go with Kubernetes. It is power (Kubernetes) against simplicity (Swarm). Or, at least, that’s how it was until recently. But, I’m jumping ahead of myself.\n\nThe only question unanswered is what those limitations are. Two of the major ones were networking and persistent volumes. Until Docker Swarm release 1.0 we could not link containers running on different servers. Actually, we still cannot link them but now we have multi-host networking to help us connect containers running on different servers. It is a very powerful feature. Kubernetes used flannel to accomplish networking and now, since the Docker release 1.9, that feature is available as part of Docker CLI.\n\nAnother problem were persistent volumes. Docker introduced them in release 1.9. Until recently, if you persist a volume, that container was tied to the server that volume resides. It could not be moved around without, again, resorting to some nasty tricks like copying volume directory from one server to another. That in itself is a slow operation that defies the goals of tools like Swarm. Besides, even if you have time to copy a volume from one to the other server, you do not know where to copy since clustering tools tend to treat your whole datacenter as a single entity. You containers will be deployed to a location most suitable for them (least number of containers running, most CPUs or memory available, and so on). Now we have persistent volumes supported by Docker natively.\n\nBoth networking and persistent volumes problems were one of the features supported by Kubernetes for quite some time and the reason why many were choosing it over Swarm. That advantage disappeared with Docker release 1.9.\n\n## The Choice\n\nWhen trying to make a choice between Docker Swarm and Kubernetes, think in following terms. Do you want to depend on Docker itself solving problems related to clustering. If you do, choose Swarm. If something is not supported by Docker it will be unlikely that it will be supported by Swarm since it relies on Docker API. On the other hand, if you want a tool that works around Docker limitations, Kubernetes might be the right one for you. Kubernetes was not built around Docker but is based on Google’s experience with containers. It is opinionated and tries to do things in its own way.\n\nThe real question is whether Kubernetes’ way of doing things, which is quite different from how we use Docker, is overshadowed by advantages it gives. Or, should we place our bets into Docker itself and hope that it will solve those problems? Before you answer those questions, take a look at the release 1.9. We got persistent volumes and software networking. We also got unless-stopped restart policy that will manage our unwanted failures. Now there are three things less of a difference between Kubernetes and Swarm. Actually, these days there are very few advantages Kubernetes has over Swarm. On the other hand, Swarm uses Docker API meaning that you get to keep all your commands and Docker Compose configurations. Personally, I’m placing my bets on Docker engine getting improvements and Docker Swarm running on top of it. The difference between the two is very small. Both are production ready but Swarm is easier to set up, easier to use and we get to keep everything we built before moving to the cluster; there is no duplication between cluster and non-cluster configurations.\n\nMy recommendation is to go with Docker Swarm. Kubernetes is too opinionated, hard to set up, too different from Docker CLI/API and at the same time it doesn’t have real advantages over Swarm since the Docker release 1.9. That doesn’t mean that there are no features available in Kubernetes that are not supported by Swarm. There are feature differences in both directions. However, those differences are, in my opinion, not major ones and the gap is getting smaller with each Docker release. Actually, for many use cases there is no gap at all while Docker Swarm is easier to set up, learn and use.","slug":"2019-06-24-k8sVSswarm","published":1,"updated":"2019-07-05T07:55:55.000Z","layout":"post","photos":[],"link":"","_id":"cjypn1qly005ey4rbjc5gl8sc","content":"<p>Kubernetes and Docker Swarm are probably two most commonly used tools to deploy containers inside a cluster. Both are created as helper tools that can be used to manage a cluster of containers and treat all servers as a single unit. However, they differ greatly in their approach.<br> <a id=\"more\"></a></p>\n<p><a href=\"https://www.oschina.net/translate/docker-clustering-tools-compared-kubernetes-vs-docker-swarm?cmp\" target=\"_blank\" rel=\"noopener\">文章转载</a></p>\n<p>Kubernetes and Docker Swarm are probably two most commonly used tools to deploy containers inside a cluster. Both are created as helper tools that can be used to manage a cluster of containers and treat all servers as a single unit. However, they differ greatly in their approach.</p>\n<h1 id=\"Kubernetes\"><a href=\"#Kubernetes\" class=\"headerlink\" title=\"Kubernetes\"></a>Kubernetes</h1><p>Kubernetes is based on Google’s experience of many years working with Linux containers. It is, in a way, a replica of what Google has been doing for a long time but, this time, adapted to Docker. That approach is great in many ways, most important being that they used their experience from the start. If you started using Kubernetes around Docker version 1.0 (or earlier), the experience with Kubernetes was great. It solved many of the problems that Docker itself had. We could mount persistent volumes that would allow us to move containers without loosing data, it used flannel to create networking between containers, it has load balancer integrated, it uses etcd for service discovery, and so on. However, Kubernetes comes at a cost. It uses a different CLI, different API and different YAML definitions. In other words, you cannot use Docker CLI nor you can use Docker Compose to define containers. Everything needs to be done from scratch exclusively for Kubernetes. It’s as if the tool was not written for Docker (which is partly true). Kubernetes brought clustering to a new level but at the expense of usability and steep learning curve.</p>\n<h1 id=\"Docker-Swarm\"><a href=\"#Docker-Swarm\" class=\"headerlink\" title=\"Docker Swarm\"></a>Docker Swarm</h1><p>Docker Swarm took a different approach. It is a native clustering for Docker. The best part is that it exposes standard Docker API meaning that any tool that you used to communicate with Docker (Docker CLI, Docker Compose, Dokku, Krane, and so on) can work equally well with Docker Swarm. That in itself is both an advantage and a disadvantage at the same time. Being able to use familiar tools of your own choosing is great but for the same reasons we are bound by the limitations of Docker API. If the API doesn’t support something, there is no way around it through Swarm API and some clever tricks need to be performed.</p>\n<p>We’ll explore those two tools in more details based on their setup and features they provide for running containers in a cluster.</p>\n<h2 id=\"Setting-Up\"><a href=\"#Setting-Up\" class=\"headerlink\" title=\"Setting Up\"></a>Setting Up</h2><p>Setting up Docker Swarm is easy, straightforward and flexible. All we have to do is install one of the service discovery tools and run the swarm container on all nodes. Since the distribution itself is packed as a Docker container, it works in the same way no matter the operating system. We run the swarm container, expose a port and inform it about the address of the service discovery. It could hardly be easier than that. We can even start using it without any service discovery tool, see whether we like it and when our usage of it becomes more serious, add etcd, Consul or some of the other supported tools.</p>\n<p>Kubernetes setup is quite more complicated and obfuscated. Installation instructions differ from OS to OS and provider to provider. Each OS or a hosting provider comes with its own set of instructions each of them having a separate maintenance team with a separate set of problems. As example, if you choose to try it out with Vagrant, you are stuck with Fedora. That does not mean that you cannot run it with Vagrant and, let’s say, Ubuntu or CoreOS. You can, but you need to start searching for instructions outside the official Kubernetes Getting Started page. Whatever your needs are, it’s likely that the community has the solution but you still need to spend some time searching for it and hoping that it works from the first attempt. The bigger problem is that the installation relies on a bash script. That would not be a big deal in itself if we would not live in the era where configuration management is a must. We might not want to run a script but make Kubernetes be part of our Puppet, Chef or Ansible definitions. Again, this can be overcome as well. You can find Ansible playbooks for running Kubernetes or you can write your own. None of those issues are a big problem but, when compared with Swarm, they are a bit painful. With Docker we were supposed not to have installation instructions (aside from a few docker run arguments). We were supposed to run containers. Swarm fulfils that promise and Kubernetes doesn’t.</p>\n<p>While some might not care about which discovery tool is used, I love the simplicity behind Swarm and the logic “batteries included but removable”. Everything works out-of-the-box but we still have the option to substitute one component with the other. Unlike Swarm, Kubernetes is opinionated tool. You need to live with the choices it made for you. If you want to use Kubernetes, you have to use etcd. I’m not trying to say that etcd is bad (quite contrary) but if you prefer, for example, to use Consul you’re in a very complicated situation and would need to use one for Kubernetes and the other for the rest of your service discovery needs. Another thing I dislike about Kubernetes is its need to know things in advance, before the setup. You need to tell it the addresses of all your nodes, which role each of them has, how many minions there are in the cluster and so on. With Swarm, we just bring up a node and tell it to join the network. Nothing needs to be set in advance since the information about the cluster is propagated through gossip.</p>\n<p>Set up might not be the most important difference between those tools. No matter which tool you choose, sooner or later everything will be up and running and you’ll forget any trouble you might have had during the process. You might say that we should not choose one tool over the other only because one is easier to set up. Fair enough. Let’s move on and speak about differences in how you define containers that should be run with those tools.</p>\n<h2 id=\"Running-Containers\"><a href=\"#Running-Containers\" class=\"headerlink\" title=\"Running Containers\"></a>Running Containers</h2><p>How do you define all the arguments needed for running Docker containers with Swarm? You don’t! Actually, you do but not in any form or way different from the way you were defining them before Swarm. If you are used to run containers through Docker CLI, you can continue using it with (almost) the same commands. If you prefer to use Docker Compose to run containers, you can continue using it to run them inside the Swarm cluster. Whichever way you’re used to run your containers, chances are that you can continue doing the same with Swarm but on a much larger scale.</p>\n<p>Kubernetes requires you to learn its CLI and configurations. You cannot use docker-compose.yml definitions you created earlier. You’ll have to create Kubernetes equivalents. You cannot use Docker CLI commands you learned before. You’ll have to learn Kubernetes CLI and, likely, make sure that the whole organization learns it as well.</p>\n<p>No matter which tool you choose for deployments to your cluster, chances are you are already familiar with Docker. You are probably already used to Docker Compose as a way to define arguments for the containers you’ll run. If you played with it for more than a few hours, you are using it as a substitute for Docker CLI. You run containers with it, tail their logs, scale them, and so on. On the other hand, you might be a hard-core Docker user who does not like Docker Compose and prefer running everything through Docker CLI or you might have your own bash scripts that run containers for you. No matter what you choose, it should work with Docker Swarm.</p>\n<p>If you adopt Kubernetes, be prepared to have multiple definitions of the same thing. You will need Docker Compose to run your containers outside Kubernetes. Developers will continue needing to run containers on their laptops, your staging environments might or might not be a big cluster, and so on. In other words, once you adopt Docker, Docker Compose or Docker CLI are unavoidable. You have to use them one way or another. Once you start using Kubernetes you will discover that all your Docker Compose definitions (or whatever else you might be using) need to be translated to Kubernetes way of describing things and, from there on, you will have to maintain both. With Kubernetes everything will have to be duplicated resulting in higher cost of maintenance. And it’s not only about duplicated configurations. Commands you’ll run outside of the cluster will be different from those inside the cluster. All those Docker commands you learned and love will have to get their Kubernetes equivalents inside the cluster.</p>\n<p>Guys behind Kubernetes are not trying to make your life miserable by forcing you to do things “their way”. The reason for such big differences is in a different approaches Swarm and Kubernetes are using to tackle the same problem. Swarm team decided to match their API with the one from Docker. As a result, we have (almost) full compatibility. Almost everything we can do with Docker we can do with Swarm as well only on a much larger scale. There’s nothing new to do, no configurations to be duplicated and nothing new to learn. No matter whether you use Docker CLI directly or go through Swarm, API is (more or less) the same. The negative side of that story is that if there is something you’d like Swarm to do and that something is not part of the Docker API, you’re in for a disappointment. Let us simplify this a bit. If you’re looking for a tool for deploying containers in a cluster that will use Docker API, Swarm is the solution. On the other hand, if you want a tool that will overcome Docker limitations, you should go with Kubernetes. It is power (Kubernetes) against simplicity (Swarm). Or, at least, that’s how it was until recently. But, I’m jumping ahead of myself.</p>\n<p>The only question unanswered is what those limitations are. Two of the major ones were networking and persistent volumes. Until Docker Swarm release 1.0 we could not link containers running on different servers. Actually, we still cannot link them but now we have multi-host networking to help us connect containers running on different servers. It is a very powerful feature. Kubernetes used flannel to accomplish networking and now, since the Docker release 1.9, that feature is available as part of Docker CLI.</p>\n<p>Another problem were persistent volumes. Docker introduced them in release 1.9. Until recently, if you persist a volume, that container was tied to the server that volume resides. It could not be moved around without, again, resorting to some nasty tricks like copying volume directory from one server to another. That in itself is a slow operation that defies the goals of tools like Swarm. Besides, even if you have time to copy a volume from one to the other server, you do not know where to copy since clustering tools tend to treat your whole datacenter as a single entity. You containers will be deployed to a location most suitable for them (least number of containers running, most CPUs or memory available, and so on). Now we have persistent volumes supported by Docker natively.</p>\n<p>Both networking and persistent volumes problems were one of the features supported by Kubernetes for quite some time and the reason why many were choosing it over Swarm. That advantage disappeared with Docker release 1.9.</p>\n<h2 id=\"The-Choice\"><a href=\"#The-Choice\" class=\"headerlink\" title=\"The Choice\"></a>The Choice</h2><p>When trying to make a choice between Docker Swarm and Kubernetes, think in following terms. Do you want to depend on Docker itself solving problems related to clustering. If you do, choose Swarm. If something is not supported by Docker it will be unlikely that it will be supported by Swarm since it relies on Docker API. On the other hand, if you want a tool that works around Docker limitations, Kubernetes might be the right one for you. Kubernetes was not built around Docker but is based on Google’s experience with containers. It is opinionated and tries to do things in its own way.</p>\n<p>The real question is whether Kubernetes’ way of doing things, which is quite different from how we use Docker, is overshadowed by advantages it gives. Or, should we place our bets into Docker itself and hope that it will solve those problems? Before you answer those questions, take a look at the release 1.9. We got persistent volumes and software networking. We also got unless-stopped restart policy that will manage our unwanted failures. Now there are three things less of a difference between Kubernetes and Swarm. Actually, these days there are very few advantages Kubernetes has over Swarm. On the other hand, Swarm uses Docker API meaning that you get to keep all your commands and Docker Compose configurations. Personally, I’m placing my bets on Docker engine getting improvements and Docker Swarm running on top of it. The difference between the two is very small. Both are production ready but Swarm is easier to set up, easier to use and we get to keep everything we built before moving to the cluster; there is no duplication between cluster and non-cluster configurations.</p>\n<p>My recommendation is to go with Docker Swarm. Kubernetes is too opinionated, hard to set up, too different from Docker CLI/API and at the same time it doesn’t have real advantages over Swarm since the Docker release 1.9. That doesn’t mean that there are no features available in Kubernetes that are not supported by Swarm. There are feature differences in both directions. However, those differences are, in my opinion, not major ones and the gap is getting smaller with each Docker release. Actually, for many use cases there is no gap at all while Docker Swarm is easier to set up, learn and use.</p>\n","site":{"data":{}},"excerpt":"<p>Kubernetes and Docker Swarm are probably two most commonly used tools to deploy containers inside a cluster. Both are created as helper tools that can be used to manage a cluster of containers and treat all servers as a single unit. However, they differ greatly in their approach.<br>","more":"</p>\n<p><a href=\"https://www.oschina.net/translate/docker-clustering-tools-compared-kubernetes-vs-docker-swarm?cmp\" target=\"_blank\" rel=\"noopener\">文章转载</a></p>\n<p>Kubernetes and Docker Swarm are probably two most commonly used tools to deploy containers inside a cluster. Both are created as helper tools that can be used to manage a cluster of containers and treat all servers as a single unit. However, they differ greatly in their approach.</p>\n<h1 id=\"Kubernetes\"><a href=\"#Kubernetes\" class=\"headerlink\" title=\"Kubernetes\"></a>Kubernetes</h1><p>Kubernetes is based on Google’s experience of many years working with Linux containers. It is, in a way, a replica of what Google has been doing for a long time but, this time, adapted to Docker. That approach is great in many ways, most important being that they used their experience from the start. If you started using Kubernetes around Docker version 1.0 (or earlier), the experience with Kubernetes was great. It solved many of the problems that Docker itself had. We could mount persistent volumes that would allow us to move containers without loosing data, it used flannel to create networking between containers, it has load balancer integrated, it uses etcd for service discovery, and so on. However, Kubernetes comes at a cost. It uses a different CLI, different API and different YAML definitions. In other words, you cannot use Docker CLI nor you can use Docker Compose to define containers. Everything needs to be done from scratch exclusively for Kubernetes. It’s as if the tool was not written for Docker (which is partly true). Kubernetes brought clustering to a new level but at the expense of usability and steep learning curve.</p>\n<h1 id=\"Docker-Swarm\"><a href=\"#Docker-Swarm\" class=\"headerlink\" title=\"Docker Swarm\"></a>Docker Swarm</h1><p>Docker Swarm took a different approach. It is a native clustering for Docker. The best part is that it exposes standard Docker API meaning that any tool that you used to communicate with Docker (Docker CLI, Docker Compose, Dokku, Krane, and so on) can work equally well with Docker Swarm. That in itself is both an advantage and a disadvantage at the same time. Being able to use familiar tools of your own choosing is great but for the same reasons we are bound by the limitations of Docker API. If the API doesn’t support something, there is no way around it through Swarm API and some clever tricks need to be performed.</p>\n<p>We’ll explore those two tools in more details based on their setup and features they provide for running containers in a cluster.</p>\n<h2 id=\"Setting-Up\"><a href=\"#Setting-Up\" class=\"headerlink\" title=\"Setting Up\"></a>Setting Up</h2><p>Setting up Docker Swarm is easy, straightforward and flexible. All we have to do is install one of the service discovery tools and run the swarm container on all nodes. Since the distribution itself is packed as a Docker container, it works in the same way no matter the operating system. We run the swarm container, expose a port and inform it about the address of the service discovery. It could hardly be easier than that. We can even start using it without any service discovery tool, see whether we like it and when our usage of it becomes more serious, add etcd, Consul or some of the other supported tools.</p>\n<p>Kubernetes setup is quite more complicated and obfuscated. Installation instructions differ from OS to OS and provider to provider. Each OS or a hosting provider comes with its own set of instructions each of them having a separate maintenance team with a separate set of problems. As example, if you choose to try it out with Vagrant, you are stuck with Fedora. That does not mean that you cannot run it with Vagrant and, let’s say, Ubuntu or CoreOS. You can, but you need to start searching for instructions outside the official Kubernetes Getting Started page. Whatever your needs are, it’s likely that the community has the solution but you still need to spend some time searching for it and hoping that it works from the first attempt. The bigger problem is that the installation relies on a bash script. That would not be a big deal in itself if we would not live in the era where configuration management is a must. We might not want to run a script but make Kubernetes be part of our Puppet, Chef or Ansible definitions. Again, this can be overcome as well. You can find Ansible playbooks for running Kubernetes or you can write your own. None of those issues are a big problem but, when compared with Swarm, they are a bit painful. With Docker we were supposed not to have installation instructions (aside from a few docker run arguments). We were supposed to run containers. Swarm fulfils that promise and Kubernetes doesn’t.</p>\n<p>While some might not care about which discovery tool is used, I love the simplicity behind Swarm and the logic “batteries included but removable”. Everything works out-of-the-box but we still have the option to substitute one component with the other. Unlike Swarm, Kubernetes is opinionated tool. You need to live with the choices it made for you. If you want to use Kubernetes, you have to use etcd. I’m not trying to say that etcd is bad (quite contrary) but if you prefer, for example, to use Consul you’re in a very complicated situation and would need to use one for Kubernetes and the other for the rest of your service discovery needs. Another thing I dislike about Kubernetes is its need to know things in advance, before the setup. You need to tell it the addresses of all your nodes, which role each of them has, how many minions there are in the cluster and so on. With Swarm, we just bring up a node and tell it to join the network. Nothing needs to be set in advance since the information about the cluster is propagated through gossip.</p>\n<p>Set up might not be the most important difference between those tools. No matter which tool you choose, sooner or later everything will be up and running and you’ll forget any trouble you might have had during the process. You might say that we should not choose one tool over the other only because one is easier to set up. Fair enough. Let’s move on and speak about differences in how you define containers that should be run with those tools.</p>\n<h2 id=\"Running-Containers\"><a href=\"#Running-Containers\" class=\"headerlink\" title=\"Running Containers\"></a>Running Containers</h2><p>How do you define all the arguments needed for running Docker containers with Swarm? You don’t! Actually, you do but not in any form or way different from the way you were defining them before Swarm. If you are used to run containers through Docker CLI, you can continue using it with (almost) the same commands. If you prefer to use Docker Compose to run containers, you can continue using it to run them inside the Swarm cluster. Whichever way you’re used to run your containers, chances are that you can continue doing the same with Swarm but on a much larger scale.</p>\n<p>Kubernetes requires you to learn its CLI and configurations. You cannot use docker-compose.yml definitions you created earlier. You’ll have to create Kubernetes equivalents. You cannot use Docker CLI commands you learned before. You’ll have to learn Kubernetes CLI and, likely, make sure that the whole organization learns it as well.</p>\n<p>No matter which tool you choose for deployments to your cluster, chances are you are already familiar with Docker. You are probably already used to Docker Compose as a way to define arguments for the containers you’ll run. If you played with it for more than a few hours, you are using it as a substitute for Docker CLI. You run containers with it, tail their logs, scale them, and so on. On the other hand, you might be a hard-core Docker user who does not like Docker Compose and prefer running everything through Docker CLI or you might have your own bash scripts that run containers for you. No matter what you choose, it should work with Docker Swarm.</p>\n<p>If you adopt Kubernetes, be prepared to have multiple definitions of the same thing. You will need Docker Compose to run your containers outside Kubernetes. Developers will continue needing to run containers on their laptops, your staging environments might or might not be a big cluster, and so on. In other words, once you adopt Docker, Docker Compose or Docker CLI are unavoidable. You have to use them one way or another. Once you start using Kubernetes you will discover that all your Docker Compose definitions (or whatever else you might be using) need to be translated to Kubernetes way of describing things and, from there on, you will have to maintain both. With Kubernetes everything will have to be duplicated resulting in higher cost of maintenance. And it’s not only about duplicated configurations. Commands you’ll run outside of the cluster will be different from those inside the cluster. All those Docker commands you learned and love will have to get their Kubernetes equivalents inside the cluster.</p>\n<p>Guys behind Kubernetes are not trying to make your life miserable by forcing you to do things “their way”. The reason for such big differences is in a different approaches Swarm and Kubernetes are using to tackle the same problem. Swarm team decided to match their API with the one from Docker. As a result, we have (almost) full compatibility. Almost everything we can do with Docker we can do with Swarm as well only on a much larger scale. There’s nothing new to do, no configurations to be duplicated and nothing new to learn. No matter whether you use Docker CLI directly or go through Swarm, API is (more or less) the same. The negative side of that story is that if there is something you’d like Swarm to do and that something is not part of the Docker API, you’re in for a disappointment. Let us simplify this a bit. If you’re looking for a tool for deploying containers in a cluster that will use Docker API, Swarm is the solution. On the other hand, if you want a tool that will overcome Docker limitations, you should go with Kubernetes. It is power (Kubernetes) against simplicity (Swarm). Or, at least, that’s how it was until recently. But, I’m jumping ahead of myself.</p>\n<p>The only question unanswered is what those limitations are. Two of the major ones were networking and persistent volumes. Until Docker Swarm release 1.0 we could not link containers running on different servers. Actually, we still cannot link them but now we have multi-host networking to help us connect containers running on different servers. It is a very powerful feature. Kubernetes used flannel to accomplish networking and now, since the Docker release 1.9, that feature is available as part of Docker CLI.</p>\n<p>Another problem were persistent volumes. Docker introduced them in release 1.9. Until recently, if you persist a volume, that container was tied to the server that volume resides. It could not be moved around without, again, resorting to some nasty tricks like copying volume directory from one server to another. That in itself is a slow operation that defies the goals of tools like Swarm. Besides, even if you have time to copy a volume from one to the other server, you do not know where to copy since clustering tools tend to treat your whole datacenter as a single entity. You containers will be deployed to a location most suitable for them (least number of containers running, most CPUs or memory available, and so on). Now we have persistent volumes supported by Docker natively.</p>\n<p>Both networking and persistent volumes problems were one of the features supported by Kubernetes for quite some time and the reason why many were choosing it over Swarm. That advantage disappeared with Docker release 1.9.</p>\n<h2 id=\"The-Choice\"><a href=\"#The-Choice\" class=\"headerlink\" title=\"The Choice\"></a>The Choice</h2><p>When trying to make a choice between Docker Swarm and Kubernetes, think in following terms. Do you want to depend on Docker itself solving problems related to clustering. If you do, choose Swarm. If something is not supported by Docker it will be unlikely that it will be supported by Swarm since it relies on Docker API. On the other hand, if you want a tool that works around Docker limitations, Kubernetes might be the right one for you. Kubernetes was not built around Docker but is based on Google’s experience with containers. It is opinionated and tries to do things in its own way.</p>\n<p>The real question is whether Kubernetes’ way of doing things, which is quite different from how we use Docker, is overshadowed by advantages it gives. Or, should we place our bets into Docker itself and hope that it will solve those problems? Before you answer those questions, take a look at the release 1.9. We got persistent volumes and software networking. We also got unless-stopped restart policy that will manage our unwanted failures. Now there are three things less of a difference between Kubernetes and Swarm. Actually, these days there are very few advantages Kubernetes has over Swarm. On the other hand, Swarm uses Docker API meaning that you get to keep all your commands and Docker Compose configurations. Personally, I’m placing my bets on Docker engine getting improvements and Docker Swarm running on top of it. The difference between the two is very small. Both are production ready but Swarm is easier to set up, easier to use and we get to keep everything we built before moving to the cluster; there is no duplication between cluster and non-cluster configurations.</p>\n<p>My recommendation is to go with Docker Swarm. Kubernetes is too opinionated, hard to set up, too different from Docker CLI/API and at the same time it doesn’t have real advantages over Swarm since the Docker release 1.9. That doesn’t mean that there are no features available in Kubernetes that are not supported by Swarm. There are feature differences in both directions. However, those differences are, in my opinion, not major ones and the gap is getting smaller with each Docker release. Actually, for many use cases there is no gap at all while Docker Swarm is easier to set up, learn and use.</p>"},{"title":"When to Use What: REST, GraphQL, Webhooks, & gRPC","date":"2019-07-05T04:00:00.000Z","comments":1,"_content":"\nWith all of the love and proclamations about REST, we can sometimes forget that it’s simply one of many options. REST is a very good standard for a wide variety of APIs, but there are other `API design styles` for more nuanced scenarios.\n\nTo help API developers make sense of which API design style to use and for what situation, let’s look at `REST` within the context of three other options – `gRPC`, `GraphQL`, and `Webhooks`. We’ll offer `real world examples` of REST, GraphQL, gRPC, and Webhooks in practice, and analyze their strengths and weaknesses to highlight what makes each option a good choice.\n\n <!-- more -->\n\n[文章转载](https://nordicapis.com/when-to-use-what-rest-graphql-webhooks-grpc/)\n\n# REST\n\n`REST` is probably the most commonly known item in this piece, as it has become very common amongst web APIs. REST as a concept was first defined by Roy Fielding in his doctoral dissertation in the year 2000. He laid out the groundwork for an architectural system defined by a set of constraints for web services, using a stateless design ethos and a standardized approach to building web APIs.\n\nREST by its very nature is stateless, and is built in such a way that any web service that is compliant with REST can interact in a stateless manner with textual resource representations. These operations are usually defined using GET, POST, PUT, and other HTTP methodologies as a matter of standardized interactions.\n\nOne of the chief properties of REST is the fact that it is `hypermedia` rich. Hypermedia and REST are so closely reliant, in fact, that Roy Fielding has stated that APIs are technically not RESTful if they do not support hypermedia. This ultimately means that in a REST API, the client and server are `loosely coupled`, which grants both clients and servers extreme amounts of freedom in resource manipulation. Due to this, rapid iteration, server evolution, resource provision elasticity, and other such elements are enabled and supported.\n\nREST supports a lot more than we’ll dive into here, but with a `layered architecture`, efficient `caching`, and high scalability, REST is a highly discoverable and highly morphable solution to a multitude of issues and constraints. The value of having standardized `HTTP` verbiage is hard to understate, providing context to the end user, and standardizing most interactions. All told, REST is a very efficient, effective, and powerful solution for the modern microservice API industry.\n\n> More on REST: [Is REST Still a Relevant API Style?](https://nordicapis.com/is-rest-still-a-relevant-api-style/)\n\n## Real-World Example: PayPal\n\nOne example of this type of API is the PayPal REST API. PayPal has a strong core business function — provide the integrated systems for payment processing. Accordingly, their APIs have to make this easy. Resources must be easily identifiable, calls must be understood with and without context, and most importantly, a variety of media must be supported in order to effectively handle a wide range of payment types and methodologies.\n\nTo this end, the PayPal API is designed to be easy to understand and easy to integrate with. Look at this example, taken from their documentation, in which a call lists a range of activities within the API:\n\n```bash\ncurl -v -X GET https://api.sandbox.paypal.com/v1/activities/activities?start_time=2012-01-01T00:00:01.000Z&amp;end_time=2014-10-01T23:59:59.999Z&amp;page_size=10 \n-H \"Content-Type: application/json\" \n-H \"Authorization: Bearer Access-Token\"\n```\n\nHere, we can see the hallmarks of an effective RESTful implementation. We can see a standard HTTP verbiage form in GET doing exactly what GET should do — retrieve a resource. The URI in this case is well defined as “activities”, and allows for specification of a time zone and in-line request constraints for page size. Additionally, the return is in a specified, known, hypermedia-supporting format. This is REST in a nutshell, and is an example of a use case in which a lightweight, stateless system is exactly what is needed to deliver the resources to the end client.\n\n# gRPC\n\nWhile REST is decidedly modern, `gRPC` is actually a new take on an old approach known as `RPC`, or Remote Procedure Call. RPC is a method for executing a procedure on a remote server, somewhat akin to running a program on a friend’s computer miles from your workstation. This has its own benefits and drawbacks – these very drawbacks were key in the development and implementation of REST, in fact, alongside other issues inherent in systems like SOAP.\n\nA key difference between gRPC and REST is the way in which RPC defines its contract negotiation. Whereas REST defines its interactions through terms standardized in its requests, RPC functions upon an idea of contracts, in which the negotiation is defined and constricted by the client-server relationship rather than the architecture itself. RPC gives much of the power (and responsibility) to the client for execution, while offloading much of the handling and computation to the remote server hosting the resource.\n\nFor this reason, RPC is very popular for IoT devices and other solutions requiring custom contracted communications for low-power devices. REST is often seen as being overly demanding of resources, whereas RPC can be used even in `extremely low-power situations`. gRPC is a further evolution on the RPC concept, and adds a wide range of features.\n\nThe biggest feature added by gRPC is the concept of `protobufs`. Protobufs are language and platform neutral systems used to serialize data, meaning that these communications can be efficiently `serialized` and communicated in an effective manner. Additionally, gRPC has a very effective and powerful authentication system that utilizes SSL/TLS through Google’s token-based system. Lastly, gRPC is also `open source`, meaning that the system can be audited, iterated, forked, and more.\n\n> More on gRPC: [Exploring The gRPC Framework for Building Microservices](https://nordicapis.com/exploring-the-grpc-framework-for-building-microservices/)\n\n## Example APIs – Google Cloud, Bugsnag\n\nIt’s difficult to demonstrate gRPC in the wild — this comes largely from the fact that, [according to the gRPC documentation itself](https://grpc.io/docs/), gRPC is typically used in the “last mile of computing.” In other words, gRPC is usually the end system driving and facilitating communication between disparate services and APIs.\n\nNonetheless, the gRPC documentation cites that, due to its transportability, gRPC is used within the mobile computing space, as well as an intermediary and processing system for data from the `Google Cloud BigTable Client API`, the `Google Cloud PubSub API`, and the `Google Cloud Speech API`. This makes sense, as the use of standard transport mechanisms and the relatively agile data load gRPC offers can be best utilized for streamlined, active, and repetitive communications.\n\nAnother example of gRPC in production can be found with [Bugsnag](https://blog.bugsnag.com/using-grpc-in-production/), a stability monitoring service. The Bugsnag engineering team found the initial design process smoother than building RESTfully. Eventually, however they found that the “barrier to entry for developing and testing gRPC was quite high,” due to a lack of [tutorials and best practices](https://github.com/grpc-ecosystem/awesome-grpc). Overall, the latency improvements and decreased transport costs made using gRPC a huge success for Bugsnag.\n\n# GraphQL\n\nGraphQL’s approach to the idea of client-server relationships is unique amongst these options, and is somewhat of a reversal of the traditional relationship. With GraphQL, the client determines what data they want, how they want it, and in what format they want it in. This is a reversal of the classic dictation from the server to the client, and allows for a lot of extended functionality. GraphQL is starkly different from REST, which is more an architecture than anything else, and from RPC, in which the contract is negotiated by client and server but largely defined by the resources themselves\n\nIt should be noted that a huge benefit of GraphQL is the fact that, by default, it typically delivers the smallest possible request. REST, on the other hand, typically sends everything it has all at once by default – the most complete request, in other words. Because of this, GraphQL can be more useful in specific use cases where a needed data type is well-defined, and a low data package is preferred.\n\nThat being said, GraphQL’s benefits are often somewhat oversold. The idea that you never have to version is derived from deprecating fields and replacing them with new ones, which is what REST evolution is concerned with. Thus, you shouldn’t think of GraphQL as “better” than REST or the “next step”, as it is often framed, but rather as an alternative option for a “new relationship between client and data”.\n\n## Example API – GitHub\n\nOne example of GraphQL usage can be found in the GitHub API GraphQL API. While the initial RESTful API was powerful, and did what was requested, the GitHub team found that the REST API was inflexible. Speaking on the problem, the team said that the API responses “simultaneously sent too much data and didn’t include data that consumers needed,” which is the classic pain point that caused the development of GraphQL in the first place.\n\nAccordingly, GitHub needed a way to deliver their content to requesters without requiring multiple distinct, complex calls. They needed to allow users to morph their requests, stating what exactly they needed. And most importantly, they needed the API to still be capable of handling the basic requests that the bulk of their REST API already handled efficiently. To that end, Github added support for GraphQL, delivering these key functionalities.\n\n# Webhooks\n\nWhile GraphQL is an option to extend an API, and gRPC is a re-tooling to a classical approach, `Webhooks` are an entirely different approach to resource provision than anything discussed here. A Webhook is relatively simple – simply put, it’s an HTTP POST that is triggered when an event occurs.\n\nThis is a reversal of the classic client-server relationship — in the classic approach, the client requests data from the server, and the server then provisions that data for the client. Under [the Webhook paradigm](https://sendgrid.com/blog/whats-webhook/), the server updates a provisioned resource, and this then automatically sent to the client as an update. The server pushes this data. Thereby, the client becomes not a requester, but a passive receiver.\n\nUltimately, this reversal can be used to facilitate a lot of communication that would otherwise require more complex requests and constant polling on the remote server. By simply receiving the resource without requesting it directly, you can update remote codebases, distribute resources easily, and even integrate into existing systems to update endpoints and other data concerning the API proper.\n\n> Related: WebHooks vs WebSub: [Which Is Better For Real-Time Event Streaming?](https://nordicapis.com/webhooks-vs-websub-which-one-is-better-to-stream-your-events-in-real-time/)\n\n## Example API – Foursquare (and SendGrid)\n\nWebhooks are a relatively simple and effective offering, and thus, their implementation is equally simple and effective. The [Foursquare method](https://developer.foursquare.com/docs) of using a webhook is essentially a flow in which the user “checks in,” prompting a webhook to push updated content to other systems and portals. In this way, the user can directly interact with the location that they are visiting while alerting others as to the nature of their relationship with the location via a client-resource analogy.\n\nAs you get further into webhooks as an implementation, you’ll often see more complex integrations. For example, SendGrid uses webhooks to send [event data updates](https://sendgrid.com/docs/API_Reference/Event_Webhook/event.html) to subscribing clients, alerting them to changes to a large number of variables. SendGrid even implements a hybridized webhook method to [parse emails](https://sendgrid.com/docs/API_Reference/Webhooks/inbound_email.html)!\n\n# Comparing Use Cases For REST, GraphQL, Webhooks, and gRPC\n\nAs you can plainly see, none of these options are truly “better” than the others, but instead fit into unique interaction scenarios. We can summarize these use cases as follows:\n\n* `REST`: A stateless architecture for data transfer that is dependent on hypermedia. REST can tie together a wide range of resources that might be requested in a variety of formats for different purposes. REST is fundamentally concerned with stateless resource management, so it’s best used in such situations. Systems requiring rapid iteration and standardized HTTP verbiage will find REST best suited for their purposes.\n\n* `gRPC`: A nimble and lightweight system for requesting data. gRPC, on the other hand, is best used when a system requires a set amount of data or processing routinely, and in which the requester is either low power or resource-jealous. The IoT is a great example of this.\n\n* `GraphQL`: An approach wherein the user defines the expected data and format of that data. GraphQL is from Facebook, and that pedigree demonstrates its use case well — situations in which the requester needs the data in a specific format for a specific use. In those cases, those data formats and the relations between them are vitally important, and no other solution provides the same level of interconnected provision of data.\n\n* `Webhooks`: Data updates to be served automatically, rather than requested. Finally, Webhooks are best used when the API in question primarily updates clients. While such APIs can also have other functions, even RESTful ones, the primary use of a Webhook microservice should be to update clients and provide updated, provisioned data upon the creation of the new, updated resource.\n\nChoosing amongst these specific options is really a matter of aligning your business functions with the appropriate approach, and ensuring that the systems in place respond within the given parameters.\n\n# Conclusion\n\nChoosing a design approach is perhaps the most important decision made in early API development. It both structures the API, and impacts how the end user will interact with the resources behind the API itself. In other words, this is not just a choice of approach for the developer — this is a choice for how you are going to establish your relationship with your consumers.\n\nUltimately, the choice of which solution you go with comes down to what fits your particular use case. Each solution has a very specific purpose, and as such, it’s not fair to say one is better than the other. It is, however, more accurate to say that some are better at doing their core functions than the other solutions — such as the case of many RESTful solutions attempting to mirror RPC functionality.\n\nOnly you can determine which solution is best given your codebase. So, do your research and choose the correct approach from the get-go to reap some serious benefits. Your code will be leaner, more responsive, and tailored to the situation at hand.","source":"_posts/2019-07-05-REST,GraphQL,Webhooks,gRPC.md","raw":"---\ntitle: \"When to Use What: REST, GraphQL, Webhooks, & gRPC\"\ndate: 2019-07-05\ncomments: true\ncategories: 容器\ntags:\n    - watch\n---\n\nWith all of the love and proclamations about REST, we can sometimes forget that it’s simply one of many options. REST is a very good standard for a wide variety of APIs, but there are other `API design styles` for more nuanced scenarios.\n\nTo help API developers make sense of which API design style to use and for what situation, let’s look at `REST` within the context of three other options – `gRPC`, `GraphQL`, and `Webhooks`. We’ll offer `real world examples` of REST, GraphQL, gRPC, and Webhooks in practice, and analyze their strengths and weaknesses to highlight what makes each option a good choice.\n\n <!-- more -->\n\n[文章转载](https://nordicapis.com/when-to-use-what-rest-graphql-webhooks-grpc/)\n\n# REST\n\n`REST` is probably the most commonly known item in this piece, as it has become very common amongst web APIs. REST as a concept was first defined by Roy Fielding in his doctoral dissertation in the year 2000. He laid out the groundwork for an architectural system defined by a set of constraints for web services, using a stateless design ethos and a standardized approach to building web APIs.\n\nREST by its very nature is stateless, and is built in such a way that any web service that is compliant with REST can interact in a stateless manner with textual resource representations. These operations are usually defined using GET, POST, PUT, and other HTTP methodologies as a matter of standardized interactions.\n\nOne of the chief properties of REST is the fact that it is `hypermedia` rich. Hypermedia and REST are so closely reliant, in fact, that Roy Fielding has stated that APIs are technically not RESTful if they do not support hypermedia. This ultimately means that in a REST API, the client and server are `loosely coupled`, which grants both clients and servers extreme amounts of freedom in resource manipulation. Due to this, rapid iteration, server evolution, resource provision elasticity, and other such elements are enabled and supported.\n\nREST supports a lot more than we’ll dive into here, but with a `layered architecture`, efficient `caching`, and high scalability, REST is a highly discoverable and highly morphable solution to a multitude of issues and constraints. The value of having standardized `HTTP` verbiage is hard to understate, providing context to the end user, and standardizing most interactions. All told, REST is a very efficient, effective, and powerful solution for the modern microservice API industry.\n\n> More on REST: [Is REST Still a Relevant API Style?](https://nordicapis.com/is-rest-still-a-relevant-api-style/)\n\n## Real-World Example: PayPal\n\nOne example of this type of API is the PayPal REST API. PayPal has a strong core business function — provide the integrated systems for payment processing. Accordingly, their APIs have to make this easy. Resources must be easily identifiable, calls must be understood with and without context, and most importantly, a variety of media must be supported in order to effectively handle a wide range of payment types and methodologies.\n\nTo this end, the PayPal API is designed to be easy to understand and easy to integrate with. Look at this example, taken from their documentation, in which a call lists a range of activities within the API:\n\n```bash\ncurl -v -X GET https://api.sandbox.paypal.com/v1/activities/activities?start_time=2012-01-01T00:00:01.000Z&amp;end_time=2014-10-01T23:59:59.999Z&amp;page_size=10 \n-H \"Content-Type: application/json\" \n-H \"Authorization: Bearer Access-Token\"\n```\n\nHere, we can see the hallmarks of an effective RESTful implementation. We can see a standard HTTP verbiage form in GET doing exactly what GET should do — retrieve a resource. The URI in this case is well defined as “activities”, and allows for specification of a time zone and in-line request constraints for page size. Additionally, the return is in a specified, known, hypermedia-supporting format. This is REST in a nutshell, and is an example of a use case in which a lightweight, stateless system is exactly what is needed to deliver the resources to the end client.\n\n# gRPC\n\nWhile REST is decidedly modern, `gRPC` is actually a new take on an old approach known as `RPC`, or Remote Procedure Call. RPC is a method for executing a procedure on a remote server, somewhat akin to running a program on a friend’s computer miles from your workstation. This has its own benefits and drawbacks – these very drawbacks were key in the development and implementation of REST, in fact, alongside other issues inherent in systems like SOAP.\n\nA key difference between gRPC and REST is the way in which RPC defines its contract negotiation. Whereas REST defines its interactions through terms standardized in its requests, RPC functions upon an idea of contracts, in which the negotiation is defined and constricted by the client-server relationship rather than the architecture itself. RPC gives much of the power (and responsibility) to the client for execution, while offloading much of the handling and computation to the remote server hosting the resource.\n\nFor this reason, RPC is very popular for IoT devices and other solutions requiring custom contracted communications for low-power devices. REST is often seen as being overly demanding of resources, whereas RPC can be used even in `extremely low-power situations`. gRPC is a further evolution on the RPC concept, and adds a wide range of features.\n\nThe biggest feature added by gRPC is the concept of `protobufs`. Protobufs are language and platform neutral systems used to serialize data, meaning that these communications can be efficiently `serialized` and communicated in an effective manner. Additionally, gRPC has a very effective and powerful authentication system that utilizes SSL/TLS through Google’s token-based system. Lastly, gRPC is also `open source`, meaning that the system can be audited, iterated, forked, and more.\n\n> More on gRPC: [Exploring The gRPC Framework for Building Microservices](https://nordicapis.com/exploring-the-grpc-framework-for-building-microservices/)\n\n## Example APIs – Google Cloud, Bugsnag\n\nIt’s difficult to demonstrate gRPC in the wild — this comes largely from the fact that, [according to the gRPC documentation itself](https://grpc.io/docs/), gRPC is typically used in the “last mile of computing.” In other words, gRPC is usually the end system driving and facilitating communication between disparate services and APIs.\n\nNonetheless, the gRPC documentation cites that, due to its transportability, gRPC is used within the mobile computing space, as well as an intermediary and processing system for data from the `Google Cloud BigTable Client API`, the `Google Cloud PubSub API`, and the `Google Cloud Speech API`. This makes sense, as the use of standard transport mechanisms and the relatively agile data load gRPC offers can be best utilized for streamlined, active, and repetitive communications.\n\nAnother example of gRPC in production can be found with [Bugsnag](https://blog.bugsnag.com/using-grpc-in-production/), a stability monitoring service. The Bugsnag engineering team found the initial design process smoother than building RESTfully. Eventually, however they found that the “barrier to entry for developing and testing gRPC was quite high,” due to a lack of [tutorials and best practices](https://github.com/grpc-ecosystem/awesome-grpc). Overall, the latency improvements and decreased transport costs made using gRPC a huge success for Bugsnag.\n\n# GraphQL\n\nGraphQL’s approach to the idea of client-server relationships is unique amongst these options, and is somewhat of a reversal of the traditional relationship. With GraphQL, the client determines what data they want, how they want it, and in what format they want it in. This is a reversal of the classic dictation from the server to the client, and allows for a lot of extended functionality. GraphQL is starkly different from REST, which is more an architecture than anything else, and from RPC, in which the contract is negotiated by client and server but largely defined by the resources themselves\n\nIt should be noted that a huge benefit of GraphQL is the fact that, by default, it typically delivers the smallest possible request. REST, on the other hand, typically sends everything it has all at once by default – the most complete request, in other words. Because of this, GraphQL can be more useful in specific use cases where a needed data type is well-defined, and a low data package is preferred.\n\nThat being said, GraphQL’s benefits are often somewhat oversold. The idea that you never have to version is derived from deprecating fields and replacing them with new ones, which is what REST evolution is concerned with. Thus, you shouldn’t think of GraphQL as “better” than REST or the “next step”, as it is often framed, but rather as an alternative option for a “new relationship between client and data”.\n\n## Example API – GitHub\n\nOne example of GraphQL usage can be found in the GitHub API GraphQL API. While the initial RESTful API was powerful, and did what was requested, the GitHub team found that the REST API was inflexible. Speaking on the problem, the team said that the API responses “simultaneously sent too much data and didn’t include data that consumers needed,” which is the classic pain point that caused the development of GraphQL in the first place.\n\nAccordingly, GitHub needed a way to deliver their content to requesters without requiring multiple distinct, complex calls. They needed to allow users to morph their requests, stating what exactly they needed. And most importantly, they needed the API to still be capable of handling the basic requests that the bulk of their REST API already handled efficiently. To that end, Github added support for GraphQL, delivering these key functionalities.\n\n# Webhooks\n\nWhile GraphQL is an option to extend an API, and gRPC is a re-tooling to a classical approach, `Webhooks` are an entirely different approach to resource provision than anything discussed here. A Webhook is relatively simple – simply put, it’s an HTTP POST that is triggered when an event occurs.\n\nThis is a reversal of the classic client-server relationship — in the classic approach, the client requests data from the server, and the server then provisions that data for the client. Under [the Webhook paradigm](https://sendgrid.com/blog/whats-webhook/), the server updates a provisioned resource, and this then automatically sent to the client as an update. The server pushes this data. Thereby, the client becomes not a requester, but a passive receiver.\n\nUltimately, this reversal can be used to facilitate a lot of communication that would otherwise require more complex requests and constant polling on the remote server. By simply receiving the resource without requesting it directly, you can update remote codebases, distribute resources easily, and even integrate into existing systems to update endpoints and other data concerning the API proper.\n\n> Related: WebHooks vs WebSub: [Which Is Better For Real-Time Event Streaming?](https://nordicapis.com/webhooks-vs-websub-which-one-is-better-to-stream-your-events-in-real-time/)\n\n## Example API – Foursquare (and SendGrid)\n\nWebhooks are a relatively simple and effective offering, and thus, their implementation is equally simple and effective. The [Foursquare method](https://developer.foursquare.com/docs) of using a webhook is essentially a flow in which the user “checks in,” prompting a webhook to push updated content to other systems and portals. In this way, the user can directly interact with the location that they are visiting while alerting others as to the nature of their relationship with the location via a client-resource analogy.\n\nAs you get further into webhooks as an implementation, you’ll often see more complex integrations. For example, SendGrid uses webhooks to send [event data updates](https://sendgrid.com/docs/API_Reference/Event_Webhook/event.html) to subscribing clients, alerting them to changes to a large number of variables. SendGrid even implements a hybridized webhook method to [parse emails](https://sendgrid.com/docs/API_Reference/Webhooks/inbound_email.html)!\n\n# Comparing Use Cases For REST, GraphQL, Webhooks, and gRPC\n\nAs you can plainly see, none of these options are truly “better” than the others, but instead fit into unique interaction scenarios. We can summarize these use cases as follows:\n\n* `REST`: A stateless architecture for data transfer that is dependent on hypermedia. REST can tie together a wide range of resources that might be requested in a variety of formats for different purposes. REST is fundamentally concerned with stateless resource management, so it’s best used in such situations. Systems requiring rapid iteration and standardized HTTP verbiage will find REST best suited for their purposes.\n\n* `gRPC`: A nimble and lightweight system for requesting data. gRPC, on the other hand, is best used when a system requires a set amount of data or processing routinely, and in which the requester is either low power or resource-jealous. The IoT is a great example of this.\n\n* `GraphQL`: An approach wherein the user defines the expected data and format of that data. GraphQL is from Facebook, and that pedigree demonstrates its use case well — situations in which the requester needs the data in a specific format for a specific use. In those cases, those data formats and the relations between them are vitally important, and no other solution provides the same level of interconnected provision of data.\n\n* `Webhooks`: Data updates to be served automatically, rather than requested. Finally, Webhooks are best used when the API in question primarily updates clients. While such APIs can also have other functions, even RESTful ones, the primary use of a Webhook microservice should be to update clients and provide updated, provisioned data upon the creation of the new, updated resource.\n\nChoosing amongst these specific options is really a matter of aligning your business functions with the appropriate approach, and ensuring that the systems in place respond within the given parameters.\n\n# Conclusion\n\nChoosing a design approach is perhaps the most important decision made in early API development. It both structures the API, and impacts how the end user will interact with the resources behind the API itself. In other words, this is not just a choice of approach for the developer — this is a choice for how you are going to establish your relationship with your consumers.\n\nUltimately, the choice of which solution you go with comes down to what fits your particular use case. Each solution has a very specific purpose, and as such, it’s not fair to say one is better than the other. It is, however, more accurate to say that some are better at doing their core functions than the other solutions — such as the case of many RESTful solutions attempting to mirror RPC functionality.\n\nOnly you can determine which solution is best given your codebase. So, do your research and choose the correct approach from the get-go to reap some serious benefits. Your code will be leaner, more responsive, and tailored to the situation at hand.","slug":"2019-07-05-REST,GraphQL,Webhooks,gRPC","published":1,"updated":"2019-07-05T07:55:55.000Z","layout":"post","photos":[],"link":"","_id":"cjypn1qly005gy4rbima2qm3h","content":"<p>With all of the love and proclamations about REST, we can sometimes forget that it’s simply one of many options. REST is a very good standard for a wide variety of APIs, but there are other <code>API design styles</code> for more nuanced scenarios.</p>\n<p>To help API developers make sense of which API design style to use and for what situation, let’s look at <code>REST</code> within the context of three other options – <code>gRPC</code>, <code>GraphQL</code>, and <code>Webhooks</code>. We’ll offer <code>real world examples</code> of REST, GraphQL, gRPC, and Webhooks in practice, and analyze their strengths and weaknesses to highlight what makes each option a good choice.</p>\n <a id=\"more\"></a>\n\n<p><a href=\"https://nordicapis.com/when-to-use-what-rest-graphql-webhooks-grpc/\" target=\"_blank\" rel=\"noopener\">文章转载</a></p>\n<h1 id=\"REST\"><a href=\"#REST\" class=\"headerlink\" title=\"REST\"></a>REST</h1><p><code>REST</code> is probably the most commonly known item in this piece, as it has become very common amongst web APIs. REST as a concept was first defined by Roy Fielding in his doctoral dissertation in the year 2000. He laid out the groundwork for an architectural system defined by a set of constraints for web services, using a stateless design ethos and a standardized approach to building web APIs.</p>\n<p>REST by its very nature is stateless, and is built in such a way that any web service that is compliant with REST can interact in a stateless manner with textual resource representations. These operations are usually defined using GET, POST, PUT, and other HTTP methodologies as a matter of standardized interactions.</p>\n<p>One of the chief properties of REST is the fact that it is <code>hypermedia</code> rich. Hypermedia and REST are so closely reliant, in fact, that Roy Fielding has stated that APIs are technically not RESTful if they do not support hypermedia. This ultimately means that in a REST API, the client and server are <code>loosely coupled</code>, which grants both clients and servers extreme amounts of freedom in resource manipulation. Due to this, rapid iteration, server evolution, resource provision elasticity, and other such elements are enabled and supported.</p>\n<p>REST supports a lot more than we’ll dive into here, but with a <code>layered architecture</code>, efficient <code>caching</code>, and high scalability, REST is a highly discoverable and highly morphable solution to a multitude of issues and constraints. The value of having standardized <code>HTTP</code> verbiage is hard to understate, providing context to the end user, and standardizing most interactions. All told, REST is a very efficient, effective, and powerful solution for the modern microservice API industry.</p>\n<blockquote>\n<p>More on REST: <a href=\"https://nordicapis.com/is-rest-still-a-relevant-api-style/\" target=\"_blank\" rel=\"noopener\">Is REST Still a Relevant API Style?</a></p>\n</blockquote>\n<h2 id=\"Real-World-Example-PayPal\"><a href=\"#Real-World-Example-PayPal\" class=\"headerlink\" title=\"Real-World Example: PayPal\"></a>Real-World Example: PayPal</h2><p>One example of this type of API is the PayPal REST API. PayPal has a strong core business function — provide the integrated systems for payment processing. Accordingly, their APIs have to make this easy. Resources must be easily identifiable, calls must be understood with and without context, and most importantly, a variety of media must be supported in order to effectively handle a wide range of payment types and methodologies.</p>\n<p>To this end, the PayPal API is designed to be easy to understand and easy to integrate with. Look at this example, taken from their documentation, in which a call lists a range of activities within the API:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -v -X GET https://api.sandbox.paypal.com/v1/activities/activities?start_time=2012-01-01T00:00:01.000Z&amp;amp;end_time=2014-10-01T23:59:59.999Z&amp;amp;page_size=10 </span><br><span class=\"line\">-H <span class=\"string\">\"Content-Type: application/json\"</span> </span><br><span class=\"line\">-H <span class=\"string\">\"Authorization: Bearer Access-Token\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Here, we can see the hallmarks of an effective RESTful implementation. We can see a standard HTTP verbiage form in GET doing exactly what GET should do — retrieve a resource. The URI in this case is well defined as “activities”, and allows for specification of a time zone and in-line request constraints for page size. Additionally, the return is in a specified, known, hypermedia-supporting format. This is REST in a nutshell, and is an example of a use case in which a lightweight, stateless system is exactly what is needed to deliver the resources to the end client.</p>\n<h1 id=\"gRPC\"><a href=\"#gRPC\" class=\"headerlink\" title=\"gRPC\"></a>gRPC</h1><p>While REST is decidedly modern, <code>gRPC</code> is actually a new take on an old approach known as <code>RPC</code>, or Remote Procedure Call. RPC is a method for executing a procedure on a remote server, somewhat akin to running a program on a friend’s computer miles from your workstation. This has its own benefits and drawbacks – these very drawbacks were key in the development and implementation of REST, in fact, alongside other issues inherent in systems like SOAP.</p>\n<p>A key difference between gRPC and REST is the way in which RPC defines its contract negotiation. Whereas REST defines its interactions through terms standardized in its requests, RPC functions upon an idea of contracts, in which the negotiation is defined and constricted by the client-server relationship rather than the architecture itself. RPC gives much of the power (and responsibility) to the client for execution, while offloading much of the handling and computation to the remote server hosting the resource.</p>\n<p>For this reason, RPC is very popular for IoT devices and other solutions requiring custom contracted communications for low-power devices. REST is often seen as being overly demanding of resources, whereas RPC can be used even in <code>extremely low-power situations</code>. gRPC is a further evolution on the RPC concept, and adds a wide range of features.</p>\n<p>The biggest feature added by gRPC is the concept of <code>protobufs</code>. Protobufs are language and platform neutral systems used to serialize data, meaning that these communications can be efficiently <code>serialized</code> and communicated in an effective manner. Additionally, gRPC has a very effective and powerful authentication system that utilizes SSL/TLS through Google’s token-based system. Lastly, gRPC is also <code>open source</code>, meaning that the system can be audited, iterated, forked, and more.</p>\n<blockquote>\n<p>More on gRPC: <a href=\"https://nordicapis.com/exploring-the-grpc-framework-for-building-microservices/\" target=\"_blank\" rel=\"noopener\">Exploring The gRPC Framework for Building Microservices</a></p>\n</blockquote>\n<h2 id=\"Example-APIs-–-Google-Cloud-Bugsnag\"><a href=\"#Example-APIs-–-Google-Cloud-Bugsnag\" class=\"headerlink\" title=\"Example APIs – Google Cloud, Bugsnag\"></a>Example APIs – Google Cloud, Bugsnag</h2><p>It’s difficult to demonstrate gRPC in the wild — this comes largely from the fact that, <a href=\"https://grpc.io/docs/\" target=\"_blank\" rel=\"noopener\">according to the gRPC documentation itself</a>, gRPC is typically used in the “last mile of computing.” In other words, gRPC is usually the end system driving and facilitating communication between disparate services and APIs.</p>\n<p>Nonetheless, the gRPC documentation cites that, due to its transportability, gRPC is used within the mobile computing space, as well as an intermediary and processing system for data from the <code>Google Cloud BigTable Client API</code>, the <code>Google Cloud PubSub API</code>, and the <code>Google Cloud Speech API</code>. This makes sense, as the use of standard transport mechanisms and the relatively agile data load gRPC offers can be best utilized for streamlined, active, and repetitive communications.</p>\n<p>Another example of gRPC in production can be found with <a href=\"https://blog.bugsnag.com/using-grpc-in-production/\" target=\"_blank\" rel=\"noopener\">Bugsnag</a>, a stability monitoring service. The Bugsnag engineering team found the initial design process smoother than building RESTfully. Eventually, however they found that the “barrier to entry for developing and testing gRPC was quite high,” due to a lack of <a href=\"https://github.com/grpc-ecosystem/awesome-grpc\" target=\"_blank\" rel=\"noopener\">tutorials and best practices</a>. Overall, the latency improvements and decreased transport costs made using gRPC a huge success for Bugsnag.</p>\n<h1 id=\"GraphQL\"><a href=\"#GraphQL\" class=\"headerlink\" title=\"GraphQL\"></a>GraphQL</h1><p>GraphQL’s approach to the idea of client-server relationships is unique amongst these options, and is somewhat of a reversal of the traditional relationship. With GraphQL, the client determines what data they want, how they want it, and in what format they want it in. This is a reversal of the classic dictation from the server to the client, and allows for a lot of extended functionality. GraphQL is starkly different from REST, which is more an architecture than anything else, and from RPC, in which the contract is negotiated by client and server but largely defined by the resources themselves</p>\n<p>It should be noted that a huge benefit of GraphQL is the fact that, by default, it typically delivers the smallest possible request. REST, on the other hand, typically sends everything it has all at once by default – the most complete request, in other words. Because of this, GraphQL can be more useful in specific use cases where a needed data type is well-defined, and a low data package is preferred.</p>\n<p>That being said, GraphQL’s benefits are often somewhat oversold. The idea that you never have to version is derived from deprecating fields and replacing them with new ones, which is what REST evolution is concerned with. Thus, you shouldn’t think of GraphQL as “better” than REST or the “next step”, as it is often framed, but rather as an alternative option for a “new relationship between client and data”.</p>\n<h2 id=\"Example-API-–-GitHub\"><a href=\"#Example-API-–-GitHub\" class=\"headerlink\" title=\"Example API – GitHub\"></a>Example API – GitHub</h2><p>One example of GraphQL usage can be found in the GitHub API GraphQL API. While the initial RESTful API was powerful, and did what was requested, the GitHub team found that the REST API was inflexible. Speaking on the problem, the team said that the API responses “simultaneously sent too much data and didn’t include data that consumers needed,” which is the classic pain point that caused the development of GraphQL in the first place.</p>\n<p>Accordingly, GitHub needed a way to deliver their content to requesters without requiring multiple distinct, complex calls. They needed to allow users to morph their requests, stating what exactly they needed. And most importantly, they needed the API to still be capable of handling the basic requests that the bulk of their REST API already handled efficiently. To that end, Github added support for GraphQL, delivering these key functionalities.</p>\n<h1 id=\"Webhooks\"><a href=\"#Webhooks\" class=\"headerlink\" title=\"Webhooks\"></a>Webhooks</h1><p>While GraphQL is an option to extend an API, and gRPC is a re-tooling to a classical approach, <code>Webhooks</code> are an entirely different approach to resource provision than anything discussed here. A Webhook is relatively simple – simply put, it’s an HTTP POST that is triggered when an event occurs.</p>\n<p>This is a reversal of the classic client-server relationship — in the classic approach, the client requests data from the server, and the server then provisions that data for the client. Under <a href=\"https://sendgrid.com/blog/whats-webhook/\" target=\"_blank\" rel=\"noopener\">the Webhook paradigm</a>, the server updates a provisioned resource, and this then automatically sent to the client as an update. The server pushes this data. Thereby, the client becomes not a requester, but a passive receiver.</p>\n<p>Ultimately, this reversal can be used to facilitate a lot of communication that would otherwise require more complex requests and constant polling on the remote server. By simply receiving the resource without requesting it directly, you can update remote codebases, distribute resources easily, and even integrate into existing systems to update endpoints and other data concerning the API proper.</p>\n<blockquote>\n<p>Related: WebHooks vs WebSub: <a href=\"https://nordicapis.com/webhooks-vs-websub-which-one-is-better-to-stream-your-events-in-real-time/\" target=\"_blank\" rel=\"noopener\">Which Is Better For Real-Time Event Streaming?</a></p>\n</blockquote>\n<h2 id=\"Example-API-–-Foursquare-and-SendGrid\"><a href=\"#Example-API-–-Foursquare-and-SendGrid\" class=\"headerlink\" title=\"Example API – Foursquare (and SendGrid)\"></a>Example API – Foursquare (and SendGrid)</h2><p>Webhooks are a relatively simple and effective offering, and thus, their implementation is equally simple and effective. The <a href=\"https://developer.foursquare.com/docs\" target=\"_blank\" rel=\"noopener\">Foursquare method</a> of using a webhook is essentially a flow in which the user “checks in,” prompting a webhook to push updated content to other systems and portals. In this way, the user can directly interact with the location that they are visiting while alerting others as to the nature of their relationship with the location via a client-resource analogy.</p>\n<p>As you get further into webhooks as an implementation, you’ll often see more complex integrations. For example, SendGrid uses webhooks to send <a href=\"https://sendgrid.com/docs/API_Reference/Event_Webhook/event.html\" target=\"_blank\" rel=\"noopener\">event data updates</a> to subscribing clients, alerting them to changes to a large number of variables. SendGrid even implements a hybridized webhook method to <a href=\"https://sendgrid.com/docs/API_Reference/Webhooks/inbound_email.html\" target=\"_blank\" rel=\"noopener\">parse emails</a>!</p>\n<h1 id=\"Comparing-Use-Cases-For-REST-GraphQL-Webhooks-and-gRPC\"><a href=\"#Comparing-Use-Cases-For-REST-GraphQL-Webhooks-and-gRPC\" class=\"headerlink\" title=\"Comparing Use Cases For REST, GraphQL, Webhooks, and gRPC\"></a>Comparing Use Cases For REST, GraphQL, Webhooks, and gRPC</h1><p>As you can plainly see, none of these options are truly “better” than the others, but instead fit into unique interaction scenarios. We can summarize these use cases as follows:</p>\n<ul>\n<li><p><code>REST</code>: A stateless architecture for data transfer that is dependent on hypermedia. REST can tie together a wide range of resources that might be requested in a variety of formats for different purposes. REST is fundamentally concerned with stateless resource management, so it’s best used in such situations. Systems requiring rapid iteration and standardized HTTP verbiage will find REST best suited for their purposes.</p>\n</li>\n<li><p><code>gRPC</code>: A nimble and lightweight system for requesting data. gRPC, on the other hand, is best used when a system requires a set amount of data or processing routinely, and in which the requester is either low power or resource-jealous. The IoT is a great example of this.</p>\n</li>\n<li><p><code>GraphQL</code>: An approach wherein the user defines the expected data and format of that data. GraphQL is from Facebook, and that pedigree demonstrates its use case well — situations in which the requester needs the data in a specific format for a specific use. In those cases, those data formats and the relations between them are vitally important, and no other solution provides the same level of interconnected provision of data.</p>\n</li>\n<li><p><code>Webhooks</code>: Data updates to be served automatically, rather than requested. Finally, Webhooks are best used when the API in question primarily updates clients. While such APIs can also have other functions, even RESTful ones, the primary use of a Webhook microservice should be to update clients and provide updated, provisioned data upon the creation of the new, updated resource.</p>\n</li>\n</ul>\n<p>Choosing amongst these specific options is really a matter of aligning your business functions with the appropriate approach, and ensuring that the systems in place respond within the given parameters.</p>\n<h1 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h1><p>Choosing a design approach is perhaps the most important decision made in early API development. It both structures the API, and impacts how the end user will interact with the resources behind the API itself. In other words, this is not just a choice of approach for the developer — this is a choice for how you are going to establish your relationship with your consumers.</p>\n<p>Ultimately, the choice of which solution you go with comes down to what fits your particular use case. Each solution has a very specific purpose, and as such, it’s not fair to say one is better than the other. It is, however, more accurate to say that some are better at doing their core functions than the other solutions — such as the case of many RESTful solutions attempting to mirror RPC functionality.</p>\n<p>Only you can determine which solution is best given your codebase. So, do your research and choose the correct approach from the get-go to reap some serious benefits. Your code will be leaner, more responsive, and tailored to the situation at hand.</p>\n","site":{"data":{}},"excerpt":"<p>With all of the love and proclamations about REST, we can sometimes forget that it’s simply one of many options. REST is a very good standard for a wide variety of APIs, but there are other <code>API design styles</code> for more nuanced scenarios.</p>\n<p>To help API developers make sense of which API design style to use and for what situation, let’s look at <code>REST</code> within the context of three other options – <code>gRPC</code>, <code>GraphQL</code>, and <code>Webhooks</code>. We’ll offer <code>real world examples</code> of REST, GraphQL, gRPC, and Webhooks in practice, and analyze their strengths and weaknesses to highlight what makes each option a good choice.</p>","more":"<p><a href=\"https://nordicapis.com/when-to-use-what-rest-graphql-webhooks-grpc/\" target=\"_blank\" rel=\"noopener\">文章转载</a></p>\n<h1 id=\"REST\"><a href=\"#REST\" class=\"headerlink\" title=\"REST\"></a>REST</h1><p><code>REST</code> is probably the most commonly known item in this piece, as it has become very common amongst web APIs. REST as a concept was first defined by Roy Fielding in his doctoral dissertation in the year 2000. He laid out the groundwork for an architectural system defined by a set of constraints for web services, using a stateless design ethos and a standardized approach to building web APIs.</p>\n<p>REST by its very nature is stateless, and is built in such a way that any web service that is compliant with REST can interact in a stateless manner with textual resource representations. These operations are usually defined using GET, POST, PUT, and other HTTP methodologies as a matter of standardized interactions.</p>\n<p>One of the chief properties of REST is the fact that it is <code>hypermedia</code> rich. Hypermedia and REST are so closely reliant, in fact, that Roy Fielding has stated that APIs are technically not RESTful if they do not support hypermedia. This ultimately means that in a REST API, the client and server are <code>loosely coupled</code>, which grants both clients and servers extreme amounts of freedom in resource manipulation. Due to this, rapid iteration, server evolution, resource provision elasticity, and other such elements are enabled and supported.</p>\n<p>REST supports a lot more than we’ll dive into here, but with a <code>layered architecture</code>, efficient <code>caching</code>, and high scalability, REST is a highly discoverable and highly morphable solution to a multitude of issues and constraints. The value of having standardized <code>HTTP</code> verbiage is hard to understate, providing context to the end user, and standardizing most interactions. All told, REST is a very efficient, effective, and powerful solution for the modern microservice API industry.</p>\n<blockquote>\n<p>More on REST: <a href=\"https://nordicapis.com/is-rest-still-a-relevant-api-style/\" target=\"_blank\" rel=\"noopener\">Is REST Still a Relevant API Style?</a></p>\n</blockquote>\n<h2 id=\"Real-World-Example-PayPal\"><a href=\"#Real-World-Example-PayPal\" class=\"headerlink\" title=\"Real-World Example: PayPal\"></a>Real-World Example: PayPal</h2><p>One example of this type of API is the PayPal REST API. PayPal has a strong core business function — provide the integrated systems for payment processing. Accordingly, their APIs have to make this easy. Resources must be easily identifiable, calls must be understood with and without context, and most importantly, a variety of media must be supported in order to effectively handle a wide range of payment types and methodologies.</p>\n<p>To this end, the PayPal API is designed to be easy to understand and easy to integrate with. Look at this example, taken from their documentation, in which a call lists a range of activities within the API:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -v -X GET https://api.sandbox.paypal.com/v1/activities/activities?start_time=2012-01-01T00:00:01.000Z&amp;amp;end_time=2014-10-01T23:59:59.999Z&amp;amp;page_size=10 </span><br><span class=\"line\">-H <span class=\"string\">\"Content-Type: application/json\"</span> </span><br><span class=\"line\">-H <span class=\"string\">\"Authorization: Bearer Access-Token\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Here, we can see the hallmarks of an effective RESTful implementation. We can see a standard HTTP verbiage form in GET doing exactly what GET should do — retrieve a resource. The URI in this case is well defined as “activities”, and allows for specification of a time zone and in-line request constraints for page size. Additionally, the return is in a specified, known, hypermedia-supporting format. This is REST in a nutshell, and is an example of a use case in which a lightweight, stateless system is exactly what is needed to deliver the resources to the end client.</p>\n<h1 id=\"gRPC\"><a href=\"#gRPC\" class=\"headerlink\" title=\"gRPC\"></a>gRPC</h1><p>While REST is decidedly modern, <code>gRPC</code> is actually a new take on an old approach known as <code>RPC</code>, or Remote Procedure Call. RPC is a method for executing a procedure on a remote server, somewhat akin to running a program on a friend’s computer miles from your workstation. This has its own benefits and drawbacks – these very drawbacks were key in the development and implementation of REST, in fact, alongside other issues inherent in systems like SOAP.</p>\n<p>A key difference between gRPC and REST is the way in which RPC defines its contract negotiation. Whereas REST defines its interactions through terms standardized in its requests, RPC functions upon an idea of contracts, in which the negotiation is defined and constricted by the client-server relationship rather than the architecture itself. RPC gives much of the power (and responsibility) to the client for execution, while offloading much of the handling and computation to the remote server hosting the resource.</p>\n<p>For this reason, RPC is very popular for IoT devices and other solutions requiring custom contracted communications for low-power devices. REST is often seen as being overly demanding of resources, whereas RPC can be used even in <code>extremely low-power situations</code>. gRPC is a further evolution on the RPC concept, and adds a wide range of features.</p>\n<p>The biggest feature added by gRPC is the concept of <code>protobufs</code>. Protobufs are language and platform neutral systems used to serialize data, meaning that these communications can be efficiently <code>serialized</code> and communicated in an effective manner. Additionally, gRPC has a very effective and powerful authentication system that utilizes SSL/TLS through Google’s token-based system. Lastly, gRPC is also <code>open source</code>, meaning that the system can be audited, iterated, forked, and more.</p>\n<blockquote>\n<p>More on gRPC: <a href=\"https://nordicapis.com/exploring-the-grpc-framework-for-building-microservices/\" target=\"_blank\" rel=\"noopener\">Exploring The gRPC Framework for Building Microservices</a></p>\n</blockquote>\n<h2 id=\"Example-APIs-–-Google-Cloud-Bugsnag\"><a href=\"#Example-APIs-–-Google-Cloud-Bugsnag\" class=\"headerlink\" title=\"Example APIs – Google Cloud, Bugsnag\"></a>Example APIs – Google Cloud, Bugsnag</h2><p>It’s difficult to demonstrate gRPC in the wild — this comes largely from the fact that, <a href=\"https://grpc.io/docs/\" target=\"_blank\" rel=\"noopener\">according to the gRPC documentation itself</a>, gRPC is typically used in the “last mile of computing.” In other words, gRPC is usually the end system driving and facilitating communication between disparate services and APIs.</p>\n<p>Nonetheless, the gRPC documentation cites that, due to its transportability, gRPC is used within the mobile computing space, as well as an intermediary and processing system for data from the <code>Google Cloud BigTable Client API</code>, the <code>Google Cloud PubSub API</code>, and the <code>Google Cloud Speech API</code>. This makes sense, as the use of standard transport mechanisms and the relatively agile data load gRPC offers can be best utilized for streamlined, active, and repetitive communications.</p>\n<p>Another example of gRPC in production can be found with <a href=\"https://blog.bugsnag.com/using-grpc-in-production/\" target=\"_blank\" rel=\"noopener\">Bugsnag</a>, a stability monitoring service. The Bugsnag engineering team found the initial design process smoother than building RESTfully. Eventually, however they found that the “barrier to entry for developing and testing gRPC was quite high,” due to a lack of <a href=\"https://github.com/grpc-ecosystem/awesome-grpc\" target=\"_blank\" rel=\"noopener\">tutorials and best practices</a>. Overall, the latency improvements and decreased transport costs made using gRPC a huge success for Bugsnag.</p>\n<h1 id=\"GraphQL\"><a href=\"#GraphQL\" class=\"headerlink\" title=\"GraphQL\"></a>GraphQL</h1><p>GraphQL’s approach to the idea of client-server relationships is unique amongst these options, and is somewhat of a reversal of the traditional relationship. With GraphQL, the client determines what data they want, how they want it, and in what format they want it in. This is a reversal of the classic dictation from the server to the client, and allows for a lot of extended functionality. GraphQL is starkly different from REST, which is more an architecture than anything else, and from RPC, in which the contract is negotiated by client and server but largely defined by the resources themselves</p>\n<p>It should be noted that a huge benefit of GraphQL is the fact that, by default, it typically delivers the smallest possible request. REST, on the other hand, typically sends everything it has all at once by default – the most complete request, in other words. Because of this, GraphQL can be more useful in specific use cases where a needed data type is well-defined, and a low data package is preferred.</p>\n<p>That being said, GraphQL’s benefits are often somewhat oversold. The idea that you never have to version is derived from deprecating fields and replacing them with new ones, which is what REST evolution is concerned with. Thus, you shouldn’t think of GraphQL as “better” than REST or the “next step”, as it is often framed, but rather as an alternative option for a “new relationship between client and data”.</p>\n<h2 id=\"Example-API-–-GitHub\"><a href=\"#Example-API-–-GitHub\" class=\"headerlink\" title=\"Example API – GitHub\"></a>Example API – GitHub</h2><p>One example of GraphQL usage can be found in the GitHub API GraphQL API. While the initial RESTful API was powerful, and did what was requested, the GitHub team found that the REST API was inflexible. Speaking on the problem, the team said that the API responses “simultaneously sent too much data and didn’t include data that consumers needed,” which is the classic pain point that caused the development of GraphQL in the first place.</p>\n<p>Accordingly, GitHub needed a way to deliver their content to requesters without requiring multiple distinct, complex calls. They needed to allow users to morph their requests, stating what exactly they needed. And most importantly, they needed the API to still be capable of handling the basic requests that the bulk of their REST API already handled efficiently. To that end, Github added support for GraphQL, delivering these key functionalities.</p>\n<h1 id=\"Webhooks\"><a href=\"#Webhooks\" class=\"headerlink\" title=\"Webhooks\"></a>Webhooks</h1><p>While GraphQL is an option to extend an API, and gRPC is a re-tooling to a classical approach, <code>Webhooks</code> are an entirely different approach to resource provision than anything discussed here. A Webhook is relatively simple – simply put, it’s an HTTP POST that is triggered when an event occurs.</p>\n<p>This is a reversal of the classic client-server relationship — in the classic approach, the client requests data from the server, and the server then provisions that data for the client. Under <a href=\"https://sendgrid.com/blog/whats-webhook/\" target=\"_blank\" rel=\"noopener\">the Webhook paradigm</a>, the server updates a provisioned resource, and this then automatically sent to the client as an update. The server pushes this data. Thereby, the client becomes not a requester, but a passive receiver.</p>\n<p>Ultimately, this reversal can be used to facilitate a lot of communication that would otherwise require more complex requests and constant polling on the remote server. By simply receiving the resource without requesting it directly, you can update remote codebases, distribute resources easily, and even integrate into existing systems to update endpoints and other data concerning the API proper.</p>\n<blockquote>\n<p>Related: WebHooks vs WebSub: <a href=\"https://nordicapis.com/webhooks-vs-websub-which-one-is-better-to-stream-your-events-in-real-time/\" target=\"_blank\" rel=\"noopener\">Which Is Better For Real-Time Event Streaming?</a></p>\n</blockquote>\n<h2 id=\"Example-API-–-Foursquare-and-SendGrid\"><a href=\"#Example-API-–-Foursquare-and-SendGrid\" class=\"headerlink\" title=\"Example API – Foursquare (and SendGrid)\"></a>Example API – Foursquare (and SendGrid)</h2><p>Webhooks are a relatively simple and effective offering, and thus, their implementation is equally simple and effective. The <a href=\"https://developer.foursquare.com/docs\" target=\"_blank\" rel=\"noopener\">Foursquare method</a> of using a webhook is essentially a flow in which the user “checks in,” prompting a webhook to push updated content to other systems and portals. In this way, the user can directly interact with the location that they are visiting while alerting others as to the nature of their relationship with the location via a client-resource analogy.</p>\n<p>As you get further into webhooks as an implementation, you’ll often see more complex integrations. For example, SendGrid uses webhooks to send <a href=\"https://sendgrid.com/docs/API_Reference/Event_Webhook/event.html\" target=\"_blank\" rel=\"noopener\">event data updates</a> to subscribing clients, alerting them to changes to a large number of variables. SendGrid even implements a hybridized webhook method to <a href=\"https://sendgrid.com/docs/API_Reference/Webhooks/inbound_email.html\" target=\"_blank\" rel=\"noopener\">parse emails</a>!</p>\n<h1 id=\"Comparing-Use-Cases-For-REST-GraphQL-Webhooks-and-gRPC\"><a href=\"#Comparing-Use-Cases-For-REST-GraphQL-Webhooks-and-gRPC\" class=\"headerlink\" title=\"Comparing Use Cases For REST, GraphQL, Webhooks, and gRPC\"></a>Comparing Use Cases For REST, GraphQL, Webhooks, and gRPC</h1><p>As you can plainly see, none of these options are truly “better” than the others, but instead fit into unique interaction scenarios. We can summarize these use cases as follows:</p>\n<ul>\n<li><p><code>REST</code>: A stateless architecture for data transfer that is dependent on hypermedia. REST can tie together a wide range of resources that might be requested in a variety of formats for different purposes. REST is fundamentally concerned with stateless resource management, so it’s best used in such situations. Systems requiring rapid iteration and standardized HTTP verbiage will find REST best suited for their purposes.</p>\n</li>\n<li><p><code>gRPC</code>: A nimble and lightweight system for requesting data. gRPC, on the other hand, is best used when a system requires a set amount of data or processing routinely, and in which the requester is either low power or resource-jealous. The IoT is a great example of this.</p>\n</li>\n<li><p><code>GraphQL</code>: An approach wherein the user defines the expected data and format of that data. GraphQL is from Facebook, and that pedigree demonstrates its use case well — situations in which the requester needs the data in a specific format for a specific use. In those cases, those data formats and the relations between them are vitally important, and no other solution provides the same level of interconnected provision of data.</p>\n</li>\n<li><p><code>Webhooks</code>: Data updates to be served automatically, rather than requested. Finally, Webhooks are best used when the API in question primarily updates clients. While such APIs can also have other functions, even RESTful ones, the primary use of a Webhook microservice should be to update clients and provide updated, provisioned data upon the creation of the new, updated resource.</p>\n</li>\n</ul>\n<p>Choosing amongst these specific options is really a matter of aligning your business functions with the appropriate approach, and ensuring that the systems in place respond within the given parameters.</p>\n<h1 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h1><p>Choosing a design approach is perhaps the most important decision made in early API development. It both structures the API, and impacts how the end user will interact with the resources behind the API itself. In other words, this is not just a choice of approach for the developer — this is a choice for how you are going to establish your relationship with your consumers.</p>\n<p>Ultimately, the choice of which solution you go with comes down to what fits your particular use case. Each solution has a very specific purpose, and as such, it’s not fair to say one is better than the other. It is, however, more accurate to say that some are better at doing their core functions than the other solutions — such as the case of many RESTful solutions attempting to mirror RPC functionality.</p>\n<p>Only you can determine which solution is best given your codebase. So, do your research and choose the correct approach from the get-go to reap some serious benefits. Your code will be leaner, more responsive, and tailored to the situation at hand.</p>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjypn1qk20007y4rbz4k8z4zo","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qk7000dy4rbzcqcmbj0"},{"post_id":"cjypn1qju0000y4rbq6xcr6wc","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qk9000iy4rbmx8y001u"},{"post_id":"cjypn1qk30008y4rbvahixwpk","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkb000ly4rb46r1g0o3"},{"post_id":"cjypn1qk5000by4rbdhcsyqx8","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkc000py4rbbek7qocg"},{"post_id":"cjypn1qjy0002y4rbzujqk38y","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkd000sy4rb71p0avlr"},{"post_id":"cjypn1qk7000cy4rblyhpm1mb","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qke000wy4rbz9s7ab0b"},{"post_id":"cjypn1qk8000hy4rb8wkp1zfd","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkf000zy4rbl14f8nqq"},{"post_id":"cjypn1qk10006y4rb4oqipwoy","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkg0013y4rbp5hmzqml"},{"post_id":"cjypn1qka000ky4rb6qran89p","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkh0016y4rbprmasmdo"},{"post_id":"cjypn1qkc000oy4rbhedy1tjv","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkj001ay4rb1ktso1t5"},{"post_id":"cjypn1qkc000ry4rbyh77vu7x","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkk001dy4rb02wr8118"},{"post_id":"cjypn1qke000vy4rbz5whgxex","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkl001hy4rb0kkbptw4"},{"post_id":"cjypn1qkf000yy4rby7165za0","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkm001ky4rbsiuq4qz9"},{"post_id":"cjypn1qkg0012y4rbr99wozip","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkn001ny4rbg4mmypk1"},{"post_id":"cjypn1qkh0015y4rb8cuh5yt7","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkp001qy4rb0j48cr15"},{"post_id":"cjypn1qki0019y4rb7aumm88d","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkq001ty4rbr4rntxaz"},{"post_id":"cjypn1qkj001cy4rbgpzatdh9","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkq001wy4rbmlobe7d0"},{"post_id":"cjypn1qkl001gy4rbllfi9zdy","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qks001zy4rbs7fq86bb"},{"post_id":"cjypn1qkm001jy4rb04ekan5t","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qks0022y4rbezld0nnb"},{"post_id":"cjypn1qkm001my4rbduqy0xgz","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkt0025y4rbar88wttw"},{"post_id":"cjypn1qko001py4rbk3mr7x6b","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qku002ay4rbsjhxe6z3"},{"post_id":"cjypn1qkp001sy4rbmm9rkas2","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkv002dy4rbx1kw5ufh"},{"post_id":"cjypn1qkq001vy4rbik4ldamt","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkw002iy4rbjk1a5xkf"},{"post_id":"cjypn1qkr001yy4rb0mtoofli","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qkx002ly4rbz0f8gas6"},{"post_id":"cjypn1qkv002cy4rbi67805mi","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qky002oy4rbl8u6ghnx"},{"post_id":"cjypn1qks0021y4rbqlvebu84","category_id":"cjypn1qku0026y4rbj71ystpp","_id":"cjypn1qkz002ty4rb2e6jttf0"},{"post_id":"cjypn1qkw002fy4rbl386uuls","category_id":"cjypn1qku0026y4rbj71ystpp","_id":"cjypn1ql0002wy4rbhd9vymsy"},{"post_id":"cjypn1qkx002ky4rbs4llauiv","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1ql20031y4rbq2yntpjd"},{"post_id":"cjypn1qkt0024y4rbohscc06y","category_id":"cjypn1qkw002gy4rbowly7q02","_id":"cjypn1ql30034y4rbh864ij5z"},{"post_id":"cjypn1qky002ny4rbosw8bje0","category_id":"cjypn1qku0026y4rbj71ystpp","_id":"cjypn1ql40039y4rbr2fuf8tr"},{"post_id":"cjypn1qku0029y4rbx98j8itm","category_id":"cjypn1qku0026y4rbj71ystpp","_id":"cjypn1ql5003cy4rbnzoo8z84"},{"post_id":"cjypn1ql20033y4rbw341rbrf","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1ql6003gy4rbztluq0uk"},{"post_id":"cjypn1qkz002sy4rbw7r9fam2","category_id":"cjypn1ql1002yy4rbxdp1yc61","_id":"cjypn1ql8003ky4rbg6c06a7c"},{"post_id":"cjypn1ql40037y4rb93v70dpo","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1ql9003oy4rb0d9acs35"},{"post_id":"cjypn1ql5003by4rb4ot4s7rc","category_id":"cjypn1qkw002gy4rbowly7q02","_id":"cjypn1qla003sy4rbc85co2e0"},{"post_id":"cjypn1ql0002vy4rb9i8b6yv8","category_id":"cjypn1ql40038y4rbg88emysn","_id":"cjypn1qlb003vy4rbxef9bk1v"},{"post_id":"cjypn1ql6003fy4rboli7fkal","category_id":"cjypn1qk00004y4rbztfp660l","_id":"cjypn1qlc003zy4rbsh7fw3fi"},{"post_id":"cjypn1ql10030y4rbm2nuxw04","category_id":"cjypn1ql6003hy4rbyxnwbn0d","_id":"cjypn1qld0041y4rb3ipsfwmm"},{"post_id":"cjypn1qlb003uy4rbta0rc44a","category_id":"cjypn1ql1002yy4rbxdp1yc61","_id":"cjypn1qle0044y4rbcfca47il"},{"post_id":"cjypn1ql7003jy4rbaeqr9ior","category_id":"cjypn1ql9003py4rb6b8pdn05","_id":"cjypn1qle0047y4rbl9fldqqa"},{"post_id":"cjypn1ql8003my4rby1zy3l2x","category_id":"cjypn1qlc003yy4rb1zxyns09","_id":"cjypn1qlf004ay4rbpnksq5qj"},{"post_id":"cjypn1qla003ry4rbdl9erj4c","category_id":"cjypn1ql9003py4rb6b8pdn05","_id":"cjypn1qlf004ey4rbo537ojqh"},{"post_id":"cjypn1qlw005by4rbpvud3ap2","category_id":"cjypn1qku0026y4rbj71ystpp","_id":"cjypn1qlz005hy4rb4rvavtvs"},{"post_id":"cjypn1qlx005cy4rb1h26vi6f","category_id":"cjypn1ql6003hy4rbyxnwbn0d","_id":"cjypn1qlz005jy4rbqrud1dz3"},{"post_id":"cjypn1qly005ey4rbjc5gl8sc","category_id":"cjypn1ql40038y4rbg88emysn","_id":"cjypn1qm0005ly4rbtrlgjbt4"},{"post_id":"cjypn1qly005gy4rbima2qm3h","category_id":"cjypn1ql40038y4rbg88emysn","_id":"cjypn1qm0005my4rbgpzmss9c"}],"PostTag":[{"post_id":"cjypn1qk5000by4rbdhcsyqx8","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qk8000gy4rbvra2hp7f"},{"post_id":"cjypn1qk5000by4rbdhcsyqx8","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qka000jy4rbdfs59l1z"},{"post_id":"cjypn1qju0000y4rbq6xcr6wc","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkb000ny4rbayhf92fq"},{"post_id":"cjypn1qju0000y4rbq6xcr6wc","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qkc000qy4rbe1eax26j"},{"post_id":"cjypn1qk7000cy4rblyhpm1mb","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkd000uy4rbd4t6uuk6"},{"post_id":"cjypn1qk7000cy4rblyhpm1mb","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qke000xy4rblvsyiekn"},{"post_id":"cjypn1qk8000hy4rb8wkp1zfd","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkf0011y4rbsq19ehwk"},{"post_id":"cjypn1qk8000hy4rb8wkp1zfd","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qkh0014y4rb0asjy4ux"},{"post_id":"cjypn1qka000ky4rb6qran89p","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qki0018y4rbzt7e2k0a"},{"post_id":"cjypn1qka000ky4rb6qran89p","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qkj001by4rburguofkg"},{"post_id":"cjypn1qkc000oy4rbhedy1tjv","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkl001fy4rbxwhpnlza"},{"post_id":"cjypn1qkc000oy4rbhedy1tjv","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qkl001iy4rbqddo71fq"},{"post_id":"cjypn1qjy0002y4rbzujqk38y","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkm001ly4rb63y41j0n"},{"post_id":"cjypn1qjy0002y4rbzujqk38y","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qko001oy4rbiw3gc6ty"},{"post_id":"cjypn1qkc000ry4rbyh77vu7x","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkp001ry4rbofikw23h"},{"post_id":"cjypn1qkc000ry4rbyh77vu7x","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qkq001uy4rbuo5py30j"},{"post_id":"cjypn1qke000vy4rbz5whgxex","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkr001xy4rby7tp8k5a"},{"post_id":"cjypn1qke000vy4rbz5whgxex","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qks0020y4rbwmrjhoyi"},{"post_id":"cjypn1qkf000yy4rby7165za0","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkt0023y4rbdg57f9r0"},{"post_id":"cjypn1qkf000yy4rby7165za0","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qku0028y4rbsp8ct3fl"},{"post_id":"cjypn1qkg0012y4rbr99wozip","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkv002by4rbpxk2fcq3"},{"post_id":"cjypn1qkg0012y4rbr99wozip","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qkv002ey4rbgg3sesaw"},{"post_id":"cjypn1qk10006y4rb4oqipwoy","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkw002jy4rb7qm7u00l"},{"post_id":"cjypn1qk10006y4rb4oqipwoy","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qkx002my4rbuauv2ma0"},{"post_id":"cjypn1qkh0015y4rb8cuh5yt7","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qkz002ry4rbzdbbelzb"},{"post_id":"cjypn1qkh0015y4rb8cuh5yt7","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1ql0002uy4rbgf19uqqx"},{"post_id":"cjypn1qki0019y4rb7aumm88d","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1ql1002zy4rbx7m9thiu"},{"post_id":"cjypn1qki0019y4rb7aumm88d","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1ql20032y4rbl2eow9s2"},{"post_id":"cjypn1qk20007y4rbz4k8z4zo","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1ql40036y4rbno8qss79"},{"post_id":"cjypn1qk20007y4rbz4k8z4zo","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1ql5003ay4rbzjswzqrm"},{"post_id":"cjypn1qkj001cy4rbgpzatdh9","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1ql5003ey4rbzamqhysv"},{"post_id":"cjypn1qkj001cy4rbgpzatdh9","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1ql7003iy4rbpjpz0l9o"},{"post_id":"cjypn1qkl001gy4rbllfi9zdy","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1ql8003ly4rbx1whnvhf"},{"post_id":"cjypn1qkl001gy4rbllfi9zdy","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1ql9003qy4rboku0hkup"},{"post_id":"cjypn1qk30008y4rbvahixwpk","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlb003ty4rbhp5xqe9p"},{"post_id":"cjypn1qk30008y4rbvahixwpk","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qlc003xy4rb32adpuwb"},{"post_id":"cjypn1qkm001jy4rb04ekan5t","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qld0040y4rbcrwzvv1h"},{"post_id":"cjypn1qkm001jy4rb04ekan5t","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qld0043y4rbo9bmnvht"},{"post_id":"cjypn1qkm001my4rbduqy0xgz","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qle0046y4rbwm9m2w7c"},{"post_id":"cjypn1qkm001my4rbduqy0xgz","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qle0049y4rbr21v2ied"},{"post_id":"cjypn1qko001py4rbk3mr7x6b","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlf004by4rbijrjdpbe"},{"post_id":"cjypn1qko001py4rbk3mr7x6b","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qlf004dy4rb76za7iht"},{"post_id":"cjypn1qkp001sy4rbmm9rkas2","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlf004fy4rbc5p7asph"},{"post_id":"cjypn1qkp001sy4rbmm9rkas2","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qlg004hy4rbrc0530jb"},{"post_id":"cjypn1qkq001vy4rbik4ldamt","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlg004iy4rb824de17k"},{"post_id":"cjypn1qkq001vy4rbik4ldamt","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qlg004jy4rb0rkbwskf"},{"post_id":"cjypn1qkr001yy4rb0mtoofli","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlh004ly4rbyt5gnl21"},{"post_id":"cjypn1qkr001yy4rb0mtoofli","tag_id":"cjypn1qk4000ay4rb5h7aun85","_id":"cjypn1qlh004my4rbqzj41l2h"},{"post_id":"cjypn1qkv002cy4rbi67805mi","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlh004ny4rbvjfw3icy"},{"post_id":"cjypn1qks0021y4rbqlvebu84","tag_id":"cjypn1qku0027y4rbptrpugum","_id":"cjypn1qlh004oy4rbtt09jaz8"},{"post_id":"cjypn1qkw002fy4rbl386uuls","tag_id":"cjypn1qku0027y4rbptrpugum","_id":"cjypn1qli004py4rbye9mczsk"},{"post_id":"cjypn1qkt0024y4rbohscc06y","tag_id":"cjypn1qkw002hy4rbidwt6ub8","_id":"cjypn1qli004qy4rbwwjl6x5r"},{"post_id":"cjypn1qky002ny4rbosw8bje0","tag_id":"cjypn1qku0027y4rbptrpugum","_id":"cjypn1qli004ry4rb9me8ni3z"},{"post_id":"cjypn1qku0029y4rbx98j8itm","tag_id":"cjypn1qku0027y4rbptrpugum","_id":"cjypn1qlj004sy4rbsm3w6ifn"},{"post_id":"cjypn1qkx002ky4rbs4llauiv","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlj004ty4rbrawt3xhi"},{"post_id":"cjypn1qkx002ky4rbs4llauiv","tag_id":"cjypn1ql0002xy4rb07m3l1z7","_id":"cjypn1qlj004uy4rbi71z8d7q"},{"post_id":"cjypn1qkz002sy4rbw7r9fam2","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlj004vy4rb4ld4bksc"},{"post_id":"cjypn1qkz002sy4rbw7r9fam2","tag_id":"cjypn1ql30035y4rbp1vrwz62","_id":"cjypn1qlj004wy4rbd2cmbedi"},{"post_id":"cjypn1ql0002vy4rb9i8b6yv8","tag_id":"cjypn1ql5003dy4rbr4syjrih","_id":"cjypn1qlj004xy4rbf9eiue78"},{"post_id":"cjypn1ql8003my4rby1zy3l2x","tag_id":"cjypn1ql0002xy4rb07m3l1z7","_id":"cjypn1qlj004yy4rb15brfts8"},{"post_id":"cjypn1ql10030y4rbm2nuxw04","tag_id":"cjypn1ql9003ny4rbfj1auodg","_id":"cjypn1qlj004zy4rb95ent8vx"},{"post_id":"cjypn1qlb003uy4rbta0rc44a","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlk0050y4rbix8hhj39"},{"post_id":"cjypn1qlb003uy4rbta0rc44a","tag_id":"cjypn1ql30035y4rbp1vrwz62","_id":"cjypn1qlk0051y4rbjomia7be"},{"post_id":"cjypn1ql20033y4rbw341rbrf","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlk0052y4rbace63x59"},{"post_id":"cjypn1ql20033y4rbw341rbrf","tag_id":"cjypn1qlb003wy4rbps58gsm8","_id":"cjypn1qlk0053y4rbpnylctv3"},{"post_id":"cjypn1ql40037y4rb93v70dpo","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlk0054y4rbcond2uxx"},{"post_id":"cjypn1ql40037y4rb93v70dpo","tag_id":"cjypn1qlb003wy4rbps58gsm8","_id":"cjypn1qlk0055y4rbiuxdvik0"},{"post_id":"cjypn1ql5003by4rb4ot4s7rc","tag_id":"cjypn1qle0048y4rbp026jzsv","_id":"cjypn1qlk0056y4rb1odd12i9"},{"post_id":"cjypn1ql6003fy4rboli7fkal","tag_id":"cjypn1qk10005y4rby04nlao2","_id":"cjypn1qlk0057y4rb02zfjyd3"},{"post_id":"cjypn1ql6003fy4rboli7fkal","tag_id":"cjypn1qlb003wy4rbps58gsm8","_id":"cjypn1qlk0058y4rbh8rmrl50"},{"post_id":"cjypn1ql7003jy4rbaeqr9ior","tag_id":"cjypn1qlg004gy4rby3tg5d17","_id":"cjypn1qlk0059y4rbojt4hju9"},{"post_id":"cjypn1qla003ry4rbdl9erj4c","tag_id":"cjypn1qlg004ky4rbljxi8971","_id":"cjypn1qll005ay4rbu1vlsb51"},{"post_id":"cjypn1qlw005by4rbpvud3ap2","tag_id":"cjypn1qku0027y4rbptrpugum","_id":"cjypn1qlx005dy4rbxjqqhy9o"},{"post_id":"cjypn1qlx005cy4rb1h26vi6f","tag_id":"cjypn1ql0002xy4rb07m3l1z7","_id":"cjypn1qly005fy4rbk63qe47u"},{"post_id":"cjypn1qly005ey4rbjc5gl8sc","tag_id":"cjypn1ql0002xy4rb07m3l1z7","_id":"cjypn1qlz005iy4rbq1roylb6"},{"post_id":"cjypn1qly005gy4rbima2qm3h","tag_id":"cjypn1ql0002xy4rb07m3l1z7","_id":"cjypn1qm0005ky4rby96vf6vf"}],"Tag":[{"name":"PHP","_id":"cjypn1qk10005y4rby04nlao2"},{"name":"设计模式","_id":"cjypn1qk4000ay4rb5h7aun85"},{"name":"MySQL","_id":"cjypn1qku0027y4rbptrpugum"},{"name":"JavaScript","_id":"cjypn1qkw002hy4rbidwt6ub8"},{"name":"watch","_id":"cjypn1ql0002xy4rb07m3l1z7"},{"name":"算法","_id":"cjypn1ql30035y4rbp1vrwz62"},{"name":"Docker","_id":"cjypn1ql5003dy4rbr4syjrih"},{"name":"Apache","_id":"cjypn1ql9003ny4rbfj1auodg"},{"name":"内核","_id":"cjypn1qlb003wy4rbps58gsm8"},{"name":"HEXO","_id":"cjypn1qle0048y4rbp026jzsv"},{"name":"manjaro","_id":"cjypn1qlg004gy4rby3tg5d17"},{"name":"ubuntu","_id":"cjypn1qlg004ky4rbljxi8971"}]}}